import{c as re,t as ae,j as y,N as oe,r as se,a8 as R,H as _,G as Ft,w as jt,y as ie}from"./index-C60dBqWj.js";import{b as f,c as le}from"./react-vendor-v5ei6ytj.js";import{W as ce,A as de}from"./WordByWord-DWVliZAU.js";import{I as pe}from"./InterpretationNavbar-mnXKeJny.js";import Tt from"./hindiTranslationService-DcmUgjXI.js";import Mt from"./urduTranslationService-DlGO01py.js";import ht from"./englishTranslationService-Bgl1XdqS.js";const xe=({surahId:z,range:H,interpretationNo:U=1,language:L="en",footnoteId:et=null,interpretationId:nt=null,onClose:Pt,blockRanges:Y=[]})=>{const{user:Rt}=re?.()||{user:null},[gt,mt]=f.useState(!0),[rt,at]=f.useState(null),[V,W]=f.useState([]),[yt,It]=f.useState(""),[ot,xt]=f.useState(!1),[vt,q]=f.useState({id:"",content:null}),[st,T]=f.useState(!1),[G,P]=f.useState({surahId:null,verseId:null}),Nt=f.useRef([]),[Dt,bt]=f.useState(!1),[_t,Vt]=f.useState([]),[B,kt]=f.useState([]),[u,wt]=f.useState(z),[p,j]=f.useState(H),[h,w]=f.useState(U),[s,Wt]=f.useState(L),[k,K]=f.useState(et),[O,Ot]=f.useState(nt),[E,it]=f.useState([]),[lt,zt]=f.useState(!1),St=f.useRef(!1),M=f.useCallback(n=>{if(n==null)return null;const t=String(n).trim();if(!t)return null;if(/^\d+$/.test(t)){const a=parseInt(t,10);return Number.isFinite(a)?{start:a,end:a,label:t}:null}const e=t.match(/^(\d+)\s*-\s*(\d+)$/);if(e){const a=parseInt(e[1],10),i=parseInt(e[2],10);if(Number.isFinite(a)&&Number.isFinite(i))return{start:a,end:i,label:a===i?`${a}`:`${a}-${i}`}}return null},[]),C=f.useMemo(()=>{if(!Array.isArray(Y)||Y.length===0)return[];const n=t=>{if(typeof t=="string"||typeof t=="number")return M(t);if(t&&typeof t=="object"){const e=t.AyaFrom??t.ayafrom??t.from??t.start??t.begin??t.AyaFromId,a=t.AyaTo??t.ayato??t.to??t.end??t.finish??t.AyaToId??e;if(e==null&&typeof t.Range=="string")return M(t.Range);if(e==null&&typeof t.range=="string")return M(t.range);const i=Number.parseInt(e,10),r=Number.parseInt(a,10);if(Number.isFinite(i)&&Number.isFinite(r))return{start:i,end:r,label:i===r?`${i}`:`${i}-${r}`}}return null};return Y.map(t=>n(t)).filter(Boolean).sort((t,e)=>t.start-e.start).map((t,e)=>({...t,index:e}))},[Y,M]),D=f.useCallback(async(n,t)=>{try{const[e,a]=t.includes("-")?t.split("-").map(r=>parseInt(r.trim(),10)):[parseInt(t,10),parseInt(t,10)],i=[];for(let r=e;r<=a;r++)try{const o=await ht.getAyahTranslation(n,r);if(o){const c=/<sup[^>]*foot_note="([^"]+)"[^>]*>(\d+)<\/sup>/g;let l;for(;(l=c.exec(o))!==null;){const d=l[1],m=parseInt(l[2],10);i.push({footnoteId:d,footnoteNumber:m,ayah:r})}}}catch(o){console.warn(`[BlockInterpretationModal] Failed to fetch translation for ayah ${r}:`,o)}return i.sort((r,o)=>r.ayah!==o.ayah?r.ayah-o.ayah:r.footnoteNumber-o.footnoteNumber),i}catch(e){return console.error("[BlockInterpretationModal] ❌ Error extracting footnotes from range:",e),[]}},[]),$t=f.useCallback(async n=>{if(!C.length||!p)return!1;const t=M(p);if(!t)return!1;const e=C.findIndex(i=>i.label===t.label||i.start===t.start&&i.end===t.end);if(e===-1)return!1;let a=e+n;for(;a>=0&&a<C.length;){const i=C[a];try{const r=await D(u,i.label);if(Array.isArray(r)&&r.length>0){const o=n>0?r[0]:r[r.length-1];return j(i.label),K(o.footnoteId),w(o.footnoteNumber),it(r),!0}}catch(r){console.warn(`[BlockInterpretationModal] Failed to load footnotes for block ${i.label}:`,r)}a+=n}return!1},[C,p,u,D,M]);f.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),f.useEffect(()=>{wt(z),j(H),w(U),Wt(L),K(et)},[z,H,U,L,et]),f.useEffect(()=>{Ot(nt)},[z,H,U,L,nt]);const ct=n=>{n&&(n.preventDefault(),n.stopPropagation()),!St.current&&(St.current=!0,zt(!0),setTimeout(()=>{Pt()},200))};f.useEffect(()=>{u&&(async()=>{try{const t=await se();Vt(t.map(a=>({value:a.id,label:`${a.id}- ${a.english||"Surah"}`})));const e=t.find(a=>a.id===Number(u));It(`${u}- ${e?.english||"Surah"}`)}catch{It(`${u}- Surah`)}})()},[u]),f.useEffect(()=>{let n=!0;return(async()=>{try{const t=await ae();if(!n)return;const a=t.find(r=>r.number===Number(u))?.ayahs||286,i=Array.from({length:a},(r,o)=>String(o+1));kt(i)}catch{n&&kt(Array.from({length:50},(e,a)=>String(a+1)))}})(),()=>{n=!1}},[u]),f.useEffect(()=>{(async()=>{if(!(!u||!p))try{mt(!0),at(null),W([]);let t;if(s==="mal")if(/^\d+$/.test(p)){const o=await R(u,parseInt(p,10),"mal");if(h&&o.length>0){const c=o.filter(l=>l.InterpretationNo===String(h)||l.interptn_no===h);t=c.length>0?c:[o[0]]}else t=o}else t=await _(u,p,h,"mal");else if(s==="hi")if(/^\d+$/.test(p)){const o=await Tt.getExplanation(u,parseInt(p,10));t=o&&o!=="N/A"?[{Interpretation:o,AudioIntrerptn:o,text:o,content:o,InterpretationNo:h}]:[]}else{const[o,c]=p.split("-").map(d=>parseInt(d.trim(),10));t=(await Tt.fetchBlockwiseHindi(u,o,c)).map(d=>({Interpretation:d.explanation,AudioIntrerptn:d.explanation,text:d.explanation,content:d.explanation,InterpretationNo:h,ayah:d.ayah}))}else if(s==="ur")if(/^\d+$/.test(p)){const o=await Mt.getExplanation(u,parseInt(p,10));t=o&&o!=="N/A"?[{Interpretation:o,AudioIntrerptn:o,text:o,content:o,InterpretationNo:h}]:[]}else{const[o,c]=p.split("-").map(d=>parseInt(d.trim(),10));t=(await Mt.fetchBlockwiseUrdu(u,o,c)).map(d=>({Interpretation:d.translation,AudioIntrerptn:d.translation,text:d.translation,content:d.translation,InterpretationNo:h,ayah:d.ayah}))}else if(s==="E"||s==="en")if(k||O)try{let r="";O?r=await ht.getInterpretationById(O):k&&(r=await ht.getExplanation(parseInt(k,10))),t=r&&r!=="N/A"?[{Interpretation:r,AudioIntrerptn:r,text:r,content:r,InterpretationNo:String(h),footnoteId:k,interpretationId:O}]:[]}catch(r){throw console.error("[BlockInterpretationModal] ❌ Error fetching English interpretation:",{error:r,message:r?.message,footnoteId:k,interpretationId:O}),r}else{const r=/^\d+$/.test(p),o="E";try{r?t=await Ft(u,parseInt(p,10),h,o):t=await _(u,p,h,o)}catch(c){throw console.error("[BlockInterpretationModal] ❌ Error fetching interpretation:",{error:c,message:c?.message,surahId:u,range:p,interpretationNo:h,langCode:o}),c}}else{const r=/^\d+$/.test(p),o=s;try{r?t=await Ft(u,parseInt(p,10),h,o):t=await _(u,p,h,o)}catch(c){throw console.error("[BlockInterpretationModal] ❌ Error fetching interpretation:",c),c}}const e=Array.isArray(t)?t:t?[t]:[];if(!(e.length>0&&e[0]&&(e[0].Interpretation&&e[0].Interpretation!==""&&e[0].Interpretation!==null&&e[0].Interpretation!==void 0||e[0].InterpretationText&&e[0].InterpretationText!==""&&e[0].InterpretationText!==null&&e[0].InterpretationText!==void 0||e[0].interpret_text&&e[0].interpret_text!==""&&e[0].interpret_text!==null&&e[0].interpret_text!==void 0||e[0].text&&e[0].text!==""&&e[0].text!==null&&e[0].text!==void 0))){console.warn(`[BlockInterpretationModal] ⚠️ No interpretation ${h} available for range ${p}`,{language:s,items:e});const r=p.match(/^(\d+)(?:-(\d+))?$/),o=r?parseInt(r[1],10):null,c=r&&r[2]?parseInt(r[2],10):o,l=o===c;let d=!1;if(o&&(s==="mal"||s==="E"||s==="en"))try{if(l){const g=await R(u,o,s==="E"||s==="en"?"E":"mal");if(g&&g.length>0){const b=($,N)=>{const x=[$.InterpretationNo,$.interpretationNo,$.interptn_no,$.resolvedInterpretationNo,N+1];for(const F of x){const A=parseInt(String(F),10);if(!isNaN(A)&&A>=1&&A<=20)return A}return N+1<=20?N+1:1};let I=g.find(($,N)=>b($,N)===h);I||(I=g[0]);const v=g.indexOf(I),S=b(I,v);w(S),W([I]),d=!0;return}}else{const g=await R(u,o,s==="E"||s==="en"?"E":"mal");if(g&&g.length>0){const b=(I,v)=>{const S=[I.InterpretationNo,I.interpretationNo,I.interptn_no,I.resolvedInterpretationNo,v+1];for(const $ of S){const N=parseInt(String($),10);if(!isNaN(N)&&N>=1&&N<=20)return N}return v+1<=20?v+1:1};for(let I=0;I<g.length;I++){const v=g[I],S=b(v,I);try{const N=await _(u,p,S,s==="E"||s==="en"?"E":"mal"),x=Array.isArray(N)?N:[N];if(x.length>0&&x[0]&&Object.keys(x[0]).length>0&&(x[0].Interpretation||x[0].interpret_text||x[0].text||"").trim()!==""){w(S),W(x),d=!0;return}}catch{continue}}}}}catch(m){console.warn("Failed to check available interpretations:",m)}if(!d)if(h!==1){w(1);return}else at(`No interpretation available for verses ${p}.`),W([])}else W(e)}catch(t){console.error(`[BlockInterpretationModal] ❌ Failed to load interpretation ${h}:`,{error:t,message:t?.message,stack:t?.stack,surahId:u,range:p,interpretationNo:h,language:s});let e="Failed to load interpretation";t.message?.includes("500")?e=`Server error loading interpretation ${h}. Please try again later.`:t.message?.includes("404")?e=`Interpretation ${h} not found for this selection.`:t.message?.includes("network")||t.message?.includes("fetch")?e="Network error. Please check your connection.":e=`Interpretation ${h} is not available.`,at(e)}finally{mt(!1)}})()},[u,p,h,s,k]);const J=()=>{Nt.current.forEach(n=>{if(!n)return;n.querySelectorAll("sup, a").forEach(e=>{const a=(e.innerText||e.textContent||"").trim();a&&(e.style.removeProperty("color"),e.style.removeProperty("text-decoration"),e.style.removeProperty("cursor"),e.style.removeProperty("font-weight"),/^N\d+$/.test(a)?(e.setAttribute("data-type","note"),e.setAttribute("data-value",a),e.onclick=pt):(/^\(?\d+\s*[:：]\s*\d+\)?$/.test(a)||/^\d+\s*[:：]\s*\d+$/.test(a)||/അശ്ശുഅറാഅ്,?\s*സൂക്തം:\s*\d+\s+\d+:\d+/.test(a)||/സൂക്തം:\s*\d+\s+\d+:\d+/.test(a))&&(e.setAttribute("data-type","verse"),e.setAttribute("data-value",a),e.onclick=pt))})})};f.useEffect(()=>{V.length>0&&(J(),setTimeout(J,100))},[V]),f.useEffect(()=>{!ot&&!st&&V.length>0&&(J(),setTimeout(J,100))},[ot,st]);const dt=async n=>{q({id:n,content:"Loading..."}),xt(!0);try{const t=await ie(n),e=t?.NoteText||t?.note_text||t?.content||t?.html||t?.text||t?.body||t?.description||t?.note||(typeof t=="string"?t:null);q(e&&e!=="Note content not available"?{id:n,content:e}:{id:n,content:'<p style="color: #666;">Note content is not available.</p>'})}catch(t){console.error(`Failed to fetch note ${n}:`,t.message),q({id:n,content:`
          <div class="note-content">
            <h3 style="color: #2AA0BF; margin-bottom: 10px;">Note ${n}</h3>
            <p style="color: #666;">Note content is temporarily unavailable. Please try again later.</p>
            <p style="color: #999; font-size: 0.9em; margin-top: 10px;">Error: ${t.message||"Unknown error"}</p>
          </div>
        `})}},pt=n=>{n.preventDefault(),n.stopPropagation();const t=n.target,e=t.getAttribute("data-type"),a=t.getAttribute("data-value"),i=t.innerText||t.textContent||"";if(!i)return;if(e==="verse"||e==="range"){const c=a||i,l=c.match(/അശ്ശുഅറാഅ്,?\s*സൂക്തം:\s*(\d+)\s+(\d+):(\d+)/)||c.match(/സൂക്തം:\s*(\d+)\s+(\d+):(\d+)/);if(l){const[,m,g]=l;P({surahId:parseInt(m,10),verseId:parseInt(g,10)}),T(!0);return}const d=c.match(/^\(?(\d+)\s*[:：]\s*(\d+)\)?$/);if(d){const[,m,g]=d;P({surahId:parseInt(m,10),verseId:parseInt(g,10)}),T(!0);return}}else if(e==="note"){dt(a||i);return}const r=i.match(/അശ്ശുഅറാഅ്,?\s*സൂക്തം:\s*(\d+)\s+(\d+):(\d+)/)||i.match(/സൂക്തം:\s*(\d+)\s+(\d+):(\d+)/);if(r){const[,c,l]=r;P({surahId:parseInt(c,10),verseId:parseInt(l,10)}),T(!0);return}const o=i.match(/^\(?(\d+)\s*[:：]\s*(\d+)\)?$/);if(o){const[,c,l]=o;P({surahId:parseInt(c,10),verseId:parseInt(l,10)}),T(!0);return}dt(i)},Ht=n=>{const t=n.target,e=t.closest(".verse-reference-link");if(e){n.preventDefault(),n.stopPropagation();const c=e.getAttribute("data-surah"),l=e.getAttribute("data-ayah");if(c&&l){P({surahId:parseInt(c,10),verseId:parseInt(l,10)}),T(!0);return}}if(t.tagName==="SUP"||t.tagName==="A"){pt(n);return}const a=t.innerText||t.textContent||"",i=a.match(/^([NHB])(\d+)$/i);if(i){const c=i[1].toUpperCase(),l=i[2],d=`${c}${l}`;dt(d);return}const r=a.match(/അശ്ശുഅറാഅ്,?\s*സൂക്തം:\s*(\d+)\s+(\d+):(\d+)/)||a.match(/സൂക്തം:\s*(\d+)\s+(\d+):(\d+)/);if(r){const[,c,l]=r;P({surahId:parseInt(c,10),verseId:parseInt(l,10)}),T(!0);return}const o=a.match(/\(?(\d+)\s*[:：]\s*(\d+)\)?/);if(o){const[,c,l]=o;P({surahId:parseInt(c,10),verseId:parseInt(l,10)}),T(!0);return}},Ut=n=>{wt(parseInt(n,10))},Lt=n=>{j(String(n))};f.useEffect(()=>{(s==="E"||s==="en")&&k&&p?(async()=>{const t=await D(u,p);it(t)})():it([])},[u,p,s,k,D]);const ut=f.useCallback(async n=>{if(!C.length||!p)return!1;const t=M(p);if(!t)return!1;const e=C.findIndex(i=>i.label===t.label||i.start===t.start&&i.end===t.end);if(e===-1)return!1;let a=e+n;for(;a>=0&&a<C.length;){const i=C[a];try{const r=await D(u,i.label);if(Array.isArray(r)&&r.length>0)return!0}catch{}a+=n}return!1},[C,p,u,D,M]),[Yt,Q]=f.useState(!0),[qt,X]=f.useState(!0);f.useEffect(()=>{if((s==="E"||s==="en")&&k&&C.length>0){let n=!1;return(async()=>{if(E.length===0){Q(!0),X(!0);return}const e=E.findIndex(r=>r.footnoteId===k);if(e>=0&&e<E.length-1)n||Q(!0);else{const r=await ut(1);n||Q(r)}if(e>0)n||X(!0);else{const r=await ut(-1);n||X(r)}})(),()=>{n=!0}}else Q(!0),X(!0)},[s,k,E,C,ut]);const At=async()=>{if((s==="E"||s==="en")&&k){if(E.length===0)console.warn("[BlockInterpretationModal] ⚠️ No footnotes loaded for range:",p);else{const e=E.findIndex(a=>a.footnoteId===k);if(e>0){const a=E[e-1];K(a.footnoteId),w(a.footnoteNumber);return}}if(await $t(-1))return}if(h>1){w(h-1);return}const n=String(p);if(/^\d+$/.test(n)){const t=parseInt(n,10);if(t<=1){alert("Already at the first verse");return}const e=t-1;if(j(String(e)),s==="mal")try{const a=await R(u,e,"mal");if(a&&a.length>0){const i=a[a.length-1],r=(l,d)=>{const m=[l.InterpretationNo,l.interpretationNo,l.interptn_no,l.resolvedInterpretationNo,d+1];for(const g of m){const b=parseInt(String(g),10);if(!isNaN(b)&&b>=1&&b<=20)return b}return d+1<=20?d+1:1},o=a.length-1,c=r(i,o);w(c)}}catch(a){console.warn("Failed to fetch available interpretations for previous verse:",a)}}else if(/^(\d+)-(\d+)$/.test(n)){const t=n.match(/^(\d+)-(\d+)$/);if(t){const[,e,a]=t,i=parseInt(e,10),o=parseInt(a,10)-i+1;if(i<=1){alert("Already at the first block");return}const c=Math.max(1,i-o),l=c+o-1;if(j(`${c}-${l}`),s==="mal")try{const d=await R(u,c,"mal");if(d&&d.length>0){const m=d[d.length-1],g=(v,S)=>{const $=[v.InterpretationNo,v.interpretationNo,v.interptn_no,v.resolvedInterpretationNo,S+1];for(const N of $){const x=parseInt(String(N),10);if(!isNaN(x)&&x>=1&&x<=20)return x}return S+1<=20?S+1:1},b=d.length-1,I=g(m,b);w(I)}}catch(d){console.warn("Failed to fetch available interpretations for previous block:",d)}}}},Et=async()=>{if((s==="E"||s==="en")&&k){if(E.length===0)console.warn("[BlockInterpretationModal] ⚠️ No footnotes loaded for range:",p);else{const c=E.findIndex(l=>l.footnoteId===k);if(c>=0&&c<E.length-1){const l=E[c+1];K(l.footnoteId),w(l.footnoteNumber);return}}if(await $t(1))return}const n=h+1,t=p.match(/^(\d+)(?:-(\d+))?$/),e=t?parseInt(t[1],10):null,a=t&&t[2]?parseInt(t[2],10):e,i=e===a;if(e&&s==="mal")try{let o=!1;if(i){const l=await R(u,e,"mal");if(l&&l.length>0){const d=(m,g)=>{const b=[m.InterpretationNo,m.interpretationNo,m.interptn_no,m.resolvedInterpretationNo,g+1];for(const I of b){const v=parseInt(String(I),10);if(!isNaN(v)&&v>=1&&v<=20)return v}return g+1<=20?g+1:1};for(let m=0;m<l.length;m++)if(d(l[m],m)===n){o=!0;break}}}else try{const l=await _(u,p,n,"mal"),d=Array.isArray(l)?l:[l];d.length>0&&d[0]&&Object.keys(d[0]).length>0&&(d[0].Interpretation||d[0].interpret_text||d[0].text||"").trim()!==""&&(o=!0)}catch{o=!1}if(o){w(n);return}const c=String(p);if(/^(\d+)-(\d+)$/.test(c)){const l=c.match(/^(\d+)-(\d+)$/);if(l){const[,d,m]=l,g=parseInt(d,10),b=parseInt(m,10),I=b-g+1,v=B.length>0?parseInt(B[B.length-1],10):286;if(b<v){const S=g+I,$=Math.min(v,S+I-1),N=`${S}-${$}`;try{if(S===$){const x=await R(u,S,"mal");if(x&&x.length>0){const F=(A,Z)=>{const ee=[A.InterpretationNo,A.interpretationNo,A.interptn_no,A.resolvedInterpretationNo,Z+1];for(const ne of ee){const tt=parseInt(String(ne),10);if(!isNaN(tt)&&tt>=1&&tt<=20)return tt}return Z+1<=20?Z+1:1};for(let A=0;A<x.length;A++)if(F(x[A],A)===n){j(N),w(n);return}}}else{const x=await _(u,N,n,"mal"),F=Array.isArray(x)?x:[x];if(F.length>0&&F[0]&&Object.keys(F[0]).length>0&&(F[0].Interpretation||F[0].interpret_text||F[0].text||"").trim()!==""){j(N),w(n);return}}}catch{}}}}}catch(o){console.warn("Failed to fetch available interpretations for next:",o)}const r=String(p);if(/^\d+$/.test(r)){const o=parseInt(r,10),c=B.length>0?parseInt(B[B.length-1],10):286;if(o>=c){alert("Already at the last verse of this surah");return}const l=o+1;j(String(l)),w(1)}else if(/^(\d+)-(\d+)$/.test(r)){const o=r.match(/^(\d+)-(\d+)$/);if(o){const[,c,l]=o,d=parseInt(c,10),m=parseInt(l,10),g=m-d+1,b=B.length>0?parseInt(B[B.length-1],10):286;if(m>=b){alert("Already at the last block of this surah");return}const I=d+g,v=Math.min(b,I+g-1);j(`${I}-${v}`),w(1)}}},Gt=async()=>{try{bt(!0);const n=jt.getEffectiveUserId(Rt);await jt.addBlockInterpretationBookmark(n,u,p,yt,h,s),alert(`Saved interpretation for Surah ${u}, verses ${p}`)}catch(n){console.error("Failed to bookmark interpretation",n),alert("Failed to save interpretation bookmark")}finally{setTimeout(()=>bt(!1),300)}},Kt=async()=>{const n=`Interpretation ${h} — Surah ${u} • Range ${p}`,t=`${window.location.origin}/interpretation-blockwise?surahId=${u}&range=${p}&ipt=${h}&lang=${s}`;try{navigator.share?await navigator.share({title:document.title||"Thafheem",text:n,url:t}):(await navigator.clipboard.writeText(`${n}
${t}`),alert("Link copied to clipboard"))}catch(e){console.error("Share failed",e),alert("Share failed: "+e.message)}},[Jt,Ct]=f.useState(!1),[Qt,Bt]=f.useState(1),Xt=()=>{const n=/^\d+/.exec(String(p))?.[0]||"1";Bt(parseInt(n)),Ct(!0)},ft=n=>{if(!n||typeof n!="string")return n;const t=/\(?(\d+)\s*[:：]\s*(\d+)\)?/g;return n.replace(t,(e,a,i)=>e.includes("verse-reference-link")?e:`<span class="verse-reference-link inline-block cursor-pointer text-cyan-500 hover:text-cyan-600 dark:text-cyan-400 dark:hover:text-cyan-300 underline decoration-cyan-500/50 hover:decoration-cyan-600 dark:decoration-cyan-400/50 dark:hover:decoration-cyan-300 transition-colors" data-surah="${a}" data-ayah="${i}" title="Click to view Surah ${a}, Verse ${i}">${e}</span>`)},Zt=n=>{if(n==null)return"";if(typeof n=="string")return ft(n);const t=["interpret_text","InterpretText","Interpret_Text","interpretation","Interpretation","text","Text","content","Content","meaning","Meaning","body","Body","desc","Desc","description","Description"];for(const e of t)if(typeof n[e]=="string"&&n[e].trim().length>0)return ft(n[e]);for(const[e,a]of Object.entries(n))if(typeof a=="string"&&a.trim().length>20)return ft(a);return console.warn("⚠️ No valid interpretation text found in item:",n),`<p class="text-gray-500 italic">No interpretation content available for interpretation ${h}</p>`},te=document.getElementById("modal-root")||document.body;return le.createPortal(y.jsxs(y.Fragment,{children:[y.jsx("style",{children:`
        /* Entry animations */
        @keyframes backdropFadeIn {
          from {
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }
        @keyframes modalSlideUp {
          from {
            opacity: 0;
            transform: translateY(30px) scale(0.95);
          }
          to {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
        }
        @keyframes modalSlideDown {
          from {
            opacity: 1;
            transform: translateY(0) scale(1);
          }
          to {
            opacity: 0;
            transform: translateY(30px) scale(0.95);
          }
        }
        .animate-backdrop-fade-in {
          animation: backdropFadeIn 0.2s ease-out;
        }
        .animate-modal-slide-up {
          animation: modalSlideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .animate-modal-slide-down {
          animation: modalSlideDown 0.2s ease-in;
        }
        
        /* Specific styling for note and verse markers in interpretation content */
        .interpretation-content sup[data-type="note"], 
        .interpretation-content a[data-type="note"],
        .interpretation-content sup[data-type="verse"], 
        .interpretation-content a[data-type="verse"] {
          transition: all 0.2s ease !important;
          color: #2AA0BF !important;
          font-weight: 600 !important;
          cursor: pointer !important;
          text-decoration: none !important;
        }
        
        .interpretation-content sup[data-type="note"]:hover, 
        .interpretation-content a[data-type="note"]:hover,
        .interpretation-content sup[data-type="verse"]:hover, 
        .interpretation-content a[data-type="verse"]:hover {
          color: #1e7a8c !important;
          text-decoration: underline !important;
          transform: scale(1.05) !important;
        }
        
        /* Fallback for elements without data-type but with note/verse patterns */
        .interpretation-content sup:not([data-type]), 
        .interpretation-content a:not([data-type]) {
          color: #2AA0BF !important;
          font-weight: 600 !important;
          cursor: pointer !important;
          text-decoration: none !important;
          transition: all 0.2s ease !important;
        }
        
        .interpretation-content sup:not([data-type]):hover, 
        .interpretation-content a:not([data-type]):hover {
          color: #1e7a8c !important;
          text-decoration: underline !important;
          transform: scale(1.05) !important;
        }
        `}),y.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[y.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:ct,style:{pointerEvents:lt?"none":"auto"}}),y.jsxs("div",{className:`relative w-full ${s==="E"||s==="en"?"sm:w-auto sm:max-w-2xl":"sm:w-auto sm:max-w-4xl xl:max-w-[1073px]"} ${s==="E"||s==="en"?"sm:max-h-[95vh]":"max-h-[85vh] sm:max-h-[90vh]"} bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col animate-slideUp sm:animate-fadeIn ${s==="E"||s==="en"?"":"overflow-hidden"} ${lt?"animate-slideDown sm:animate-fadeOut":""}`,onClick:n=>n.stopPropagation(),style:{...s==="E"||s==="en"?{maxWidth:"42rem",minWidth:"min(90vw, 20rem)",height:"auto",maxHeight:"95vh"}:{}},children:[y.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 sm:hidden cursor-grab active:cursor-grabbing",onClick:ct,style:{pointerEvents:lt?"none":"auto"},children:y.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),y.jsx("div",{className:"flex-shrink-0 z-10 bg-white dark:bg-gray-900",children:y.jsx(pe,{interpretationNumber:h,surahName:yt,verseRange:p.replace(/-/g," - "),language:s,onClose:ct,onBookmark:Gt,onShare:Kt,onWordByWord:Xt,bookmarking:Dt,surahOptions:_t,rangeOptions:B,onPickSurah:Ut,onPickRange:Lt,onPrev:(s==="E"||s==="en")&&k&&E.length>0?qt?At:null:At,onNext:(s==="E"||s==="en")&&k&&E.length>0?Yt?Et:null:Et,isModal:!0,hideTitle:!!k},`navbar-${u}-${p}-${h}`)}),y.jsxs("div",{className:`${s==="E"||s==="en"?"overflow-y-auto":"flex-1 overflow-y-auto"} px-4 sm:px-6 py-6 sm:py-8 ${s==="E"||s==="en"?"":"min-h-0"}`,style:{...s==="E"||s==="en"?{maxHeight:"calc(95vh - 120px)"}:{}},children:[gt&&y.jsx("div",{className:"flex items-center justify-center py-8",children:y.jsxs("div",{className:"text-center",children:[y.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),y.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading interpretation..."})]})}),rt&&y.jsxs("div",{className:"text-center py-8",children:[y.jsx("p",{className:"text-red-500 dark:text-red-400 text-lg mb-2",children:"Failed to load interpretation"}),y.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:rt}),y.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Try Again"})]}),!gt&&!rt&&V.length===0&&y.jsx("div",{className:"text-center py-10 text-gray-600 dark:text-gray-300",children:"No interpretation found for this selection."}),y.jsx("div",{className:"font-poppins space-y-6 sm:space-y-8",children:V.map((n,t)=>y.jsx("div",{className:"mb-6 sm:mb-8",children:y.jsx("div",{className:"interpretation-content text-gray-700 leading-relaxed dark:text-gray-300 text-sm sm:text-base prose dark:prose-invert max-w-none",ref:e=>Nt.current[t]=e,onClick:Ht,style:{pointerEvents:"auto",position:"relative",zIndex:1},dangerouslySetInnerHTML:{__html:Zt(n)}})},`${u}-${p}-${h}-${n?.ID||n?.id||t}`))},`block-${u}-${p}-${h}`)]}),Jt&&y.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-start justify-center z-[100000] pt-24 sm:pt-28 lg:pt-32 p-4 overflow-hidden",children:y.jsx(ce,{selectedVerse:Qt,surahId:u,onClose:()=>Ct(!1),onNavigate:Bt,onSurahChange:()=>{}})})]})]}),y.jsx(oe,{isOpen:ot,onClose:()=>xt(!1),noteId:vt.id,noteContent:vt.content}),st&&G.surahId&&G.verseId&&y.jsx(de,{surahId:G.surahId,verseId:G.verseId,onClose:()=>T(!1),interpretationNo:h,language:s})]}),te)};export{xe as B};
