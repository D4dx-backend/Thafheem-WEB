import{r as o,a as At,b as Tt,g as Et,u as Bt,d as Ct,c as It,j as e,T as $t,C as Ft,A as Pt,P as Wt,B as Lt,F as Dt,n as Rt,x as ke,o as Mt,p as Ye,X as _t,D as zt,v as Ut,E as Vt}from"./index-D2bCerlO.js";import{u as qt,T as Ne}from"./Toast-PYsKcHUz.js";import{W as Ot}from"./WordByWord-DQOcv8oE.js";import Je from"./InterpretationBlockwise-Dxrw9J6V.js";import{a as Ze,D as Qt,B as Ht,C as Kt,A as je}from"./LoadingSkeleton-Do9US71E.js";import Xt from"./StickyAudioPlayer-g2uuUt3z.js";import Se from"./englishTranslationService-Ju4YN8zF.js";import{g as Gt,s as Yt}from"./surahNameUtils-CNmXwDjY.js";import{C as et}from"./chevron-left-BigIIEdd.js";import"./tamilWordByWordService-SO7jYcnK.js";import"./hindiWordByWordService-0Fk5bvry.js";import"./banglaWordByWordService-B0pxDZ7G.js";import"./banglaTranslationService-dFx8O3w7.js";import"./apiService-CutSZesJ.js";import"./tamilTranslationService-54WtXJFr.js";import"./hindiTranslationService-BBKiYQvL.js";import"./urduTranslationService-CWrhNGUr.js";import"./BlockInterpretationModal-DixLp3B3.js";import"./InterpretationNavbar-Bey27izA.js";import"./WordByWordIcon-DzsIehi4.js";import"./volume-x-DcjtUz6Y.js";import"./volume-2-DEtoG3TP.js";import"./skip-forward-kQrQ6tj_.js";import"./surahNameUnicodes-C_pntk6C.js";const Pa=()=>{const[Jt,Zt]=o.useState("Translation"),[ea,ta]=o.useState("Block wise"),[tt,oe]=o.useState(!1),[ie,Ae]=o.useState(null),[Q,at]=o.useState("al-hudaify"),[P,le]=o.useState(["quran"]),[H,rt]=o.useState(1),[y,I]=o.useState(null),[aa,M]=o.useState(null),[S,A]=o.useState(null),[ra,T]=o.useState(1),[N,j]=o.useState(!1),[L,k]=o.useState(!1),u=o.useRef(null);o.useEffect(()=>{console.log("[BlockWise] audioTypes state updated",P)},[P]);const[ce,nt]=o.useState(null),[Te,de]=o.useState(!0),[Ee,Be]=o.useState(null),[na,sa]=o.useState([]),[Ce,st]=o.useState([]),[ue,Ie]=o.useState({}),[f,ot]=o.useState([]),[it,$e]=o.useState({}),[K,me]=o.useState(null),[lt,he]=o.useState(!1),[Fe,J]=o.useState(null),[ct,Z]=o.useState(new Set),X=o.useRef(!1),[dt,Pe]=o.useState(!1),[oa,We]=o.useState(!1),[ia,la]=o.useState(!1),[ut,ee]=o.useState(!1),[mt,te]=o.useState(""),[ht,pe]=o.useState(!1),[ae,Le]=o.useState({footnoteId:null,footnoteNumber:null,surah:null,ayah:null}),_=At(),De=Tt(),{pathname:Re}=De,{user:G}=Et(),{toasts:ge,removeToast:xe,showSuccess:U,showError:D,showWarning:Me}=qt(),{quranFont:_e,translationLanguage:h,theme:pt,translationFontSize:ze,viewType:re,setViewType:ne}=Bt(),gt=Math.max(Number(ze)-2,10),{surahId:l}=Ct();o.useEffect(()=>{if(!(h==="mal"||h==="E")){re!=="Ayah Wise"&&ne("Ayah Wise");return}if(re==="Ayah Wise"){const r=`/surah/${l}`;Re!==r&&_(r)}else re!=="Block Wise"&&ne("Block Wise")},[re,h,l,_,Re,ne]);const{surahs:fe}=It(),xt=t=>{const r=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];return t.toString().split("").map(a=>r[a]||a).join("")},W=(t,r=null)=>{const a=Number.parseInt(t,10);return Number.isFinite(a)?a:r};o.useEffect(()=>(u.current||(u.current=new Audio),()=>{u.current&&(u.current.pause(),u.current.src="",u.current.currentTime=0),I(null),M(null),A(null),j(!1),k(!1)}),[]);const ft={"al-hudaify":"QH","al-afasy":"QA","al-ghamidi":"QG"},Ue=t=>({E:"English",mal:"Malayalam",ur:"Urdu",bn:"Bangla",ta:"Tamil",hi:"Hindi"})[t]||t,se=(t,r=!1)=>{if(!u.current)return;if(console.log("[BlockWise] playBlockAudio start",{blockId:t,fromContinuous:r,audioTypes:P,translationLanguage:h,selectedQirath:Q}),!r&&h!=="mal"&&P.some(x=>x==="translation"||x==="interpretation")){const x=Ue(h);Me(`${x} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available.`);const p=P.filter(m=>m!=="translation"&&m!=="interpretation");p.length>0?le(p):le(["quran"]);return}u.current&&u.current.pause();const a=f.find(i=>(i.ID||i.id)===t);if(!a){console.error("Block not found:",t);return}const n=a.AyaFrom||a.ayafrom||a.from||1,s=W(n,1);j(!0),I(t),A(s),T(1),k(!1),console.log("[BlockWise] playBlockAudio state set",{playingBlock:t,normalizedStartingAyah:s,currentAudioType:P?.[0]||"quran"}),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}})),q(t,s,0)},yt=(t,r,a)=>{const n=String(t).padStart(3,"0"),s=String(r).padStart(3,"0"),i="https://old.thafheem.net/audio";return a==="quran"?`${i}/qirath/${Q}/${ft[Q]}${n}_${s}.ogg`:a==="translation"?`${i}/translation/T${n}_${s}.ogg`:a==="interpretation"?`${i}/interpretation/I${n}_${s}.ogg`:null},V=(t,r,a=0,n=null)=>{if(!u.current)return;const s=W(r,W(S,1)||1),i=n||P;if(console.log("[BlockWise] playAyahAudioWithTypes",{blockId:t,requestedAyah:r,ayahToPlay:s,audioTypeIndex:a,audioTypes:i,playbackSpeed:H,isContinuousPlay:N,isPaused:L,playingBlock:y}),a>=i.length){Ve(s,i);return}u.current.pause();const x=i[a],p=yt(l,s,x);if(!p){V(t,s,a+1,n);return}console.log("[BlockWise] generated audioUrl",{blockId:t,ayahToPlay:s,currentAudioType:x,audioUrl:p});const z={quran:"qirath",translation:"translation",interpretation:"interpretation"}[x]||"qirath";M(z),A(s),u.current.onended=null,u.current.onerror=null,u.current.onended=()=>{V(t,s,a+1,i)},u.current.onerror=()=>{console.error("Error playing audio:",p),V(t,s,a+1,i)},u.current.src=p,u.current.playbackRate=H,u.current.load(),u.current.play().catch(b=>{console.error("Error playing audio:",b.name,b.message,p),V(t,s,a+1,i)})},q=(t,r,a=0,n=null)=>{V(t,r,a,n)},Ve=(t=null,r=null)=>{const a=t??S;if(!y||!a)return;const n=f.find(m=>(m.ID||m.id)===y);if(!n)return;const s=n.AyaTo||n.ayato||n.to,i=W(a,null),x=W(s,i);if(i===null||x===null){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - invalid ayah numbers",{playingBlock:y,currentAyahInBlock:a,ayaTo:s});return}const p=i+1;console.log("[BlockWise] moveToNextAyahOrBlock",{playingBlock:y,currentAyahNumber:i,nextAyah:p,ayaToNumber:x,isContinuousPlay:N}),p<=x?(T(1),q(y,p,0,r)):N?(T(1),wt()):(I(null),M(null),A(null),T(1),k(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}})))},bt=(t=null,r=null)=>{const a=t??S;if(!y||!a)return;const n=f.find(m=>(m.ID||m.id)===y);if(!n)return;const s=n.AyaFrom||n.ayafrom||n.from||1,i=W(a,null),x=W(s,1);if(i===null||x===null){console.warn("[BlockWise] moveToPreviousAyahOrBlock aborted - invalid ayah numbers",{playingBlock:y,currentAyahInBlock:a,ayaFrom:s});return}const p=i-1;console.log("[BlockWise] moveToPreviousAyahOrBlock",{playingBlock:y,currentAyahNumber:i,previousAyah:p,ayaFromNumber:x,isContinuousPlay:N}),p>=x?(T(1),q(y,p,0,r)):N?(T(1),vt()):(I(null),M(null),A(null),T(1),k(!1))},vt=()=>{if(!N||!f||f.length===0)return;const t=f.findIndex(r=>(r.ID||r.id)===y);if(t>0){const r=f[t-1],a=r.ID||r.id,n=r.AyaTo||r.ayato||r.to||1,s=W(n,1);j(!0),I(a),A(s),T(1),k(!1),q(a,s)}else{const r=f[0],a=r.ID||r.id,n=r.AyaFrom||r.ayafrom||r.from||1,s=W(n,1);I(a),A(s),T(1),q(a,s)}},wt=()=>{if(!N||!f||f.length===0)return;const t=f.findIndex(r=>(r.ID||r.id)===y);if(t!==-1&&t<f.length-1){const r=f[t+1],a=r.ID||r.id;se(a,!0)}else I(null),M(null),A(null),T(1),j(!1),k(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))},qe=()=>{if(!f||f.length===0){D("No blocks available to play");return}if(h!=="mal"){const t=Ue(h);Me(`${t} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available.`);return}try{if(N)u.current&&u.current.pause(),j(!1),k(!0),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}));else if(y&&S)j(!0),k(!1),u.current&&u.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(t=>{console.error("Error resuming audio:",t)});else{j(!0),k(!1);const t=f[0].ID||f[0].id;se(t)}}catch(t){console.error("Error in handlePlayAudio:",t),j(!1),I(null),A(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},ye=o.useRef(null);ye.current=qe,o.useEffect(()=>{const t=()=>{ye.current&&ye.current()};return window.addEventListener("playAudio",t),()=>{window.removeEventListener("playAudio",t)}},[]),o.useEffect(()=>{const t=N&&!L&&y!==null;window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:t}}))},[N,L,y]),o.useEffect(()=>{const t=r=>{const{type:a,message:n}=r.detail;a==="success"?U(n):a==="error"&&D(n)};return window.addEventListener("showToast",t),()=>{window.removeEventListener("showToast",t)}},[U,D]);const be=()=>{u.current&&(u.current.pause(),u.current.currentTime=0),j(!1),I(null),M(null),A(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}})),T(1),k(!1)};o.useEffect(()=>()=>{try{be()}catch{}},[]),o.useEffect(()=>()=>{u.current&&(u.current.pause(),I(null),M(null),A(null),T(1),j(!1),k(!1))},[l]),o.useEffect(()=>{y&&S&&u.current&&N&&q(y,S,0)},[Q,P]),o.useEffect(()=>{u.current&&(u.current.playbackRate=H)},[H]),o.useEffect(()=>((async()=>{if(!l||X.current||fe.length===0)return;if(!(h==="mal"||h==="E")){console.log(`⚠️ BlockWise: Language '${h}' doesn't support blockwise. Skipping fetch.`),de(!1);return}X.current=!0;try{de(!0),Be(null);const[a,n]=await Promise.all([zt(parseInt(l),h||"mal"),Ut(parseInt(l))]),s=fe.find(i=>i.number===parseInt(l));if(nt({surahInfo:s||{number:parseInt(l),arabic:"القرآن",type:"Makki"}}),st(n||[]),ot(a||[]),a&&a.length>0){const i=async(c,v)=>{const w=c.AyaFrom||c.ayafrom||c.from,d=c.AyaTo||c.ayato||c.to;if(w==null||d===void 0||d===null)return;const g=Number.parseInt(w,10),E=Number.parseInt(d,10),B=Number.isFinite(g)&&Number.isFinite(E),C=B?`${g}-${E}`:`${w}-${d}`,F=c.ID||c.id||C||`block-${v}`,jt=B?g:w,St=B?E:d;try{Z(R=>new Set([...R,F]));let Y;const we=h||"mal";Y=await Vt(parseInt(l),C,we),$e(R=>({...R,[F]:{range:C,ayaFrom:jt,ayaTo:St,data:Y}})),Z(R=>{const Ge=new Set(R);return Ge.delete(F),Ge})}catch(Y){Y.message?.includes("timeout")||console.error(`❌ BlockWise: Failed to load block ${C}:`,Y.message),Z(we=>{const R=new Set(we);return R.delete(F),R})}},p=[];let m=0;const z=async(c,v)=>new Promise(w=>{const d=async()=>{m++;try{await i(c,v)}catch{}finally{m--,p.length>0&&p.shift()(),w()}};m<5?d():p.push(d)}),b=c=>{const v=c.slice(0,3),w=c.slice(3);return{visibleBlocks:v,backgroundBlocks:w}},{visibleBlocks:O,backgroundBlocks:$}=b(a),Xe=O.map((c,v)=>i(c,v));$.forEach((c,v)=>{setTimeout(()=>{z(c,v+O.length)},50*Math.floor(v/5))}),Promise.allSettled(Xe).then(c=>{const v=c.filter(w=>w.status==="fulfilled").length})}}catch(a){let n=a.message;a.message?.includes("timeout")||a.message?.includes("Request timeout")?n="The server is taking longer than expected to respond. Please try again in a moment. If the problem persists, the English blockwise data may be temporarily unavailable.":a.message?.includes("Failed to fetch")||a.message?.includes("Network error")?n="Unable to connect to the server. Please check your internet connection and try again.":a.message?.includes("HTTP error")&&(n=`Server error: ${a.message}. Please try again later.`),Be(n),console.error("Error fetching block-wise data:",a),X.current=!1}finally{de(!1)}})(),()=>{X.current=!1}),[l,fe,h]),o.useEffect(()=>{if(f.length>0){const t=new Set(f.map(r=>{const a=r.AyaFrom??r.ayafrom??r.from??1,n=r.AyaTo??r.ayato??r.to??a,s=Number.parseInt(a,10),i=Number.parseInt(n,10),x=Number.isFinite(s)&&Number.isFinite(i),p=Number.isFinite(Number(a))?Number(a):1,m=x?s:p,z=Number.isFinite(Number(n))?Number(n):m,O=x?`${m}-${x?i:z}`:`${a}-${n}`;return r.ID||r.id||O||`block-${f.indexOf(r)}`}));Z(t)}$e({}),X.current=!1,me(null),oe(!1),ee(!1),te(""),pe(!1),Le({footnoteId:null,footnoteNumber:null,surah:null,ayah:null})},[h]),o.useEffect(()=>{(async()=>{if(!G||!l){We(!1);return}try{const r=await ke.isFavorited(G.uid,l);We(r)}catch(r){console.error("Error loading favorite status:",r)}})()},[G,l]),o.useEffect(()=>{if(h!=="E")return;const t=async r=>{const a=r.target.closest(".english-footnote-link");if(!a)return;r.preventDefault(),r.stopPropagation();const n=a.getAttribute("data-footnote-id");if(!n)return;const s=(a.textContent||"").trim()||a.getAttribute("data-footnote-number"),i=a.getAttribute("data-ayah"),x=i?parseInt(i,10):null;Le({footnoteId:n,footnoteNumber:s||null,surah:l?parseInt(l,10):null,ayah:x}),te("Loading..."),pe(!0),ee(!0);try{const p=await Se.getExplanation(parseInt(n,10));te(p||"Explanation not available.")}catch(p){console.error("Error fetching English footnote explanation:",p),te(`Error loading explanation: ${p.message||p}`)}finally{pe(!1)}};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[h,l]);const Oe=(t,r)=>{if(!t)return"";const a=document.createElement("div");return a.innerHTML=t,a.querySelectorAll("sup").forEach(s=>{const i=s.textContent.trim();/^\d+$/.test(i)&&(s.style.cssText=`
          cursor: pointer !important;
          background-color: rgb(41 169 199) !important;
          color: rgb(255, 255, 255) !important;
          font-weight: 600 !important;
          text-decoration: none !important;
          border: none !important;
          display: inline-flex !important;
          align-items: center !important;
          justify-content: center !important;
          font-size: 12px !important;
          vertical-align: middle !important;
          line-height: 1 !important;
          border-radius: 9999px !important;
          position: relative !important;
          z-index: 10 !important;
          top: 0px !important;
          min-width: 20px !important;
          min-height: 19px !important;
          text-align: center !important;
          transition: 0.2s ease-in-out !important;
          padding-top: 3px !important;
          margin-right: 4px;
          margin-left: -1px;
          margin-top: -15px;
          padding-left: 2px !important;
          padding-right: 2px !important;
        `,s.setAttribute("data-interpretation",i),s.setAttribute("data-range",r),s.setAttribute("data-lang",h==="E"?"en":"mal"),s.setAttribute("title",`Click to view interpretation ${i}`),s.className="interpretation-link")}),a.innerHTML};o.useEffect(()=>{const t=a=>{const n=a.target.closest(".interpretation-link");if(n){a.preventDefault(),a.stopPropagation();const s=n.getAttribute("data-interpretation"),i=n.getAttribute("data-range");s&&i&&(console.log("Interpretation clicked:",{range:i,interpretationNumber:s}),me({range:i,interpretationNumber:parseInt(s,10)}))}},r=document.createElement("style");return r.textContent=`
      .interpretation-link {
        cursor: pointer !important;
      }
      .interpretation-link > a {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 100% !important;
        height: 100% !important;
        color: inherit !important;
        font-weight: inherit !important;
        text-decoration: none !important;
      }
      .interpretation-link:hover {
        background-color: #0891b2 !important;
        transform: scale(1.05) !important;
      }
      .interpretation-link:active {
        background-color: #0e7490 !important;
        transform: scale(0.95) !important;
      }
    `,document.head.appendChild(r),document.addEventListener("click",t,!0),()=>{document.removeEventListener("click",t,!0),document.head.removeChild(r)}},[]);const Qe=()=>{const t=parseInt(l)-1;t>=1&&_(`/blockwise/${t}`)},He=()=>{const t=parseInt(l)+1;t<=114&&_(`/blockwise/${t}`)};if(o.useEffect(()=>{const t=()=>{window.scrollY>300?Pe(!0):Pe(!1)};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[]),Te&&f.length===0)return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{toasts:ge,removeToast:xe}),e.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"h-12 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-64 mx-auto mb-4 relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})}),e.jsx("div",{className:"h-6 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-40 mx-auto relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})})]}),e.jsx(Ze,{count:3})]})})]});if(Ee)return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{toasts:ge,removeToast:xe}),e.jsx("div",{className:"min-h-screen bg-white dark:bg-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 dark:text-red-400 text-lg mb-2",children:"Failed to load Block-wise data"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:Ee}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Try Again"})]})})]});const ve=ce?.surahInfo?.arabic||(l?`Surah ${l}`:"Surah"),kt=Gt(l,ve),Ke=l?String(l):"",Nt=Ke==="1"||Ke==="2"?"font-normal":"font-semibold";return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{toasts:ge,removeToast:xe}),e.jsx("div",{className:"mx-auto min-h-screen bg-gray-50 dark:bg-gray-900 font-outfit transition-colors duration-300",children:e.jsxs("div",{className:"sticky top-0 z-40 glass border-b border-gray-200/50 dark:border-gray-700/50 transition-all duration-300",children:[e.jsx("div",{className:"container-responsive py-3 sm:py-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center relative",children:[e.jsx("div",{className:"mb-2 sm:mb-4",children:e.jsx("h1",{className:`text-4xl sm:text-5xl md:text-6xl font-arabic text-center text-gray-800 dark:text-white drop-shadow-sm ${Nt}`,style:{fontFamily:Yt},"aria-label":ve,children:ce?kt:ve})}),parseInt(l)!==1&&parseInt(l)!==9&&e.jsxs("div",{className:"mb-4 sm:mb-6",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsx("div",{className:"max-w-[1290px] mx-auto relative flex items-center justify-center px-4 lg:px-8",children:e.jsx("div",{className:"flex-shrink-0 px-4 sm:px-6 pt-8 pb-6 sm:pt-10 sm:pb-8",children:parseInt(l)!==1&&parseInt(l)!==9?e.jsx("img",{src:pt==="dark"?Qt:Ht,alt:"Bismi",className:"w-[236px] h-[52.9px]"}):e.jsx("div",{className:"h-[52.9px]"})})})}),e.jsx("div",{className:"w-full flex justify-center mt-2",children:(h==="mal"||h==="E")&&e.jsx($t,{options:["Ayah Wise","Block Wise"],value:"Block Wise",onChange:t=>ne(t)})})]})]})}),e.jsx("div",{className:`container-responsive py-6 sm:py-8 space-y-4 sm:space-y-6 ${S?"pb-32 sm:pb-36":""}`,children:Te&&f.length===0?e.jsx(Ze,{count:5}):f&&f.length>0?f.map((t,r)=>{const a=t.AyaFrom??t.ayafrom??t.from??1,n=t.AyaTo??t.ayato??t.to??a,s=Number.parseInt(a,10),i=Number.parseInt(n,10),x=Number.isFinite(s)&&Number.isFinite(i),p=Number.isFinite(Number(a))?Number(a):1,m=x?s:p,z=Number.isFinite(Number(n))?Number(n):m,b=x?i:z,O=x?`${m}-${b}`:`${a}-${n}`,$=t.ID||t.id||O||`block-${r}`,c=(it[$]||null)?.data,v=Array.isArray(c)?c:Array.isArray(c?.translations)?c.translations:Array.isArray(c?.data)?c.data:[],w=Array.isArray(Ce)?Ce.slice(m-1,b):[];return e.jsxs("div",{className:"relative rounded-2xl bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 hover:shadow-card hover:border-gray-200 dark:hover:border-gray-600 transition-all duration-300",children:[e.jsxs("div",{className:"absolute top-0 left-0 bg-gray-50 dark:bg-gray-700/50 px-3 py-1.5 rounded-br-xl border-b border-r border-gray-100 dark:border-gray-700 text-xs font-medium text-gray-500 dark:text-gray-400 z-10",children:[l,":",m,m!==b&&`-${b}`]}),e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 pt-12",children:[e.jsx("div",{className:"w-full mb-6 sm:mb-8 text-right",dir:"rtl",children:e.jsx("p",{className:"leading-[2.2] text-gray-800 dark:text-gray-100",style:{fontFamily:_e?`'${_e}', serif`:'"Amiri Quran", serif',direction:"rtl",lineHeight:"2.7",fontSize:"23px"},children:w.length>0?w.map((d,g)=>`${d.text_uthmani} ﴿${xt(m+g)}﴾`).join(" "):"Loading Arabic text..."})}),e.jsx("div",{className:"w-full text-left mb-6",children:c?e.jsx("div",{className:`prose dark:prose-invert max-w-none text-gray-600 dark:text-gray-300 ${h==="hi"?"font-hindi":h==="ur"?"font-urdu":h==="bn"?"font-bengali":h==="ta"?"font-tamil":h==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${gt}px`},children:v.length>0?v.map((d,g)=>{const E=d.TranslationText||d.translationText||d.translation_text||d.text||"",B=d.VerseNo||d.Verse_Number||d.verse_number||d.VerseNumber||d.ayah_number||d.AyaId||d.AyahId||m+g,C=Number.isFinite(parseInt(B,10))?parseInt(B,10):m+g,F=h==="E"?Se.parseEnglishTranslationWithClickableFootnotes(E,parseInt(l,10),C):Oe(E,`${m}-${b}`);return e.jsx("div",{className:"leading-relaxed",style:{fontSize:"17px"},dangerouslySetInnerHTML:{__html:F}},`translation-${$}-${g}`)}):c?.TranslationText||c?.translationText||c?.translation_text||c?.text?e.jsx("div",{className:"leading-relaxed",style:{fontSize:"17px"},dangerouslySetInnerHTML:{__html:h==="E"?Se.parseEnglishTranslationWithClickableFootnotes(c.TranslationText||c.translationText||c.translation_text||c.text,parseInt(l,10),m):Oe(c.TranslationText||c.translationText||c.translation_text||c.text,`${m}-${b}`)}}):e.jsx("p",{children:"Translation not available"})}):ct.has($)?e.jsx(Kt,{message:"Loading translation..."}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Translation not available"})}),e.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-700/50",children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("button",{className:"icon-btn",onClick:async()=>{try{const d=w.length>0?w.map((B,C)=>`${B.text_uthmani} ﴿${m+C}﴾`).join(" "):"Loading Arabic text...";let g="Loading translation...";if(c){let B="";if(v.length>0){const F=v[0];B=F.TranslationText||F.translationText||F.translation_text||F.text||""}else B=c.TranslationText||c.translationText||c.translation_text||c.text||"";const C=document.createElement("div");C.innerHTML=B,g=C.textContent||C.innerText||""}const E=`${d}

${g}`;await navigator.clipboard.writeText(E),U("Text copied to clipboard!")}catch(d){console.error("Copy failed",d),D("Failed to copy text")}},title:"Copy text",children:e.jsx(Ft,{className:"w-5 h-5"})}),e.jsx("button",{className:`icon-btn ${y===$&&!L?"text-primary bg-primary/10":""}`,onClick:()=>{y===$?L?(k(!1),j(!0),u.current&&u.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(d=>{console.error("Error resuming audio:",d)})):(u.current&&u.current.pause(),k(!0),j(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))):se($)},title:y===$?L?"Resume audio":"Pause audio":"Play audio",children:y===$&&!L?e.jsx(Pt,{className:"w-5 h-5"}):e.jsx(Wt,{className:"w-5 h-5"})}),h!=="ta"&&h!=="E"&&h!=="mal"&&e.jsx("button",{className:"icon-btn group",onClick:d=>{const g=`/surah/${l}#verse-${m}`;d?.ctrlKey||d?.metaKey?(d.preventDefault(),window.open(g,"_blank","noopener,noreferrer")):_(g)},title:"View ayah details",children:e.jsx(Lt,{className:"w-5 h-5 group-hover:scale-110 transition-transform"})}),e.jsx("button",{className:"icon-btn group",onClick:d=>{const g=`/word-by-word/${l}/${m}`;if(d?.ctrlKey||d?.metaKey){d.preventDefault(),window.open(g,"_blank","noopener,noreferrer");return}he(!0),J(m)},title:"Word by word",children:e.jsx(Dt,{className:"w-5 h-5 group-hover:scale-110 transition-transform"})}),e.jsx("button",{className:`icon-btn ${ue[`${m}-${b}`]?"opacity-50 cursor-not-allowed":""}`,onClick:async()=>{if(!G){D("Please sign in to bookmark blocks"),_("/sign",{state:{from:De.pathname,message:"Sign in to bookmark blocks"}});return}const d=`${m}-${b}`;try{Ie(E=>({...E,[d]:!0}));const g=ke.getEffectiveUserId(G);await ke.addBlockBookmark(g,l,m,b),U(`Saved block ${m}-${b}`)}catch(g){console.error("Failed to bookmark block:",g),D("Failed to save block")}finally{Ie(g=>({...g,[d]:!1}))}},title:"Bookmark block",disabled:ue[`${m}-${b}`],children:ue[`${m}-${b}`]?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b border-current"}):e.jsx(Rt,{className:"w-5 h-5"})}),e.jsx("button",{className:"icon-btn",onClick:async()=>{try{const d=`Surah ${l} • Verses ${m}-${b}`,g=window.location.href;navigator.share?await navigator.share({title:"Thafheem - Quran Study",text:d,url:g}):(await navigator.clipboard.writeText(`${d}
${g}`),U("Link copied to clipboard!"))}catch(d){console.error("Share failed",d),D("Failed to share")}},title:"Share block",children:e.jsx(Mt,{className:"w-5 h-5"})})]})})]})]},`block-${$}-${m}-${b}`)}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No blocks available for this Surah"})})}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 dark:border-gray-700 px-3 sm:px-4 lg:px-6 py-3 sm:py-4 mt-6 sm:mt-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"sm:hidden space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:Qe,disabled:parseInt(l)<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 \r
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 \r
                               border border-gray-300 dark:border-gray-600 rounded-lg w-[173.96px] min-h-[44px]\r
                               disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx(et,{className:"w-3 h-3"}),e.jsx("span",{children:"Previous Surah"})]}),e.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 \r
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 \r
                               border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]`,children:[e.jsx(je,{className:"w-3 h-3"}),e.jsx("span",{children:"Beginning of Surah"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:He,disabled:parseInt(l)>=114,className:`w-[173.96px] flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 \r
                                 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 \r
                                 border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]\r
                                 disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("span",{children:"Next Surah"}),e.jsx(Ye,{className:"w-3 h-3"})]})})]}),e.jsxs("div",{className:"hidden sm:flex items-center justify-center space-x-2 sm:space-x-4 lg:space-x-6",children:[e.jsxs("button",{onClick:Qe,disabled:parseInt(l)<=1,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(et,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{children:"Previous Surah"})]}),e.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px]",children:[e.jsx(je,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{children:"Beginning of Surah"})]}),e.jsxs("button",{onClick:He,disabled:parseInt(l)>=114,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{children:"Next Surah"}),e.jsx(Ye,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]})}),tt&&ie&&e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:()=>{oe(!1),Ae(null)}}),e.jsxs("div",{className:"relative w-full sm:w-[550px] max-h-[85vh] sm:max-h-[90vh] bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col animate-slideUp sm:animate-fadeIn overflow-hidden",children:[e.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 sm:hidden cursor-grab active:cursor-grabbing",children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(Je,{surahId:parseInt(l),range:ie.toString(),ipt:1,lang:h==="E"?"E":"mal",onClose:()=>{oe(!1),Ae(null)},showSuccess:U,showError:D,isModal:!0},`interpretation-${l}-${ie}`)})]})]}),lt&&Fe&&e.jsx(Ot,{selectedVerse:Fe,surahId:l,onClose:()=>{he(!1),J(null)},onNavigate:t=>J(t),onSurahChange:t=>{he(!1),J(null),_(`/surah/${t}?wordByWord=1`)}}),ut&&e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:()=>ee(!1)}),e.jsxs("div",{className:"relative w-full sm:w-[480px] md:max-w-2xl lg:max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col animate-slideUp sm:animate-fadeIn overflow-hidden",children:[e.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 sm:hidden cursor-grab active:cursor-grabbing",children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white",children:"English Explanation"}),ae?.footnoteNumber&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Footnote ",ae.footnoteNumber,ae?.ayah?` • Ayah ${ae.ayah}`:""]})]}),e.jsx("button",{onClick:()=>ee(!1),className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-500 dark:text-gray-400",children:e.jsx(_t,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5 space-y-6",children:ht?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading explanation..."})]})}):e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg",children:e.jsx("div",{className:"text-gray-700 leading-[1.6] font-poppins sm:leading-[1.7] lg:leading-[1.8] dark:text-white text-sm sm:text-base lg:text-lg prose prose-sm dark:prose-invert max-w-none",style:{fontSize:`${ze}px`},children:mt})})})]})]}),K&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-start justify-center z-[9999] pt-24 sm:pt-28 lg:pt-32 p-2 sm:p-4 lg:p-6 overflow-y-auto",children:e.jsx("div",{className:"bg-white dark:bg-[#2A2C38] rounded-lg max-w-xs sm:max-w-4xl max-h-[90vh] overflow-y-auto relative w-full shadow-2xl",children:e.jsx(Je,{surahId:parseInt(l),range:K.range,ipt:K.interpretationNumber,lang:h==="E"?"E":"mal",onClose:()=>me(null)},`block-interpretation-${l}-${K.range}-${K.interpretationNumber}`)})}),dt&&e.jsx("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`fixed right-6 z-[60] bg-cyan-500 hover:bg-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center ${S?"bottom-32 sm:bottom-36":"bottom-6"}`,title:"Beginning of Surah","aria-label":"Beginning of Surah",children:e.jsx(je,{className:"w-6 h-6"})})]})}),S&&e.jsx(Xt,{audioElement:u.current,isPlaying:N&&u.current&&!u.current.paused,currentAyah:S,totalAyahs:f.reduce((t,r)=>{const a=r.AyaTo||r.ayato||r.to||0,n=r.AyaFrom||r.ayafrom||r.from||0;return t+(a-n+1)},0),surahInfo:ce?.surahInfo,onPlayPause:qe,onStop:be,onSkipBack:()=>{bt()},onSkipForward:()=>{Ve()},onClose:null,selectedQari:Q,onQariChange:t=>{at(t),y&&S&&(be(),setTimeout(()=>{se(y)},100))},translationLanguage:h,audioTypes:P,onAudioTypesChange:t=>{const r=y,a=S;if(console.log("[BlockWise] onAudioTypesChange",{newTypes:t,currentBlock:r,currentAyah:a,isContinuousPlay:N,isPaused:L}),le(t),r&&a){if(u.current)try{u.current.pause(),u.current.currentTime=0}catch(n){console.warn("[BlockWise] Failed to pause audio before restarting with new types",n)}j(!0),k(!1),I(r),A(a),setTimeout(()=>{console.log("[BlockWise] restarting playback after audioTypes change",{currentBlock:r,currentAyah:a,newTypes:t}),V(r,a,0,t)},100)}},playbackSpeed:H,onPlaybackSpeedChange:t=>{rt(t)}})]})};export{Pa as default};
