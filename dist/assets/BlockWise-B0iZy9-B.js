import{c as Ot,u as Qt,i as Ht,a as Kt,j as t,T as Xt,C as Gt,x as Yt,P as Jt,B as Zt,F as ea,m as ta,t as De,n as aa,o as pt,X as ra,y as na,k as sa,z as oa}from"./index-zWRKLUWk.js";import{b as i,u as ia,e as la,d as ca}from"./react-vendor-v5ei6ytj.js";import{u as da,T as Me}from"./Toast-DunFfijn.js";import{W as ua}from"./WordByWord-DN1As7tc.js";import ft from"./InterpretationBlockwise-taaGcYg_.js";import{a as gt,D as ma,B as ha,C as pa,A as _e}from"./LoadingSkeleton-c9dbzQb2.js";import fa from"./StickyAudioPlayer-DeSRjKWI.js";import le from"./englishTranslationService-CdieVbVi.js";import{u as ga}from"./useSequentialEnglishFootnotes-B4d1JHKd.js";import{g as xa,s as ya}from"./surahNameUtils-CNmXwDjY.js";import{C as xt}from"./chevron-left-8YABQ6I3.js";import"./tamilWordByWordService-B0xEV9Gl.js";import"./apiService-hOh9yyny.js";import"./hindiWordByWordService-BCeNezEp.js";import"./banglaWordByWordService-DG8H3aZ-.js";import"./banglaTranslationService-DLkj577Y.js";import"./tamilTranslationService-CJsvEoeN.js";import"./hindiTranslationService-BGO3ah39.js";import"./urduTranslationService-jZuXP4Cs.js";import"./BlockInterpretationModal-DlJKBSK3.js";import"./InterpretationNavbar-BnNdja9N.js";import"./WordByWordIcon-DxjBUJXe.js";import"./volume-x-D3v98kuA.js";import"./volume-2-B8vAoamP.js";import"./skip-forward-_vqWQBqI.js";import"./surahNameUnicodes-C_pntk6C.js";const rr=()=>{const[ba,ka]=i.useState("Translation"),[wa,va]=i.useState("Block wise"),[yt,ke]=i.useState(!1),[we,Ve]=i.useState(null),[ae,bt]=i.useState("al-hudaify"),[L,ve]=i.useState(["quran"]),[re,kt]=i.useState(1),[v,W]=i.useState(null),[Na,q]=i.useState(null),[$,F]=i.useState(null),[Aa,P]=i.useState(1),[I,C]=i.useState(!1),[_,E]=i.useState(!1),p=i.useRef(null);i.useEffect(()=>{console.log("[BlockWise] audioTypes state updated",L)},[L]);const[J,ze]=i.useState(null),[O,ce]=i.useState(!0),[Ue,de]=i.useState(null),[ja,Ta]=i.useState([]),[ue,qe]=i.useState([]),[Ne,Oe]=i.useState({}),[u,Qe]=i.useState([]),[R,me]=i.useState({}),[Q,ne]=i.useState(null),[wt,Ae]=i.useState(!1),[He,he]=i.useState(null),[V,H]=i.useState(new Set),K=i.useRef(!1),[vt,Nt]=i.useState(0),[je,pe]=i.useState(!1),[At,Ke]=i.useState(!1),[Sa,Xe]=i.useState(!1),[Ba,Ea]=i.useState(!1),[jt,fe]=i.useState(!1),[Tt,se]=i.useState(""),[St,Te]=i.useState(!1),[ge,Ge]=i.useState({footnoteId:null,footnoteNumber:null,surah:null,ayah:null}),X=ia(),Ye=la(),{pathname:Je}=Ye,{user:oe}=Ot(),{toasts:Se,removeToast:Be,showSuccess:Z,showError:z,showWarning:Ze}=da(),{quranFont:et,translationLanguage:c,theme:Bt,adjustedTranslationFontSize:tt,viewType:G,setViewType:xe}=Qt(),Et=Math.max(Number(tt)-2,10),{surahId:o}=ca(),{getBlockViewCache:at,setBlockViewCache:Ee}=Ht(),rt=i.useRef(!1),nt=i.useRef(c),st=i.useRef(o);ga({enabled:c==="E"&&G==="Block Wise",context:"blockwise",dependencies:[R,u,o,J]}),i.useEffect(()=>{if(!(c==="mal"||c==="E")){G!=="Ayah Wise"&&xe("Ayah Wise");return}if(G==="Ayah Wise"){const r=`/surah/${o}`;Je!==r&&X(r)}else G!=="Block Wise"&&xe("Block Wise")},[G,c,o,X,Je,xe]);const{surahs:Ie}=Kt(),ye=i.useCallback((e=[])=>!Array.isArray(e)||e.length===0?new Set:new Set(e.map((r,a)=>{const n=r.AyaFrom??r.ayafrom??r.from??1,s=r.AyaTo??r.ayato??r.to??n,l=Number.parseInt(n,10),g=Number.parseInt(s,10),f=Number.isFinite(l)&&Number.isFinite(g),d=Number.isFinite(Number(n))?Number(n):1,B=f?l:d,y=Number.isFinite(Number(s))?Number(s):B,w=f?`${B}-${f?g:y}`:`${n}-${s}`;return r.ID||r.id||w||`block-${a}`})),[]),It=e=>{const r=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];return e.toString().split("").map(a=>r[a]||a).join("")},Ct=e=>e?e.replace(/\s*﴿\s*[\d\u0660-\u0669]+\s*﴾\s*$/u,"").trim():"",Ce=(e,r)=>`${Ct(e)||e||""} ﴿${It(r)}﴾`,D=(e,r=null)=>{const a=Number.parseInt(e,10);return Number.isFinite(a)?a:r},$e=i.useCallback((e="manual")=>{if(!o)return;console.log(`[BlockWise] Triggering blockwise reload (${e})`),K.current=!1;const r=ye(u);H(r),me({}),de(null),e==="manual"&&pe(!1),Nt(a=>a+1)},[o,u,ye]);i.useEffect(()=>(p.current||(p.current=new Audio),()=>{p.current&&(p.current.pause(),p.current.src="",p.current.currentTime=0),W(null),q(null),F(null),C(!1),E(!1)}),[]);const $t={"al-hudaify":"QH","al-afasy":"QA","al-ghamidi":"QG"},ot=e=>({E:"English",mal:"Malayalam",ur:"Urdu",bn:"Bangla",ta:"Tamil",hi:"Hindi"})[e]||e,be=(e,r=!1)=>{if(!p.current)return;if(console.log("[BlockWise] playBlockAudio start",{blockId:e,fromContinuous:r,audioTypes:L,translationLanguage:c,selectedQirath:ae}),!r&&c!=="mal"&&L.some(g=>g==="translation"||g==="interpretation")){const g=ot(c);Ze(`${g} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available.`);const f=L.filter(d=>d!=="translation"&&d!=="interpretation");f.length>0?ve(f):ve(["quran"]);return}p.current&&p.current.pause();const a=u.find(l=>(l.ID||l.id)===e);if(!a){console.error("Block not found:",e);return}const n=a.AyaFrom||a.ayafrom||a.from||1,s=D(n,1);C(!0),W(e),F(s),P(1),E(!1),console.log("[BlockWise] playBlockAudio state set",{playingBlock:e,normalizedStartingAyah:s,currentAudioType:L?.[0]||"quran"}),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}})),te(e,s,0)},Ft=(e,r,a)=>{const n=String(e).padStart(3,"0"),s=String(r).padStart(3,"0"),l="https://old.thafheem.net/audio";return a==="quran"?`${l}/qirath/${ae}/${$t[ae]}${n}_${s}.ogg`:a==="translation"?`${l}/translation/T${n}_${s}.ogg`:a==="interpretation"?`${l}/interpretation/I${n}_${s}.ogg`:null},ee=(e,r,a=0,n=null)=>{if(!p.current)return;const s=D(r,D($,1)||1),l=n||L;if(console.log("[BlockWise] playAyahAudioWithTypes",{blockId:e,requestedAyah:r,ayahToPlay:s,audioTypeIndex:a,audioTypes:l,playbackSpeed:re,isContinuousPlay:I,isPaused:_,playingBlock:v}),a>=l.length){it(s,l);return}p.current.pause();const g=l[a],f=Ft(o,s,g);if(!f){ee(e,s,a+1,n);return}console.log("[BlockWise] generated audioUrl",{blockId:e,ayahToPlay:s,currentAudioType:g,audioUrl:f});const B={quran:"qirath",translation:"translation",interpretation:"interpretation"}[g]||"qirath";q(B),F(s),p.current.onended=null,p.current.onerror=null,p.current.onended=()=>{ee(e,s,a+1,l)},p.current.onerror=()=>{console.error("Error playing audio:",f),ee(e,s,a+1,l)},p.current.src=f,p.current.playbackRate=re,p.current.load(),p.current.play().catch(y=>{console.error("Error playing audio:",y.name,y.message,f),ee(e,s,a+1,l)})},te=(e,r,a=0,n=null)=>{ee(e,r,a,n)},it=(e=null,r=null)=>{const a=e??$;if(!v||!a)return;const n=u.find(d=>(d.ID||d.id)===v);if(!n)return;const s=n.AyaTo||n.ayato||n.to,l=D(a,null),g=D(s,l);if(l===null||g===null){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - invalid ayah numbers",{playingBlock:v,currentAyahInBlock:a,ayaTo:s});return}const f=l+1;console.log("[BlockWise] moveToNextAyahOrBlock",{playingBlock:v,currentAyahNumber:l,nextAyah:f,ayaToNumber:g,isContinuousPlay:I}),f<=g?(P(1),te(v,f,0,r)):I?(P(1),Rt()):(W(null),q(null),F(null),P(1),E(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}})))},Pt=(e=null,r=null)=>{const a=e??$;if(!v||!a)return;const n=u.find(d=>(d.ID||d.id)===v);if(!n)return;const s=n.AyaFrom||n.ayafrom||n.from||1,l=D(a,null),g=D(s,1);if(l===null||g===null){console.warn("[BlockWise] moveToPreviousAyahOrBlock aborted - invalid ayah numbers",{playingBlock:v,currentAyahInBlock:a,ayaFrom:s});return}const f=l-1;console.log("[BlockWise] moveToPreviousAyahOrBlock",{playingBlock:v,currentAyahNumber:l,previousAyah:f,ayaFromNumber:g,isContinuousPlay:I}),f>=g?(P(1),te(v,f,0,r)):I?(P(1),Wt()):(W(null),q(null),F(null),P(1),E(!1))},Wt=()=>{if(!I||!u||u.length===0)return;const e=u.findIndex(r=>(r.ID||r.id)===v);if(e>0){const r=u[e-1],a=r.ID||r.id,n=r.AyaTo||r.ayato||r.to||1,s=D(n,1);C(!0),W(a),F(s),P(1),E(!1),te(a,s)}else{const r=u[0],a=r.ID||r.id,n=r.AyaFrom||r.ayafrom||r.from||1,s=D(n,1);W(a),F(s),P(1),te(a,s)}},Rt=()=>{if(!I||!u||u.length===0)return;const e=u.findIndex(r=>(r.ID||r.id)===v);if(e!==-1&&e<u.length-1){const r=u[e+1],a=r.ID||r.id;be(a,!0)}else W(null),q(null),F(null),P(1),C(!1),E(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))},lt=()=>{if(!u||u.length===0){z("No blocks available to play");return}if(c!=="mal"){const e=ot(c);Ze(`${e} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available.`);return}try{if(I)p.current&&p.current.pause(),C(!1),E(!0),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}));else if(v&&$)C(!0),E(!1),p.current&&p.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(e=>{console.error("Error resuming audio:",e)});else{C(!0),E(!1);const e=u[0].ID||u[0].id;be(e)}}catch(e){console.error("Error in handlePlayAudio:",e),C(!1),W(null),F(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},Fe=i.useRef(null);Fe.current=lt,i.useEffect(()=>{const e=()=>{Fe.current&&Fe.current()};return window.addEventListener("playAudio",e),()=>{window.removeEventListener("playAudio",e)}},[]),i.useEffect(()=>{const e=I&&!_&&v!==null;window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:e}}))},[I,_,v]),i.useEffect(()=>{const e=r=>{const{type:a,message:n}=r.detail;a==="success"?Z(n):a==="error"&&z(n)};return window.addEventListener("showToast",e),()=>{window.removeEventListener("showToast",e)}},[Z,z]);const Pe=()=>{p.current&&(p.current.pause(),p.current.currentTime=0),C(!1),W(null),q(null),F(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}})),P(1),E(!1)};i.useEffect(()=>()=>{try{Pe()}catch{}},[]),i.useEffect(()=>()=>{p.current&&(p.current.pause(),W(null),q(null),F(null),P(1),C(!1),E(!1))},[o]),i.useEffect(()=>{v&&$&&p.current&&I&&te(v,$,0)},[ae,L]),i.useEffect(()=>{p.current&&(p.current.playbackRate=re)},[re]),i.useEffect(()=>{rt.current=!1},[o,c]),i.useEffect(()=>{pe(!1)},[o]),i.useEffect(()=>{if(!o||!(c==="mal"||c==="E"))return;const r=at?.(o,c);if(r){rt.current=!0,ze(r.blockData||null),Qe(r.blockRanges||[]),qe(r.arabicVerses||[]),me(r.blockTranslations||{}),de(null),H(new Set);const a=r.blockTranslations?Object.keys(r.blockTranslations).length:0,n=!!(r.__meta?.isComplete&&a>0);ce(!n),K.current=n}},[o,c,at]),i.useEffect(()=>((async()=>{if(!o||K.current||Ie.length===0)return;if(!(c==="mal"||c==="E")){console.log(`⚠️ BlockWise: Language '${c}' doesn't support blockwise. Skipping fetch.`),ce(!1);return}K.current=!0;try{ce(!0),de(null);const[a,n]=await Promise.all([na(parseInt(o),c||"mal"),sa(parseInt(o))]),s=Ie.find(l=>l.number===parseInt(o));if(ze({surahInfo:s||{number:parseInt(o),arabic:"القرآن",type:"Makki"}}),qe(n||[]),Qe(a||[]),a&&a.length>0){const l=async(m,A)=>{const S=m.AyaFrom||m.ayafrom||m.from,j=m.AyaTo||m.ayato||m.to;if(S==null||j===void 0||j===null)return;const h=Number.parseInt(S,10),b=Number.parseInt(j,10),k=Number.isFinite(h)&&Number.isFinite(b),x=k?`${h}-${b}`:`${S}-${j}`,T=m.ID||m.id||x||`block-${A}`,Y=k?h:S,Re=k?b:j;try{H(U=>new Set([...U,T]));let ie;const Le=c||"mal";ie=await oa(parseInt(o),x,Le),me(U=>({...U,[T]:{range:x,ayaFrom:Y,ayaTo:Re,data:ie}})),H(U=>{const ht=new Set(U);return ht.delete(T),ht})}catch(ie){ie.message?.includes("timeout")||console.error(`❌ BlockWise: Failed to load block ${x}:`,ie.message),H(Le=>{const U=new Set(Le);return U.delete(T),U})}},f=[];let d=0;const B=async(m,A)=>new Promise(S=>{const j=async()=>{d++;try{await l(m,A)}catch{}finally{d--,f.length>0&&f.shift()(),S()}};d<5?j():f.push(j)}),y=m=>{const A=m.slice(0,3),S=m.slice(3);return{visibleBlocks:A,backgroundBlocks:S}},{visibleBlocks:N,backgroundBlocks:w}=y(a),M=N.map((m,A)=>l(m,A));w.forEach((m,A)=>{setTimeout(()=>{B(m,A+N.length)},50*Math.floor(A/5))}),Promise.allSettled(M).then(m=>{const A=m.filter(S=>S.status==="fulfilled").length})}}catch(a){let n=a.message;a.message?.includes("timeout")||a.message?.includes("Request timeout")?n="The server is taking longer than expected to respond. Please try again in a moment. If the problem persists, the English blockwise data may be temporarily unavailable.":a.message?.includes("Failed to fetch")||a.message?.includes("Network error")?n="Unable to connect to the server. Please check your internet connection and try again.":a.message?.includes("HTTP error")&&(n=`Server error: ${a.message}. Please try again later.`),de(n),console.error("Error fetching block-wise data:",a),K.current=!1}finally{ce(!1)}})(),()=>{K.current=!1}),[o,Ie,c,vt]),i.useEffect(()=>{if(!o||!(c==="mal"||c==="E")||!Ee||O||!Array.isArray(u)||u.length===0)return;const a=(R?Object.keys(R).length:0)>0&&(!V||V.size===0);Ee(o,c,{blockData:J,blockRanges:u,arabicVerses:ue,blockTranslations:R,__meta:{isComplete:a}})},[o,c,J,u,ue,R,O,V,Ee]),i.useEffect(()=>{const e=c==="mal"||c==="E",r=Array.isArray(u)&&u.length>0,a=O||V&&V.size>0,n=R?Object.keys(R).length:0;!o||!e||!r||a||n>0||je||(pe(!0),$e("auto"))},[o,c,u,R,O,V,je,$e]),i.useEffect(()=>{const e=nt.current!==c,r=st.current!==o;!e&&!r||(nt.current=c,st.current=o,u.length>0?H(ye(u)):H(new Set),me({}),K.current=!1,ne(null),ke(!1),fe(!1),se(""),Te(!1),Ge({footnoteId:null,footnoteNumber:null,surah:null,ayah:null}),pe(!1))},[c,o,u,ye]),i.useEffect(()=>{(async()=>{if(!oe||!o){Xe(!1);return}try{const r=await De.isFavorited(oe.uid,o);Xe(r)}catch(r){console.error("Error loading favorite status:",r)}})()},[oe,o]),i.useEffect(()=>{if(c!=="E")return;const e=async r=>{const a=r.target.closest(".english-footnote-link");if(!a)return;if(G==="Block Wise"){r.preventDefault(),r.stopPropagation();const N=a.getAttribute("data-footnote-id"),w=a.getAttribute("data-interpretation-id"),M=w&&/^\d+$/.test(w)?parseInt(w,10):null,A=a.getAttribute("data-interpretation-number")||a.getAttribute("data-footnote-number")||(a.textContent||"").trim(),S=A&&/^\d+$/.test(A)?parseInt(A,10):1,j=a.getAttribute("data-ayah"),h=j?parseInt(j,10):null;if(!A&&!N){console.warn("[BlockWise] ⚠️ Missing displayed number and footnote ID");return}let b=null;if(h&&u.length>0){const k=u.find(x=>{const T=x.AyaFrom||x.ayafrom||x.from||0,Y=x.AyaTo||x.ayato||x.to||T;return h>=T&&h<=Y});if(k){const x=k.AyaFrom||k.ayafrom||k.from||1,T=k.AyaTo||k.ayato||k.to||x;b=`${x}-${T}`}else console.warn("[BlockWise] ⚠️ Could not find block range for verse:",h,"available blocks:",u.map(x=>({from:x.AyaFrom||x.ayafrom||x.from,to:x.AyaTo||x.ayato||x.to})))}if(!b&&u.length>0){const k=u[0],x=k.AyaFrom||k.ayafrom||k.from||1,T=k.AyaTo||k.ayato||k.to||x;b=`${x}-${T}`}if(b){ne({range:b,interpretationNumber:S,footnoteId:N,interpretationId:M});return}else console.warn("[BlockWise] ⚠️ Could not determine block range, falling back to footnote modal")}r.preventDefault(),r.stopPropagation();const n=a.getAttribute("data-footnote-id"),s=a.getAttribute("data-interpretation-id"),l=s&&/^\d+$/.test(s)?parseInt(s,10):null,g=a.getAttribute("data-footnote-number")||(a.textContent||"").trim(),f=a.getAttribute("data-interpretation-number")||a.getAttribute("data-footnote-number"),d=f&&/^\d+$/.test(f)?parseInt(f,10):null,B=a.getAttribute("data-ayah"),y=B?parseInt(B,10):null;Ge({footnoteId:n,interpretationId:l,footnoteNumber:g||null,surah:o?parseInt(o,10):null,ayah:y}),se("Loading..."),Te(!0),fe(!0);try{let N="";if(l)N=await le.getInterpretationById(l);else if(n)N=await le.getExplanation(parseInt(n,10));else if(d&&y)N=await le.getInterpretationByNumber(parseInt(o,10),y,d);else{se("Explanation not available.");return}se(N||"Explanation not available.")}catch(N){console.error("Error fetching English footnote explanation:",N),se(`Error loading explanation: ${N.message||N}`)}finally{Te(!1)}};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[c,o,G,u]);const Lt=e=>{if(!e)return"";const r=document.createElement("div");return r.innerHTML=e,r.textContent||r.innerText||""},Dt=(e={})=>e?.TranslationText||e?.translationText||e?.translation_text||e?.text||"",Mt=(e={},r)=>{const a=e?.VerseNo??e?.Verse_Number??e?.verse_number??e?.VerseNumber??e?.ayah_number??e?.AyaId??e?.AyahId??r,n=Number.parseInt(a,10);return Number.isFinite(n)?n:r},_t=(e=[],r=null,a=1)=>{const n=e.length>0?e:r?[r]:[];return n.length===0?"":n.map((s,l)=>{const g=Dt(s);if(!g)return"";const f=Lt(g).trim();if(!f)return"";const d=Mt(s,a+l);return n.length>1?`${d}. ${f}`:f}).filter(Boolean).join(`

`)},ct=(e,r)=>{if(!e)return"";const a=document.createElement("div");return a.innerHTML=e,a.querySelectorAll("sup").forEach(s=>{const l=s.textContent.trim();/^\d+$/.test(l)&&(s.style.cssText=`
          cursor: pointer !important;
          background-color: rgb(41 169 199) !important;
          color: rgb(255, 255, 255) !important;
          font-weight: 600 !important;
          text-decoration: none !important;
          border: none !important;
          display: inline-flex !important;
          align-items: center !important;
          justify-content: center !important;
          font-size: 12px !important;
          vertical-align: middle !important;
          line-height: 1 !important;
          border-radius: 9999px !important;
          position: relative !important;
          z-index: 10 !important;
          top: 0px !important;
          min-width: 20px !important;
          min-height: 19px !important;
          text-align: center !important;
          transition: 0.2s ease-in-out !important;
          padding-top: 3px !important;
          margin-right: 4px;
          margin-left: -1px;
          margin-top: -15px;
          padding-left: 2px !important;
          padding-right: 2px !important;
        `,s.setAttribute("data-interpretation",l),s.setAttribute("data-range",r),s.setAttribute("data-lang",c==="E"?"en":"mal"),s.setAttribute("title",`Click to view interpretation ${l}`),s.setAttribute("aria-label",`Interpretation ${l}`),s.setAttribute("data-interpretation-label",l),s.className="interpretation-link")}),a.innerHTML};i.useEffect(()=>{const e=a=>{let n=a.target.closest(".interpretation-link");if(!n&&c==="E"){const s=a.target.closest(".english-footnote-link");if(s){const g=s.getAttribute("data-interpretation-number")||s.getAttribute("data-footnote-number")||s.textContent?.trim()||"",f=g&&/^\d+$/.test(g)?parseInt(g,10):1,d=s.getAttribute("data-surah"),B=s.getAttribute("data-ayah");if(d===o&&B&&u.length>0){const y=parseInt(B,10),N=u.find(w=>{const M=w.AyaFrom||w.ayafrom||w.from||0,m=w.AyaTo||w.ayato||w.to||M;return y>=M&&y<=m});if(N){const w=N.AyaFrom||N.ayafrom||N.from||1,M=N.AyaTo||N.ayato||N.to||w,m=`${w}-${M}`,A=s.getAttribute("data-footnote-id");a.preventDefault(),a.stopPropagation(),ne({range:m,interpretationNumber:f,footnoteId:A});return}else console.warn("[BlockWise] ⚠️ Could not find block range for verse:",y)}}}if(n){a.preventDefault(),a.stopPropagation();const s=n.getAttribute("data-interpretation"),l=n.getAttribute("data-range");n.getAttribute("data-lang"),s&&l?ne({range:l,interpretationNumber:parseInt(s,10)}):console.warn("[BlockWise] ⚠️ Missing interpretation data:",{interpretationNumber:s,range:l})}},r=document.createElement("style");return r.textContent=`
      .interpretation-link {
        cursor: pointer !important;
      }
      .interpretation-link > a {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 100% !important;
        height: 100% !important;
        color: inherit !important;
        font-weight: inherit !important;
        text-decoration: none !important;
      }
      .interpretation-link:hover {
        background-color: #0891b2 !important;
        transform: scale(1.05) !important;
      }
      .interpretation-link:active {
        background-color: #0e7490 !important;
        transform: scale(0.95) !important;
      }
    `,document.head.appendChild(r),document.addEventListener("click",e,!0),()=>{document.removeEventListener("click",e,!0),document.head.removeChild(r)}},[]);const dt=()=>{const e=parseInt(o)-1;e>=1&&X(`/blockwise/${e}`)},ut=()=>{const e=parseInt(o)+1;e<=114&&X(`/blockwise/${e}`)};if(i.useEffect(()=>{const e=()=>{window.scrollY>300?Ke(!0):Ke(!1)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),O&&u.length===0)return t.jsxs(t.Fragment,{children:[t.jsx(Me,{toasts:Se,removeToast:Be}),t.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 px-4 py-8",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("div",{className:"h-12 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-64 mx-auto mb-4 relative overflow-hidden",children:t.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})}),t.jsx("div",{className:"h-6 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-40 mx-auto relative overflow-hidden",children:t.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})})]}),t.jsx(gt,{count:3})]})})]});if(Ue)return t.jsxs(t.Fragment,{children:[t.jsx(Me,{toasts:Se,removeToast:Be}),t.jsx("div",{className:"min-h-screen bg-white dark:bg-black flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-red-500 dark:text-red-400 text-lg mb-2",children:"Failed to load Block-wise data"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:Ue}),t.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Try Again"})]})})]});const We=J?.surahInfo?.arabic||(o?`Surah ${o}`:"Surah"),Vt=xa(o,We),mt=o?String(o):"",zt=mt==="1"||mt==="2"?"font-normal":"font-semibold",Ut=R?Object.keys(R).length:0,qt=!O&&Array.isArray(u)&&u.length>0&&(V?.size??0)===0&&Ut===0&&je;return t.jsxs(t.Fragment,{children:[t.jsx(Me,{toasts:Se,removeToast:Be}),t.jsx("div",{className:"mx-auto min-h-screen bg-gray-50 dark:bg-gray-900 font-outfit transition-colors duration-300",children:t.jsxs("div",{className:"sticky top-0 z-40 glass border-b border-gray-200/50 dark:border-gray-700/50 transition-all duration-300",children:[t.jsx("div",{className:"container-responsive py-3 sm:py-4",children:t.jsxs("div",{className:"flex flex-col items-center justify-center relative",children:[t.jsx("div",{className:"mb-2 sm:mb-4",children:t.jsx("h1",{className:`text-4xl sm:text-5xl md:text-6xl font-arabic text-center text-gray-800 dark:text-white drop-shadow-sm ${zt}`,style:{fontFamily:ya},"aria-label":We,children:J?Vt:We})}),parseInt(o)!==1&&parseInt(o)!==9&&t.jsx("div",{className:"mb-4 sm:mb-6",children:t.jsx("div",{className:"hidden sm:block",children:t.jsx("div",{className:"max-w-[1290px] mx-auto relative flex items-center justify-center px-4 lg:px-8",children:t.jsx("div",{className:"flex-shrink-0 px-4 sm:px-6 pt-8 pb-6 sm:pt-10 sm:pb-8",children:parseInt(o)!==1&&parseInt(o)!==9?t.jsx("img",{src:Bt==="dark"?ma:ha,alt:"Bismi",className:"w-[236px] h-[52.9px]"}):t.jsx("div",{className:"h-[52.9px]"})})})})}),t.jsx("div",{className:"w-full flex justify-center mb-4 sm:mb-6",children:(c==="mal"||c==="E")&&t.jsx(Xt,{options:["Ayah Wise","Block Wise"],value:"Block Wise",onChange:e=>xe(e)})}),qt&&t.jsx("div",{className:"w-full flex justify-center mb-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 rounded-2xl border border-amber-200 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/30 px-4 py-3 text-sm text-amber-900 dark:text-amber-100",children:[t.jsx("span",{children:"We couldn't load the blockwise translation. Please retry."}),t.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-full bg-amber-600 text-white px-3 py-1.5 text-xs font-semibold hover:bg-amber-700 transition-colors",onClick:()=>$e("manual"),children:"Retry now"})]})})]})}),t.jsx("div",{className:`container-responsive py-6 sm:py-8 space-y-4 sm:space-y-6 ${$?"pb-32 sm:pb-36":""}`,children:O&&u.length===0?t.jsx(gt,{count:5}):u&&u.length>0?u.map((e,r)=>{const a=e.AyaFrom??e.ayafrom??e.from??1,n=e.AyaTo??e.ayato??e.to??a,s=Number.parseInt(a,10),l=Number.parseInt(n,10),g=Number.isFinite(s)&&Number.isFinite(l),f=Number.isFinite(Number(a))?Number(a):1,d=g?s:f,B=Number.isFinite(Number(n))?Number(n):d,y=g?l:B,N=g?`${d}-${y}`:`${a}-${n}`,w=e.ID||e.id||N||`block-${r}`,m=(R[w]||null)?.data,A=Array.isArray(m)?m:Array.isArray(m?.translations)?m.translations:Array.isArray(m?.data)?m.data:[],S=m?_t(A,m,d):"",j=Array.isArray(ue)?ue.slice(d-1,y):[];return t.jsxs("div",{className:"relative rounded-2xl bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 hover:shadow-card hover:border-gray-200 dark:hover:border-gray-600 transition-all duration-300",children:[t.jsxs("div",{className:"absolute top-0 left-0 bg-gray-50 dark:bg-gray-700/50 px-3 py-1.5 rounded-br-xl border-b border-r border-gray-100 dark:border-gray-700 text-xs font-medium text-gray-500 dark:text-gray-400 z-10",children:[o,":",d,d!==y&&`-${y}`]}),t.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 pt-12",children:[t.jsx("div",{className:"w-full mb-6 sm:mb-8 text-right",dir:"rtl",children:t.jsx("p",{className:"leading-[2.2] text-gray-800 dark:text-gray-100",style:{fontFamily:et?`'${et}', serif`:'"Amiri Quran", serif',direction:"rtl",lineHeight:"2.7",fontSize:"23px"},children:j.length>0?j.map((h,b)=>Ce(h.text_uthmani,d+b)).join(" "):"Loading Arabic text..."})}),t.jsx("div",{className:"w-full text-left mb-6",children:m?t.jsx("div",{className:`prose dark:prose-invert max-w-none text-gray-600 dark:text-gray-300 ${c==="hi"?"font-hindi":c==="ur"?"font-urdu":c==="bn"?"font-bengali":c==="ta"?"font-tamil":c==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${tt}px`},children:A.length>0?A.map((h,b)=>{const k=h.TranslationText||h.translationText||h.translation_text||h.text||"",x=h.VerseNo||h.Verse_Number||h.verse_number||h.VerseNumber||h.ayah_number||h.AyaId||h.AyahId||d+b,T=Number.isFinite(parseInt(x,10))?parseInt(x,10):d+b,Y=c==="E"?le.parseEnglishTranslationWithClickableFootnotes(k,parseInt(o,10),T):ct(k,`${d}-${y}`);return t.jsx("div",{className:"leading-relaxed",style:{fontSize:"17px"},"data-footnote-context":"blockwise",dangerouslySetInnerHTML:{__html:Y}},`translation-${w}-${b}`)}):m?.TranslationText||m?.translationText||m?.translation_text||m?.text?t.jsx("div",{className:"leading-relaxed",style:{fontSize:"17px"},"data-footnote-context":"blockwise",dangerouslySetInnerHTML:{__html:c==="E"?le.parseEnglishTranslationWithClickableFootnotes(m.TranslationText||m.translationText||m.translation_text||m.text,parseInt(o,10),d):ct(m.TranslationText||m.translationText||m.translation_text||m.text,`${d}-${y}`)}}):t.jsx("p",{children:"Translation not available"})}):V.has(w)?t.jsx(pa,{message:"Loading translation..."}):t.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Translation not available"})}),t.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-700/50",children:t.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[t.jsx("button",{className:"icon-btn",onClick:async()=>{try{const k=`${j.length>0?j.map((x,T)=>Ce(x.text_uthmani,d+T)).join(" "):"Loading Arabic text..."}

${S||"Translation not available"}`;await navigator.clipboard.writeText(k),Z("Text copied to clipboard!")}catch(h){console.error("Copy failed",h),z("Failed to copy text")}},title:"Copy text",children:t.jsx(Gt,{className:"w-5 h-5"})}),t.jsx("button",{className:`icon-btn ${v===w&&!_?"text-primary bg-primary/10":""}`,onClick:()=>{v===w?_?(E(!1),C(!0),p.current&&p.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(h=>{console.error("Error resuming audio:",h)})):(p.current&&p.current.pause(),E(!0),C(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))):be(w)},title:v===w?_?"Resume audio":"Pause audio":"Play audio",children:v===w&&!_?t.jsx(Yt,{className:"w-5 h-5"}):t.jsx(Jt,{className:"w-5 h-5"})}),c!=="ta"&&c!=="E"&&c!=="mal"&&t.jsx("button",{className:"icon-btn group",onClick:h=>{const b=`/surah/${o}#verse-${d}`;h?.ctrlKey||h?.metaKey?(h.preventDefault(),window.open(b,"_blank","noopener,noreferrer")):X(b)},title:"View ayah details",children:t.jsx(Zt,{className:"w-5 h-5 group-hover:scale-110 transition-transform"})}),t.jsx("button",{className:"icon-btn group",onClick:h=>{const b=`/word-by-word/${o}/${d}`;if(h?.ctrlKey||h?.metaKey){h.preventDefault(),window.open(b,"_blank","noopener,noreferrer");return}Ae(!0),he(d)},title:"Word by word",children:t.jsx(ea,{className:"w-5 h-5 group-hover:scale-110 transition-transform"})}),t.jsx("button",{className:`icon-btn ${Ne[`${d}-${y}`]?"opacity-50 cursor-not-allowed":""}`,onClick:async()=>{if(!oe){z("Please sign in to bookmark blocks"),X("/sign",{state:{from:Ye.pathname,message:"Sign in to bookmark blocks"}});return}const h=`${d}-${y}`;try{Oe(k=>({...k,[h]:!0}));const b=De.getEffectiveUserId(oe);await De.addBlockBookmark(b,o,d,y),Z(`Saved block ${d}-${y}`)}catch(b){console.error("Failed to bookmark block:",b),z("Failed to save block")}finally{Oe(b=>({...b,[h]:!1}))}},title:"Bookmark block",disabled:Ne[`${d}-${y}`],children:Ne[`${d}-${y}`]?t.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b border-current"}):t.jsx(ta,{className:"w-5 h-5"})}),t.jsx("button",{className:"icon-btn",onClick:async()=>{try{const h=window.location.href,x=`${j.length>0?j.map((Y,Re)=>Ce(Y.text_uthmani,d+Re)).join(" "):"Arabic text is loading..."}

${S||"Translation not available"}

Read more: ${h}`,T=`Surah ${o} • Verses ${d}-${y}`;navigator.share?await navigator.share({title:T,text:x}):(await navigator.clipboard.writeText(x),Z("Content copied to clipboard!"))}catch(h){console.error("Share failed",h),z("Failed to share")}},title:"Share block",children:t.jsx(aa,{className:"w-5 h-5"})})]})})]})]},`block-${w}-${d}-${y}`)}):t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No blocks available for this Surah"})})}),t.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 dark:border-gray-700 px-3 sm:px-4 lg:px-6 py-3 sm:py-4 mt-6 sm:mt-8",children:t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"sm:hidden space-y-2",children:[t.jsxs("div",{className:"flex space-x-2",children:[t.jsxs("button",{onClick:dt,disabled:parseInt(o)<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg w-[173.96px] min-h-[44px]
                               disabled:opacity-50 disabled:cursor-not-allowed`,children:[t.jsx(xt,{className:"w-3 h-3"}),t.jsx("span",{children:"Previous Surah"})]}),t.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]`,children:[t.jsx(_e,{className:"w-3 h-3"}),t.jsx("span",{children:"Beginning of Surah"})]})]}),t.jsx("div",{className:"flex justify-center",children:t.jsxs("button",{onClick:ut,disabled:parseInt(o)>=114,className:`w-[173.96px] flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                                 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                                 border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]
                                 disabled:opacity-50 disabled:cursor-not-allowed`,children:[t.jsx("span",{children:"Next Surah"}),t.jsx(pt,{className:"w-3 h-3"})]})})]}),t.jsxs("div",{className:"hidden sm:flex items-center justify-center space-x-2 sm:space-x-4 lg:space-x-6",children:[t.jsxs("button",{onClick:dt,disabled:parseInt(o)<=1,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx(xt,{className:"w-3 h-3 sm:w-4 sm:h-4"}),t.jsx("span",{children:"Previous Surah"})]}),t.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px]",children:[t.jsx(_e,{className:"w-3 h-3 sm:w-4 sm:h-4"}),t.jsx("span",{children:"Beginning of Surah"})]}),t.jsxs("button",{onClick:ut,disabled:parseInt(o)>=114,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx("span",{children:"Next Surah"}),t.jsx(pt,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]})}),yt&&we&&t.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:()=>{ke(!1),Ve(null)}}),t.jsxs("div",{className:"relative w-full sm:w-[550px] max-h-[85vh] sm:max-h-[90vh] bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col animate-slideUp sm:animate-fadeIn overflow-hidden",children:[t.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 sm:hidden cursor-grab active:cursor-grabbing",children:t.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:t.jsx(ft,{surahId:parseInt(o),range:we.toString(),ipt:1,lang:c==="E"?"E":"mal",onClose:()=>{ke(!1),Ve(null)},showSuccess:Z,showError:z,isModal:!0},`interpretation-${o}-${we}`)})]})]}),wt&&He&&t.jsx(ua,{selectedVerse:He,surahId:o,onClose:()=>{Ae(!1),he(null)},onNavigate:e=>he(e),onSurahChange:e=>{Ae(!1),he(null),X(`/surah/${e}?wordByWord=1`)}}),jt&&t.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:()=>fe(!1)}),t.jsxs("div",{className:"relative w-full sm:w-[480px] md:max-w-2xl lg:max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col animate-slideUp sm:animate-fadeIn overflow-hidden",children:[t.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 sm:hidden cursor-grab active:cursor-grabbing",children:t.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),t.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100 dark:border-gray-800",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white",children:"English Explanation"}),ge?.footnoteNumber&&t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Footnote ",ge.footnoteNumber,ge?.ayah?` • Ayah ${ge.ayah}`:""]})]}),t.jsx("button",{onClick:()=>fe(!1),className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-500 dark:text-gray-400",children:t.jsx(ra,{className:"w-5 h-5"})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-5 space-y-6",children:St?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading explanation..."})]})}):t.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg",children:t.jsx("div",{className:"text-gray-700 leading-[1.6] font-poppins sm:leading-[1.7] lg:leading-[1.8] dark:text-white text-sm sm:text-base lg:text-lg prose prose-sm dark:prose-invert max-w-none",style:{fontSize:`${Et}px`},children:Tt})})})]})]}),Q&&t.jsx(ft,{surahId:parseInt(o),range:Q.range,ipt:Q.interpretationNumber,lang:c==="E"?"E":"mal",footnoteId:Q.footnoteId||null,blockRanges:u,onClose:()=>ne(null)},`block-interpretation-${o}-${Q.range}-${Q.interpretationNumber}-${Q.footnoteId||""}`),At&&t.jsx("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`fixed right-6 z-[60] bg-cyan-500 hover:bg-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center ${$?"bottom-32 sm:bottom-36":"bottom-6"}`,title:"Beginning of Surah","aria-label":"Beginning of Surah",children:t.jsx(_e,{className:"w-6 h-6"})})]})}),$&&t.jsx(fa,{audioElement:p.current,isPlaying:I&&p.current&&!p.current.paused,currentAyah:$,totalAyahs:u.reduce((e,r)=>{const a=r.AyaTo||r.ayato||r.to||0,n=r.AyaFrom||r.ayafrom||r.from||0;return e+(a-n+1)},0),surahInfo:J?.surahInfo,onPlayPause:lt,onStop:Pe,onSkipBack:()=>{Pt()},onSkipForward:()=>{it()},onClose:null,selectedQari:ae,onQariChange:e=>{bt(e),v&&$&&(Pe(),setTimeout(()=>{be(v)},100))},translationLanguage:c,audioTypes:L,onAudioTypesChange:e=>{const r=v,a=$;if(console.log("[BlockWise] onAudioTypesChange",{newTypes:e,currentBlock:r,currentAyah:a,isContinuousPlay:I,isPaused:_}),ve(e),r&&a){if(p.current)try{p.current.pause(),p.current.currentTime=0}catch(n){console.warn("[BlockWise] Failed to pause audio before restarting with new types",n)}C(!0),E(!1),W(r),F(a),setTimeout(()=>{console.log("[BlockWise] restarting playback after audioTypes change",{currentBlock:r,currentAyah:a,newTypes:e}),ee(r,a,0,e)},100)}},playbackSpeed:re,onPlaybackSpeedChange:e=>{kt(e)}})]})};export{rr as default};
