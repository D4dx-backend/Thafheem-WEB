import{c as Xt,u as Gt,m as Yt,a as Jt,j as r,T as Zt,C as er,z as tr,P as rr,B as nr,F as ar,o as or,w as ze,p as sr,q as yt,X as ir,A as lr,n as cr,D as ur}from"./index-C60dBqWj.js";import{b as i,u as dr,e as mr,d as fr}from"./react-vendor-v5ei6ytj.js";import{u as hr,T as Ue}from"./Toast-DXMRaaxF.js";import{W as pr}from"./WordByWord-DWVliZAU.js";import xt from"./InterpretationBlockwise-D_NvBXoh.js";import{a as bt,D as gr,B as yr,C as xr,A as qe}from"./LoadingSkeleton-BIJ_MASq.js";import br from"./StickyAudioPlayer-pobjQ3-a.js";import fe from"./englishTranslationService-Bgl1XdqS.js";import{u as kr}from"./useSequentialEnglishFootnotes-B4d1JHKd.js";import{g as wr,s as vr}from"./surahNameUtils-CNmXwDjY.js";import{C as kt}from"./chevron-left-CGNhdKMb.js";import"./tamilWordByWordService-BQTdAcFX.js";import"./apiService-E2C6IBEZ.js";import"./hindiWordByWordService-BZ4hEixL.js";import"./banglaWordByWordService-CDwAi5xz.js";import"./banglaTranslationService-BpXz4sbx.js";import"./tamilTranslationService-BcRoNkHS.js";import"./hindiTranslationService-DcmUgjXI.js";import"./urduTranslationService-DlGO01py.js";import"./BlockInterpretationModal-DiBw8Wvq.js";import"./InterpretationNavbar-mnXKeJny.js";import"./WordByWordIcon-CYdrOSTj.js";import"./volume-x-BZcMCFfr.js";import"./volume-2-BRmDGB-i.js";import"./skip-forward-Go3Yv1Eg.js";import"./surahNameUnicodes-C_pntk6C.js";const sn=()=>{const[Nr,Ar]=i.useState("Translation"),[Br,Tr]=i.useState("Block wise"),[wt,Ae]=i.useState(!1),[Be,Oe]=i.useState(null),[ie,vt]=i.useState("al-hudaify"),[q,Te]=i.useState(["quran"]),[le,Nt]=i.useState(1),[B,L]=i.useState(null),[jr,O]=i.useState(null),[W,R]=i.useState(null),[At,F]=i.useState(1),[D,P]=i.useState(!1),[Q,I]=i.useState(!1),s=i.useRef(null),E=i.useRef(null),T=i.useRef(!1),A=i.useRef(!1);i.useEffect(()=>{console.log("[BlockWise] audioTypes state updated",q)},[q]);const[ne,Qe]=i.useState(null),[V,he]=i.useState(!0),[He,pe]=i.useState(null),[Sr,Er]=i.useState([]),[ge,Ke]=i.useState([]),[je,Xe]=i.useState({}),[d,Ge]=i.useState([]),[M,ye]=i.useState({}),[G,ce]=i.useState(null),[Bt,Se]=i.useState(!1),[Ye,xe]=i.useState(null),[H,Y]=i.useState(new Set),J=i.useRef(!1),[Tt,jt]=i.useState(0),[Ee,be]=i.useState(!1),[St,Je]=i.useState(!1),[Cr,Ze]=i.useState(!1),[$r,Ir]=i.useState(!1),[Et,ke]=i.useState(!1),[Ct,ue]=i.useState(""),[$t,Ce]=i.useState(!1),[we,et]=i.useState({footnoteId:null,footnoteNumber:null,surah:null,ayah:null}),Z=dr(),ee=mr(),{pathname:tt}=ee,{user:de}=Xt(),{toasts:$e,removeToast:Ie,showSuccess:ae,showError:K,showWarning:rt}=hr(),{quranFont:nt,translationLanguage:m,theme:It,adjustedTranslationFontSize:at,viewType:te,setViewType:oe}=Gt(),Wt=Math.max(Number(at)-2,10),{surahId:l}=fr(),{getBlockViewCache:ot,setBlockViewCache:We}=Yt(),st=i.useRef(!1),it=i.useRef(m),lt=i.useRef(l);kr({enabled:m==="E"&&te==="Block Wise",context:"blockwise",dependencies:[M,d,l,ne]}),i.useEffect(()=>{ee.state?.viewType&&oe(ee.state.viewType)},[ee.state,oe]),i.useEffect(()=>{if(!(m==="mal"||m==="E")){te!=="Ayah Wise"&&oe("Ayah Wise");return}if(te==="Ayah Wise"){const n=`/surah/${l}`;tt!==n&&Z(n)}else te!=="Block Wise"&&oe("Block Wise")},[te,m,l,Z,tt,oe]);const{surahs:Fe}=Jt(),ve=i.useCallback((e=[])=>!Array.isArray(e)||e.length===0?new Set:new Set(e.map((n,t)=>{const a=n.AyaFrom??n.ayafrom??n.from??1,o=n.AyaTo??n.ayato??n.to??a,c=Number.parseInt(a,10),p=Number.parseInt(o,10),g=Number.isFinite(c)&&Number.isFinite(p),u=Number.isFinite(Number(a))?Number(a):1,j=g?c:u,b=Number.isFinite(Number(o))?Number(o):j,x=g?`${j}-${g?p:b}`:`${a}-${o}`;return n.ID||n.id||x||`block-${t}`})),[]),Ft=e=>{const n=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];return e.toString().split("").map(t=>n[t]||t).join("")},Pt=e=>e?e.replace(/\s*﴿\s*[\d\u0660-\u0669]+\s*﴾\s*$/u,"").trim():"",Pe=(e,n)=>`${Pt(e)||e||""} ﴿${Ft(n)}﴾`,z=(e,n=null)=>{const t=Number.parseInt(e,10);return Number.isFinite(t)?t:n},Re=i.useCallback((e="manual")=>{if(!l)return;console.log(`[BlockWise] Triggering blockwise reload (${e})`),J.current=!1;const n=ve(d);Y(n),ye({}),pe(null),e==="manual"&&be(!1),jt(t=>t+1)},[l,d,ve]);i.useEffect(()=>(s.current||(s.current=new Audio),()=>{s.current&&(s.current.pause(),s.current.src="",s.current.currentTime=0),L(null),O(null),R(null),P(!1),I(!1),E.current=null,T.current=!1}),[]);const Rt={"al-hudaify":"QH","al-afasy":"QA","al-ghamidi":"QG"},ct=e=>({E:"English",mal:"Malayalam",ur:"Urdu",bn:"Bangla",ta:"Tamil",hi:"Hindi"})[e]||e,Ne=(e,n=!1,t=null)=>{if(!s.current)return;const a=t||q;if(console.log("[BlockWise] playBlockAudio start",{blockId:e,fromContinuous:n,audioTypes:a,preservedAudioTypes:t,translationLanguage:m,selectedQirath:ie}),!n&&m!=="mal"&&a.some(u=>u==="translation"||u==="interpretation")){const u=ct(m);rt(`${u} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available for blockwise view.`);const j=q.filter(b=>b!=="translation"&&b!=="interpretation");j.length>0?Te(j):Te(["quran"]);return}if(s.current)try{s.current.pause(),s.current.onended=null,s.current.onerror=null,s.current.src="",s.current.load()}catch(g){console.warn("[BlockWise] Error cleaning up audio:",g)}const o=d.find(g=>(g.ID||g.id)===e);if(!o){console.error("Block not found:",e),A.current=!1;return}const c=o.AyaFrom||o.ayafrom||o.from||1,p=z(c,1);P(!0),L(e),R(p),F(1),I(!1),E.current=e,T.current=!0,console.log("[BlockWise] playBlockAudio state set",{playingBlock:e,normalizedStartingAyah:p,currentAudioType:a?.[0]||"quran",audioTypes:a}),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}})),se(e,p,0,a)},Lt=async(e,n,t,a=1)=>{const o=String(e).padStart(3,"0"),c=String(n).padStart(3,"0"),p="https://old.thafheem.net/audio";if(t==="quran")return`${p}/qirath/${ie}/${Rt[ie]}${o}_${c}.ogg`;if(t==="translation")return`${p}/translation/T${o}_${c}.ogg`;if(t==="interpretation"){if(a===1)return`${p}/interpretation/I${o}_${c}.ogg`;{const g=String(a).padStart(2,"0");return`${p}/interpretation/I${o}_${c}_${g}.ogg`}}return null},U=async(e,n,t=0,a=null)=>{if(!s.current)return;const o=z(n,z(W,1)||1),c=a||q;if(console.log("[BlockWise] playAyahAudioWithTypes",{blockId:e,requestedAyah:n,ayahToPlay:o,audioTypeIndex:t,audioTypes:c,audioTypesLength:c.length,shouldMoveToNext:t>=c.length,playbackSpeed:le,isContinuousPlay:D,isPaused:Q,playingBlock:B}),t>=c.length){console.log("[BlockWise] All audio types played for ayah, moving to next ayah",{audioTypeIndex:t,audioTypesLength:c.length,ayahToPlay:o,blockId:e}),ut(o,c);return}try{s.current.onended&&(s.current.onended=null),s.current.onerror&&(s.current.onerror=null),s.current.pause()}catch(y){console.warn("[BlockWise] Error stopping previous audio:",y)}const p=c[t];let g=1;p==="interpretation"&&(g=At);let u;try{u=await Lt(l,o,p,g)}catch(y){console.error("[BlockWise] Error generating audio URL:",y),U(e,o,t+1,a);return}if(!u){U(e,o,t+1,a);return}console.log("[BlockWise] generated audioUrl",{blockId:e,ayahToPlay:o,currentAudioType:p,audioUrl:u});const b={quran:"qirath",translation:"translation",interpretation:"interpretation"}[p]||"qirath";O(b),R(o);try{s.current.onended=null,s.current.onerror=null}catch(y){console.warn("[BlockWise] Error clearing audio handlers:",y)}let w=null;const x=()=>{w&&(clearTimeout(w),w=null)},_=()=>{x(),w=setTimeout(()=>{s.current&&s.current.readyState<2&&B===e&&W===o&&D&&(console.warn("[BlockWise] Audio load timeout (file may be missing):",u),U(e,o,t+1,c))},5e3)};s.current.onended=()=>{if(x(),console.log("[BlockWise] Audio ended",{blockId:e,ayahToPlay:o,audioTypeIndex:t,currentAudioType:p,playingBlock:E.current,isContinuousPlay:T.current,audioTypes:c,totalTypes:c.length,isProcessingNext:A.current}),A.current){console.warn("[BlockWise] onended handler aborted - already processing next move");return}T.current&&E.current===e?(console.log("[BlockWise] Continuing to next audio type/ayah"),U(e,o,t+1,c)):console.warn("[BlockWise] Not continuing - state mismatch",{isContinuousPlay:T.current,playingBlock:E.current,blockId:e,ayahToPlay:o})},s.current.onerror=y=>{x();const S=s.current;if(S&&S.error){const h=S.error.code;if(h===2||h===4){if(p==="interpretation"){if(A.current=!0,s.current)try{s.current.pause(),s.current.onended=null,s.current.onerror=null}catch(v){console.warn("[BlockWise] Error cleaning up audio on interpretation error:",v)}if(F(1),T.current&&E.current===e){setTimeout(()=>{U(e,o,t+1,c),setTimeout(()=>{A.current=!1},300)},200);return}else A.current=!1}}else console.error("[BlockWise] Unexpected audio error:",{errorCode:S.error?.code,audioUrl:u,currentAudioType:p})}else console.error("[BlockWise] Audio error event (unknown error):",u,y);T.current&&E.current===e&&!A.current?setTimeout(()=>{U(e,o,t+1,c)},200):A.current||console.warn("[BlockWise] Not continuing after error - state mismatch",{isContinuousPlay:T.current,playingBlock:E.current,blockId:e})};const f=()=>{A.current=!1,s.current.removeEventListener("canplay",f)};s.current.addEventListener("canplay",f,{once:!0}),s.current.addEventListener("canplay",x,{once:!0}),s.current.addEventListener("loadeddata",x,{once:!0}),s.current.src=u,s.current.playbackRate=le,s.current.load(),_(),s.current.play().catch(y=>{if(x(),A.current){setTimeout(()=>{A.current=!1},100);return}y.name!=="NotSupportedError"&&console.error("[BlockWise] Error playing audio:",y.name,y.message,u),T.current&&E.current===e?(A.current=!1,setTimeout(()=>{U(e,o,t+1,c)},200)):(A.current=!1,console.warn("[BlockWise] Not continuing after play error - state mismatch",{blockId:e,playingBlockRef:E.current,isContinuousPlayRef:T.current}))})},se=(e,n,t=0,a=null)=>{U(e,n,t,a)},ut=(e=null,n=null)=>{if(A.current){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - already processing next",{currentAyahOverride:e,currentAyahInBlock:W});return}const t=e??W,a=E.current||B;if(!a||!t){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - no playing block or ayah",{currentPlayingBlock:a,effectiveCurrentAyah:t,playingBlock:B,playingBlockRef:E.current});return}A.current=!0;const o=d.find(j=>(j.ID||j.id)===a);if(!o){A.current=!1;return}const c=o.AyaTo||o.ayato||o.to,p=z(t,null),g=z(c,p);if(p===null||g===null){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - invalid ayah numbers",{currentPlayingBlock:a,currentAyahInBlock:t,ayaTo:c}),A.current=!1;return}const u=p+1;if(console.log("[BlockWise] moveToNextAyahOrBlock",{currentPlayingBlock:a,currentAyahNumber:p,nextAyah:u,ayaToNumber:g,isContinuousPlay:T.current}),u<=g)F(1),se(a,u,0,n);else if(T.current){if(s.current)try{s.current.pause(),s.current.onended=null,s.current.onerror=null}catch(j){console.warn("[BlockWise] Error cleaning up audio before next block:",j)}F(1),A.current=!1,setTimeout(()=>{_t()},50)}else{if(s.current)try{s.current.pause(),s.current.onended=null,s.current.onerror=null}catch(j){console.warn("[BlockWise] Error stopping audio:",j)}L(null),O(null),R(null),F(1),I(!1),E.current=null,T.current=!1,A.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},Dt=(e=null,n=null)=>{const t=e??W;if(!B||!t)return;const a=d.find(u=>(u.ID||u.id)===B);if(!a)return;const o=a.AyaFrom||a.ayafrom||a.from||1,c=z(t,null),p=z(o,1);if(c===null||p===null){console.warn("[BlockWise] moveToPreviousAyahOrBlock aborted - invalid ayah numbers",{playingBlock:B,currentAyahInBlock:t,ayaFrom:o});return}const g=c-1;console.log("[BlockWise] moveToPreviousAyahOrBlock",{playingBlock:B,currentAyahNumber:c,previousAyah:g,ayaFromNumber:p,isContinuousPlay:D}),g>=p?(F(1),se(B,g,0,n)):D?(F(1),Mt()):(L(null),O(null),R(null),F(1),I(!1))},Mt=()=>{if(!D||!d||d.length===0)return;const e=d.findIndex(n=>(n.ID||n.id)===B);if(e>0){const n=d[e-1],t=n.ID||n.id,a=n.AyaTo||n.ayato||n.to||1,o=z(a,1);P(!0),L(t),R(o),F(1),I(!1),E.current=t,T.current=!0,se(t,o)}else{const n=d[0],t=n.ID||n.id,a=n.AyaFrom||n.ayafrom||n.from||1,o=z(a,1);L(t),R(o),F(1),se(t,o)}},_t=()=>{if(A.current){console.warn("[BlockWise] playNextBlock aborted - already processing next");return}if(!T.current||!d||d.length===0){console.warn("[BlockWise] playNextBlock aborted - invalid state",{isContinuousPlay:T.current,isContinuousPlayState:D,blockRangesLength:d?.length}),A.current=!1;return}A.current=!0;const n=E.current||B,t=d.findIndex(a=>(a.ID||a.id)===n);if(console.log("[BlockWise] playNextBlock",{currentIndex:t,currentPlayingBlock:n,playingBlock:B,playingBlockRef:E.current,blockRangesLength:d.length}),t!==-1&&t<d.length-1){const a=d[t+1],o=a.ID||a.id;if(!o){console.error("[BlockWise] playNextBlock - next block has no ID",a);return}if(s.current)try{s.current.pause(),s.current.onended=null,s.current.onerror=null,s.current.src="",s.current.load()}catch(c){console.warn("[BlockWise] Error cleaning up audio before next block:",c)}setTimeout(()=>{try{Ne(o,!0,q)}catch(c){console.error("[BlockWise] Error playing next block:",c),L(null),O(null),R(null),F(1),P(!1),I(!1),A.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},100)}else{if(console.log("[BlockWise] playNextBlock - end of blocks reached"),s.current)try{s.current.pause(),s.current.onended=null,s.current.onerror=null}catch(a){console.warn("[BlockWise] Error stopping audio at end:",a)}L(null),O(null),R(null),F(1),P(!1),I(!1),E.current=null,T.current=!1,A.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},dt=()=>{if(!d||d.length===0){K("No blocks available to play");return}if(m!=="mal"){const e=ct(m);rt(`${e} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available.`);return}try{if(D)s.current&&s.current.pause(),P(!1),I(!0),T.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}));else if(B&&W)P(!0),I(!1),T.current=!0,s.current&&s.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(e=>{console.error("Error resuming audio:",e)});else{P(!0),I(!1),T.current=!0;const e=d[0].ID||d[0].id;Ne(e)}}catch(e){console.error("Error in handlePlayAudio:",e),P(!1),L(null),R(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},Le=i.useRef(null);Le.current=dt,i.useEffect(()=>{const e=()=>{Le.current&&Le.current()};return window.addEventListener("playAudio",e),()=>{window.removeEventListener("playAudio",e)}},[]),i.useEffect(()=>{const e=D&&!Q&&B!==null;window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:e}}))},[D,Q,B]),i.useEffect(()=>{const e=n=>{const{type:t,message:a}=n.detail;t==="success"?ae(a):t==="error"&&K(a)};return window.addEventListener("showToast",e),()=>{window.removeEventListener("showToast",e)}},[ae,K]);const De=()=>{s.current&&(s.current.pause(),s.current.currentTime=0,s.current.onended=null,s.current.onerror=null),P(!1),L(null),O(null),R(null),E.current=null,T.current=!1,A.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}})),F(1),I(!1)};i.useEffect(()=>()=>{try{De()}catch{}},[]),i.useEffect(()=>()=>{s.current&&(s.current.pause(),L(null),O(null),R(null),F(1),P(!1),I(!1),E.current=null,T.current=!1,A.current=!1)},[l]),i.useEffect(()=>{B&&W&&s.current&&D&&se(B,W,0)},[ie,q]),i.useEffect(()=>{s.current&&(s.current.playbackRate=le)},[le]),i.useEffect(()=>{st.current=!1},[l,m]),i.useEffect(()=>{be(!1)},[l]),i.useEffect(()=>{if(!l||!(m==="mal"||m==="E"))return;const n=ot?.(l,m);if(n){st.current=!0,Qe(n.blockData||null),Ge(n.blockRanges||[]),Ke(n.arabicVerses||[]),ye(n.blockTranslations||{}),pe(null),Y(new Set);const t=n.blockTranslations?Object.keys(n.blockTranslations).length:0,a=!!(n.__meta?.isComplete&&t>0);he(!a),J.current=a}},[l,m,ot]),i.useEffect(()=>((async()=>{if(!l||J.current||Fe.length===0)return;if(!(m==="mal"||m==="E")){console.log(`⚠️ BlockWise: Language '${m}' doesn't support blockwise. Skipping fetch.`),he(!1);return}J.current=!0;try{he(!0),pe(null);const[t,a]=await Promise.all([lr(parseInt(l),m||"mal"),cr(parseInt(l))]),o=Fe.find(c=>c.number===parseInt(l));if(Qe({surahInfo:o||{number:parseInt(l),arabic:"القرآن",type:"Makki"}}),Ke(a||[]),Ge(t||[]),t&&t.length>0){const c=async(f,y)=>{const S=f.AyaFrom||f.ayafrom||f.from,C=f.AyaTo||f.ayato||f.to;if(S==null||C===void 0||C===null)return;const h=Number.parseInt(S,10),N=Number.parseInt(C,10),v=Number.isFinite(h)&&Number.isFinite(N),k=v?`${h}-${N}`:`${S}-${C}`,$=f.ID||f.id||k||`block-${y}`,re=v?h:S,_e=v?N:C;try{Y(X=>new Set([...X,$]));let me;const Ve=m||"mal";me=await ur(parseInt(l),k,Ve),ye(X=>({...X,[$]:{range:k,ayaFrom:re,ayaTo:_e,data:me}})),Y(X=>{const gt=new Set(X);return gt.delete($),gt})}catch(me){me.message?.includes("timeout")||console.error(`❌ BlockWise: Failed to load block ${k}:`,me.message),Y(Ve=>{const X=new Set(Ve);return X.delete($),X})}},g=[];let u=0;const j=async(f,y)=>new Promise(S=>{const C=async()=>{u++;try{await c(f,y)}catch{}finally{u--,g.length>0&&g.shift()(),S()}};u<5?C():g.push(C)}),b=f=>{const y=f.slice(0,3),S=f.slice(3);return{visibleBlocks:y,backgroundBlocks:S}},{visibleBlocks:w,backgroundBlocks:x}=b(t),_=w.map((f,y)=>c(f,y));x.forEach((f,y)=>{setTimeout(()=>{j(f,y+w.length)},50*Math.floor(y/5))}),Promise.allSettled(_).then(f=>{const y=f.filter(S=>S.status==="fulfilled").length})}}catch(t){let a=t.message;t.message?.includes("timeout")||t.message?.includes("Request timeout")?a="The server is taking longer than expected to respond. Please try again in a moment. If the problem persists, the English blockwise data may be temporarily unavailable.":t.message?.includes("Failed to fetch")||t.message?.includes("Network error")?a="Unable to connect to the server. Please check your internet connection and try again.":t.message?.includes("HTTP error")&&(a=`Server error: ${t.message}. Please try again later.`),pe(a),console.error("Error fetching block-wise data:",t),J.current=!1}finally{he(!1)}})(),()=>{J.current=!1}),[l,Fe,m,Tt]),i.useEffect(()=>{if(!l||!(m==="mal"||m==="E")||!We||V||!Array.isArray(d)||d.length===0)return;const t=(M?Object.keys(M).length:0)>0&&(!H||H.size===0);We(l,m,{blockData:ne,blockRanges:d,arabicVerses:ge,blockTranslations:M,__meta:{isComplete:t}})},[l,m,ne,d,ge,M,V,H,We]),i.useEffect(()=>{const e=m==="mal"||m==="E",n=Array.isArray(d)&&d.length>0,t=V||H&&H.size>0,a=M?Object.keys(M).length:0;!l||!e||!n||t||a>0||Ee||(be(!0),Re("auto"))},[l,m,d,M,V,H,Ee,Re]),i.useEffect(()=>{const e=it.current!==m,n=lt.current!==l;!e&&!n||(it.current=m,lt.current=l,d.length>0?Y(ve(d)):Y(new Set),ye({}),J.current=!1,ce(null),Ae(!1),ke(!1),ue(""),Ce(!1),et({footnoteId:null,footnoteNumber:null,surah:null,ayah:null}),be(!1))},[m,l,d,ve]),i.useEffect(()=>{(async()=>{if(!de||!l){Ze(!1);return}try{const n=await ze.isFavorited(de.uid,l);Ze(n)}catch(n){console.error("Error loading favorite status:",n)}})()},[de,l]),i.useEffect(()=>{if(m!=="E")return;const e=async n=>{const t=n.target.closest(".english-footnote-link");if(!t)return;if(te==="Block Wise"){n.preventDefault(),n.stopPropagation();const w=t.getAttribute("data-footnote-id"),x=t.getAttribute("data-interpretation-id"),_=x&&/^\d+$/.test(x)?parseInt(x,10):null,y=t.getAttribute("data-interpretation-number")||t.getAttribute("data-footnote-number")||(t.textContent||"").trim(),S=y&&/^\d+$/.test(y)?parseInt(y,10):1,C=t.getAttribute("data-ayah"),h=C?parseInt(C,10):null;if(!y&&!w){console.warn("[BlockWise] ⚠️ Missing displayed number and footnote ID");return}let N=null;if(h&&d.length>0){const v=d.find(k=>{const $=k.AyaFrom||k.ayafrom||k.from||0,re=k.AyaTo||k.ayato||k.to||$;return h>=$&&h<=re});if(v){const k=v.AyaFrom||v.ayafrom||v.from||1,$=v.AyaTo||v.ayato||v.to||k;N=`${k}-${$}`}else console.warn("[BlockWise] ⚠️ Could not find block range for verse:",h,"available blocks:",d.map(k=>({from:k.AyaFrom||k.ayafrom||k.from,to:k.AyaTo||k.ayato||k.to})))}if(!N&&d.length>0){const v=d[0],k=v.AyaFrom||v.ayafrom||v.from||1,$=v.AyaTo||v.ayato||v.to||k;N=`${k}-${$}`}if(N){ce({range:N,interpretationNumber:S,footnoteId:w,interpretationId:_});return}else console.warn("[BlockWise] ⚠️ Could not determine block range, falling back to footnote modal")}n.preventDefault(),n.stopPropagation();const a=t.getAttribute("data-footnote-id"),o=t.getAttribute("data-interpretation-id"),c=o&&/^\d+$/.test(o)?parseInt(o,10):null,p=t.getAttribute("data-footnote-number")||(t.textContent||"").trim(),g=t.getAttribute("data-interpretation-number")||t.getAttribute("data-footnote-number"),u=g&&/^\d+$/.test(g)?parseInt(g,10):null,j=t.getAttribute("data-ayah"),b=j?parseInt(j,10):null;et({footnoteId:a,interpretationId:c,footnoteNumber:p||null,surah:l?parseInt(l,10):null,ayah:b}),ue("Loading..."),Ce(!0),ke(!0);try{let w="";if(c)w=await fe.getInterpretationById(c);else if(a)w=await fe.getExplanation(parseInt(a,10));else if(u&&b)w=await fe.getInterpretationByNumber(parseInt(l,10),b,u);else{ue("Explanation not available.");return}ue(w||"Explanation not available.")}catch(w){console.error("Error fetching English footnote explanation:",w),ue(`Error loading explanation: ${w.message||w}`)}finally{Ce(!1)}};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[m,l,te,d]);const Vt=e=>{if(!e)return"";const n=document.createElement("div");return n.innerHTML=e,n.textContent||n.innerText||""},zt=(e={})=>e?.TranslationText||e?.translationText||e?.translation_text||e?.text||"",Ut=(e={},n)=>{const t=e?.VerseNo??e?.Verse_Number??e?.verse_number??e?.VerseNumber??e?.ayah_number??e?.AyaId??e?.AyahId??n,a=Number.parseInt(t,10);return Number.isFinite(a)?a:n},qt=(e=[],n=null,t=1)=>{const a=e.length>0?e:n?[n]:[];return a.length===0?"":a.map((o,c)=>{const p=zt(o);if(!p)return"";const g=Vt(p).trim();if(!g)return"";const u=Ut(o,t+c);return a.length>1?`${u}. ${g}`:g}).filter(Boolean).join(`

`)},mt=(e,n)=>{if(!e)return"";const t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll("sup").forEach(o=>{const c=o.textContent.trim();/^\d+$/.test(c)&&(o.style.cssText=`
          cursor: pointer !important;
          background-color: rgb(41 169 199) !important;
          color: rgb(255, 255, 255) !important;
          font-weight: 600 !important;
          text-decoration: none !important;
          border: none !important;
          display: inline-flex !important;
          align-items: center !important;
          justify-content: center !important;
          font-size: 12px !important;
          vertical-align: middle !important;
          line-height: 1 !important;
          border-radius: 9999px !important;
          position: relative !important;
          z-index: 10 !important;
          top: 0px !important;
          min-width: 20px !important;
          min-height: 19px !important;
          text-align: center !important;
          transition: 0.2s ease-in-out !important;
          padding-top: 3px !important;
          margin-right: 4px;
          margin-left: -1px;
          margin-top: -15px;
          padding-left: 2px !important;
          padding-right: 2px !important;
        `,o.setAttribute("data-interpretation",c),o.setAttribute("data-range",n),o.setAttribute("data-lang",m==="E"?"en":"mal"),o.setAttribute("title",`Click to view interpretation ${c}`),o.setAttribute("aria-label",`Interpretation ${c}`),o.setAttribute("data-interpretation-label",c),o.className="interpretation-link")}),t.innerHTML};i.useEffect(()=>{const e=t=>{let a=t.target.closest(".interpretation-link");if(!a&&m==="E"){const o=t.target.closest(".english-footnote-link");if(o){const p=o.getAttribute("data-interpretation-number")||o.getAttribute("data-footnote-number")||o.textContent?.trim()||"",g=p&&/^\d+$/.test(p)?parseInt(p,10):1,u=o.getAttribute("data-surah"),j=o.getAttribute("data-ayah");if(u===l&&j&&d.length>0){const b=parseInt(j,10),w=d.find(x=>{const _=x.AyaFrom||x.ayafrom||x.from||0,f=x.AyaTo||x.ayato||x.to||_;return b>=_&&b<=f});if(w){const x=w.AyaFrom||w.ayafrom||w.from||1,_=w.AyaTo||w.ayato||w.to||x,f=`${x}-${_}`,y=o.getAttribute("data-footnote-id");t.preventDefault(),t.stopPropagation(),ce({range:f,interpretationNumber:g,footnoteId:y});return}else console.warn("[BlockWise] ⚠️ Could not find block range for verse:",b)}}}if(a){t.preventDefault(),t.stopPropagation();const o=a.getAttribute("data-interpretation"),c=a.getAttribute("data-range");a.getAttribute("data-lang"),o&&c?ce({range:c,interpretationNumber:parseInt(o,10)}):console.warn("[BlockWise] ⚠️ Missing interpretation data:",{interpretationNumber:o,range:c})}},n=document.createElement("style");return n.textContent=`
      .interpretation-link {
        cursor: pointer !important;
      }
      .interpretation-link > a {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 100% !important;
        height: 100% !important;
        color: inherit !important;
        font-weight: inherit !important;
        text-decoration: none !important;
      }
      .interpretation-link:hover {
        background-color: #0891b2 !important;
        transform: scale(1.05) !important;
      }
      .interpretation-link:active {
        background-color: #0e7490 !important;
        transform: scale(0.95) !important;
      }
    `,document.head.appendChild(n),document.addEventListener("click",e,!0),()=>{document.removeEventListener("click",e,!0),document.head.removeChild(n)}},[]);const ft=()=>{const e=parseInt(l)-1;e>=1&&Z(`/blockwise/${e}`)},ht=()=>{const e=parseInt(l)+1;e<=114&&Z(`/blockwise/${e}`)};if(i.useEffect(()=>{const e=()=>{window.scrollY>300?Je(!0):Je(!1)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),i.useEffect(()=>{const e=()=>{const n=ee.state?.scrollToBlock;n&&!V&&d.length>0&&setTimeout(()=>{const t=document.getElementById(`block-${n}`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.backgroundColor="#fef3c7",setTimeout(()=>{t.style.backgroundColor=""},2e3))},500)};!V&&d.length>0&&e()},[V,d,ee.state]),V&&d.length===0)return r.jsxs(r.Fragment,{children:[r.jsx(Ue,{toasts:$e,removeToast:Ie}),r.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 px-4 py-8",children:r.jsxs("div",{className:"max-w-7xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"h-12 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-64 mx-auto mb-4 relative overflow-hidden",children:r.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})}),r.jsx("div",{className:"h-6 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-40 mx-auto relative overflow-hidden",children:r.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})})]}),r.jsx(bt,{count:3})]})})]});if(He)return r.jsxs(r.Fragment,{children:[r.jsx(Ue,{toasts:$e,removeToast:Ie}),r.jsx("div",{className:"min-h-screen bg-white dark:bg-black flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 dark:text-red-400 text-lg mb-2",children:"Failed to load Block-wise data"}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:He}),r.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Try Again"})]})})]});const Me=ne?.surahInfo?.arabic||(l?`Surah ${l}`:"Surah"),Ot=wr(l,Me),pt=l?String(l):"",Qt=pt==="1"||pt==="2"?"font-normal":"font-semibold",Ht=M?Object.keys(M).length:0,Kt=!V&&Array.isArray(d)&&d.length>0&&(H?.size??0)===0&&Ht===0&&Ee;return r.jsxs(r.Fragment,{children:[r.jsx(Ue,{toasts:$e,removeToast:Ie}),r.jsx("div",{className:"mx-auto min-h-screen bg-gray-50 dark:bg-gray-900 font-outfit transition-colors duration-300",children:r.jsxs("div",{className:"sticky top-0 z-40 glass border-b border-gray-200/50 dark:border-gray-700/50 transition-all duration-300",children:[r.jsx("div",{className:"container-responsive py-3 sm:py-4",children:r.jsxs("div",{className:"flex flex-col items-center justify-center relative",children:[r.jsx("div",{className:"mb-2 sm:mb-4",children:r.jsx("h1",{className:`text-4xl sm:text-5xl md:text-6xl font-arabic text-center text-gray-800 dark:text-white drop-shadow-sm ${Qt}`,style:{fontFamily:vr},"aria-label":Me,children:ne?Ot:Me})}),parseInt(l)!==1&&parseInt(l)!==9&&r.jsx("div",{className:"mb-4 sm:mb-6",children:r.jsx("div",{className:"hidden sm:block",children:r.jsx("div",{className:"max-w-[1290px] mx-auto relative flex items-center justify-center px-4 lg:px-8",children:r.jsx("div",{className:"flex-shrink-0 px-4 sm:px-6 pt-8 pb-6 sm:pt-10 sm:pb-8",children:parseInt(l)!==1&&parseInt(l)!==9?r.jsx("img",{src:It==="dark"?gr:yr,alt:"Bismi",className:"w-[236px] h-[52.9px]"}):r.jsx("div",{className:"h-[52.9px]"})})})})}),r.jsx("div",{className:"w-full flex justify-center mb-4 sm:mb-6",children:(m==="mal"||m==="E")&&r.jsx(Zt,{options:["Ayah Wise","Block Wise"],value:"Block Wise",onChange:e=>oe(e)})}),Kt&&r.jsx("div",{className:"w-full flex justify-center mb-4",children:r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 rounded-2xl border border-amber-200 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/30 px-4 py-3 text-sm text-amber-900 dark:text-amber-100",children:[r.jsx("span",{children:"We couldn't load the blockwise translation. Please retry."}),r.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-full bg-amber-600 text-white px-3 py-1.5 text-xs font-semibold hover:bg-amber-700 transition-colors",onClick:()=>Re("manual"),children:"Retry now"})]})})]})}),r.jsx("div",{className:`container-responsive py-6 sm:py-8 space-y-4 sm:space-y-6 ${W?"pb-32 sm:pb-36":""}`,children:V&&d.length===0?r.jsx(bt,{count:5}):d&&d.length>0?d.map((e,n)=>{const t=e.AyaFrom??e.ayafrom??e.from??1,a=e.AyaTo??e.ayato??e.to??t,o=Number.parseInt(t,10),c=Number.parseInt(a,10),p=Number.isFinite(o)&&Number.isFinite(c),g=Number.isFinite(Number(t))?Number(t):1,u=p?o:g,j=Number.isFinite(Number(a))?Number(a):u,b=p?c:j,w=p?`${u}-${b}`:`${t}-${a}`,x=e.ID||e.id||w||`block-${n}`,f=(M[x]||null)?.data,y=Array.isArray(f)?f:Array.isArray(f?.translations)?f.translations:Array.isArray(f?.data)?f.data:[],S=f?qt(y,f,u):"",C=Array.isArray(ge)?ge.slice(u-1,b):[];return r.jsxs("div",{id:`block-${u}-${b}`,className:"relative rounded-2xl bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 hover:shadow-card hover:border-gray-200 dark:hover:border-gray-600 transition-all duration-300",children:[r.jsxs("div",{className:"absolute top-0 left-0 bg-gray-50 dark:bg-gray-700/50 px-3 py-1.5 rounded-br-xl border-b border-r border-gray-100 dark:border-gray-700 text-xs font-medium text-gray-500 dark:text-gray-400 z-10",children:[l,":",u,u!==b&&`-${b}`]}),r.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 pt-12",children:[r.jsx("div",{className:"w-full mb-6 sm:mb-8 text-right",dir:"rtl",children:r.jsx("p",{className:"leading-[2.2] text-gray-800 dark:text-gray-100",style:{fontFamily:nt?`'${nt}', serif`:'"Amiri Quran", serif',direction:"rtl",lineHeight:"2.7",fontSize:"23px"},children:C.length>0?C.map((h,N)=>Pe(h.text_uthmani,u+N)).join(" "):"Loading Arabic text..."})}),r.jsx("div",{className:"w-full text-left mb-6",children:f?r.jsx("div",{className:`prose dark:prose-invert max-w-none text-gray-600 dark:text-gray-300 ${m==="hi"?"font-hindi":m==="ur"?"font-urdu":m==="bn"?"font-bengali":m==="ta"?"font-tamil":m==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${at}px`},children:y.length>0?y.map((h,N)=>{const v=h.TranslationText||h.translationText||h.translation_text||h.text||"",k=h.VerseNo||h.Verse_Number||h.verse_number||h.VerseNumber||h.ayah_number||h.AyaId||h.AyahId||u+N,$=Number.isFinite(parseInt(k,10))?parseInt(k,10):u+N,re=m==="E"?fe.parseEnglishTranslationWithClickableFootnotes(v,parseInt(l,10),$):mt(v,`${u}-${b}`);return r.jsx("div",{className:"leading-relaxed",style:{fontSize:"17px"},"data-footnote-context":"blockwise",dangerouslySetInnerHTML:{__html:re}},`translation-${x}-${N}`)}):f?.TranslationText||f?.translationText||f?.translation_text||f?.text?r.jsx("div",{className:"leading-relaxed",style:{fontSize:"17px"},"data-footnote-context":"blockwise",dangerouslySetInnerHTML:{__html:m==="E"?fe.parseEnglishTranslationWithClickableFootnotes(f.TranslationText||f.translationText||f.translation_text||f.text,parseInt(l,10),u):mt(f.TranslationText||f.translationText||f.translation_text||f.text,`${u}-${b}`)}}):r.jsx("p",{children:"Translation not available"})}):H.has(x)?r.jsx(xr,{message:"Loading translation..."}):r.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Translation not available"})}),r.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-700/50",children:r.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[r.jsx("button",{className:"icon-btn",onClick:async()=>{try{const v=`${C.length>0?C.map((k,$)=>Pe(k.text_uthmani,u+$)).join(" "):"Loading Arabic text..."}

${S||"Translation not available"}`;await navigator.clipboard.writeText(v),ae("Text copied to clipboard!")}catch(h){console.error("Copy failed",h),K("Failed to copy text")}},title:"Copy text",children:r.jsx(er,{className:"w-5 h-5"})}),r.jsx("button",{className:`icon-btn ${B===x&&!Q?"text-primary bg-primary/10":""}`,onClick:()=>{B===x?Q?(I(!1),P(!0),T.current=!0,s.current&&s.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(h=>{console.error("Error resuming audio:",h)})):(s.current&&s.current.pause(),I(!0),P(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))):Ne(x)},title:B===x?Q?"Resume audio":"Pause audio":"Play audio",children:B===x&&!Q?r.jsx(tr,{className:"w-5 h-5"}):r.jsx(rr,{className:"w-5 h-5"})}),m!=="ta"&&m!=="E"&&m!=="mal"&&r.jsx("button",{className:"icon-btn group",onClick:h=>{const N=`/surah/${l}#verse-${u}`;h?.ctrlKey||h?.metaKey?(h.preventDefault(),window.open(N,"_blank","noopener,noreferrer")):Z(N)},title:"View ayah details",children:r.jsx(nr,{className:"w-5 h-5 group-hover:scale-110 transition-transform"})}),r.jsx("button",{className:"icon-btn group",onClick:h=>{const N=`/word-by-word/${l}/${u}`;if(h?.ctrlKey||h?.metaKey){h.preventDefault(),window.open(N,"_blank","noopener,noreferrer");return}Se(!0),xe(u)},title:"Word by word",children:r.jsx(ar,{className:"w-5 h-5 group-hover:scale-110 transition-transform"})}),r.jsx("button",{className:`icon-btn ${je[`${u}-${b}`]?"opacity-50 cursor-not-allowed":""}`,onClick:async()=>{if(!de){K("Please sign in to bookmark blocks"),Z("/sign",{state:{from:ee.pathname,message:"Sign in to bookmark blocks"}});return}const h=`${u}-${b}`;try{Xe(v=>({...v,[h]:!0}));const N=ze.getEffectiveUserId(de);await ze.addBlockBookmark(N,l,u,b),ae(`Saved block ${u}-${b}`)}catch(N){console.error("Failed to bookmark block:",N),K("Failed to save block")}finally{Xe(N=>({...N,[h]:!1}))}},title:"Bookmark block",disabled:je[`${u}-${b}`],children:je[`${u}-${b}`]?r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b border-current"}):r.jsx(or,{className:"w-5 h-5"})}),r.jsx("button",{className:"icon-btn",onClick:async()=>{try{const h=window.location.href,k=`${C.length>0?C.map((re,_e)=>Pe(re.text_uthmani,u+_e)).join(" "):"Arabic text is loading..."}

${S||"Translation not available"}

Read more: ${h}`,$=`Surah ${l} • Verses ${u}-${b}`;navigator.share?await navigator.share({title:$,text:k}):(await navigator.clipboard.writeText(k),ae("Content copied to clipboard!"))}catch(h){console.error("Share failed",h),K("Failed to share")}},title:"Share block",children:r.jsx(sr,{className:"w-5 h-5"})})]})})]})]},`block-${x}-${u}-${b}`)}):r.jsx("div",{className:"text-center py-8",children:r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No blocks available for this Surah"})})}),r.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 dark:border-gray-700 px-3 sm:px-4 lg:px-6 py-3 sm:py-4 mt-6 sm:mt-8",children:r.jsxs("div",{className:"max-w-4xl mx-auto",children:[r.jsxs("div",{className:"sm:hidden space-y-2",children:[r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs("button",{onClick:ft,disabled:parseInt(l)<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg w-[173.96px] min-h-[44px]
                               disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx(kt,{className:"w-3 h-3"}),r.jsx("span",{children:"Previous Surah"})]}),r.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]`,children:[r.jsx(qe,{className:"w-3 h-3"}),r.jsx("span",{children:"Beginning of Surah"})]})]}),r.jsx("div",{className:"flex justify-center",children:r.jsxs("button",{onClick:ht,disabled:parseInt(l)>=114,className:`w-[173.96px] flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                                 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                                 border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]
                                 disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx("span",{children:"Next Surah"}),r.jsx(yt,{className:"w-3 h-3"})]})})]}),r.jsxs("div",{className:"hidden sm:flex items-center justify-center space-x-2 sm:space-x-4 lg:space-x-6",children:[r.jsxs("button",{onClick:ft,disabled:parseInt(l)<=1,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(kt,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{children:"Previous Surah"})]}),r.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px]",children:[r.jsx(qe,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{children:"Beginning of Surah"})]}),r.jsxs("button",{onClick:ht,disabled:parseInt(l)>=114,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx("span",{children:"Next Surah"}),r.jsx(yt,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]})}),wt&&Be&&r.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[r.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:()=>{Ae(!1),Oe(null)}}),r.jsxs("div",{className:"relative w-full sm:w-[550px] max-h-[85vh] sm:max-h-[90vh] bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col animate-slideUp sm:animate-fadeIn overflow-hidden",children:[r.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 sm:hidden cursor-grab active:cursor-grabbing",children:r.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:r.jsx(xt,{surahId:parseInt(l),range:Be.toString(),ipt:1,lang:m==="E"?"E":"mal",onClose:()=>{Ae(!1),Oe(null)},showSuccess:ae,showError:K,isModal:!0},`interpretation-${l}-${Be}`)})]})]}),Bt&&Ye&&r.jsx(pr,{selectedVerse:Ye,surahId:l,onClose:()=>{Se(!1),xe(null)},onNavigate:e=>xe(e),onSurahChange:e=>{Se(!1),xe(null),Z(`/surah/${e}?wordByWord=1`)}}),Et&&r.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[r.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:()=>ke(!1)}),r.jsxs("div",{className:"relative w-full sm:w-[480px] md:max-w-2xl lg:max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col animate-slideUp sm:animate-fadeIn overflow-hidden",children:[r.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 sm:hidden cursor-grab active:cursor-grabbing",children:r.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),r.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100 dark:border-gray-800",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white",children:"English Explanation"}),we?.footnoteNumber&&r.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Footnote ",we.footnoteNumber,we?.ayah?` • Ayah ${we.ayah}`:""]})]}),r.jsx("button",{onClick:()=>ke(!1),className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-500 dark:text-gray-400",children:r.jsx(ir,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-5 space-y-6",children:$t?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading explanation..."})]})}):r.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg",children:r.jsx("div",{className:"text-gray-700 leading-[1.6] font-poppins sm:leading-[1.7] lg:leading-[1.8] dark:text-white text-sm sm:text-base lg:text-lg prose prose-sm dark:prose-invert max-w-none",style:{fontSize:`${Wt}px`},children:Ct})})})]})]}),G&&r.jsx(xt,{surahId:parseInt(l),range:G.range,ipt:G.interpretationNumber,lang:m==="E"?"E":"mal",footnoteId:G.footnoteId||null,blockRanges:d,onClose:()=>ce(null)},`block-interpretation-${l}-${G.range}-${G.interpretationNumber}-${G.footnoteId||""}`),St&&r.jsx("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`fixed right-6 z-[60] bg-cyan-500 hover:bg-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center ${W?"bottom-32 sm:bottom-36":"bottom-6"}`,title:"Beginning of Surah","aria-label":"Beginning of Surah",children:r.jsx(qe,{className:"w-6 h-6"})})]})}),W&&r.jsx(br,{audioElement:s.current,isPlaying:D&&s.current&&!s.current.paused,currentAyah:W,totalAyahs:d.reduce((e,n)=>{const t=n.AyaTo||n.ayato||n.to||0,a=n.AyaFrom||n.ayafrom||n.from||0;return e+(t-a+1)},0),surahInfo:ne?.surahInfo,onPlayPause:dt,onStop:De,onSkipBack:()=>{Dt()},onSkipForward:()=>{ut()},onClose:null,selectedQari:ie,onQariChange:e=>{vt(e),B&&W&&(De(),setTimeout(()=>{Ne(B)},100))},translationLanguage:m,audioTypes:q,onAudioTypesChange:e=>{const n=B,t=W;if(console.log("[BlockWise] onAudioTypesChange",{newTypes:e,currentBlock:n,currentAyah:t,isContinuousPlay:D,isPaused:Q}),Te(e),n&&t){if(s.current)try{s.current.pause(),s.current.currentTime=0}catch(a){console.warn("[BlockWise] Failed to pause audio before restarting with new types",a)}P(!0),I(!1),L(n),R(t),E.current=n,T.current=!0,setTimeout(()=>{console.log("[BlockWise] restarting playback after audioTypes change",{currentBlock:n,currentAyah:t,newTypes:e}),U(n,t,0,e)},100)}},playbackSpeed:le,onPlaybackSpeedChange:e=>{Nt(e)}})]})};export{sn as default};
