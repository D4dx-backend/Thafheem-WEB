import{r,a as Ft,b as Pt,g as Wt,u as Lt,d as Dt,c as Rt,j as e,C as Mt,A as _t,P as Vt,B as zt,F as qt,n as Ut,x as ve,o as Ot,p as Ye,D as Qt,v as Ht,E as Je}from"./index-BMIAMJ2S.js";import{u as Kt,T as ke}from"./Toast-hgqkhZCU.js";import{W as Xt}from"./WordByWord-jcr3aTZE.js";import Ze from"./InterpretationBlockwise-BhF0D3Ou.js";import{a as et,D as tt,B as at,C as Gt,A as Ne}from"./LoadingSkeleton-CYX4cX91.js";import{A as st,B as rt,t as nt}from"./ViewToggleIcons-CDYDORcl.js";import Yt from"./StickyAudioPlayer-CuthTrXn.js";import je from"./englishTranslationService-4zs7-gXX.js";import{g as Jt,s as Zt}from"./surahNameUtils-CNmXwDjY.js";import{C as ot}from"./chevron-left-DDzfuR59.js";import"./tamilWordByWordService-CbdEWK98.js";import"./hindiWordByWordService-C4orOXOT.js";import"./banglaWordByWordService-CCV5metC.js";import"./banglaTranslationService-ByBH3qbp.js";import"./apiService-xUHHIAvd.js";import"./tamilTranslationService-CFME1no4.js";import"./hindiTranslationService-C7DZVBgF.js";import"./urduTranslationService-BXqK4Yjb.js";import"./InterpretationNavbar-CN815TMw.js";import"./WordByWordIcon-C1MNQ2Dq.js";import"./volume-x-C6ZEY_RJ.js";import"./volume-2-C53T7naH.js";import"./skip-forward-on6WBx6y.js";import"./surahNameUnicodes-C_pntk6C.js";const La=()=>{const[ea,ta]=r.useState("Translation"),[aa,sa]=r.useState("Block wise"),[it,Ae]=r.useState(!1),[oe,lt]=r.useState(null),[O,ct]=r.useState("al-hudaify"),[P,ie]=r.useState(["quran"]),[Q,dt]=r.useState(1),[f,C]=r.useState(null),[ra,R]=r.useState(null),[I,S]=r.useState(null),[na,T]=r.useState(1),[j,A]=r.useState(!1),[M,N]=r.useState(!1),d=r.useRef(null);r.useEffect(()=>{console.log("[BlockWise] audioTypes state updated",P)},[P]);const[le,ut]=r.useState(null),[Se,ce]=r.useState(!0),[Te,Ee]=r.useState(null),[oa,ia]=r.useState([]),[Be,mt]=r.useState([]),[de,Ce]=r.useState({}),[g,Ie]=r.useState([]),[ht,$e]=r.useState({}),[H,ue]=r.useState(null),[pt,me]=r.useState(!1),[Fe,J]=r.useState(null),[xt,Z]=r.useState(new Set),K=r.useRef(!1),[ft,Pe]=r.useState(!1),[la,We]=r.useState(!1),[ca,da]=r.useState(!1),[gt,he]=r.useState(!1),[yt,ee]=r.useState(""),[bt,pe]=r.useState(!1),[te,Le]=r.useState({footnoteId:null,footnoteNumber:null,surah:null,ayah:null}),_=Ft(),De=Pt(),{pathname:Re}=De,{user:X}=Wt(),{toasts:xe,removeToast:fe,showSuccess:V,showError:W,showWarning:Me}=Kt(),{quranFont:wt,translationLanguage:m,theme:_e,translationFontSize:Ve,viewType:ae,setViewType:se}=Lt(),vt=Math.max(Number(Ve)-2,10),{surahId:i}=Dt();r.useEffect(()=>{if(!(m==="mal"||m==="E")){ae!=="Ayah Wise"&&se("Ayah Wise");return}if(ae==="Ayah Wise"){const s=`/surah/${i}`;Re!==s&&_(s)}else ae!=="Block Wise"&&se("Block Wise")},[ae,m,i,_,Re,se]);const ze=()=>{se("Ayah Wise")},{surahs:ge}=Rt(),kt=t=>{const s=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];return t.toString().split("").map(a=>s[a]||a).join("")},L=(t,s=null)=>{const a=Number.parseInt(t,10);return Number.isFinite(a)?a:s};r.useEffect(()=>(d.current||(d.current=new Audio),()=>{d.current&&(d.current.pause(),d.current.src="",d.current.currentTime=0),C(null),R(null),S(null),A(!1),N(!1)}),[]);const Nt={"al-hudaify":"QH","al-afasy":"QA","al-ghamidi":"QG"},qe=t=>({E:"English",mal:"Malayalam",ur:"Urdu",bn:"Bangla",ta:"Tamil",hi:"Hindi"})[t]||t,re=(t,s=!1)=>{if(!d.current)return;if(console.log("[BlockWise] playBlockAudio start",{blockId:t,fromContinuous:s,audioTypes:P,translationLanguage:m,selectedQirath:O}),!s&&m!=="mal"&&P.some(y=>y==="translation"||y==="interpretation")){const y=qe(m);Me(`${y} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available.`);const p=P.filter(h=>h!=="translation"&&h!=="interpretation");p.length>0?ie(p):ie(["quran"]);return}d.current&&d.current.pause();const a=g.find(u=>(u.ID||u.id)===t);if(!a){console.error("Block not found:",t);return}const n=a.AyaFrom||a.ayafrom||a.from||1,o=L(n,1);A(!0),C(t),S(o),T(1),N(!1),console.log("[BlockWise] playBlockAudio state set",{playingBlock:t,normalizedStartingAyah:o,currentAudioType:P?.[0]||"quran"}),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}})),U(t,o,0)},jt=(t,s,a)=>{const n=String(t).padStart(3,"0"),o=String(s).padStart(3,"0");return a==="quran"?`https://old.thafheem.net/audio/qirath/${O}/${Nt[O]}${n}_${o}.ogg`:a==="translation"?`https://old.thafheem.net/audio/translation/T${n}_${o}.ogg`:a==="interpretation"?`https://old.thafheem.net/audio/interpretation/I${n}_${o}.ogg`:null},q=(t,s,a=0,n=null)=>{if(!d.current)return;const o=L(s,L(I,1)||1),u=n||P;if(console.log("[BlockWise] playAyahAudioWithTypes",{blockId:t,requestedAyah:s,ayahToPlay:o,audioTypeIndex:a,audioTypes:u,playbackSpeed:Q,isContinuousPlay:j,isPaused:M,playingBlock:f}),a>=u.length){Ue(o,u);return}d.current.pause();const y=u[a],p=jt(i,o,y);if(!p){q(t,o,a+1,n);return}console.log("[BlockWise] generated audioUrl",{blockId:t,ayahToPlay:o,currentAudioType:y,audioUrl:p});const G={quran:"qirath",translation:"translation",interpretation:"interpretation"}[y]||"qirath";R(G),S(o),d.current.onended=null,d.current.onerror=null,d.current.onended=()=>{q(t,o,a+1,u)},d.current.onerror=()=>{console.error("Error playing audio:",p),q(t,o,a+1,u)},d.current.src=p,d.current.playbackRate=Q,d.current.load(),d.current.play().catch(b=>{console.error("Error playing audio:",b.name,b.message,p),q(t,o,a+1,u)})},U=(t,s,a=0,n=null)=>{q(t,s,a,n)},Ue=(t=null,s=null)=>{const a=t??I;if(!f||!a)return;const n=g.find(h=>(h.ID||h.id)===f);if(!n)return;const o=n.AyaTo||n.ayato||n.to,u=L(a,null),y=L(o,u);if(u===null||y===null){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - invalid ayah numbers",{playingBlock:f,currentAyahInBlock:a,ayaTo:o});return}const p=u+1;console.log("[BlockWise] moveToNextAyahOrBlock",{playingBlock:f,currentAyahNumber:u,nextAyah:p,ayaToNumber:y,isContinuousPlay:j}),p<=y?(T(1),U(f,p,0,s)):j?(T(1),Tt()):(C(null),R(null),S(null),T(1),N(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}})))},At=(t=null,s=null)=>{const a=t??I;if(!f||!a)return;const n=g.find(h=>(h.ID||h.id)===f);if(!n)return;const o=n.AyaFrom||n.ayafrom||n.from||1,u=L(a,null),y=L(o,1);if(u===null||y===null){console.warn("[BlockWise] moveToPreviousAyahOrBlock aborted - invalid ayah numbers",{playingBlock:f,currentAyahInBlock:a,ayaFrom:o});return}const p=u-1;console.log("[BlockWise] moveToPreviousAyahOrBlock",{playingBlock:f,currentAyahNumber:u,previousAyah:p,ayaFromNumber:y,isContinuousPlay:j}),p>=y?(T(1),U(f,p,0,s)):j?(T(1),St()):(C(null),R(null),S(null),T(1),N(!1))},St=()=>{if(!j||!g||g.length===0)return;const t=g.findIndex(s=>(s.ID||s.id)===f);if(t>0){const s=g[t-1],a=s.ID||s.id,n=s.AyaTo||s.ayato||s.to||1,o=L(n,1);A(!0),C(a),S(o),T(1),N(!1),U(a,o)}else{const s=g[0],a=s.ID||s.id,n=s.AyaFrom||s.ayafrom||s.from||1,o=L(n,1);C(a),S(o),T(1),U(a,o)}},Tt=()=>{if(!j||!g||g.length===0)return;const t=g.findIndex(s=>(s.ID||s.id)===f);if(t!==-1&&t<g.length-1){const s=g[t+1],a=s.ID||s.id;re(a,!0)}else C(null),R(null),S(null),T(1),A(!1),N(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))},Oe=()=>{if(!g||g.length===0){W("No blocks available to play");return}if(m!=="mal"){const t=qe(m);Me(`${t} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available.`);return}try{if(j)d.current&&d.current.pause(),A(!1),N(!0),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}));else if(f&&I)A(!0),N(!1),d.current&&d.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(t=>{console.error("Error resuming audio:",t)});else{A(!0),N(!1);const t=g[0].ID||g[0].id;re(t)}}catch(t){console.error("Error in handlePlayAudio:",t),A(!1),C(null),S(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},ye=r.useRef(null);ye.current=Oe,r.useEffect(()=>{const t=()=>{ye.current&&ye.current()};return window.addEventListener("playAudio",t),()=>{window.removeEventListener("playAudio",t)}},[]),r.useEffect(()=>{const t=j&&!M&&f!==null;window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:t}}))},[j,M,f]),r.useEffect(()=>{const t=s=>{const{type:a,message:n}=s.detail;a==="success"?V(n):a==="error"&&W(n)};return window.addEventListener("showToast",t),()=>{window.removeEventListener("showToast",t)}},[V,W]);const be=()=>{d.current&&(d.current.pause(),d.current.currentTime=0),A(!1),C(null),R(null),S(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}})),T(1),N(!1)};r.useEffect(()=>()=>{try{be()}catch{}},[]),r.useEffect(()=>()=>{d.current&&(d.current.pause(),C(null),R(null),S(null),T(1),A(!1),N(!1))},[i]),r.useEffect(()=>{f&&I&&d.current&&j&&U(f,I,0)},[O,P]),r.useEffect(()=>{d.current&&(d.current.playbackRate=Q)},[Q]),r.useEffect(()=>((async()=>{if(!i||K.current||ge.length===0)return;if(!(m==="mal"||m==="E")){console.log(`⚠️ BlockWise: Language '${m}' doesn't support blockwise. Skipping fetch.`),ce(!1);return}K.current=!0;try{ce(!0),Ee(null);const[a,n]=await Promise.all([Qt(parseInt(i),m||"mal"),Ht(parseInt(i))]),o=ge.find(u=>u.number===parseInt(i));if(ut({surahInfo:o||{number:parseInt(i),arabic:"القرآن",type:"Makki"}}),mt(n||[]),Ie(a||[]),a&&a.length>0){const u=async(l,w)=>{const v=l.AyaFrom||l.ayafrom||l.from,c=l.AyaTo||l.ayato||l.to;if(v==null||c===void 0||c===null)return;const x=Number.parseInt(v,10),E=Number.parseInt(c,10),B=Number.isFinite(x)&&Number.isFinite(E),k=B?`${x}-${E}`:`${v}-${c}`,F=l.ID||l.id||k||`block-${w}`,It=B?x:v,$t=B?E:c;try{Z(z=>new Set([...z,F]));let D;m==="E"?(D=await nt.getCachedTranslation(parseInt(i),k,"E"),D||(D=await Je(parseInt(i),k,"E"),await nt.setCachedTranslation(parseInt(i),k,D,"E"))):D=await Je(parseInt(i),k,m||"mal"),$e(z=>({...z,[F]:{range:k,ayaFrom:It,ayaTo:$t,data:D}})),Z(z=>{const Y=new Set(z);return Y.delete(F),Y})}catch(D){D.message?.includes("timeout")||console.error(`❌ BlockWise: Failed to load block ${k}:`,D.message),Z(z=>{const Y=new Set(z);return Y.delete(F),Y})}},p=[];let h=0;const G=async(l,w)=>new Promise(v=>{const c=async()=>{h++;try{await u(l,w)}catch{}finally{h--,p.length>0&&p.shift()(),v()}};h<3?c():p.push(c)}),b=l=>{const w=l.slice(0,2),v=l.slice(2);return{visibleBlocks:w,backgroundBlocks:v}},{visibleBlocks:ne,backgroundBlocks:$}=b(a),Ge=ne.map((l,w)=>u(l,w));setTimeout(()=>{$.forEach((l,w)=>{setTimeout(()=>{G(l,w+ne.length)},200*Math.floor(w/3))})},500),Promise.allSettled(Ge).then(l=>{const w=l.filter(v=>v.status==="fulfilled").length})}}catch(a){Ee(a.message),console.error("Error fetching block-wise data:",a),K.current=!1}finally{ce(!1)}})(),()=>{K.current=!1}),[i,ge,m]),r.useEffect(()=>{$e({}),Ie([]),Z(new Set),K.current=!1,ue(null),Ae(!1),he(!1),ee(""),pe(!1),Le({footnoteId:null,footnoteNumber:null,surah:null,ayah:null})},[m]),r.useEffect(()=>{(async()=>{if(!X||!i){We(!1);return}try{const s=await ve.isFavorited(X.uid,i);We(s)}catch(s){console.error("Error loading favorite status:",s)}})()},[X,i]),r.useEffect(()=>{if(m!=="E")return;const t=async s=>{const a=s.target.closest(".english-footnote-link");if(!a)return;s.preventDefault(),s.stopPropagation();const n=a.getAttribute("data-footnote-id");if(!n)return;const o=(a.textContent||"").trim()||a.getAttribute("data-footnote-number"),u=a.getAttribute("data-ayah"),y=u?parseInt(u,10):null;Le({footnoteId:n,footnoteNumber:o||null,surah:i?parseInt(i,10):null,ayah:y}),ee("Loading..."),pe(!0),he(!0);try{const p=await je.getExplanation(parseInt(n,10));ee(p||"Explanation not available.")}catch(p){console.error("Error fetching English footnote explanation:",p),ee(`Error loading explanation: ${p.message||p}`)}finally{pe(!1)}};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[m,i]);const Et=(t,s)=>{ue({range:t,interpretationNumber:s})},Qe=(t,s)=>{if(!t)return"";const a=document.createElement("div");return a.innerHTML=t,a.querySelectorAll("sup").forEach(o=>{const u=o.textContent.trim();/^\d+$/.test(u)&&(o.style.cssText=`
          cursor: pointer !important;
          background-color: #19B5DD !important;
          color: #ffffff !important;
          font-weight: 600 !important;
          text-decoration: none !important;
          border: none !important;
          padding: 0 !important;
          margin: 0 4px !important;
          display: inline-flex !important;
          align-items: center !important;
          justify-content: center !important;
          font-size: 12px !important;
          vertical-align: middle !important;
          line-height: 1 !important;
          border-radius: 9999px !important;
          position: relative !important;
          top: 0 !important;
          min-width: 24px !important;
          min-height: 24px !important;
          width: 24px !important;
          height: 24px !important;
          text-align: center !important;
          transition: all 0.2s ease-in-out !important;
        `,o.setAttribute("data-interpretation",u),o.setAttribute("data-range",s),o.setAttribute("data-lang",m==="E"?"en":"mal"),o.setAttribute("title",`Click to view interpretation ${u}`),o.className="interpretation-link")}),a.innerHTML};r.useEffect(()=>{const t=a=>{const n=a.target.closest(".interpretation-link");if(n){a.preventDefault(),a.stopPropagation();const o=n.getAttribute("data-interpretation"),u=n.getAttribute("data-range");n.getAttribute("data-lang"),o&&u&&requestAnimationFrame(()=>{Et(u,parseInt(o))})}},s=document.createElement("style");return s.textContent=`
      .interpretation-link {
        cursor: pointer !important;
      }
      .interpretation-link > a {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 100% !important;
        height: 100% !important;
        color: inherit !important;
        font-weight: inherit !important;
        text-decoration: none !important;
      }
      .interpretation-link:hover {
        background-color: #0891b2 !important;
        transform: scale(1.05) !important;
      }
      .interpretation-link:active {
        background-color: #0e7490 !important;
        transform: scale(0.95) !important;
      }
    `,document.head.appendChild(s),document.addEventListener("click",t,!0),()=>{document.removeEventListener("click",t,!0),document.head.removeChild(s)}},[]);const He=()=>{const t=parseInt(i)-1;t>=1&&_(`/blockwise/${t}`)},Ke=()=>{const t=parseInt(i)+1;t<=114&&_(`/blockwise/${t}`)};if(r.useEffect(()=>{const t=()=>{window.scrollY>300?Pe(!0):Pe(!1)};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[]),Se&&g.length===0)return e.jsxs(e.Fragment,{children:[e.jsx(ke,{toasts:xe,removeToast:fe}),e.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"h-12 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-64 mx-auto mb-4 relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})}),e.jsx("div",{className:"h-6 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-40 mx-auto relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})})]}),e.jsx(et,{count:3})]})})]});if(Te)return e.jsxs(e.Fragment,{children:[e.jsx(ke,{toasts:xe,removeToast:fe}),e.jsx("div",{className:"min-h-screen bg-white dark:bg-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 dark:text-red-400 text-lg mb-2",children:"Failed to load Block-wise data"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:Te}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Try Again"})]})})]});const we=le?.surahInfo?.arabic||(i?`Surah ${i}`:"Surah"),Bt=Jt(i,we),Xe=i?String(i):"",Ct=Xe==="1"||Xe==="2"?"font-normal":"font-semibold";return e.jsxs(e.Fragment,{children:[e.jsx(ke,{toasts:xe,removeToast:fe}),e.jsx("div",{className:"mx-auto min-h-screen bg-white dark:bg-gray-900",children:e.jsxs("div",{className:"sticky top-0 z-40 bg-white dark:bg-gray-900 shadow-md",children:[e.jsx("div",{className:"mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"py-3 sm:py-4",children:[e.jsx("div",{className:"text-center mb-3 sm:mb-4",children:e.jsx("h1",{className:`text-4xl sm:text-5xl font-arabic dark:text-white text-gray-900 mb-5 sm:mb-7 px-4 sm:px-6 ${Ct}`,style:{fontFamily:Zt},"aria-label":we,children:le?Bt:we})}),e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsxs("div",{className:"max-w-[1290px] mx-auto relative flex items-center justify-center px-4 lg:px-8",children:[e.jsx("div",{className:"flex-shrink-0 px-4 sm:px-6 pt-8 pb-6 sm:pt-10 sm:pb-8",children:parseInt(i)!==1&&parseInt(i)!==9?e.jsx("img",{src:_e==="dark"?tt:at,alt:"Bismi",className:"w-[236px] h-[52.9px]"}):e.jsx("div",{className:"h-[52.9px]"})}),(m==="mal"||m==="E")&&e.jsx("div",{className:"absolute -right-4 md:-right-3 lg:-right-2 xl:-right-1 top-1/2 -translate-y-1/2",children:e.jsxs("div",{className:"flex gap-1 bg-gray-100 dark:bg-[#323A3F] rounded-full p-1 shadow-sm",children:[e.jsxs("button",{className:"flex items-center justify-center px-3 py-1.5 text-gray-500 rounded-full dark:text-white hover:text-cyan-600 dark:hover:text-cyan-400 hover:bg-cyan-50 dark:hover:bg-cyan-900/40 transition-colors whitespace-nowrap",onClick:ze,"aria-label":"Switch to ayah wise view",children:[e.jsx(st,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"sr-only",children:"Ayah wise"})]}),e.jsxs("button",{className:"flex items-center justify-center px-3 py-1.5 bg-white dark:bg-gray-900 text-gray-900 dark:text-white rounded-full shadow-sm transition-colors whitespace-nowrap","aria-label":"Block wise view selected",children:[e.jsx(rt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"sr-only",children:"Block wise"})]})]})})]})}),e.jsxs("div",{className:"sm:hidden",children:[e.jsx("div",{className:"flex justify-center",children:parseInt(i)!==1&&parseInt(i)!==9?e.jsx("div",{className:"px-4 pt-8 pb-6",children:e.jsx("img",{src:_e==="dark"?tt:at,alt:"Bismi",className:"w-[236px] h-[52.9px]"})}):e.jsx("div",{className:"h-[52.9px]"})}),(m==="mal"||m==="E")&&e.jsx("div",{className:"mt-3 flex justify-end px-4",children:e.jsxs("div",{className:"flex gap-1 bg-gray-100 dark:bg-[#323A3F] rounded-full p-1 shadow-sm",children:[e.jsxs("button",{className:"flex items-center justify-center px-2 py-1.5 text-gray-500 rounded-full dark:text-white hover:text-cyan-600 dark:hover:text-cyan-400 hover:bg-cyan-50 dark:hover:bg-cyan-900/40 transition-colors",onClick:ze,"aria-label":"Switch to ayah wise view",children:[e.jsx(st,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Ayah wise"})]}),e.jsxs("button",{className:"flex items-center justify-center px-2 py-1.5 bg-white dark:bg-gray-900 text-gray-900 dark:text-white rounded-full shadow transition-colors","aria-label":"Block wise view selected",children:[e.jsx(rt,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Block wise"})]})]})})]})]})]})}),e.jsxs("div",{className:"mx-auto px-3 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"max-w-full sm:max-w-[1290px] mx-auto pb-6 sm:pb-8",children:[Se&&g.length===0?e.jsx(et,{count:5}):g&&g.length>0?g.map((t,s)=>{const a=t.AyaFrom??t.ayafrom??t.from??1,n=t.AyaTo??t.ayato??t.to??a,o=Number.parseInt(a,10),u=Number.parseInt(n,10),y=Number.isFinite(o)&&Number.isFinite(u),p=Number.isFinite(Number(a))?Number(a):1,h=y?o:p,G=Number.isFinite(Number(n))?Number(n):h,b=y?u:G,ne=y?`${h}-${b}`:`${a}-${n}`,$=t.ID||t.id||ne||`block-${s}`,l=(ht[$]||null)?.data,w=Array.isArray(l)?l:Array.isArray(l?.translations)?l.translations:Array.isArray(l?.data)?l.data:[],v=Array.isArray(Be)?Be.slice(h-1,b):[];return e.jsxs("div",{className:"rounded-xl mb-2 sm:mb-3 border border-gray-200 dark:border-gray-700 dark:hover:bg-gray-800 hover:bg-[#e8f2f6] active:bg-[#e8f2f6] transition-colors",children:[e.jsx("div",{className:"px-4 sm:px-6 md:px-8 pt-3 sm:pt-4 pb-1 sm:pb-1.5",children:e.jsx("p",{className:"text-lg sm:text-lg md:text-xl lg:text-2xl xl:text-xl text-right text-gray-900 dark:text-white",style:{fontFamily:`'${wt}', serif`,direction:"rtl",lineHeight:"2.5"},children:v.length>0?v.map((c,x)=>`${c.text_uthmani} ﴿${kt(h+x)}﴾`).join(" "):"Loading Arabic text..."})}),e.jsx("div",{className:"px-4 sm:px-6 md:px-8 pt-3 sm:pt-4 pb-2 sm:pb-3",children:l?e.jsx("div",{className:`text-gray-700 dark:text-white leading-relaxed text-left ${m==="hi"?"font-hindi":m==="ur"?"font-urdu":m==="bn"?"font-bengali":m==="ta"?"font-tamil":m==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${vt}px`},children:w.length>0?w.map((c,x)=>{const E=c.TranslationText||c.translationText||c.translation_text||c.text||"",B=c.VerseNo||c.Verse_Number||c.verse_number||c.VerseNumber||c.ayah_number||c.AyaId||c.AyahId||h+x,k=Number.isFinite(parseInt(B,10))?parseInt(B,10):h+x,F=m==="E"?je.parseEnglishTranslationWithClickableFootnotes(E,parseInt(i,10),k):Qe(E,`${h}-${b}`);return e.jsx("div",{className:"leading-relaxed",dangerouslySetInnerHTML:{__html:F}},`translation-${$}-${x}`)}):l?.TranslationText||l?.translationText||l?.translation_text||l?.text?e.jsx("div",{className:"leading-relaxed",dangerouslySetInnerHTML:{__html:m==="E"?je.parseEnglishTranslationWithClickableFootnotes(l.TranslationText||l.translationText||l.translation_text||l.text,parseInt(i,10),h):Qe(l.TranslationText||l.translationText||l.translation_text||l.text,`${h}-${b}`)}}):e.jsx("p",{children:"Translation not available"})}):xt.has($)?e.jsx(Gt,{message:"Loading translation..."}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Translation not available"})}),e.jsx("div",{className:"px-4 sm:px-6 md:px-8 pt-0.5 pb-1 sm:pb-1.5",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-1 sm:gap-1.5 lg:gap-2",children:[e.jsx("button",{className:"p-1.5 sm:p-1.5 text-[#2AA0BF] hover:text-[#0f5f72] dark:hover:text-cyan-300 transition-colors min-h-[36px] sm:min-h-[40px] min-w-[36px] sm:min-w-[40px] flex items-center justify-center focus:outline-none",onClick:async()=>{try{const c=v.length>0?v.map((B,k)=>`${B.text_uthmani} ﴿${h+k}﴾`).join(" "):"Loading Arabic text...";let x="Loading translation...";if(l){let B="";if(w.length>0){const F=w[0];B=F.TranslationText||F.translationText||F.translation_text||F.text||""}else B=l.TranslationText||l.translationText||l.translation_text||l.text||"";const k=document.createElement("div");k.innerHTML=B,x=k.textContent||k.innerText||""}const E=`${c}

${x}`;await navigator.clipboard.writeText(E),V("Text copied to clipboard!")}catch(c){console.error("Copy failed",c),W("Failed to copy text")}},title:"Copy text",children:e.jsx(Mt,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{className:`p-1.5 sm:p-1.5 hover:text-[#0f5f72] dark:hover:text-cyan-300 transition-colors min-h-[36px] sm:min-h-[40px] min-w-[36px] sm:min-w-[40px] flex items-center justify-center ${f===$?"text-cyan-500 dark:text-cyan-400":"text-[#2AA0BF]"}`,onClick:()=>{f===$?M?(N(!1),A(!0),d.current&&d.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(c=>{console.error("Error resuming audio:",c)})):(d.current&&d.current.pause(),N(!0),A(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))):re($)},title:f===$?M?"Resume audio":"Pause audio":"Play audio",children:f===$&&!M?e.jsx(_t,{className:"w-3 h-3 sm:w-4 sm:h-4"}):e.jsx(Vt,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),m!=="ta"&&m!=="E"&&m!=="mal"&&e.jsx("button",{className:"p-1.5 sm:p-1.5 text-[#2AA0BF] hover:text-[#0f5f72] dark:hover:text-cyan-300 transition-colors min-h-[36px] sm:min-h-[40px] min-w-[36px] sm:min-w-[40px] flex items-center justify-center",onClick:c=>{const x=`/surah/${i}#verse-${h}`;c?.ctrlKey||c?.metaKey?(c.preventDefault(),window.open(x,"_blank","noopener,noreferrer")):_(x)},title:"View ayah details",children:e.jsx(zt,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{className:"p-1.5 sm:p-1.5 text-[#2AA0BF] hover:text-[#0f5f72] dark:hover:text-cyan-300 transition-colors min-h-[36px] sm:min-h-[40px] min-w-[36px] sm:min-w-[40px] flex items-center justify-center focus:outline-none",onClick:c=>{const x=`/word-by-word/${i}/${h}`;if(c?.ctrlKey||c?.metaKey){c.preventDefault(),window.open(x,"_blank","noopener,noreferrer");return}me(!0),J(h)},title:"Word by word",children:e.jsx(qt,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{className:`p-1.5 sm:p-1.5 text-[#2AA0BF] hover:text-[#0f5f72] dark:hover:text-cyan-300 transition-colors min-h-[36px] sm:min-h-[40px] min-w-[36px] sm:min-w-[40px] flex items-center justify-center ${de[`${h}-${b}`]?"opacity-50 cursor-not-allowed":""}`,onClick:async()=>{if(!X){W("Please sign in to bookmark blocks"),_("/sign",{state:{from:De.pathname,message:"Sign in to bookmark blocks"}});return}const c=`${h}-${b}`;try{Ce(E=>({...E,[c]:!0}));const x=ve.getEffectiveUserId(X);await ve.addBlockBookmark(x,i,h,b),V(`Saved block ${h}-${b}`)}catch(x){console.error("Failed to bookmark block:",x),W("Failed to save block")}finally{Ce(x=>({...x,[c]:!1}))}},title:"Bookmark block",disabled:de[`${h}-${b}`],children:de[`${h}-${b}`]?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b border-current"}):e.jsx(Ut,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{className:"p-1.5 sm:p-1.5 text-[#2AA0BF] hover:text-[#0f5f72] dark:hover:text-cyan-300 transition-colors min-h-[36px] sm:min-h-[40px] min-w-[36px] sm:min-w-[40px] flex items-center justify-center focus:outline-none",onClick:async()=>{try{const c=`Surah ${i} • Verses ${h}-${b}`,x=window.location.href;navigator.share?await navigator.share({title:"Thafheem - Quran Study",text:c,url:x}):(await navigator.clipboard.writeText(`${c}
${x}`),V("Link copied to clipboard!"))}catch(c){console.error("Share failed",c),W("Failed to share")}},title:"Share block",children:e.jsx(Ot,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]})})]},`block-${$}-${h}-${b}`)}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No blocks available for this Surah"})}),e.jsxs("div",{className:"bg-white border-t dark:bg-gray-900 border-gray-200 dark:border-gray-700 px-3 sm:px-4 py-3 sm:py-4 mt-6 sm:mt-8 rounded-lg",children:[e.jsxs("div",{className:"sm:hidden space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:He,disabled:parseInt(i)<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg w-[173.96px] min-h-[44px]
                               disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx(ot,{className:"w-3 h-3"}),e.jsx("span",{children:"Previous Surah"})]}),e.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]`,children:[e.jsx(Ne,{className:"w-3 h-3"}),e.jsx("span",{children:"Beginning of Surah"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:Ke,disabled:parseInt(i)>=114,className:`w-[173.96px] flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                                 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                                 border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]
                                 disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("span",{children:"Next Surah"}),e.jsx(Ye,{className:"w-3 h-3"})]})})]}),e.jsxs("div",{className:"hidden sm:flex items-center justify-center space-x-2 sm:space-x-4 lg:space-x-6",children:[e.jsxs("button",{onClick:He,disabled:parseInt(i)<=1,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ot,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{children:"Previous Surah"})]}),e.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px]",children:[e.jsx(Ne,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{children:"Beginning of Surah"})]}),e.jsxs("button",{onClick:Ke,disabled:parseInt(i)>=114,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{children:"Next Surah"}),e.jsx(Ye,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]})]}),it&&oe&&e.jsx("div",{className:"fixed inset-0 bg-gray-500/70 bg-opacity-50 flex items-start justify-center z-[9999] pt-24 sm:pt-28 lg:pt-32 p-2 sm:p-4 lg:p-6 overflow-y-auto",children:e.jsx("div",{className:"bg-white dark:bg-[#2A2C38] rounded-lg max-w-xs sm:max-w-4xl max-h-[90vh] overflow-y-auto relative w-full",children:e.jsx(Ze,{surahId:parseInt(i),range:oe.toString(),ipt:1,lang:m==="E"?"E":"mal",onClose:()=>{Ae(!1),lt(null)},showSuccess:V,showError:W},`interpretation-${i}-${oe}`)})}),pt&&Fe&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-start justify-center z-[9999] pt-24 sm:pt-28 lg:pt-32 p-4 overflow-hidden",children:e.jsx(Xt,{selectedVerse:Fe,surahId:i,onClose:()=>{me(!1),J(null)},onNavigate:t=>J(t),onSurahChange:t=>{me(!1),J(null),_(`/surah/${t}?wordByWord=1`)}})}),gt&&e.jsx("div",{className:"fixed inset-0 flex items-start justify-center z-[9999] pt-32 sm:pt-40 lg:pt-48 p-2 sm:p-4 lg:p-6 bg-gray-500/70 dark:bg-black/70 overflow-y-auto",children:e.jsxs("div",{className:"bg-white dark:bg-[#2A2C38] rounded-lg shadow-xl w-full max-w-xs sm:max-w-2xl lg:max-w-4xl xl:max-w-[1073px] h-[85vh] sm:h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"English Explanation"}),te?.footnoteNumber&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Footnote ",te.footnoteNumber,te?.ayah?` • Ayah ${te.ayah}`:""]})]}),e.jsx("button",{onClick:()=>he(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-4 sm:px-6 py-4 sm:py-6 overflow-y-auto flex-1",children:bt?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading explanation..."})]})}):e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 sm:p-6",children:e.jsx("div",{className:"text-gray-700 leading-[1.6] font-poppins sm:leading-[1.7] lg:leading-[1.8] dark:text-white text-sm sm:text-base lg:text-lg prose prose-sm dark:prose-invert max-w-none",style:{fontSize:`${Ve}px`},children:yt})})})]})}),H&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-start justify-center z-[9999] pt-24 sm:pt-28 lg:pt-32 p-2 sm:p-4 lg:p-6 overflow-y-auto",children:e.jsx("div",{className:"bg-white dark:bg-[#2A2C38] rounded-lg max-w-xs sm:max-w-4xl max-h-[90vh] overflow-y-auto relative w-full shadow-2xl",children:e.jsx(Ze,{surahId:parseInt(i),range:H.range,ipt:H.interpretationNumber,lang:m==="E"?"E":"mal",onClose:()=>ue(null),showSuccess:V,showError:W},`block-interpretation-${i}-${H.range}-${H.interpretationNumber}`)})}),ft&&e.jsx("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`fixed right-6 z-[60] bg-cyan-500 hover:bg-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center ${I?"bottom-32 sm:bottom-36":"bottom-6"}`,title:"Beginning of Surah","aria-label":"Beginning of Surah",children:e.jsx(Ne,{className:"w-6 h-6"})}),I&&e.jsx(Yt,{audioElement:d.current,isPlaying:j&&d.current&&!d.current.paused,currentAyah:I,totalAyahs:g.reduce((t,s)=>{const a=s.AyaTo||s.ayato||s.to||0,n=s.AyaFrom||s.ayafrom||s.from||0;return t+(a-n+1)},0),surahInfo:le?.surahInfo,onPlayPause:Oe,onStop:be,onSkipBack:()=>{At()},onSkipForward:()=>{Ue()},onClose:null,selectedQari:O,onQariChange:t=>{ct(t),f&&I&&(be(),setTimeout(()=>{re(f)},100))},translationLanguage:m,audioTypes:P,onAudioTypesChange:t=>{const s=f,a=I;if(console.log("[BlockWise] onAudioTypesChange",{newTypes:t,currentBlock:s,currentAyah:a,isContinuousPlay:j,isPaused:M}),ie(t),s&&a){if(d.current)try{d.current.pause(),d.current.currentTime=0}catch(n){console.warn("[BlockWise] Failed to pause audio before restarting with new types",n)}A(!0),N(!1),C(s),S(a),setTimeout(()=>{console.log("[BlockWise] restarting playback after audioTypes change",{currentBlock:s,currentAyah:a,newTypes:t}),q(s,a,0,t)},100)}},playbackSpeed:Q,onPlaybackSpeedChange:t=>{dt(t)}})]})]})})]})};export{La as default};
