import{u as nr,i as ar,k as or,z as sr,j as r,T as ir,C as lr,D as cr,P as ur,B as dr,F as mr,o as fr,w as Ke,p as pr,q as At,X as hr,E as gr,n as yr,G as xr}from"./index-CUlJBpza.js";import{b as i,u as br,e as kr,d as wr}from"./react-vendor-v5ei6ytj.js";import{u as vr,T as Xe}from"./Toast-B2OJdYtw.js";import{W as Nr}from"./WordByWord-KJZdy24d.js";import Tt from"./InterpretationBlockwise-Ckqj2yzD.js";import{a as St,D as Ar,B as Tr,C as Sr,A as Ge}from"./LoadingSkeleton-Dbw3s3GM.js";import Br from"./StickyAudioPlayer-D8IUMogI.js";import ge from"./englishTranslationService-BXVPM7Au.js";import{u as Er}from"./useSequentialEnglishFootnotes-B4d1JHKd.js";import{g as Cr,s as jr}from"./surahNameUtils-DnNHw9gw.js";import{C as Bt}from"./chevron-left-Cd5zBMff.js";import"./tamilWordByWordService-vV6hXtFw.js";import"./apiService-B0XJNrcm.js";import"./hindiWordByWordService-BxXIkP0f.js";import"./banglaWordByWordService-CwmEntKu.js";import"./banglaTranslationService-BkW9UeJs.js";import"./tamilTranslationService-BMRWUV2A.js";import"./hindiTranslationService-CSJnwD8n.js";import"./urduTranslationService-DMW3Lbpt.js";import"./BlockInterpretationModal-DyQPynPR.js";import"./InterpretationNavbar-DZSMkKMQ.js";import"./WordByWordIcon-BKhnaaGx.js";import"./volume-x-w4A9WPZB.js";import"./skip-forward-Bxg33zbA.js";const fn=()=>{const[$r,Ir]=i.useState("Translation"),[Fr,Rr]=i.useState("Block wise"),[Et,Ce]=i.useState(!1),[je,Ye]=i.useState(null),[U,Je]=i.useState(()=>localStorage.getItem("reciter")||"al-hudaify"),[se,$e]=i.useState(["quran"]),[M,Ze]=i.useState(()=>{const e=localStorage.getItem("playbackSpeed");return e?parseFloat(e):1}),[B,D]=i.useState(null),[Wr,K]=i.useState(null),[R,L]=i.useState(null),[Ct,W]=i.useState(1),[_,P]=i.useState(!1),[X,F]=i.useState(!1),o=i.useRef(null),j=i.useRef(null),E=i.useRef(!1),T=i.useRef(!1),ye=i.useRef(M),xe=i.useRef(null),[ie,et]=i.useState(null),[z,be]=i.useState(!0),[tt,ke]=i.useState(null),[Pr,Lr]=i.useState([]),[we,rt]=i.useState([]),[Ie,nt]=i.useState({}),[f,at]=i.useState([]),[V,ve]=i.useState({}),[J,me]=i.useState(null),[jt,Fe]=i.useState(!1),[ot,Ne]=i.useState(null),[G,Z]=i.useState(new Set),ee=i.useRef(!1),[$t,It]=i.useState(0),[Re,Ae]=i.useState(!1),[Ft,st]=i.useState(!1),[Mr,it]=i.useState(!1),[Dr,_r]=i.useState(!1),[Rt,Te]=i.useState(!1),[Wt,fe]=i.useState(""),[Pt,We]=i.useState(!1),[Se,lt]=i.useState({footnoteId:null,footnoteNumber:null,surah:null,ayah:null}),te=br(),re=kr(),{pathname:ct}=re,{user:pe}=nr(),{toasts:Pe,removeToast:Le,showSuccess:le,showError:Y,showWarning:ut}=vr(),{quranFont:dt,translationLanguage:p,theme:Lt,fontSize:Mt,adjustedTranslationFontSize:mt,viewType:ne,setViewType:ce}=ar(),Dt=Math.max(Number(mt)-2,10),{surahId:l}=wr(),{getBlockViewCache:ft,setBlockViewCache:Me}=or(),pt=i.useRef(!1),ht=i.useRef(p),gt=i.useRef(l),De=i.useRef(new Set);Er({enabled:p==="E"&&ne==="Block Wise",context:"blockwise",dependencies:[V,f,l,ie]}),i.useEffect(()=>{re.state?.viewType&&ce(re.state.viewType)},[re.state,ce]),i.useEffect(()=>{if(!(p==="mal"||p==="E")){ne!=="Ayah Wise"&&ce("Ayah Wise");return}if(ne==="Ayah Wise"){const n=`/surah/${l}`;ct!==n&&te(n)}else ne!=="Block Wise"&&ce("Block Wise")},[ne,p,l,te,ct,ce]);const{surahs:_e}=sr(p),Be=i.useCallback((e=[])=>!Array.isArray(e)||e.length===0?new Set:new Set(e.map((n,t)=>{const a=n.AyaFrom??n.ayafrom??n.from??1,s=n.AyaTo??n.ayato??n.to??a,u=Number.parseInt(a,10),y=Number.parseInt(s,10),b=Number.isFinite(u)&&Number.isFinite(y),c=Number.isFinite(Number(a))?Number(a):1,v=b?u:c,k=Number.isFinite(Number(s))?Number(s):v,h=b?`${v}-${b?y:k}`:`${a}-${s}`;return n.ID||n.id||h||`block-${t}`})),[]),_t=e=>{const n=["Ù ","Ù¡","Ù¢","Ù£","Ù¤","Ù¥","Ù¦","Ù§","Ù¨","Ù©"];return e.toString().split("").map(t=>n[t]||t).join("")},Vt=e=>e?e.replace(/\s*ï´¿\s*[\d\u0660-\u0669]+\s*ï´¾\s*$/u,"").trim():"",Ve=(e,n)=>`${Vt(e)||e||""} ï´¿${_t(n)}ï´¾`,H=(e,n=null)=>{const t=Number.parseInt(e,10);return Number.isFinite(t)?t:n},Oe=i.useCallback((e="manual")=>{if(!l)return;console.log(`[BlockWise] Triggering blockwise reload (${e})`),ee.current=!1;const n=Be(f);Z(n),ve({}),ke(null),e==="manual"&&Ae(!1),It(t=>t+1)},[l,f,Be]);i.useEffect(()=>(o.current||(o.current=new Audio),()=>{o.current&&(o.current.pause(),o.current.src="",o.current.currentTime=0),D(null),K(null),L(null),P(!1),F(!1),j.current=null,E.current=!1}),[]);const Ot={"al-hudaify":"QH","al-afasy":"QA","al-ghamidi":"QG"},yt=e=>({E:"English",mal:"Malayalam",ur:"Urdu",bn:"Bangla",ta:"Tamil",hi:"Hindi"})[e]||e,Ee=(e,n=!1,t=null)=>{if(!o.current)return;const a=t||n&&xe.current||se;if(n||(xe.current=a),console.log("[BlockWise] playBlockAudio start",{blockId:e,fromContinuous:n,audioTypes:a,preservedAudioTypes:t,translationLanguage:p,selectedQirath:U}),!n&&p!=="mal"&&a.some(c=>c==="translation"||c==="interpretation")){const c=yt(p);ut(`${c} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available for blockwise view.`);const v=se.filter(k=>k!=="translation"&&k!=="interpretation");v.length>0?$e(v):$e(["quran"]);return}if(o.current)try{o.current.pause(),o.current.onended=null,o.current.onerror=null,o.current.src="",o.current.load()}catch(b){console.warn("[BlockWise] Error cleaning up audio:",b)}const s=f.find(b=>(b.ID||b.id)===e);if(!s){console.error("Block not found:",e),T.current=!1;return}const u=s.AyaFrom||s.ayafrom||s.from||1,y=H(u,1);P(!0),D(e),L(y),W(1),F(!1),j.current=e,E.current=!0,console.log("[BlockWise] playBlockAudio state set",{playingBlock:e,normalizedStartingAyah:y,currentAudioType:a?.[0]||"quran",audioTypes:a}),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}})),ue(e,y,0,a)},Ut=async(e,n,t,a=1)=>{const s=String(e).padStart(3,"0"),u=String(n).padStart(3,"0"),y="https://old.thafheem.net/audio";if(t==="quran")return`${y}/qirath/${U}/${Ot[U]}${s}_${u}.ogg`;if(t==="translation")return`${y}/translation/T${s}_${u}.ogg`;if(t==="interpretation"){if(a===1)return`${y}/interpretation/I${s}_${u}.ogg`;{const b=String(a).padStart(2,"0");return`${y}/interpretation/I${s}_${u}_${b}.ogg`}}return null},Q=async(e,n,t=0,a=null)=>{if(!o.current)return;const s=H(n,H(R,1)||1),u=a||se;if(console.log("[BlockWise] playAyahAudioWithTypes",{blockId:e,requestedAyah:n,ayahToPlay:s,audioTypeIndex:t,audioTypes:u,audioTypesLength:u.length,shouldMoveToNext:t>=u.length,playbackSpeed:M,isContinuousPlay:_,isPaused:X,playingBlock:B}),t>=u.length){console.log("[BlockWise] All audio types played for ayah, moving to next ayah",{audioTypeIndex:t,audioTypesLength:u.length,ayahToPlay:s,blockId:e}),xt(s,u);return}try{o.current.onended&&(o.current.onended=null),o.current.onerror&&(o.current.onerror=null),o.current.pause()}catch(S){console.warn("[BlockWise] Error stopping previous audio:",S)}const y=u[t];let b=1;y==="interpretation"&&(b=Ct);let c;try{c=await Ut(l,s,y,b)}catch(S){console.error("[BlockWise] Error generating audio URL:",S),Q(e,s,t+1,a);return}if(!c){Q(e,s,t+1,a);return}console.log("[BlockWise] generated audioUrl",{blockId:e,ayahToPlay:s,currentAudioType:y,audioUrl:c});const k={quran:"qirath",translation:"translation",interpretation:"interpretation"}[y]||"qirath";K(k),L(s);try{o.current.onended=null,o.current.onerror=null}catch(S){console.warn("[BlockWise] Error clearing audio handlers:",S)}let w=null;const h=()=>{w&&(clearTimeout(w),w=null)},N=()=>{h(),w=setTimeout(()=>{o.current&&o.current.readyState<2&&B===e&&R===s&&_&&(console.warn("[BlockWise] Audio load timeout (file may be missing):",c),Q(e,s,t+1,u))},5e3)};o.current.onended=()=>{if(h(),console.log("[BlockWise] Audio ended",{blockId:e,ayahToPlay:s,audioTypeIndex:t,currentAudioType:y,playingBlock:j.current,isContinuousPlay:E.current,audioTypes:u,totalTypes:u.length,isProcessingNext:T.current}),T.current){console.warn("[BlockWise] onended handler aborted - already processing next move");return}E.current&&j.current===e?(console.log("[BlockWise] Continuing to next audio type/ayah"),Q(e,s,t+1,u)):console.warn("[BlockWise] Not continuing - state mismatch",{isContinuousPlay:E.current,playingBlock:j.current,blockId:e,ayahToPlay:s})},o.current.onerror=S=>{h();const $=o.current;if($&&$.error){const m=$.error.code;if(m===2||m===4){if(y==="interpretation"){if(T.current=!0,o.current)try{o.current.pause(),o.current.onended=null,o.current.onerror=null}catch(x){console.warn("[BlockWise] Error cleaning up audio on interpretation error:",x)}if(W(1),E.current&&j.current===e){setTimeout(()=>{Q(e,s,t+1,u),setTimeout(()=>{T.current=!1},300)},200);return}else T.current=!1}}else console.error("[BlockWise] Unexpected audio error:",{errorCode:$.error?.code,audioUrl:c,currentAudioType:y})}else console.error("[BlockWise] Audio error event (unknown error):",c,S);E.current&&j.current===e&&!T.current?setTimeout(()=>{Q(e,s,t+1,u)},200):T.current||console.warn("[BlockWise] Not continuing after error - state mismatch",{isContinuousPlay:E.current,playingBlock:j.current,blockId:e})};const d=()=>{T.current=!1,o.current&&(o.current.playbackRate=ye.current),o.current.removeEventListener("canplay",d)};o.current.addEventListener("canplay",d,{once:!0}),o.current.addEventListener("canplay",h,{once:!0}),o.current.addEventListener("loadeddata",h,{once:!0});const C=()=>{o.current&&(o.current.playbackRate=ye.current),o.current.removeEventListener("loadedmetadata",C)};o.current.addEventListener("loadedmetadata",C,{once:!0}),o.current.src=c,o.current.playbackRate=ye.current,o.current.load(),N(),o.current.play().catch(S=>{if(h(),T.current){setTimeout(()=>{T.current=!1},100);return}S.name!=="NotSupportedError"&&console.error("[BlockWise] Error playing audio:",S.name,S.message,c),E.current&&j.current===e?(T.current=!1,setTimeout(()=>{Q(e,s,t+1,u)},200)):(T.current=!1,console.warn("[BlockWise] Not continuing after play error - state mismatch",{blockId:e,playingBlockRef:j.current,isContinuousPlayRef:E.current}))})},ue=(e,n,t=0,a=null)=>{Q(e,n,t,a)},xt=(e=null,n=null)=>{if(T.current){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - already processing next",{currentAyahOverride:e,currentAyahInBlock:R});return}const t=e??R,a=j.current||B;if(!a||!t){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - no playing block or ayah",{currentPlayingBlock:a,effectiveCurrentAyah:t,playingBlock:B,playingBlockRef:j.current});return}T.current=!0;const s=f.find(v=>(v.ID||v.id)===a);if(!s){T.current=!1;return}const u=s.AyaTo||s.ayato||s.to,y=H(t,null),b=H(u,y);if(y===null||b===null){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - invalid ayah numbers",{currentPlayingBlock:a,currentAyahInBlock:t,ayaTo:u}),T.current=!1;return}const c=y+1;if(console.log("[BlockWise] moveToNextAyahOrBlock",{currentPlayingBlock:a,currentAyahNumber:y,nextAyah:c,ayaToNumber:b,isContinuousPlay:E.current}),c<=b)W(1),ue(a,c,0,n);else if(E.current){if(o.current)try{o.current.pause(),o.current.onended=null,o.current.onerror=null}catch(v){console.warn("[BlockWise] Error cleaning up audio before next block:",v)}W(1),T.current=!1,setTimeout(()=>{Ht()},50)}else{if(o.current)try{o.current.pause(),o.current.onended=null,o.current.onerror=null}catch(v){console.warn("[BlockWise] Error stopping audio:",v)}D(null),K(null),L(null),W(1),F(!1),j.current=null,E.current=!1,T.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},zt=(e=null,n=null)=>{const t=e??R;if(!B||!t)return;const a=f.find(c=>(c.ID||c.id)===B);if(!a)return;const s=a.AyaFrom||a.ayafrom||a.from||1,u=H(t,null),y=H(s,1);if(u===null||y===null){console.warn("[BlockWise] moveToPreviousAyahOrBlock aborted - invalid ayah numbers",{playingBlock:B,currentAyahInBlock:t,ayaFrom:s});return}const b=u-1;console.log("[BlockWise] moveToPreviousAyahOrBlock",{playingBlock:B,currentAyahNumber:u,previousAyah:b,ayaFromNumber:y,isContinuousPlay:_}),b>=y?(W(1),ue(B,b,0,n)):_?(W(1),qt()):(D(null),K(null),L(null),W(1),F(!1))},qt=()=>{if(!_||!f||f.length===0)return;const e=f.findIndex(n=>(n.ID||n.id)===B);if(e>0){const n=f[e-1],t=n.ID||n.id,a=n.AyaTo||n.ayato||n.to||1,s=H(a,1);P(!0),D(t),L(s),W(1),F(!1),j.current=t,E.current=!0,ue(t,s)}else{const n=f[0],t=n.ID||n.id,a=n.AyaFrom||n.ayafrom||n.from||1,s=H(a,1);D(t),L(s),W(1),ue(t,s)}},Ht=()=>{if(T.current){console.warn("[BlockWise] playNextBlock aborted - already processing next");return}if(!E.current||!f||f.length===0){console.warn("[BlockWise] playNextBlock aborted - invalid state",{isContinuousPlay:E.current,isContinuousPlayState:_,blockRangesLength:f?.length}),T.current=!1;return}T.current=!0;const n=j.current||B,t=f.findIndex(a=>(a.ID||a.id)===n);if(console.log("[BlockWise] playNextBlock",{currentIndex:t,currentPlayingBlock:n,playingBlock:B,playingBlockRef:j.current,blockRangesLength:f.length}),t!==-1&&t<f.length-1){const a=f[t+1],s=a.ID||a.id;if(!s){console.error("[BlockWise] playNextBlock - next block has no ID",a);return}if(o.current)try{o.current.pause(),o.current.onended=null,o.current.onerror=null,o.current.src="",o.current.load()}catch(u){console.warn("[BlockWise] Error cleaning up audio before next block:",u)}setTimeout(()=>{try{const u=xe.current||se;Ee(s,!0,u)}catch(u){console.error("[BlockWise] Error playing next block:",u),D(null),K(null),L(null),W(1),P(!1),F(!1),T.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},100)}else{if(console.log("[BlockWise] playNextBlock - end of blocks reached"),o.current)try{o.current.pause(),o.current.onended=null,o.current.onerror=null}catch(a){console.warn("[BlockWise] Error stopping audio at end:",a)}D(null),K(null),L(null),W(1),P(!1),F(!1),j.current=null,E.current=!1,T.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},bt=()=>{if(!f||f.length===0){Y("No blocks available to play");return}if(p!=="mal"){const e=yt(p);ut(`${e} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available.`);return}try{if(_)o.current&&o.current.pause(),P(!1),F(!0),E.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}));else if(B&&R)P(!0),F(!1),E.current=!0,o.current&&o.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(e=>{console.error("Error resuming audio:",e)});else{P(!0),F(!1),E.current=!0;const e=f[0].ID||f[0].id;Ee(e)}}catch(e){console.error("Error in handlePlayAudio:",e),P(!1),D(null),L(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},Ue=i.useRef(null);Ue.current=bt,i.useEffect(()=>{const e=()=>{Ue.current&&Ue.current()};return window.addEventListener("playAudio",e),()=>{window.removeEventListener("playAudio",e)}},[]),i.useEffect(()=>{const e=_&&!X&&B!==null;window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:e}}))},[_,X,B]),i.useEffect(()=>{const e=n=>{const{type:t,message:a}=n.detail;t==="success"?le(a):t==="error"&&Y(a)};return window.addEventListener("showToast",e),()=>{window.removeEventListener("showToast",e)}},[le,Y]);const ze=()=>{o.current&&(o.current.pause(),o.current.currentTime=0,o.current.onended=null,o.current.onerror=null),P(!1),D(null),K(null),L(null),j.current=null,E.current=!1,T.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}})),W(1),F(!1)};i.useEffect(()=>()=>{try{ze()}catch{}},[]),i.useEffect(()=>()=>{o.current&&(o.current.pause(),D(null),K(null),L(null),W(1),P(!1),F(!1),j.current=null,E.current=!1,T.current=!1)},[l]),i.useEffect(()=>{localStorage.setItem("reciter",U),window.dispatchEvent(new CustomEvent("reciterChange",{detail:{reciter:U}}))},[U]),i.useEffect(()=>{const e=n=>{const t=n.detail.reciter;t!==U&&Je(t)};return window.addEventListener("reciterChange",e),()=>{window.removeEventListener("reciterChange",e)}},[U]),i.useEffect(()=>{B&&R&&o.current&&_&&ue(B,R,0)},[U,se]),i.useEffect(()=>{ye.current=M},[M]),i.useEffect(()=>{localStorage.setItem("playbackSpeed",M.toString()),window.dispatchEvent(new CustomEvent("playbackSpeedChange",{detail:{playbackSpeed:M}}))},[M]),i.useEffect(()=>{const e=n=>{const t=n.detail.playbackSpeed;t!==M&&Ze(t)};return window.addEventListener("playbackSpeedChange",e),()=>{window.removeEventListener("playbackSpeedChange",e)}},[M]),i.useEffect(()=>{o.current&&(o.current.playbackRate=M)},[M]),i.useEffect(()=>{pt.current=!1},[l,p]),i.useEffect(()=>{Ae(!1)},[l]),i.useEffect(()=>{if(!l||!(p==="mal"||p==="E"))return;const n=ft?.(l,p);if(n){pt.current=!0,et(n.blockData||null),at(n.blockRanges||[]),rt(n.arabicVerses||[]),ve(n.blockTranslations||{}),ke(null),Z(new Set);const t=n.blockTranslations?Object.keys(n.blockTranslations).length:0,a=!!(n.__meta?.isComplete&&t>0);be(!a),ee.current=a}},[l,p,ft]),i.useEffect(()=>((async()=>{if(!l||ee.current||_e.length===0)return;if(!(p==="mal"||p==="E")){console.log(`âš ï¸ BlockWise: Language '${p}' doesn't support blockwise. Skipping fetch.`),be(!1);return}ee.current=!0;try{be(!0),ke(null);const[t,a]=await Promise.all([gr(parseInt(l),p||"mal"),yr(parseInt(l))]),s=_e.find(u=>u.number===parseInt(l));if(et({surahInfo:s||{number:parseInt(l),arabic:"Ø§Ù„Ù‚Ø±Ø¢Ù†",type:"Makki"}}),rt(a||[]),at(t||[]),t&&t.length>0){const u=async(A,m)=>{const g=A.AyaFrom||A.ayafrom||A.from,x=A.AyaTo||A.ayato||A.to;if(g==null||x===void 0||x===null)return;const I=Number.parseInt(g,10),O=Number.parseInt(x,10),ae=Number.isFinite(I)&&Number.isFinite(O),de=ae?`${I}-${O}`:`${g}-${x}`,oe=A.ID||A.id||de||`block-${m}`,tr=ae?I:g,rr=ae?O:x;if(!De.current.has(oe)){De.current.add(oe);try{Z(q=>new Set([...q,oe]));let he;const Qe=p||"mal";he=await xr(parseInt(l),de,Qe),ve(q=>q[oe]?.data?q:{...q,[oe]:{range:de,ayaFrom:tr,ayaTo:rr,data:he}}),Z(q=>{const Nt=new Set(q);return Nt.delete(oe),Nt})}catch(he){he.message?.includes("timeout")||console.error(`âŒ BlockWise: Failed to load block ${de}:`,he.message),Z(Qe=>{const q=new Set(Qe);return q.delete(oe),q})}}};let v=2,k=0;const w=[];let h=0;const N=async(A,m)=>new Promise(g=>{const x=async()=>{h++;try{await u(A,m),k++,k===3&&v<5&&(v=5,console.log("ðŸš€ Increased concurrent requests from 2 to 5 after 3 successful loads"))}catch{}finally{h--,w.length>0&&w.shift()(),g()}};h<v?x():w.push(x)}),d=A=>{const m=A.slice(0,3),g=A.slice(3);return{visibleBlocks:m,backgroundBlocks:g}},{visibleBlocks:C,backgroundBlocks:S}=d(t),$=C.map((A,m)=>u(A,m));S.forEach((A,m)=>{setTimeout(()=>{N(A,m+C.length)},50*Math.floor(m/v))}),Promise.allSettled($).then(A=>{const m=A.filter(g=>g.status==="fulfilled").length})}}catch(t){let a=t.message;t.message?.includes("timeout")||t.message?.includes("Request timeout")?a="The server is taking longer than expected to respond. Please try again in a moment. If the problem persists, the English blockwise data may be temporarily unavailable.":t.message?.includes("Failed to fetch")||t.message?.includes("Network error")?a="Unable to connect to the server. Please check your internet connection and try again.":t.message?.includes("HTTP error")&&(a=`Server error: ${t.message}. Please try again later.`),ke(a),console.error("Error fetching block-wise data:",t),ee.current=!1}finally{be(!1)}})(),()=>{ee.current=!1}),[l,_e,p,$t]),i.useEffect(()=>{if(!l||!(p==="mal"||p==="E")||!Me||z||!Array.isArray(f)||f.length===0)return;const t=(V?Object.keys(V).length:0)>0&&(!G||G.size===0);Me(l,p,{blockData:ie,blockRanges:f,arabicVerses:we,blockTranslations:V,__meta:{isComplete:t}})},[l,p,ie,f,we,V,z,G,Me]),i.useEffect(()=>{const e=p==="mal"||p==="E",n=Array.isArray(f)&&f.length>0,t=z||G&&G.size>0,a=V?Object.keys(V).length:0;!l||!e||!n||t||a>0||Re||(Ae(!0),Oe("auto"))},[l,p,f,V,z,G,Re,Oe]),i.useEffect(()=>{const e=ht.current!==p,n=gt.current!==l;!e&&!n||(ht.current=p,gt.current=l,f.length>0?Z(Be(f)):Z(new Set),ve({}),De.current.clear(),ee.current=!1,me(null),Ce(!1),Te(!1),fe(""),We(!1),lt({footnoteId:null,footnoteNumber:null,surah:null,ayah:null}),Ae(!1))},[p,l,f,Be]),i.useEffect(()=>{(async()=>{if(!pe||!l){it(!1);return}try{const n=await Ke.isFavorited(pe.uid,l);it(n)}catch(n){console.error("Error loading favorite status:",n)}})()},[pe,l]),i.useEffect(()=>{if(p!=="E")return;const e=async n=>{const t=n.target.closest(".english-footnote-link");if(!t)return;if(ne==="Block Wise"){n.preventDefault(),n.stopPropagation();const w=t.getAttribute("data-footnote-id"),h=t.getAttribute("data-interpretation-id"),N=h&&/^\d+$/.test(h)?parseInt(h,10):null,C=t.getAttribute("data-interpretation-number")||t.getAttribute("data-footnote-number")||(t.textContent||"").trim(),S=C&&/^\d+$/.test(C)?parseInt(C,10):1,$=t.getAttribute("data-ayah"),A=$?parseInt($,10):null;if(!C&&!w){console.warn("[BlockWise] âš ï¸ Missing displayed number and footnote ID");return}let m=null;if(A&&f.length>0){const g=f.find(x=>{const I=x.AyaFrom||x.ayafrom||x.from||0,O=x.AyaTo||x.ayato||x.to||I;return A>=I&&A<=O});if(g){const x=g.AyaFrom||g.ayafrom||g.from||1,I=g.AyaTo||g.ayato||g.to||x;m=`${x}-${I}`}else console.warn("[BlockWise] âš ï¸ Could not find block range for verse:",A,"available blocks:",f.map(x=>({from:x.AyaFrom||x.ayafrom||x.from,to:x.AyaTo||x.ayato||x.to})))}if(!m&&f.length>0){const g=f[0],x=g.AyaFrom||g.ayafrom||g.from||1,I=g.AyaTo||g.ayato||g.to||x;m=`${x}-${I}`}if(m){me({range:m,interpretationNumber:S,footnoteId:w,interpretationId:N});return}else console.warn("[BlockWise] âš ï¸ Could not determine block range, falling back to footnote modal")}n.preventDefault(),n.stopPropagation();const a=t.getAttribute("data-footnote-id"),s=t.getAttribute("data-interpretation-id"),u=s&&/^\d+$/.test(s)?parseInt(s,10):null,y=t.getAttribute("data-footnote-number")||(t.textContent||"").trim(),b=t.getAttribute("data-interpretation-number")||t.getAttribute("data-footnote-number"),c=b&&/^\d+$/.test(b)?parseInt(b,10):null,v=t.getAttribute("data-ayah"),k=v?parseInt(v,10):null;lt({footnoteId:a,interpretationId:u,footnoteNumber:y||null,surah:l?parseInt(l,10):null,ayah:k}),fe("Loading..."),We(!0),Te(!0);try{let w="";if(u)w=await ge.getInterpretationById(u);else if(a)w=await ge.getExplanation(parseInt(a,10));else if(c&&k)w=await ge.getInterpretationByNumber(parseInt(l,10),k,c);else{fe("Explanation not available.");return}fe(w||"Explanation not available.")}catch(w){console.error("Error fetching English footnote explanation:",w),fe(`Error loading explanation: ${w.message||w}`)}finally{We(!1)}};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[p,l,ne,f]);const Qt=e=>{if(!e)return"";const n=document.createElement("div");return n.innerHTML=e,n.textContent||n.innerText||""},Kt=(e={})=>e?.TranslationText||e?.translationText||e?.translation_text||e?.text||"",Xt=(e={},n)=>{const t=e?.VerseNo??e?.Verse_Number??e?.verse_number??e?.VerseNumber??e?.ayah_number??e?.AyaId??e?.AyahId??n,a=Number.parseInt(t,10);return Number.isFinite(a)?a:n},Gt=(e=[],n=null,t=1)=>{const a=e.length>0?e:n?[n]:[];return a.length===0?"":a.map((s,u)=>{const y=Kt(s);if(!y)return"";const b=Qt(y).trim();if(!b)return"";const c=Xt(s,t+u);return a.length>1?`${c}. ${b}`:b}).filter(Boolean).join(`

`)},qe=(e,n)=>{if(!e)return"";let t=String(e);const a=p==="E"?"en":"mal",s="cursor:pointer!important;background-color:rgb(41,169,199)!important;color:rgb(255,255,255)!important;font-weight:600!important;text-decoration:none!important;border:none!important;display:inline-flex!important;align-items:center!important;justify-content:center!important;font-size:12px!important;vertical-align:middle!important;line-height:1!important;border-radius:9999px!important;position:relative!important;z-index:10!important;top:0!important;min-width:20px!important;min-height:19px!important;text-align:center!important;transition:0.2s ease-in-out!important;padding-top:3px!important;margin-right:4px!important;margin-left:-1px!important;margin-top:-15px!important;padding-left:2px!important;padding-right:2px!important;",u=N=>`<sup class="interpretation-link" data-interpretation="${N}" data-range="${n}" data-lang="${a}" data-interpretation-number="${N}" data-interpretation-label="${N}" title="Click to view interpretation ${N}" aria-label="Interpretation ${N}" style="${s}">${N}</sup>`,y=/\((\d+)\)/g;t=t.replace(y,(N,d)=>{const C=parseInt(d,10);return C>=1&&C<=99?u(d):N});const b=/(\.|'|'|'|\u2018|\u2019)(\d{1,2})(?=[\s\u0D00-\u0D7F.,;:!?]|$)/g,c=[];let v;for(;(v=b.exec(t))!==null;){const N=parseInt(v[2],10);N>=1&&N<=99&&c.push({index:v.index,number:v[2],fullMatch:v[0],prefix:v[1]})}for(let N=c.length-1;N>=0;N--){const d=c[N],C=t.substring(0,d.index),S=t.substring(d.index+d.fullMatch.length);t=C+d.prefix+u(d.number)+S}const k=/([\u0D00-\u0D7F])(\d{1,2})(?=[\s\u0D00-\u0D7F.,;:!?]|$)/g,w=[];let h;for(k.lastIndex=0;(h=k.exec(t))!==null;){const N=parseInt(h[2],10);if(N>=1&&N<=99){if(h.index>0){const $=t[h.index-1];if($==="."||$==="'"||$==="'"||$==="'"||$==="â€˜"||$==="â€™")continue}const d=t.substring(Math.max(0,h.index-100),h.index),C=d.lastIndexOf("<sup"),S=d.lastIndexOf("</sup>");if(C>S)continue;w.push({index:h.index,before:h[1],number:h[2],fullMatch:h[0]})}}for(let N=w.length-1;N>=0;N--){const d=w[N],C=t.substring(0,d.index),S=t.substring(d.index+d.fullMatch.length);t=C+d.before+u(d.number)+S}return t};i.useEffect(()=>{const e=t=>{let a=t.target.closest(".interpretation-link");if(!a&&p==="E"){const s=t.target.closest(".english-footnote-link");if(s){const y=s.getAttribute("data-interpretation-number")||s.getAttribute("data-footnote-number")||s.textContent?.trim()||"",b=y&&/^\d+$/.test(y)?parseInt(y,10):1,c=s.getAttribute("data-surah"),v=s.getAttribute("data-ayah");if(c===l&&v&&f.length>0){const k=parseInt(v,10),w=f.find(h=>{const N=h.AyaFrom||h.ayafrom||h.from||0,d=h.AyaTo||h.ayato||h.to||N;return k>=N&&k<=d});if(w){const h=w.AyaFrom||w.ayafrom||w.from||1,N=w.AyaTo||w.ayato||w.to||h,d=`${h}-${N}`,C=s.getAttribute("data-footnote-id");t.preventDefault(),t.stopPropagation(),me({range:d,interpretationNumber:b,footnoteId:C});return}else console.warn("[BlockWise] âš ï¸ Could not find block range for verse:",k)}}}if(a){t.preventDefault(),t.stopPropagation();const s=a.getAttribute("data-interpretation"),u=a.getAttribute("data-range");a.getAttribute("data-lang"),s&&u?me({range:u,interpretationNumber:parseInt(s,10)}):console.warn("[BlockWise] âš ï¸ Missing interpretation data:",{interpretationNumber:s,range:u})}},n=document.createElement("style");return n.textContent=`
      .interpretation-link {
        cursor: pointer !important;
      }
      .interpretation-link > a {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 100% !important;
        height: 100% !important;
        color: inherit !important;
        font-weight: inherit !important;
        text-decoration: none !important;
      }
      .interpretation-link:hover {
        background-color: #0891b2 !important;
        transform: scale(1.05) !important;
      }
      .interpretation-link:active {
        background-color: #0e7490 !important;
        transform: scale(0.95) !important;
      }
    `,document.head.appendChild(n),document.addEventListener("click",e,!0),()=>{document.removeEventListener("click",e,!0),document.head.removeChild(n)}},[]);const kt=()=>{const e=parseInt(l)-1;e>=1&&te(`/blockwise/${e}`)},wt=()=>{const e=parseInt(l)+1;e<=114&&te(`/blockwise/${e}`)};if(i.useEffect(()=>{const e=()=>{window.scrollY>300?st(!0):st(!1)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),i.useEffect(()=>{const e=()=>{const n=re.state?.scrollToBlock;n&&!z&&f.length>0&&setTimeout(()=>{const t=document.getElementById(`block-${n}`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.backgroundColor="#fef3c7",setTimeout(()=>{t.style.backgroundColor=""},2e3))},500)};!z&&f.length>0&&e()},[z,f,re.state]),z&&f.length===0)return r.jsxs(r.Fragment,{children:[r.jsx(Xe,{toasts:Pe,removeToast:Le}),r.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 px-4 py-8",children:r.jsxs("div",{className:"max-w-7xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"h-12 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-64 mx-auto mb-4 relative overflow-hidden",children:r.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})}),r.jsx("div",{className:"h-6 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-40 mx-auto relative overflow-hidden",children:r.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})})]}),r.jsx(St,{count:3})]})})]});if(tt)return r.jsxs(r.Fragment,{children:[r.jsx(Xe,{toasts:Pe,removeToast:Le}),r.jsx("div",{className:"min-h-screen bg-white dark:bg-black flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 dark:text-red-400 text-lg mb-2",children:"Failed to load Block-wise data"}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:tt}),r.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Try Again"})]})})]});const He=ie?.surahInfo?.arabic||(l?`Surah ${l}`:"Surah"),Yt=Cr(l,He),vt=l?String(l):"",Jt=vt==="1"||vt==="2"?"font-normal":"font-semibold",Zt=V?Object.keys(V).length:0,er=!z&&Array.isArray(f)&&f.length>0&&(G?.size??0)===0&&Zt===0&&Re;return r.jsxs(r.Fragment,{children:[r.jsx(Xe,{toasts:Pe,removeToast:Le}),r.jsx("div",{className:"mx-auto min-h-screen bg-gray-50 dark:bg-gray-900 font-outfit transition-colors duration-300",children:r.jsxs("div",{className:"sticky top-0 z-40 glass border-b border-gray-200/50 dark:border-gray-700/50 transition-all duration-300",children:[r.jsx("div",{className:"container-responsive py-3 sm:py-4",children:r.jsxs("div",{className:"flex flex-col items-center justify-center relative",children:[r.jsx("div",{className:"mb-2 sm:mb-4",children:r.jsx("h1",{className:`text-4xl sm:text-5xl md:text-6xl font-arabic text-center text-gray-800 dark:text-white drop-shadow-sm ${Jt}`,style:{fontFamily:jr},"aria-label":He,children:ie?Yt:He})}),parseInt(l)!==1&&parseInt(l)!==9&&r.jsx("div",{className:"mb-4 sm:mb-6",children:r.jsx("div",{className:"hidden sm:block",children:r.jsx("div",{className:"max-w-[1290px] mx-auto relative flex items-center justify-center px-4 lg:px-8",children:r.jsx("div",{className:"flex-shrink-0 px-4 sm:px-6 pt-8 pb-6 sm:pt-10 sm:pb-8",children:parseInt(l)!==1&&parseInt(l)!==9?r.jsx("img",{src:Lt==="dark"?Ar:Tr,alt:"Bismi",className:"w-[236px] h-[52.9px]"}):r.jsx("div",{className:"h-[52.9px]"})})})})}),r.jsx("div",{className:"w-full flex justify-center mb-4 sm:mb-6",children:(p==="mal"||p==="E")&&r.jsx(ir,{options:["Ayah Wise","Block Wise"],value:"Block Wise",onChange:e=>ce(e)})}),er&&r.jsx("div",{className:"w-full flex justify-center mb-4",children:r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 rounded-2xl border border-amber-200 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/30 px-4 py-3 text-sm text-amber-900 dark:text-amber-100",children:[r.jsx("span",{children:"We couldn't load the blockwise translation. Please retry."}),r.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-full bg-amber-600 text-white px-3 py-1.5 text-xs font-semibold hover:bg-amber-700 transition-colors",onClick:()=>Oe("manual"),children:"Retry now"})]})})]})}),r.jsx("div",{className:`container-responsive py-6 sm:py-8 space-y-4 sm:space-y-6 ${R?"pb-32 sm:pb-36":""}`,children:z&&f.length===0?r.jsx(St,{count:5}):f&&f.length>0?f.map((e,n)=>{const t=e.AyaFrom??e.ayafrom??e.from??1,a=e.AyaTo??e.ayato??e.to??t,s=Number.parseInt(t,10),u=Number.parseInt(a,10),y=Number.isFinite(s)&&Number.isFinite(u),b=Number.isFinite(Number(t))?Number(t):1,c=y?s:b,v=Number.isFinite(Number(a))?Number(a):c,k=y?u:v,w=y?`${c}-${k}`:`${t}-${a}`,h=e.ID||e.id||w||`block-${n}`,d=(V[h]||null)?.data,C=p==="mal"&&!Array.isArray(d)&&!Array.isArray(d?.translations)&&!Array.isArray(d?.data)&&(d?.AudioText||d?.translation_text||d?.TranslationText),S=Array.isArray(d)?d:Array.isArray(d?.translations)?d.translations:Array.isArray(d?.data)?d.data:[],$=d?Gt(S,d,c):"",A=Array.isArray(we)?we.slice(c-1,k):[];return r.jsxs("div",{id:`block-${c}-${k}`,className:"relative rounded-2xl bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 hover:shadow-card hover:border-gray-200 dark:hover:border-gray-600 transition-all duration-300",children:[r.jsxs("div",{className:"absolute top-0 left-0 bg-gray-50 dark:bg-gray-700/50 px-3 py-1.5 rounded-br-xl border-b border-r border-gray-100 dark:border-gray-700 text-xs font-medium text-gray-500 dark:text-gray-400 z-10",children:[l,":",c,c!==k&&`-${k}`]}),r.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 pt-12",children:[r.jsx("div",{className:"w-full mb-6 sm:mb-8 text-right",dir:"rtl",children:r.jsx("p",{className:"leading-[2.2] text-gray-800 dark:text-gray-100",style:{fontFamily:dt?`'${dt}', serif`:'"Amiri Quran", serif',direction:"rtl",lineHeight:"2.7",fontSize:`${Mt}px`},children:A.length>0?A.map((m,g)=>Ve(m.text_uthmani,c+g)).join(" "):"Loading Arabic text..."})}),r.jsx("div",{className:"w-full text-left mb-6",children:d?r.jsx("div",{className:`prose dark:prose-invert max-w-none text-gray-600 dark:text-gray-300 ${p==="hi"?"font-hindi":p==="ur"?"font-urdu":p==="bn"?"font-bengali":p==="ta"?"font-tamil":p==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${mt}px`},children:C?r.jsx("div",{className:"leading-relaxed","data-footnote-context":"blockwise",dangerouslySetInnerHTML:{__html:qe(d.AudioText||d.translation_text||d.TranslationText||"",`${c}-${k}`)}}):S.length>0?S.map((m,g)=>{const x=m.TranslationText||m.translationText||m.translation_text||m.text||"",I=m.VerseNo||m.Verse_Number||m.verse_number||m.VerseNumber||m.ayah_number||m.AyaId||m.AyahId||c+g,O=Number.isFinite(parseInt(I,10))?parseInt(I,10):c+g,ae=p==="E"?ge.parseEnglishTranslationWithClickableFootnotes(x,parseInt(l,10),O):qe(x,`${c}-${k}`);return r.jsx("div",{className:"leading-relaxed","data-footnote-context":"blockwise",dangerouslySetInnerHTML:{__html:ae}},`translation-${h}-${g}`)}):d?.TranslationText||d?.translationText||d?.translation_text||d?.text?r.jsx("div",{className:"leading-relaxed","data-footnote-context":"blockwise",dangerouslySetInnerHTML:{__html:p==="E"?ge.parseEnglishTranslationWithClickableFootnotes(d.TranslationText||d.translationText||d.translation_text||d.text,parseInt(l,10),c):qe(d.TranslationText||d.translationText||d.translation_text||d.text,`${c}-${k}`)}}):r.jsx("p",{children:"Translation not available"})}):G.has(h)?r.jsx(Sr,{message:"Loading translation..."}):r.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Translation not available"})}),r.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-700/50",children:r.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[r.jsx("button",{className:"icon-btn",onClick:async()=>{try{const x=`${A.length>0?A.map((I,O)=>Ve(I.text_uthmani,c+O)).join(" "):"Loading Arabic text..."}

${$||"Translation not available"}`;await navigator.clipboard.writeText(x),le("Text copied to clipboard!")}catch(m){console.error("Copy failed",m),Y("Failed to copy text")}},title:"Copy text",children:r.jsx(lr,{className:"w-5 h-5"})}),r.jsx("button",{className:`icon-btn ${B===h&&!X?"text-primary bg-primary/10":""}`,onClick:()=>{B===h?X?(F(!1),P(!0),E.current=!0,o.current&&o.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(m=>{console.error("Error resuming audio:",m)})):(o.current&&o.current.pause(),F(!0),P(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))):Ee(h)},title:B===h?X?"Resume audio":"Pause audio":"Play audio",children:B===h&&!X?r.jsx(cr,{className:"w-5 h-5"}):r.jsx(ur,{className:"w-5 h-5"})}),p!=="ta"&&p!=="E"&&p!=="mal"&&r.jsx("button",{className:"icon-btn group",onClick:m=>{const g=`/surah/${l}#verse-${c}`;m?.ctrlKey||m?.metaKey?(m.preventDefault(),window.open(g,"_blank","noopener,noreferrer")):te(g)},title:"View ayah details",children:r.jsx(dr,{className:"w-5 h-5 group-hover:scale-110 transition-transform"})}),r.jsx("button",{className:"icon-btn group",onClick:m=>{const g=`/word-by-word/${l}/${c}`;if(m?.ctrlKey||m?.metaKey){m.preventDefault(),window.open(g,"_blank","noopener,noreferrer");return}Fe(!0),Ne(c)},title:"Word by word",children:r.jsx(mr,{className:"w-5 h-5 group-hover:scale-110 transition-transform"})}),r.jsx("button",{className:`icon-btn ${Ie[`${c}-${k}`]?"opacity-50 cursor-not-allowed":""}`,onClick:async()=>{if(!pe){Y("Please sign in to bookmark blocks"),te("/sign",{state:{from:re.pathname,message:"Sign in to bookmark blocks"}});return}const m=`${c}-${k}`;try{nt(x=>({...x,[m]:!0}));const g=Ke.getEffectiveUserId(pe);await Ke.addBlockBookmark(g,l,c,k),le(`Saved block ${c}-${k}`)}catch(g){console.error("Failed to bookmark block:",g),Y("Failed to save block")}finally{nt(g=>({...g,[m]:!1}))}},title:"Bookmark block",disabled:Ie[`${c}-${k}`],children:Ie[`${c}-${k}`]?r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b border-current"}):r.jsx(fr,{className:"w-5 h-5"})}),r.jsx("button",{className:"icon-btn",onClick:async()=>{try{const m=window.location.href,I=`${A.length>0?A.map((ae,de)=>Ve(ae.text_uthmani,c+de)).join(" "):"Arabic text is loading..."}

${$||"Translation not available"}

Read more: ${m}`,O=`Surah ${l} â€¢ Verses ${c}-${k}`;navigator.share?await navigator.share({title:O,text:I}):(await navigator.clipboard.writeText(I),le("Content copied to clipboard!"))}catch(m){console.error("Share failed",m),Y("Failed to share")}},title:"Share block",children:r.jsx(pr,{className:"w-5 h-5"})})]})})]})]},`block-${h}-${c}-${k}`)}):r.jsx("div",{className:"text-center py-8",children:r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No blocks available for this Surah"})})}),r.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 dark:border-gray-700 px-3 sm:px-4 lg:px-6 py-3 sm:py-4 mt-6 sm:mt-8",children:r.jsxs("div",{className:"max-w-4xl mx-auto",children:[r.jsxs("div",{className:"sm:hidden space-y-2",children:[r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs("button",{onClick:kt,disabled:parseInt(l)<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg w-[173.96px] min-h-[44px]
                               disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx(Bt,{className:"w-3 h-3"}),r.jsx("span",{children:"Previous Surah"})]}),r.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]`,children:[r.jsx(Ge,{className:"w-3 h-3"}),r.jsx("span",{children:"Beginning of Surah"})]})]}),r.jsx("div",{className:"flex justify-center",children:r.jsxs("button",{onClick:wt,disabled:parseInt(l)>=114,className:`w-[173.96px] flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                                 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                                 border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]
                                 disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx("span",{children:"Next Surah"}),r.jsx(At,{className:"w-3 h-3"})]})})]}),r.jsxs("div",{className:"hidden sm:flex items-center justify-center space-x-2 sm:space-x-4 lg:space-x-6",children:[r.jsxs("button",{onClick:kt,disabled:parseInt(l)<=1,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Bt,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{children:"Previous Surah"})]}),r.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px]",children:[r.jsx(Ge,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{children:"Beginning of Surah"})]}),r.jsxs("button",{onClick:wt,disabled:parseInt(l)>=114,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx("span",{children:"Next Surah"}),r.jsx(At,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]})}),Et&&je&&r.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[r.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:()=>{Ce(!1),Ye(null)}}),r.jsxs("div",{className:"relative w-full sm:w-[550px] max-h-[85vh] sm:max-h-[90vh] bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col animate-slideUp sm:animate-fadeIn overflow-hidden",children:[r.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 sm:hidden cursor-grab active:cursor-grabbing",children:r.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:r.jsx(Tt,{surahId:parseInt(l),range:je.toString(),ipt:1,lang:p==="E"?"E":"mal",onClose:()=>{Ce(!1),Ye(null)},showSuccess:le,showError:Y,isModal:!0},`interpretation-${l}-${je}`)})]})]}),jt&&ot&&r.jsx(Nr,{selectedVerse:ot,surahId:l,onClose:()=>{Fe(!1),Ne(null)},onNavigate:e=>Ne(e),onSurahChange:e=>{Fe(!1),Ne(null),te(`/surah/${e}?wordByWord=1`)}}),Rt&&r.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[r.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:()=>Te(!1)}),r.jsxs("div",{className:"relative w-full sm:w-[480px] md:max-w-2xl lg:max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col animate-slideUp sm:animate-fadeIn overflow-hidden",children:[r.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 sm:hidden cursor-grab active:cursor-grabbing",children:r.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),r.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100 dark:border-gray-800",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white",children:"English Explanation"}),Se?.footnoteNumber&&r.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Footnote ",Se.footnoteNumber,Se?.ayah?` â€¢ Ayah ${Se.ayah}`:""]})]}),r.jsx("button",{onClick:()=>Te(!1),className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-500 dark:text-gray-400",children:r.jsx(hr,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-5 space-y-6",children:Pt?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading explanation..."})]})}):r.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg",children:r.jsx("div",{className:"text-gray-700 leading-[1.6] font-poppins sm:leading-[1.7] lg:leading-[1.8] dark:text-white text-sm sm:text-base lg:text-lg prose prose-sm dark:prose-invert max-w-none",style:{fontSize:`${Dt}px`},children:Wt})})})]})]}),J&&r.jsx(Tt,{surahId:parseInt(l),range:J.range,ipt:J.interpretationNumber,lang:p==="E"?"E":"mal",footnoteId:J.footnoteId||null,blockRanges:f,onClose:()=>me(null)},`block-interpretation-${l}-${J.range}-${J.interpretationNumber}-${J.footnoteId||""}`),Ft&&r.jsx("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`fixed right-6 z-[60] bg-cyan-500 hover:bg-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center ${R?"bottom-32 sm:bottom-36":"bottom-6"}`,title:"Beginning of Surah","aria-label":"Beginning of Surah",children:r.jsx(Ge,{className:"w-6 h-6"})})]})}),R&&r.jsx(Br,{audioElement:o.current,isPlaying:_&&o.current&&!o.current.paused,currentAyah:R,totalAyahs:f.reduce((e,n)=>{const t=n.AyaTo||n.ayato||n.to||0,a=n.AyaFrom||n.ayafrom||n.from||0;return e+(t-a+1)},0),surahInfo:ie?.surahInfo,onPlayPause:bt,onStop:ze,onSkipBack:()=>{zt()},onSkipForward:()=>{xt()},onClose:null,selectedQari:U,onQariChange:e=>{Je(e),B&&R&&(ze(),setTimeout(()=>{Ee(B)},100))},translationLanguage:p,audioTypes:se,onAudioTypesChange:e=>{const n=B,t=R;if(console.log("[BlockWise] onAudioTypesChange",{newTypes:e,currentBlock:n,currentAyah:t,isContinuousPlay:_,isPaused:X}),$e(e),xe.current=e,n&&t){if(o.current)try{o.current.pause(),o.current.currentTime=0}catch(a){console.warn("[BlockWise] Failed to pause audio before restarting with new types",a)}P(!0),F(!1),D(n),L(t),j.current=n,E.current=!0,setTimeout(()=>{console.log("[BlockWise] restarting playback after audioTypes change",{currentBlock:n,currentAyah:t,newTypes:e}),Q(n,t,0,e)},100)}},playbackSpeed:M,onPlaybackSpeedChange:e=>{Ze(e),o.current&&(o.current.playbackRate=e)}})]})};export{fn as default};
