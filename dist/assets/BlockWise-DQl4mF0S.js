import{u as Yt,i as Jt,k as Zt,z as er,j as r,T as tr,C as rr,A as nr,P as ar,B as or,F as sr,o as ir,w as Ue,p as lr,q as kt,X as cr,D as ur,n as dr,E as mr}from"./index-DmadXW_T.js";import{b as i,u as fr,e as pr,d as hr}from"./react-vendor-v5ei6ytj.js";import{u as gr,T as qe}from"./Toast-8dnuOEuu.js";import{W as yr}from"./WordByWord-Br-NRyM5.js";import wt from"./InterpretationBlockwise-DkLq9h8C.js";import{a as vt,D as xr,B as br,C as kr,A as Oe}from"./LoadingSkeleton-BE1LZfF_.js";import wr from"./StickyAudioPlayer-DRRhBZ5E.js";import fe from"./englishTranslationService-Cw_-4qKN.js";import{u as vr}from"./useSequentialEnglishFootnotes-B4d1JHKd.js";import{g as Nr,s as Ar}from"./surahNameUtils-DQZqK-eJ.js";import{C as Nt}from"./chevron-left-DAZqGN25.js";import"./tamilWordByWordService-CjzSbLrS.js";import"./apiService-BnqKikZw.js";import"./hindiWordByWordService-CwYWlP76.js";import"./banglaWordByWordService-CtsFC8ds.js";import"./banglaTranslationService-BhOEZ8RM.js";import"./tamilTranslationService-D5LUOoAY.js";import"./hindiTranslationService-BCljsrBM.js";import"./urduTranslationService-BM_bPhej.js";import"./BlockInterpretationModal-C2y0CgXW.js";import"./InterpretationNavbar-BJwNmLm3.js";import"./WordByWordIcon-COHpKhIK.js";import"./volume-x-DAJKYzCy.js";import"./skip-forward-M3Ahlipj.js";const sn=()=>{const[Br,Tr]=i.useState("Translation"),[Sr,Er]=i.useState("Block wise"),[At,Be]=i.useState(!1),[Te,Qe]=i.useState(null),[z,He]=i.useState(()=>localStorage.getItem("reciter")||"al-hudaify"),[Q,Se]=i.useState(["quran"]),[L,Ke]=i.useState(()=>{const e=localStorage.getItem("playbackSpeed");return e?parseFloat(e):1}),[T,D]=i.useState(null),[jr,H]=i.useState(null),[F,R]=i.useState(null),[Bt,W]=i.useState(1),[M,P]=i.useState(!1),[K,I]=i.useState(!1),a=i.useRef(null),C=i.useRef(null),S=i.useRef(!1),A=i.useRef(!1),pe=i.useRef(L);i.useEffect(()=>{console.log("[BlockWise] audioTypes state updated",Q)},[Q]);const[oe,Xe]=i.useState(null),[U,he]=i.useState(!0),[Ge,ge]=i.useState(null),[Cr,$r]=i.useState([]),[ye,Ye]=i.useState([]),[Ee,Je]=i.useState({}),[d,Ze]=i.useState([]),[_,xe]=i.useState({}),[J,ce]=i.useState(null),[Tt,je]=i.useState(!1),[et,be]=i.useState(null),[X,Z]=i.useState(new Set),ee=i.useRef(!1),[St,Et]=i.useState(0),[Ce,ke]=i.useState(!1),[jt,tt]=i.useState(!1),[Ir,rt]=i.useState(!1),[Fr,Wr]=i.useState(!1),[Ct,we]=i.useState(!1),[$t,ue]=i.useState(""),[It,$e]=i.useState(!1),[ve,nt]=i.useState({footnoteId:null,footnoteNumber:null,surah:null,ayah:null}),te=fr(),re=pr(),{pathname:at}=re,{user:de}=Yt(),{toasts:Ie,removeToast:Fe,showSuccess:se,showError:G,showWarning:ot}=gr(),{quranFont:st,translationLanguage:m,theme:Ft,fontSize:Wt,adjustedTranslationFontSize:it,viewType:ne,setViewType:ie}=Jt(),Pt=Math.max(Number(it)-2,10),{surahId:l}=hr(),{getBlockViewCache:lt,setBlockViewCache:We}=Zt(),ct=i.useRef(!1),ut=i.useRef(m),dt=i.useRef(l);vr({enabled:m==="E"&&ne==="Block Wise",context:"blockwise",dependencies:[_,d,l,oe]}),i.useEffect(()=>{re.state?.viewType&&ie(re.state.viewType)},[re.state,ie]),i.useEffect(()=>{if(!(m==="mal"||m==="E")){ne!=="Ayah Wise"&&ie("Ayah Wise");return}if(ne==="Ayah Wise"){const n=`/surah/${l}`;at!==n&&te(n)}else ne!=="Block Wise"&&ie("Block Wise")},[ne,m,l,te,at,ie]);const{surahs:Pe}=er(),Ne=i.useCallback((e=[])=>!Array.isArray(e)||e.length===0?new Set:new Set(e.map((n,t)=>{const o=n.AyaFrom??n.ayafrom??n.from??1,s=n.AyaTo??n.ayato??n.to??o,c=Number.parseInt(o,10),h=Number.parseInt(s,10),g=Number.isFinite(c)&&Number.isFinite(h),u=Number.isFinite(Number(o))?Number(o):1,E=g?c:u,b=Number.isFinite(Number(s))?Number(s):E,y=g?`${E}-${g?h:b}`:`${o}-${s}`;return n.ID||n.id||y||`block-${t}`})),[]),Rt=e=>{const n=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];return e.toString().split("").map(t=>n[t]||t).join("")},Lt=e=>e?e.replace(/\s*﴿\s*[\d\u0660-\u0669]+\s*﴾\s*$/u,"").trim():"",Re=(e,n)=>`${Lt(e)||e||""} ﴿${Rt(n)}﴾`,q=(e,n=null)=>{const t=Number.parseInt(e,10);return Number.isFinite(t)?t:n},Le=i.useCallback((e="manual")=>{if(!l)return;console.log(`[BlockWise] Triggering blockwise reload (${e})`),ee.current=!1;const n=Ne(d);Z(n),xe({}),ge(null),e==="manual"&&ke(!1),Et(t=>t+1)},[l,d,Ne]);i.useEffect(()=>(a.current||(a.current=new Audio),()=>{a.current&&(a.current.pause(),a.current.src="",a.current.currentTime=0),D(null),H(null),R(null),P(!1),I(!1),C.current=null,S.current=!1}),[]);const Dt={"al-hudaify":"QH","al-afasy":"QA","al-ghamidi":"QG"},mt=e=>({E:"English",mal:"Malayalam",ur:"Urdu",bn:"Bangla",ta:"Tamil",hi:"Hindi"})[e]||e,Ae=(e,n=!1,t=null)=>{if(!a.current)return;const o=t||Q;if(console.log("[BlockWise] playBlockAudio start",{blockId:e,fromContinuous:n,audioTypes:o,preservedAudioTypes:t,translationLanguage:m,selectedQirath:z}),!n&&m!=="mal"&&o.some(u=>u==="translation"||u==="interpretation")){const u=mt(m);ot(`${u} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available for blockwise view.`);const E=Q.filter(b=>b!=="translation"&&b!=="interpretation");E.length>0?Se(E):Se(["quran"]);return}if(a.current)try{a.current.pause(),a.current.onended=null,a.current.onerror=null,a.current.src="",a.current.load()}catch(g){console.warn("[BlockWise] Error cleaning up audio:",g)}const s=d.find(g=>(g.ID||g.id)===e);if(!s){console.error("Block not found:",e),A.current=!1;return}const c=s.AyaFrom||s.ayafrom||s.from||1,h=q(c,1);P(!0),D(e),R(h),W(1),I(!1),C.current=e,S.current=!0,console.log("[BlockWise] playBlockAudio state set",{playingBlock:e,normalizedStartingAyah:h,currentAudioType:o?.[0]||"quran",audioTypes:o}),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}})),le(e,h,0,o)},Mt=async(e,n,t,o=1)=>{const s=String(e).padStart(3,"0"),c=String(n).padStart(3,"0"),h="https://old.thafheem.net/audio";if(t==="quran")return`${h}/qirath/${z}/${Dt[z]}${s}_${c}.ogg`;if(t==="translation")return`${h}/translation/T${s}_${c}.ogg`;if(t==="interpretation"){if(o===1)return`${h}/interpretation/I${s}_${c}.ogg`;{const g=String(o).padStart(2,"0");return`${h}/interpretation/I${s}_${c}_${g}.ogg`}}return null},O=async(e,n,t=0,o=null)=>{if(!a.current)return;const s=q(n,q(F,1)||1),c=o||Q;if(console.log("[BlockWise] playAyahAudioWithTypes",{blockId:e,requestedAyah:n,ayahToPlay:s,audioTypeIndex:t,audioTypes:c,audioTypesLength:c.length,shouldMoveToNext:t>=c.length,playbackSpeed:L,isContinuousPlay:M,isPaused:K,playingBlock:T}),t>=c.length){console.log("[BlockWise] All audio types played for ayah, moving to next ayah",{audioTypeIndex:t,audioTypesLength:c.length,ayahToPlay:s,blockId:e}),ft(s,c);return}try{a.current.onended&&(a.current.onended=null),a.current.onerror&&(a.current.onerror=null),a.current.pause()}catch(v){console.warn("[BlockWise] Error stopping previous audio:",v)}const h=c[t];let g=1;h==="interpretation"&&(g=Bt);let u;try{u=await Mt(l,s,h,g)}catch(v){console.error("[BlockWise] Error generating audio URL:",v),O(e,s,t+1,o);return}if(!u){O(e,s,t+1,o);return}console.log("[BlockWise] generated audioUrl",{blockId:e,ayahToPlay:s,currentAudioType:h,audioUrl:u});const b={quran:"qirath",translation:"translation",interpretation:"interpretation"}[h]||"qirath";H(b),R(s);try{a.current.onended=null,a.current.onerror=null}catch(v){console.warn("[BlockWise] Error clearing audio handlers:",v)}let w=null;const y=()=>{w&&(clearTimeout(w),w=null)},V=()=>{y(),w=setTimeout(()=>{a.current&&a.current.readyState<2&&T===e&&F===s&&M&&(console.warn("[BlockWise] Audio load timeout (file may be missing):",u),O(e,s,t+1,c))},5e3)};a.current.onended=()=>{if(y(),console.log("[BlockWise] Audio ended",{blockId:e,ayahToPlay:s,audioTypeIndex:t,currentAudioType:h,playingBlock:C.current,isContinuousPlay:S.current,audioTypes:c,totalTypes:c.length,isProcessingNext:A.current}),A.current){console.warn("[BlockWise] onended handler aborted - already processing next move");return}S.current&&C.current===e?(console.log("[BlockWise] Continuing to next audio type/ayah"),O(e,s,t+1,c)):console.warn("[BlockWise] Not continuing - state mismatch",{isContinuousPlay:S.current,playingBlock:C.current,blockId:e,ayahToPlay:s})},a.current.onerror=v=>{y();const j=a.current;if(j&&j.error){const k=j.error.code;if(k===2||k===4){if(h==="interpretation"){if(A.current=!0,a.current)try{a.current.pause(),a.current.onended=null,a.current.onerror=null}catch(x){console.warn("[BlockWise] Error cleaning up audio on interpretation error:",x)}if(W(1),S.current&&C.current===e){setTimeout(()=>{O(e,s,t+1,c),setTimeout(()=>{A.current=!1},300)},200);return}else A.current=!1}}else console.error("[BlockWise] Unexpected audio error:",{errorCode:j.error?.code,audioUrl:u,currentAudioType:h})}else console.error("[BlockWise] Audio error event (unknown error):",u,v);S.current&&C.current===e&&!A.current?setTimeout(()=>{O(e,s,t+1,c)},200):A.current||console.warn("[BlockWise] Not continuing after error - state mismatch",{isContinuousPlay:S.current,playingBlock:C.current,blockId:e})};const f=()=>{A.current=!1,a.current&&(a.current.playbackRate=pe.current),a.current.removeEventListener("canplay",f)};a.current.addEventListener("canplay",f,{once:!0}),a.current.addEventListener("canplay",y,{once:!0}),a.current.addEventListener("loadeddata",y,{once:!0});const B=()=>{a.current&&(a.current.playbackRate=pe.current),a.current.removeEventListener("loadedmetadata",B)};a.current.addEventListener("loadedmetadata",B,{once:!0}),a.current.src=u,a.current.playbackRate=pe.current,a.current.load(),V(),a.current.play().catch(v=>{if(y(),A.current){setTimeout(()=>{A.current=!1},100);return}v.name!=="NotSupportedError"&&console.error("[BlockWise] Error playing audio:",v.name,v.message,u),S.current&&C.current===e?(A.current=!1,setTimeout(()=>{O(e,s,t+1,c)},200)):(A.current=!1,console.warn("[BlockWise] Not continuing after play error - state mismatch",{blockId:e,playingBlockRef:C.current,isContinuousPlayRef:S.current}))})},le=(e,n,t=0,o=null)=>{O(e,n,t,o)},ft=(e=null,n=null)=>{if(A.current){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - already processing next",{currentAyahOverride:e,currentAyahInBlock:F});return}const t=e??F,o=C.current||T;if(!o||!t){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - no playing block or ayah",{currentPlayingBlock:o,effectiveCurrentAyah:t,playingBlock:T,playingBlockRef:C.current});return}A.current=!0;const s=d.find(E=>(E.ID||E.id)===o);if(!s){A.current=!1;return}const c=s.AyaTo||s.ayato||s.to,h=q(t,null),g=q(c,h);if(h===null||g===null){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - invalid ayah numbers",{currentPlayingBlock:o,currentAyahInBlock:t,ayaTo:c}),A.current=!1;return}const u=h+1;if(console.log("[BlockWise] moveToNextAyahOrBlock",{currentPlayingBlock:o,currentAyahNumber:h,nextAyah:u,ayaToNumber:g,isContinuousPlay:S.current}),u<=g)W(1),le(o,u,0,n);else if(S.current){if(a.current)try{a.current.pause(),a.current.onended=null,a.current.onerror=null}catch(E){console.warn("[BlockWise] Error cleaning up audio before next block:",E)}W(1),A.current=!1,setTimeout(()=>{zt()},50)}else{if(a.current)try{a.current.pause(),a.current.onended=null,a.current.onerror=null}catch(E){console.warn("[BlockWise] Error stopping audio:",E)}D(null),H(null),R(null),W(1),I(!1),C.current=null,S.current=!1,A.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},_t=(e=null,n=null)=>{const t=e??F;if(!T||!t)return;const o=d.find(u=>(u.ID||u.id)===T);if(!o)return;const s=o.AyaFrom||o.ayafrom||o.from||1,c=q(t,null),h=q(s,1);if(c===null||h===null){console.warn("[BlockWise] moveToPreviousAyahOrBlock aborted - invalid ayah numbers",{playingBlock:T,currentAyahInBlock:t,ayaFrom:s});return}const g=c-1;console.log("[BlockWise] moveToPreviousAyahOrBlock",{playingBlock:T,currentAyahNumber:c,previousAyah:g,ayaFromNumber:h,isContinuousPlay:M}),g>=h?(W(1),le(T,g,0,n)):M?(W(1),Vt()):(D(null),H(null),R(null),W(1),I(!1))},Vt=()=>{if(!M||!d||d.length===0)return;const e=d.findIndex(n=>(n.ID||n.id)===T);if(e>0){const n=d[e-1],t=n.ID||n.id,o=n.AyaTo||n.ayato||n.to||1,s=q(o,1);P(!0),D(t),R(s),W(1),I(!1),C.current=t,S.current=!0,le(t,s)}else{const n=d[0],t=n.ID||n.id,o=n.AyaFrom||n.ayafrom||n.from||1,s=q(o,1);D(t),R(s),W(1),le(t,s)}},zt=()=>{if(A.current){console.warn("[BlockWise] playNextBlock aborted - already processing next");return}if(!S.current||!d||d.length===0){console.warn("[BlockWise] playNextBlock aborted - invalid state",{isContinuousPlay:S.current,isContinuousPlayState:M,blockRangesLength:d?.length}),A.current=!1;return}A.current=!0;const n=C.current||T,t=d.findIndex(o=>(o.ID||o.id)===n);if(console.log("[BlockWise] playNextBlock",{currentIndex:t,currentPlayingBlock:n,playingBlock:T,playingBlockRef:C.current,blockRangesLength:d.length}),t!==-1&&t<d.length-1){const o=d[t+1],s=o.ID||o.id;if(!s){console.error("[BlockWise] playNextBlock - next block has no ID",o);return}if(a.current)try{a.current.pause(),a.current.onended=null,a.current.onerror=null,a.current.src="",a.current.load()}catch(c){console.warn("[BlockWise] Error cleaning up audio before next block:",c)}setTimeout(()=>{try{Ae(s,!0,Q)}catch(c){console.error("[BlockWise] Error playing next block:",c),D(null),H(null),R(null),W(1),P(!1),I(!1),A.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},100)}else{if(console.log("[BlockWise] playNextBlock - end of blocks reached"),a.current)try{a.current.pause(),a.current.onended=null,a.current.onerror=null}catch(o){console.warn("[BlockWise] Error stopping audio at end:",o)}D(null),H(null),R(null),W(1),P(!1),I(!1),C.current=null,S.current=!1,A.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},pt=()=>{if(!d||d.length===0){G("No blocks available to play");return}if(m!=="mal"){const e=mt(m);ot(`${e} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available.`);return}try{if(M)a.current&&a.current.pause(),P(!1),I(!0),S.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}));else if(T&&F)P(!0),I(!1),S.current=!0,a.current&&a.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(e=>{console.error("Error resuming audio:",e)});else{P(!0),I(!1),S.current=!0;const e=d[0].ID||d[0].id;Ae(e)}}catch(e){console.error("Error in handlePlayAudio:",e),P(!1),D(null),R(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},De=i.useRef(null);De.current=pt,i.useEffect(()=>{const e=()=>{De.current&&De.current()};return window.addEventListener("playAudio",e),()=>{window.removeEventListener("playAudio",e)}},[]),i.useEffect(()=>{const e=M&&!K&&T!==null;window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:e}}))},[M,K,T]),i.useEffect(()=>{const e=n=>{const{type:t,message:o}=n.detail;t==="success"?se(o):t==="error"&&G(o)};return window.addEventListener("showToast",e),()=>{window.removeEventListener("showToast",e)}},[se,G]);const Me=()=>{a.current&&(a.current.pause(),a.current.currentTime=0,a.current.onended=null,a.current.onerror=null),P(!1),D(null),H(null),R(null),C.current=null,S.current=!1,A.current=!1,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}})),W(1),I(!1)};i.useEffect(()=>()=>{try{Me()}catch{}},[]),i.useEffect(()=>()=>{a.current&&(a.current.pause(),D(null),H(null),R(null),W(1),P(!1),I(!1),C.current=null,S.current=!1,A.current=!1)},[l]),i.useEffect(()=>{localStorage.setItem("reciter",z),window.dispatchEvent(new CustomEvent("reciterChange",{detail:{reciter:z}}))},[z]),i.useEffect(()=>{const e=n=>{const t=n.detail.reciter;t!==z&&He(t)};return window.addEventListener("reciterChange",e),()=>{window.removeEventListener("reciterChange",e)}},[z]),i.useEffect(()=>{T&&F&&a.current&&M&&le(T,F,0)},[z,Q]),i.useEffect(()=>{pe.current=L},[L]),i.useEffect(()=>{localStorage.setItem("playbackSpeed",L.toString()),window.dispatchEvent(new CustomEvent("playbackSpeedChange",{detail:{playbackSpeed:L}}))},[L]),i.useEffect(()=>{const e=n=>{const t=n.detail.playbackSpeed;t!==L&&Ke(t)};return window.addEventListener("playbackSpeedChange",e),()=>{window.removeEventListener("playbackSpeedChange",e)}},[L]),i.useEffect(()=>{a.current&&(a.current.playbackRate=L)},[L]),i.useEffect(()=>{ct.current=!1},[l,m]),i.useEffect(()=>{ke(!1)},[l]),i.useEffect(()=>{if(!l||!(m==="mal"||m==="E"))return;const n=lt?.(l,m);if(n){ct.current=!0,Xe(n.blockData||null),Ze(n.blockRanges||[]),Ye(n.arabicVerses||[]),xe(n.blockTranslations||{}),ge(null),Z(new Set);const t=n.blockTranslations?Object.keys(n.blockTranslations).length:0,o=!!(n.__meta?.isComplete&&t>0);he(!o),ee.current=o}},[l,m,lt]),i.useEffect(()=>((async()=>{if(!l||ee.current||Pe.length===0)return;if(!(m==="mal"||m==="E")){console.log(`⚠️ BlockWise: Language '${m}' doesn't support blockwise. Skipping fetch.`),he(!1);return}ee.current=!0;try{he(!0),ge(null);const[t,o]=await Promise.all([ur(parseInt(l),m||"mal"),dr(parseInt(l))]),s=Pe.find(c=>c.number===parseInt(l));if(Xe({surahInfo:s||{number:parseInt(l),arabic:"القرآن",type:"Makki"}}),Ye(o||[]),Ze(t||[]),t&&t.length>0){const c=async(f,B)=>{const v=f.AyaFrom||f.ayafrom||f.from,j=f.AyaTo||f.ayato||f.to;if(v==null||j===void 0||j===null)return;const p=Number.parseInt(v,10),k=Number.parseInt(j,10),N=Number.isFinite(p)&&Number.isFinite(k),x=N?`${p}-${k}`:`${v}-${j}`,$=f.ID||f.id||x||`block-${B}`,ae=N?p:v,Ve=N?k:j;try{Z(Y=>new Set([...Y,$]));let me;const ze=m||"mal";me=await mr(parseInt(l),x,ze),xe(Y=>({...Y,[$]:{range:x,ayaFrom:ae,ayaTo:Ve,data:me}})),Z(Y=>{const bt=new Set(Y);return bt.delete($),bt})}catch(me){me.message?.includes("timeout")||console.error(`❌ BlockWise: Failed to load block ${x}:`,me.message),Z(ze=>{const Y=new Set(ze);return Y.delete($),Y})}},g=[];let u=0;const E=async(f,B)=>new Promise(v=>{const j=async()=>{u++;try{await c(f,B)}catch{}finally{u--,g.length>0&&g.shift()(),v()}};u<5?j():g.push(j)}),b=f=>{const B=f.slice(0,3),v=f.slice(3);return{visibleBlocks:B,backgroundBlocks:v}},{visibleBlocks:w,backgroundBlocks:y}=b(t),V=w.map((f,B)=>c(f,B));y.forEach((f,B)=>{setTimeout(()=>{E(f,B+w.length)},50*Math.floor(B/5))}),Promise.allSettled(V).then(f=>{const B=f.filter(v=>v.status==="fulfilled").length})}}catch(t){let o=t.message;t.message?.includes("timeout")||t.message?.includes("Request timeout")?o="The server is taking longer than expected to respond. Please try again in a moment. If the problem persists, the English blockwise data may be temporarily unavailable.":t.message?.includes("Failed to fetch")||t.message?.includes("Network error")?o="Unable to connect to the server. Please check your internet connection and try again.":t.message?.includes("HTTP error")&&(o=`Server error: ${t.message}. Please try again later.`),ge(o),console.error("Error fetching block-wise data:",t),ee.current=!1}finally{he(!1)}})(),()=>{ee.current=!1}),[l,Pe,m,St]),i.useEffect(()=>{if(!l||!(m==="mal"||m==="E")||!We||U||!Array.isArray(d)||d.length===0)return;const t=(_?Object.keys(_).length:0)>0&&(!X||X.size===0);We(l,m,{blockData:oe,blockRanges:d,arabicVerses:ye,blockTranslations:_,__meta:{isComplete:t}})},[l,m,oe,d,ye,_,U,X,We]),i.useEffect(()=>{const e=m==="mal"||m==="E",n=Array.isArray(d)&&d.length>0,t=U||X&&X.size>0,o=_?Object.keys(_).length:0;!l||!e||!n||t||o>0||Ce||(ke(!0),Le("auto"))},[l,m,d,_,U,X,Ce,Le]),i.useEffect(()=>{const e=ut.current!==m,n=dt.current!==l;!e&&!n||(ut.current=m,dt.current=l,d.length>0?Z(Ne(d)):Z(new Set),xe({}),ee.current=!1,ce(null),Be(!1),we(!1),ue(""),$e(!1),nt({footnoteId:null,footnoteNumber:null,surah:null,ayah:null}),ke(!1))},[m,l,d,Ne]),i.useEffect(()=>{(async()=>{if(!de||!l){rt(!1);return}try{const n=await Ue.isFavorited(de.uid,l);rt(n)}catch(n){console.error("Error loading favorite status:",n)}})()},[de,l]),i.useEffect(()=>{if(m!=="E")return;const e=async n=>{const t=n.target.closest(".english-footnote-link");if(!t)return;if(ne==="Block Wise"){n.preventDefault(),n.stopPropagation();const w=t.getAttribute("data-footnote-id"),y=t.getAttribute("data-interpretation-id"),V=y&&/^\d+$/.test(y)?parseInt(y,10):null,B=t.getAttribute("data-interpretation-number")||t.getAttribute("data-footnote-number")||(t.textContent||"").trim(),v=B&&/^\d+$/.test(B)?parseInt(B,10):1,j=t.getAttribute("data-ayah"),p=j?parseInt(j,10):null;if(!B&&!w){console.warn("[BlockWise] ⚠️ Missing displayed number and footnote ID");return}let k=null;if(p&&d.length>0){const N=d.find(x=>{const $=x.AyaFrom||x.ayafrom||x.from||0,ae=x.AyaTo||x.ayato||x.to||$;return p>=$&&p<=ae});if(N){const x=N.AyaFrom||N.ayafrom||N.from||1,$=N.AyaTo||N.ayato||N.to||x;k=`${x}-${$}`}else console.warn("[BlockWise] ⚠️ Could not find block range for verse:",p,"available blocks:",d.map(x=>({from:x.AyaFrom||x.ayafrom||x.from,to:x.AyaTo||x.ayato||x.to})))}if(!k&&d.length>0){const N=d[0],x=N.AyaFrom||N.ayafrom||N.from||1,$=N.AyaTo||N.ayato||N.to||x;k=`${x}-${$}`}if(k){ce({range:k,interpretationNumber:v,footnoteId:w,interpretationId:V});return}else console.warn("[BlockWise] ⚠️ Could not determine block range, falling back to footnote modal")}n.preventDefault(),n.stopPropagation();const o=t.getAttribute("data-footnote-id"),s=t.getAttribute("data-interpretation-id"),c=s&&/^\d+$/.test(s)?parseInt(s,10):null,h=t.getAttribute("data-footnote-number")||(t.textContent||"").trim(),g=t.getAttribute("data-interpretation-number")||t.getAttribute("data-footnote-number"),u=g&&/^\d+$/.test(g)?parseInt(g,10):null,E=t.getAttribute("data-ayah"),b=E?parseInt(E,10):null;nt({footnoteId:o,interpretationId:c,footnoteNumber:h||null,surah:l?parseInt(l,10):null,ayah:b}),ue("Loading..."),$e(!0),we(!0);try{let w="";if(c)w=await fe.getInterpretationById(c);else if(o)w=await fe.getExplanation(parseInt(o,10));else if(u&&b)w=await fe.getInterpretationByNumber(parseInt(l,10),b,u);else{ue("Explanation not available.");return}ue(w||"Explanation not available.")}catch(w){console.error("Error fetching English footnote explanation:",w),ue(`Error loading explanation: ${w.message||w}`)}finally{$e(!1)}};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[m,l,ne,d]);const Ut=e=>{if(!e)return"";const n=document.createElement("div");return n.innerHTML=e,n.textContent||n.innerText||""},qt=(e={})=>e?.TranslationText||e?.translationText||e?.translation_text||e?.text||"",Ot=(e={},n)=>{const t=e?.VerseNo??e?.Verse_Number??e?.verse_number??e?.VerseNumber??e?.ayah_number??e?.AyaId??e?.AyahId??n,o=Number.parseInt(t,10);return Number.isFinite(o)?o:n},Qt=(e=[],n=null,t=1)=>{const o=e.length>0?e:n?[n]:[];return o.length===0?"":o.map((s,c)=>{const h=qt(s);if(!h)return"";const g=Ut(h).trim();if(!g)return"";const u=Ot(s,t+c);return o.length>1?`${u}. ${g}`:g}).filter(Boolean).join(`

`)},ht=(e,n)=>{if(!e)return"";const t=document.createElement("div");return t.innerHTML=e,t.querySelectorAll("sup").forEach(s=>{const c=s.textContent.trim();/^\d+$/.test(c)&&(s.style.cssText=`
          cursor: pointer !important;
          background-color: rgb(41 169 199) !important;
          color: rgb(255, 255, 255) !important;
          font-weight: 600 !important;
          text-decoration: none !important;
          border: none !important;
          display: inline-flex !important;
          align-items: center !important;
          justify-content: center !important;
          font-size: 12px !important;
          vertical-align: middle !important;
          line-height: 1 !important;
          border-radius: 9999px !important;
          position: relative !important;
          z-index: 10 !important;
          top: 0px !important;
          min-width: 20px !important;
          min-height: 19px !important;
          text-align: center !important;
          transition: 0.2s ease-in-out !important;
          padding-top: 3px !important;
          margin-right: 4px;
          margin-left: -1px;
          margin-top: -15px;
          padding-left: 2px !important;
          padding-right: 2px !important;
        `,s.setAttribute("data-interpretation",c),s.setAttribute("data-range",n),s.setAttribute("data-lang",m==="E"?"en":"mal"),s.setAttribute("title",`Click to view interpretation ${c}`),s.setAttribute("aria-label",`Interpretation ${c}`),s.setAttribute("data-interpretation-label",c),s.className="interpretation-link")}),t.innerHTML};i.useEffect(()=>{const e=t=>{let o=t.target.closest(".interpretation-link");if(!o&&m==="E"){const s=t.target.closest(".english-footnote-link");if(s){const h=s.getAttribute("data-interpretation-number")||s.getAttribute("data-footnote-number")||s.textContent?.trim()||"",g=h&&/^\d+$/.test(h)?parseInt(h,10):1,u=s.getAttribute("data-surah"),E=s.getAttribute("data-ayah");if(u===l&&E&&d.length>0){const b=parseInt(E,10),w=d.find(y=>{const V=y.AyaFrom||y.ayafrom||y.from||0,f=y.AyaTo||y.ayato||y.to||V;return b>=V&&b<=f});if(w){const y=w.AyaFrom||w.ayafrom||w.from||1,V=w.AyaTo||w.ayato||w.to||y,f=`${y}-${V}`,B=s.getAttribute("data-footnote-id");t.preventDefault(),t.stopPropagation(),ce({range:f,interpretationNumber:g,footnoteId:B});return}else console.warn("[BlockWise] ⚠️ Could not find block range for verse:",b)}}}if(o){t.preventDefault(),t.stopPropagation();const s=o.getAttribute("data-interpretation"),c=o.getAttribute("data-range");o.getAttribute("data-lang"),s&&c?ce({range:c,interpretationNumber:parseInt(s,10)}):console.warn("[BlockWise] ⚠️ Missing interpretation data:",{interpretationNumber:s,range:c})}},n=document.createElement("style");return n.textContent=`
      .interpretation-link {
        cursor: pointer !important;
      }
      .interpretation-link > a {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 100% !important;
        height: 100% !important;
        color: inherit !important;
        font-weight: inherit !important;
        text-decoration: none !important;
      }
      .interpretation-link:hover {
        background-color: #0891b2 !important;
        transform: scale(1.05) !important;
      }
      .interpretation-link:active {
        background-color: #0e7490 !important;
        transform: scale(0.95) !important;
      }
    `,document.head.appendChild(n),document.addEventListener("click",e,!0),()=>{document.removeEventListener("click",e,!0),document.head.removeChild(n)}},[]);const gt=()=>{const e=parseInt(l)-1;e>=1&&te(`/blockwise/${e}`)},yt=()=>{const e=parseInt(l)+1;e<=114&&te(`/blockwise/${e}`)};if(i.useEffect(()=>{const e=()=>{window.scrollY>300?tt(!0):tt(!1)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),i.useEffect(()=>{const e=()=>{const n=re.state?.scrollToBlock;n&&!U&&d.length>0&&setTimeout(()=>{const t=document.getElementById(`block-${n}`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.backgroundColor="#fef3c7",setTimeout(()=>{t.style.backgroundColor=""},2e3))},500)};!U&&d.length>0&&e()},[U,d,re.state]),U&&d.length===0)return r.jsxs(r.Fragment,{children:[r.jsx(qe,{toasts:Ie,removeToast:Fe}),r.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 px-4 py-8",children:r.jsxs("div",{className:"max-w-7xl mx-auto",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("div",{className:"h-12 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-64 mx-auto mb-4 relative overflow-hidden",children:r.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})}),r.jsx("div",{className:"h-6 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-40 mx-auto relative overflow-hidden",children:r.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})})]}),r.jsx(vt,{count:3})]})})]});if(Ge)return r.jsxs(r.Fragment,{children:[r.jsx(qe,{toasts:Ie,removeToast:Fe}),r.jsx("div",{className:"min-h-screen bg-white dark:bg-black flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"text-red-500 dark:text-red-400 text-lg mb-2",children:"Failed to load Block-wise data"}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:Ge}),r.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Try Again"})]})})]});const _e=oe?.surahInfo?.arabic||(l?`Surah ${l}`:"Surah"),Ht=Nr(l,_e),xt=l?String(l):"",Kt=xt==="1"||xt==="2"?"font-normal":"font-semibold",Xt=_?Object.keys(_).length:0,Gt=!U&&Array.isArray(d)&&d.length>0&&(X?.size??0)===0&&Xt===0&&Ce;return r.jsxs(r.Fragment,{children:[r.jsx(qe,{toasts:Ie,removeToast:Fe}),r.jsx("div",{className:"mx-auto min-h-screen bg-gray-50 dark:bg-gray-900 font-outfit transition-colors duration-300",children:r.jsxs("div",{className:"sticky top-0 z-40 glass border-b border-gray-200/50 dark:border-gray-700/50 transition-all duration-300",children:[r.jsx("div",{className:"container-responsive py-3 sm:py-4",children:r.jsxs("div",{className:"flex flex-col items-center justify-center relative",children:[r.jsx("div",{className:"mb-2 sm:mb-4",children:r.jsx("h1",{className:`text-4xl sm:text-5xl md:text-6xl font-arabic text-center text-gray-800 dark:text-white drop-shadow-sm ${Kt}`,style:{fontFamily:Ar},"aria-label":_e,children:oe?Ht:_e})}),parseInt(l)!==1&&parseInt(l)!==9&&r.jsx("div",{className:"mb-4 sm:mb-6",children:r.jsx("div",{className:"hidden sm:block",children:r.jsx("div",{className:"max-w-[1290px] mx-auto relative flex items-center justify-center px-4 lg:px-8",children:r.jsx("div",{className:"flex-shrink-0 px-4 sm:px-6 pt-8 pb-6 sm:pt-10 sm:pb-8",children:parseInt(l)!==1&&parseInt(l)!==9?r.jsx("img",{src:Ft==="dark"?xr:br,alt:"Bismi",className:"w-[236px] h-[52.9px]"}):r.jsx("div",{className:"h-[52.9px]"})})})})}),r.jsx("div",{className:"w-full flex justify-center mb-4 sm:mb-6",children:(m==="mal"||m==="E")&&r.jsx(tr,{options:["Ayah Wise","Block Wise"],value:"Block Wise",onChange:e=>ie(e)})}),Gt&&r.jsx("div",{className:"w-full flex justify-center mb-4",children:r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 rounded-2xl border border-amber-200 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/30 px-4 py-3 text-sm text-amber-900 dark:text-amber-100",children:[r.jsx("span",{children:"We couldn't load the blockwise translation. Please retry."}),r.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-full bg-amber-600 text-white px-3 py-1.5 text-xs font-semibold hover:bg-amber-700 transition-colors",onClick:()=>Le("manual"),children:"Retry now"})]})})]})}),r.jsx("div",{className:`container-responsive py-6 sm:py-8 space-y-4 sm:space-y-6 ${F?"pb-32 sm:pb-36":""}`,children:U&&d.length===0?r.jsx(vt,{count:5}):d&&d.length>0?d.map((e,n)=>{const t=e.AyaFrom??e.ayafrom??e.from??1,o=e.AyaTo??e.ayato??e.to??t,s=Number.parseInt(t,10),c=Number.parseInt(o,10),h=Number.isFinite(s)&&Number.isFinite(c),g=Number.isFinite(Number(t))?Number(t):1,u=h?s:g,E=Number.isFinite(Number(o))?Number(o):u,b=h?c:E,w=h?`${u}-${b}`:`${t}-${o}`,y=e.ID||e.id||w||`block-${n}`,f=(_[y]||null)?.data,B=Array.isArray(f)?f:Array.isArray(f?.translations)?f.translations:Array.isArray(f?.data)?f.data:[],v=f?Qt(B,f,u):"",j=Array.isArray(ye)?ye.slice(u-1,b):[];return r.jsxs("div",{id:`block-${u}-${b}`,className:"relative rounded-2xl bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 hover:shadow-card hover:border-gray-200 dark:hover:border-gray-600 transition-all duration-300",children:[r.jsxs("div",{className:"absolute top-0 left-0 bg-gray-50 dark:bg-gray-700/50 px-3 py-1.5 rounded-br-xl border-b border-r border-gray-100 dark:border-gray-700 text-xs font-medium text-gray-500 dark:text-gray-400 z-10",children:[l,":",u,u!==b&&`-${b}`]}),r.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 pt-12",children:[r.jsx("div",{className:"w-full mb-6 sm:mb-8 text-right",dir:"rtl",children:r.jsx("p",{className:"leading-[2.2] text-gray-800 dark:text-gray-100",style:{fontFamily:st?`'${st}', serif`:'"Amiri Quran", serif',direction:"rtl",lineHeight:"2.7",fontSize:`${Wt}px`},children:j.length>0?j.map((p,k)=>Re(p.text_uthmani,u+k)).join(" "):"Loading Arabic text..."})}),r.jsx("div",{className:"w-full text-left mb-6",children:f?r.jsx("div",{className:`prose dark:prose-invert max-w-none text-gray-600 dark:text-gray-300 ${m==="hi"?"font-hindi":m==="ur"?"font-urdu":m==="bn"?"font-bengali":m==="ta"?"font-tamil":m==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${it}px`},children:B.length>0?B.map((p,k)=>{const N=p.TranslationText||p.translationText||p.translation_text||p.text||"",x=p.VerseNo||p.Verse_Number||p.verse_number||p.VerseNumber||p.ayah_number||p.AyaId||p.AyahId||u+k,$=Number.isFinite(parseInt(x,10))?parseInt(x,10):u+k,ae=m==="E"?fe.parseEnglishTranslationWithClickableFootnotes(N,parseInt(l,10),$):ht(N,`${u}-${b}`);return r.jsx("div",{className:"leading-relaxed","data-footnote-context":"blockwise",dangerouslySetInnerHTML:{__html:ae}},`translation-${y}-${k}`)}):f?.TranslationText||f?.translationText||f?.translation_text||f?.text?r.jsx("div",{className:"leading-relaxed","data-footnote-context":"blockwise",dangerouslySetInnerHTML:{__html:m==="E"?fe.parseEnglishTranslationWithClickableFootnotes(f.TranslationText||f.translationText||f.translation_text||f.text,parseInt(l,10),u):ht(f.TranslationText||f.translationText||f.translation_text||f.text,`${u}-${b}`)}}):r.jsx("p",{children:"Translation not available"})}):X.has(y)?r.jsx(kr,{message:"Loading translation..."}):r.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Translation not available"})}),r.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-700/50",children:r.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[r.jsx("button",{className:"icon-btn",onClick:async()=>{try{const N=`${j.length>0?j.map((x,$)=>Re(x.text_uthmani,u+$)).join(" "):"Loading Arabic text..."}

${v||"Translation not available"}`;await navigator.clipboard.writeText(N),se("Text copied to clipboard!")}catch(p){console.error("Copy failed",p),G("Failed to copy text")}},title:"Copy text",children:r.jsx(rr,{className:"w-5 h-5"})}),r.jsx("button",{className:`icon-btn ${T===y&&!K?"text-primary bg-primary/10":""}`,onClick:()=>{T===y?K?(I(!1),P(!0),S.current=!0,a.current&&a.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(p=>{console.error("Error resuming audio:",p)})):(a.current&&a.current.pause(),I(!0),P(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))):Ae(y)},title:T===y?K?"Resume audio":"Pause audio":"Play audio",children:T===y&&!K?r.jsx(nr,{className:"w-5 h-5"}):r.jsx(ar,{className:"w-5 h-5"})}),m!=="ta"&&m!=="E"&&m!=="mal"&&r.jsx("button",{className:"icon-btn group",onClick:p=>{const k=`/surah/${l}#verse-${u}`;p?.ctrlKey||p?.metaKey?(p.preventDefault(),window.open(k,"_blank","noopener,noreferrer")):te(k)},title:"View ayah details",children:r.jsx(or,{className:"w-5 h-5 group-hover:scale-110 transition-transform"})}),r.jsx("button",{className:"icon-btn group",onClick:p=>{const k=`/word-by-word/${l}/${u}`;if(p?.ctrlKey||p?.metaKey){p.preventDefault(),window.open(k,"_blank","noopener,noreferrer");return}je(!0),be(u)},title:"Word by word",children:r.jsx(sr,{className:"w-5 h-5 group-hover:scale-110 transition-transform"})}),r.jsx("button",{className:`icon-btn ${Ee[`${u}-${b}`]?"opacity-50 cursor-not-allowed":""}`,onClick:async()=>{if(!de){G("Please sign in to bookmark blocks"),te("/sign",{state:{from:re.pathname,message:"Sign in to bookmark blocks"}});return}const p=`${u}-${b}`;try{Je(N=>({...N,[p]:!0}));const k=Ue.getEffectiveUserId(de);await Ue.addBlockBookmark(k,l,u,b),se(`Saved block ${u}-${b}`)}catch(k){console.error("Failed to bookmark block:",k),G("Failed to save block")}finally{Je(k=>({...k,[p]:!1}))}},title:"Bookmark block",disabled:Ee[`${u}-${b}`],children:Ee[`${u}-${b}`]?r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b border-current"}):r.jsx(ir,{className:"w-5 h-5"})}),r.jsx("button",{className:"icon-btn",onClick:async()=>{try{const p=window.location.href,x=`${j.length>0?j.map((ae,Ve)=>Re(ae.text_uthmani,u+Ve)).join(" "):"Arabic text is loading..."}

${v||"Translation not available"}

Read more: ${p}`,$=`Surah ${l} • Verses ${u}-${b}`;navigator.share?await navigator.share({title:$,text:x}):(await navigator.clipboard.writeText(x),se("Content copied to clipboard!"))}catch(p){console.error("Share failed",p),G("Failed to share")}},title:"Share block",children:r.jsx(lr,{className:"w-5 h-5"})})]})})]})]},`block-${y}-${u}-${b}`)}):r.jsx("div",{className:"text-center py-8",children:r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No blocks available for this Surah"})})}),r.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 dark:border-gray-700 px-3 sm:px-4 lg:px-6 py-3 sm:py-4 mt-6 sm:mt-8",children:r.jsxs("div",{className:"max-w-4xl mx-auto",children:[r.jsxs("div",{className:"sm:hidden space-y-2",children:[r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs("button",{onClick:gt,disabled:parseInt(l)<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg w-[173.96px] min-h-[44px]
                               disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx(Nt,{className:"w-3 h-3"}),r.jsx("span",{children:"Previous Surah"})]}),r.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]`,children:[r.jsx(Oe,{className:"w-3 h-3"}),r.jsx("span",{children:"Beginning of Surah"})]})]}),r.jsx("div",{className:"flex justify-center",children:r.jsxs("button",{onClick:yt,disabled:parseInt(l)>=114,className:`w-[173.96px] flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                                 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                                 border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]
                                 disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx("span",{children:"Next Surah"}),r.jsx(kt,{className:"w-3 h-3"})]})})]}),r.jsxs("div",{className:"hidden sm:flex items-center justify-center space-x-2 sm:space-x-4 lg:space-x-6",children:[r.jsxs("button",{onClick:gt,disabled:parseInt(l)<=1,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx(Nt,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{children:"Previous Surah"})]}),r.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px]",children:[r.jsx(Oe,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{children:"Beginning of Surah"})]}),r.jsxs("button",{onClick:yt,disabled:parseInt(l)>=114,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx("span",{children:"Next Surah"}),r.jsx(kt,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]})}),At&&Te&&r.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[r.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:()=>{Be(!1),Qe(null)}}),r.jsxs("div",{className:"relative w-full sm:w-[550px] max-h-[85vh] sm:max-h-[90vh] bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col animate-slideUp sm:animate-fadeIn overflow-hidden",children:[r.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 sm:hidden cursor-grab active:cursor-grabbing",children:r.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:r.jsx(wt,{surahId:parseInt(l),range:Te.toString(),ipt:1,lang:m==="E"?"E":"mal",onClose:()=>{Be(!1),Qe(null)},showSuccess:se,showError:G,isModal:!0},`interpretation-${l}-${Te}`)})]})]}),Tt&&et&&r.jsx(yr,{selectedVerse:et,surahId:l,onClose:()=>{je(!1),be(null)},onNavigate:e=>be(e),onSurahChange:e=>{je(!1),be(null),te(`/surah/${e}?wordByWord=1`)}}),Ct&&r.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[r.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:()=>we(!1)}),r.jsxs("div",{className:"relative w-full sm:w-[480px] md:max-w-2xl lg:max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col animate-slideUp sm:animate-fadeIn overflow-hidden",children:[r.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 sm:hidden cursor-grab active:cursor-grabbing",children:r.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),r.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100 dark:border-gray-800",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white",children:"English Explanation"}),ve?.footnoteNumber&&r.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Footnote ",ve.footnoteNumber,ve?.ayah?` • Ayah ${ve.ayah}`:""]})]}),r.jsx("button",{onClick:()=>we(!1),className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-500 dark:text-gray-400",children:r.jsx(cr,{className:"w-5 h-5"})})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-5 space-y-6",children:It?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading explanation..."})]})}):r.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg",children:r.jsx("div",{className:"text-gray-700 leading-[1.6] font-poppins sm:leading-[1.7] lg:leading-[1.8] dark:text-white text-sm sm:text-base lg:text-lg prose prose-sm dark:prose-invert max-w-none",style:{fontSize:`${Pt}px`},children:$t})})})]})]}),J&&r.jsx(wt,{surahId:parseInt(l),range:J.range,ipt:J.interpretationNumber,lang:m==="E"?"E":"mal",footnoteId:J.footnoteId||null,blockRanges:d,onClose:()=>ce(null)},`block-interpretation-${l}-${J.range}-${J.interpretationNumber}-${J.footnoteId||""}`),jt&&r.jsx("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`fixed right-6 z-[60] bg-cyan-500 hover:bg-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center ${F?"bottom-32 sm:bottom-36":"bottom-6"}`,title:"Beginning of Surah","aria-label":"Beginning of Surah",children:r.jsx(Oe,{className:"w-6 h-6"})})]})}),F&&r.jsx(wr,{audioElement:a.current,isPlaying:M&&a.current&&!a.current.paused,currentAyah:F,totalAyahs:d.reduce((e,n)=>{const t=n.AyaTo||n.ayato||n.to||0,o=n.AyaFrom||n.ayafrom||n.from||0;return e+(t-o+1)},0),surahInfo:oe?.surahInfo,onPlayPause:pt,onStop:Me,onSkipBack:()=>{_t()},onSkipForward:()=>{ft()},onClose:null,selectedQari:z,onQariChange:e=>{He(e),T&&F&&(Me(),setTimeout(()=>{Ae(T)},100))},translationLanguage:m,audioTypes:Q,onAudioTypesChange:e=>{const n=T,t=F;if(console.log("[BlockWise] onAudioTypesChange",{newTypes:e,currentBlock:n,currentAyah:t,isContinuousPlay:M,isPaused:K}),Se(e),n&&t){if(a.current)try{a.current.pause(),a.current.currentTime=0}catch(o){console.warn("[BlockWise] Failed to pause audio before restarting with new types",o)}P(!0),I(!1),D(n),R(t),C.current=n,S.current=!0,setTimeout(()=>{console.log("[BlockWise] restarting playback after audioTypes change",{currentBlock:n,currentAyah:t,newTypes:e}),O(n,t,0,e)},100)}},playbackSpeed:L,onPlaybackSpeedChange:e=>{Ke(e),a.current&&(a.current.playbackRate=e)}})]})};export{sn as default};
