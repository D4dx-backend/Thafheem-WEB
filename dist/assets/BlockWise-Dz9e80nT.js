import{r as n,a as Ft,b as Pt,g as Wt,u as Lt,d as Dt,c as Rt,j as e,C as Mt,A as _t,P as zt,B as Vt,F as qt,n as Ut,x as ve,o as Ot,p as Je,D as Qt,v as Ht,E as Kt}from"./index-B7u_SSOz.js";import{u as Xt,T as ke}from"./Toast-D4Nb5re8.js";import{W as Gt}from"./WordByWord-CkrSEn2v.js";import Ze from"./InterpretationBlockwise-CZxixEZF.js";import{a as et,D as tt,B as at,C as Yt,A as Ne}from"./LoadingSkeleton-DZJI2H_L.js";import{A as rt,B as st,t as nt}from"./ViewToggleIcons-DT94-_81.js";import Jt from"./StickyAudioPlayer-CwiBEhYY.js";import je from"./englishTranslationService-DpzBpiF9.js";import{g as Zt,s as ea}from"./surahNameUtils-CNmXwDjY.js";import{C as ot}from"./chevron-left-B6JAG1f4.js";import"./tamilWordByWordService-CbdEWK98.js";import"./hindiWordByWordService-C4orOXOT.js";import"./banglaWordByWordService-BjQoe-Kj.js";import"./banglaTranslationService-CRMal1nz.js";import"./apiService-CSIDMmbA.js";import"./tamilTranslationService-Nmj16z_z.js";import"./hindiTranslationService-CFfqL_Tk.js";import"./urduTranslationService-DSQwp1l5.js";import"./InterpretationNavbar-D78rKEOp.js";import"./WordByWordIcon-DqXWQqc-.js";import"./volume-x-D_zez6nW.js";import"./volume-2-CXSwBq65.js";import"./skip-forward-Cf5imDPc.js";import"./surahNameUnicodes-C_pntk6C.js";const Da=()=>{const[ta,aa]=n.useState("Translation"),[ra,sa]=n.useState("Block wise"),[it,Ae]=n.useState(!1),[oe,lt]=n.useState(null),[H,ct]=n.useState("al-hudaify"),[P,ie]=n.useState(["quran"]),[K,dt]=n.useState(1),[y,C]=n.useState(null),[na,M]=n.useState(null),[I,S]=n.useState(null),[oa,T]=n.useState(1),[j,A]=n.useState(!1),[_,k]=n.useState(!1),u=n.useRef(null);n.useEffect(()=>{console.log("[BlockWise] audioTypes state updated",P)},[P]);const[le,ut]=n.useState(null),[Se,ce]=n.useState(!0),[Te,Ee]=n.useState(null),[ia,la]=n.useState([]),[Be,mt]=n.useState([]),[de,Ce]=n.useState({}),[g,ht]=n.useState([]),[pt,Ie]=n.useState({}),[X,ue]=n.useState(null),[xt,me]=n.useState(!1),[$e,Z]=n.useState(null),[ft,ee]=n.useState(new Set),G=n.useRef(!1),[gt,Fe]=n.useState(!1),[ca,Pe]=n.useState(!1),[da,ua]=n.useState(!1),[yt,he]=n.useState(!1),[bt,te]=n.useState(""),[wt,pe]=n.useState(!1),[ae,We]=n.useState({footnoteId:null,footnoteNumber:null,surah:null,ayah:null}),z=Ft(),Le=Pt(),{pathname:De}=Le,{user:Y}=Wt(),{toasts:xe,removeToast:fe,showSuccess:V,showError:W,showWarning:Re}=Xt(),{quranFont:Me,translationLanguage:h,theme:_e,translationFontSize:ze,viewType:re,setViewType:se}=Lt(),vt=Math.max(Number(ze)-2,10),{surahId:i}=Dt();n.useEffect(()=>{if(!(h==="mal"||h==="E")){re!=="Ayah Wise"&&se("Ayah Wise");return}if(re==="Ayah Wise"){const r=`/surah/${i}`;De!==r&&z(r)}else re!=="Block Wise"&&se("Block Wise")},[re,h,i,z,De,se]);const Ve=()=>{se("Ayah Wise")},{surahs:ge}=Rt(),kt=t=>{const r=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];return t.toString().split("").map(a=>r[a]||a).join("")},L=(t,r=null)=>{const a=Number.parseInt(t,10);return Number.isFinite(a)?a:r};n.useEffect(()=>(u.current||(u.current=new Audio),()=>{u.current&&(u.current.pause(),u.current.src="",u.current.currentTime=0),C(null),M(null),S(null),A(!1),k(!1)}),[]);const Nt={"al-hudaify":"QH","al-afasy":"QA","al-ghamidi":"QG"},qe=t=>({E:"English",mal:"Malayalam",ur:"Urdu",bn:"Bangla",ta:"Tamil",hi:"Hindi"})[t]||t,ne=(t,r=!1)=>{if(!u.current)return;if(console.log("[BlockWise] playBlockAudio start",{blockId:t,fromContinuous:r,audioTypes:P,translationLanguage:h,selectedQirath:H}),!r&&h!=="mal"&&P.some(f=>f==="translation"||f==="interpretation")){const f=qe(h);Re(`${f} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available.`);const p=P.filter(m=>m!=="translation"&&m!=="interpretation");p.length>0?ie(p):ie(["quran"]);return}u.current&&u.current.pause();const a=g.find(l=>(l.ID||l.id)===t);if(!a){console.error("Block not found:",t);return}const s=a.AyaFrom||a.ayafrom||a.from||1,o=L(s,1);A(!0),C(t),S(o),T(1),k(!1),console.log("[BlockWise] playBlockAudio state set",{playingBlock:t,normalizedStartingAyah:o,currentAudioType:P?.[0]||"quran"}),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}})),O(t,o,0)},jt=(t,r,a)=>{const s=String(t).padStart(3,"0"),o=String(r).padStart(3,"0"),l="https://old.thafheem.net/audio";return a==="quran"?`${l}/qirath/${H}/${Nt[H]}${s}_${o}.ogg`:a==="translation"?`${l}/translation/T${s}_${o}.ogg`:a==="interpretation"?`${l}/interpretation/I${s}_${o}.ogg`:null},U=(t,r,a=0,s=null)=>{if(!u.current)return;const o=L(r,L(I,1)||1),l=s||P;if(console.log("[BlockWise] playAyahAudioWithTypes",{blockId:t,requestedAyah:r,ayahToPlay:o,audioTypeIndex:a,audioTypes:l,playbackSpeed:K,isContinuousPlay:j,isPaused:_,playingBlock:y}),a>=l.length){Ue(o,l);return}u.current.pause();const f=l[a],p=jt(i,o,f);if(!p){U(t,o,a+1,s);return}console.log("[BlockWise] generated audioUrl",{blockId:t,ayahToPlay:o,currentAudioType:f,audioUrl:p});const q={quran:"qirath",translation:"translation",interpretation:"interpretation"}[f]||"qirath";M(q),S(o),u.current.onended=null,u.current.onerror=null,u.current.onended=()=>{U(t,o,a+1,l)},u.current.onerror=()=>{console.error("Error playing audio:",p),U(t,o,a+1,l)},u.current.src=p,u.current.playbackRate=K,u.current.load(),u.current.play().catch(b=>{console.error("Error playing audio:",b.name,b.message,p),U(t,o,a+1,l)})},O=(t,r,a=0,s=null)=>{U(t,r,a,s)},Ue=(t=null,r=null)=>{const a=t??I;if(!y||!a)return;const s=g.find(m=>(m.ID||m.id)===y);if(!s)return;const o=s.AyaTo||s.ayato||s.to,l=L(a,null),f=L(o,l);if(l===null||f===null){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - invalid ayah numbers",{playingBlock:y,currentAyahInBlock:a,ayaTo:o});return}const p=l+1;console.log("[BlockWise] moveToNextAyahOrBlock",{playingBlock:y,currentAyahNumber:l,nextAyah:p,ayaToNumber:f,isContinuousPlay:j}),p<=f?(T(1),O(y,p,0,r)):j?(T(1),Tt()):(C(null),M(null),S(null),T(1),k(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}})))},At=(t=null,r=null)=>{const a=t??I;if(!y||!a)return;const s=g.find(m=>(m.ID||m.id)===y);if(!s)return;const o=s.AyaFrom||s.ayafrom||s.from||1,l=L(a,null),f=L(o,1);if(l===null||f===null){console.warn("[BlockWise] moveToPreviousAyahOrBlock aborted - invalid ayah numbers",{playingBlock:y,currentAyahInBlock:a,ayaFrom:o});return}const p=l-1;console.log("[BlockWise] moveToPreviousAyahOrBlock",{playingBlock:y,currentAyahNumber:l,previousAyah:p,ayaFromNumber:f,isContinuousPlay:j}),p>=f?(T(1),O(y,p,0,r)):j?(T(1),St()):(C(null),M(null),S(null),T(1),k(!1))},St=()=>{if(!j||!g||g.length===0)return;const t=g.findIndex(r=>(r.ID||r.id)===y);if(t>0){const r=g[t-1],a=r.ID||r.id,s=r.AyaTo||r.ayato||r.to||1,o=L(s,1);A(!0),C(a),S(o),T(1),k(!1),O(a,o)}else{const r=g[0],a=r.ID||r.id,s=r.AyaFrom||r.ayafrom||r.from||1,o=L(s,1);C(a),S(o),T(1),O(a,o)}},Tt=()=>{if(!j||!g||g.length===0)return;const t=g.findIndex(r=>(r.ID||r.id)===y);if(t!==-1&&t<g.length-1){const r=g[t+1],a=r.ID||r.id;ne(a,!0)}else C(null),M(null),S(null),T(1),A(!1),k(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))},Oe=()=>{if(!g||g.length===0){W("No blocks available to play");return}if(h!=="mal"){const t=qe(h);Re(`${t} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available.`);return}try{if(j)u.current&&u.current.pause(),A(!1),k(!0),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}));else if(y&&I)A(!0),k(!1),u.current&&u.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(t=>{console.error("Error resuming audio:",t)});else{A(!0),k(!1);const t=g[0].ID||g[0].id;ne(t)}}catch(t){console.error("Error in handlePlayAudio:",t),A(!1),C(null),S(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},ye=n.useRef(null);ye.current=Oe,n.useEffect(()=>{const t=()=>{ye.current&&ye.current()};return window.addEventListener("playAudio",t),()=>{window.removeEventListener("playAudio",t)}},[]),n.useEffect(()=>{const t=j&&!_&&y!==null;window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:t}}))},[j,_,y]),n.useEffect(()=>{const t=r=>{const{type:a,message:s}=r.detail;a==="success"?V(s):a==="error"&&W(s)};return window.addEventListener("showToast",t),()=>{window.removeEventListener("showToast",t)}},[V,W]);const be=()=>{u.current&&(u.current.pause(),u.current.currentTime=0),A(!1),C(null),M(null),S(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}})),T(1),k(!1)};n.useEffect(()=>()=>{try{be()}catch{}},[]),n.useEffect(()=>()=>{u.current&&(u.current.pause(),C(null),M(null),S(null),T(1),A(!1),k(!1))},[i]),n.useEffect(()=>{y&&I&&u.current&&j&&O(y,I,0)},[H,P]),n.useEffect(()=>{u.current&&(u.current.playbackRate=K)},[K]),n.useEffect(()=>((async()=>{if(!i||G.current||ge.length===0)return;if(!(h==="mal"||h==="E")){console.log(`⚠️ BlockWise: Language '${h}' doesn't support blockwise. Skipping fetch.`),ce(!1);return}G.current=!0;try{ce(!0),Ee(null);const[a,s]=await Promise.all([Qt(parseInt(i),h||"mal"),Ht(parseInt(i))]),o=ge.find(l=>l.number===parseInt(i));if(ut({surahInfo:o||{number:parseInt(i),arabic:"القرآن",type:"Makki"}}),mt(s||[]),ht(a||[]),a&&a.length>0){const l=async(c,w)=>{const v=c.AyaFrom||c.ayafrom||c.from,d=c.AyaTo||c.ayato||c.to;if(v==null||d===void 0||d===null)return;const x=Number.parseInt(v,10),E=Number.parseInt(d,10),B=Number.isFinite(x)&&Number.isFinite(E),N=B?`${x}-${E}`:`${v}-${d}`,F=c.ID||c.id||N||`block-${w}`,It=B?x:v,$t=B?E:d;try{ee(R=>new Set([...R,F]));let D;const J=h||"mal";D=await nt.getCachedTranslation(parseInt(i),N,J),D||(D=await Kt(parseInt(i),N,J),await nt.setCachedTranslation(parseInt(i),N,D,J)),Ie(R=>({...R,[F]:{range:N,ayaFrom:It,ayaTo:$t,data:D}})),ee(R=>{const Ye=new Set(R);return Ye.delete(F),Ye})}catch(D){D.message?.includes("timeout")||console.error(`❌ BlockWise: Failed to load block ${N}:`,D.message),ee(J=>{const R=new Set(J);return R.delete(F),R})}},p=[];let m=0;const q=async(c,w)=>new Promise(v=>{const d=async()=>{m++;try{await l(c,w)}catch{}finally{m--,p.length>0&&p.shift()(),v()}};m<5?d():p.push(d)}),b=c=>{const w=c.slice(0,3),v=c.slice(3);return{visibleBlocks:w,backgroundBlocks:v}},{visibleBlocks:Q,backgroundBlocks:$}=b(a),Ge=Q.map((c,w)=>l(c,w));$.forEach((c,w)=>{setTimeout(()=>{q(c,w+Q.length)},50*Math.floor(w/5))}),Promise.allSettled(Ge).then(c=>{const w=c.filter(v=>v.status==="fulfilled").length})}}catch(a){let s=a.message;a.message?.includes("timeout")||a.message?.includes("Request timeout")?s="The server is taking longer than expected to respond. Please try again in a moment. If the problem persists, the English blockwise data may be temporarily unavailable.":a.message?.includes("Failed to fetch")||a.message?.includes("Network error")?s="Unable to connect to the server. Please check your internet connection and try again.":a.message?.includes("HTTP error")&&(s=`Server error: ${a.message}. Please try again later.`),Ee(s),console.error("Error fetching block-wise data:",a),G.current=!1}finally{ce(!1)}})(),()=>{G.current=!1}),[i,ge,h]),n.useEffect(()=>{if(g.length>0){const t=new Set(g.map(r=>{const a=r.AyaFrom??r.ayafrom??r.from??1,s=r.AyaTo??r.ayato??r.to??a,o=Number.parseInt(a,10),l=Number.parseInt(s,10),f=Number.isFinite(o)&&Number.isFinite(l),p=Number.isFinite(Number(a))?Number(a):1,m=f?o:p,q=Number.isFinite(Number(s))?Number(s):m,Q=f?`${m}-${f?l:q}`:`${a}-${s}`;return r.ID||r.id||Q||`block-${g.indexOf(r)}`}));ee(t)}Ie({}),G.current=!1,ue(null),Ae(!1),he(!1),te(""),pe(!1),We({footnoteId:null,footnoteNumber:null,surah:null,ayah:null})},[h]),n.useEffect(()=>{(async()=>{if(!Y||!i){Pe(!1);return}try{const r=await ve.isFavorited(Y.uid,i);Pe(r)}catch(r){console.error("Error loading favorite status:",r)}})()},[Y,i]),n.useEffect(()=>{if(h!=="E")return;const t=async r=>{const a=r.target.closest(".english-footnote-link");if(!a)return;r.preventDefault(),r.stopPropagation();const s=a.getAttribute("data-footnote-id");if(!s)return;const o=(a.textContent||"").trim()||a.getAttribute("data-footnote-number"),l=a.getAttribute("data-ayah"),f=l?parseInt(l,10):null;We({footnoteId:s,footnoteNumber:o||null,surah:i?parseInt(i,10):null,ayah:f}),te("Loading..."),pe(!0),he(!0);try{const p=await je.getExplanation(parseInt(s,10));te(p||"Explanation not available.")}catch(p){console.error("Error fetching English footnote explanation:",p),te(`Error loading explanation: ${p.message||p}`)}finally{pe(!1)}};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[h,i]);const Et=(t,r)=>{ue({range:t,interpretationNumber:r})},Qe=(t,r)=>{if(!t)return"";const a=document.createElement("div");return a.innerHTML=t,a.querySelectorAll("sup").forEach(o=>{const l=o.textContent.trim();/^\d+$/.test(l)&&(o.style.cssText=`
          cursor: pointer !important;
          background-color: rgb(41 169 199) !important;
          color: rgb(255, 255, 255) !important;
          font-weight: 600 !important;
          text-decoration: none !important;
          border: none !important;
          display: inline-flex !important;
          align-items: center !important;
          justify-content: center !important;
          font-size: 12px !important;
          vertical-align: middle !important;
          line-height: 1 !important;
          border-radius: 9999px !important;
          position: relative !important;
          top: 0px !important;
          min-width: 20px !important;
          min-height: 19px !important;
          text-align: center !important;
          transition: 0.2s ease-in-out !important;
          padding-top: 3px !important;
          margin-right: 4px;
          margin-left: -1px;
          margin-top: -15px;
          padding-left: 2px !important;
          padding-right: 2px !important;
        `,o.setAttribute("data-interpretation",l),o.setAttribute("data-range",r),o.setAttribute("data-lang",h==="E"?"en":"mal"),o.setAttribute("title",`Click to view interpretation ${l}`),o.className="interpretation-link")}),a.innerHTML};n.useEffect(()=>{const t=a=>{const s=a.target.closest(".interpretation-link");if(s){a.preventDefault(),a.stopPropagation();const o=s.getAttribute("data-interpretation"),l=s.getAttribute("data-range");s.getAttribute("data-lang"),o&&l&&requestAnimationFrame(()=>{Et(l,parseInt(o))})}},r=document.createElement("style");return r.textContent=`
      .interpretation-link {
        cursor: pointer !important;
      }
      .interpretation-link > a {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 100% !important;
        height: 100% !important;
        color: inherit !important;
        font-weight: inherit !important;
        text-decoration: none !important;
      }
      .interpretation-link:hover {
        background-color: #0891b2 !important;
        transform: scale(1.05) !important;
      }
      .interpretation-link:active {
        background-color: #0e7490 !important;
        transform: scale(0.95) !important;
      }
    `,document.head.appendChild(r),document.addEventListener("click",t,!0),()=>{document.removeEventListener("click",t,!0),document.head.removeChild(r)}},[]);const He=()=>{const t=parseInt(i)-1;t>=1&&z(`/blockwise/${t}`)},Ke=()=>{const t=parseInt(i)+1;t<=114&&z(`/blockwise/${t}`)};if(n.useEffect(()=>{const t=()=>{window.scrollY>300?Fe(!0):Fe(!1)};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[]),Se&&g.length===0)return e.jsxs(e.Fragment,{children:[e.jsx(ke,{toasts:xe,removeToast:fe}),e.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 px-4 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"h-12 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-64 mx-auto mb-4 relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})}),e.jsx("div",{className:"h-6 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-40 mx-auto relative overflow-hidden",children:e.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})})]}),e.jsx(et,{count:3})]})})]});if(Te)return e.jsxs(e.Fragment,{children:[e.jsx(ke,{toasts:xe,removeToast:fe}),e.jsx("div",{className:"min-h-screen bg-white dark:bg-black flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 dark:text-red-400 text-lg mb-2",children:"Failed to load Block-wise data"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:Te}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Try Again"})]})})]});const we=le?.surahInfo?.arabic||(i?`Surah ${i}`:"Surah"),Bt=Zt(i,we),Xe=i?String(i):"",Ct=Xe==="1"||Xe==="2"?"font-normal":"font-semibold";return e.jsxs(e.Fragment,{children:[e.jsx(ke,{toasts:xe,removeToast:fe}),e.jsx("div",{className:"mx-auto min-h-screen bg-white dark:bg-gray-900",children:e.jsxs("div",{className:"sticky top-0 z-40 bg-white dark:bg-gray-900 shadow-md",children:[e.jsx("div",{className:"mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"py-3 sm:py-4",children:[e.jsx("div",{className:"text-center mb-3 sm:mb-4",children:e.jsx("h1",{className:`text-4xl sm:text-5xl font-arabic dark:text-white text-gray-900 mb-5 sm:mb-7 px-4 sm:px-6 ${Ct}`,style:{fontFamily:ea},"aria-label":we,children:le?Bt:we})}),e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsxs("div",{className:"max-w-[1290px] mx-auto relative flex items-center justify-center px-4 lg:px-8",children:[e.jsx("div",{className:"flex-shrink-0 px-4 sm:px-6 pt-8 pb-6 sm:pt-10 sm:pb-8",children:parseInt(i)!==1&&parseInt(i)!==9?e.jsx("img",{src:_e==="dark"?tt:at,alt:"Bismi",className:"w-[236px] h-[52.9px]"}):e.jsx("div",{className:"h-[52.9px]"})}),(h==="mal"||h==="E")&&e.jsx("div",{className:"absolute -right-4 md:-right-3 lg:-right-2 xl:-right-1 top-1/2 -translate-y-1/2",children:e.jsxs("div",{className:"flex gap-1 bg-gray-100 dark:bg-[#323A3F] rounded-full p-1 shadow-sm",children:[e.jsxs("button",{className:"flex items-center justify-center px-3 py-1.5 text-gray-500 rounded-full dark:text-white hover:text-cyan-600 dark:hover:text-cyan-400 hover:bg-cyan-50 dark:hover:bg-cyan-900/40 transition-colors whitespace-nowrap",onClick:Ve,"aria-label":"Switch to ayah wise view",children:[e.jsx(rt,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"sr-only",children:"Ayah wise"})]}),e.jsxs("button",{className:"flex items-center justify-center px-3 py-1.5 bg-white dark:bg-gray-900 text-gray-900 dark:text-white rounded-full shadow-sm transition-colors whitespace-nowrap","aria-label":"Block wise view selected",children:[e.jsx(st,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"sr-only",children:"Block wise"})]})]})})]})}),e.jsxs("div",{className:"sm:hidden",children:[e.jsx("div",{className:"flex justify-center",children:parseInt(i)!==1&&parseInt(i)!==9?e.jsx("div",{className:"px-4 pt-8 pb-6",children:e.jsx("img",{src:_e==="dark"?tt:at,alt:"Bismi",className:"w-[236px] h-[52.9px]"})}):e.jsx("div",{className:"h-[52.9px]"})}),(h==="mal"||h==="E")&&e.jsx("div",{className:"mt-3 flex justify-end px-4",children:e.jsxs("div",{className:"flex gap-1 bg-gray-100 dark:bg-[#323A3F] rounded-full p-1 shadow-sm",children:[e.jsxs("button",{className:"flex items-center justify-center px-2 py-1.5 text-gray-500 rounded-full dark:text-white hover:text-cyan-600 dark:hover:text-cyan-400 hover:bg-cyan-50 dark:hover:bg-cyan-900/40 transition-colors",onClick:Ve,"aria-label":"Switch to ayah wise view",children:[e.jsx(rt,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Ayah wise"})]}),e.jsxs("button",{className:"flex items-center justify-center px-2 py-1.5 bg-white dark:bg-gray-900 text-gray-900 dark:text-white rounded-full shadow transition-colors","aria-label":"Block wise view selected",children:[e.jsx(st,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Block wise"})]})]})})]})]})]})}),e.jsxs("div",{className:"mx-auto px-3 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"max-w-full sm:max-w-[1290px] mx-auto pb-6 sm:pb-8",children:[Se&&g.length===0?e.jsx(et,{count:5}):g&&g.length>0?g.map((t,r)=>{const a=t.AyaFrom??t.ayafrom??t.from??1,s=t.AyaTo??t.ayato??t.to??a,o=Number.parseInt(a,10),l=Number.parseInt(s,10),f=Number.isFinite(o)&&Number.isFinite(l),p=Number.isFinite(Number(a))?Number(a):1,m=f?o:p,q=Number.isFinite(Number(s))?Number(s):m,b=f?l:q,Q=f?`${m}-${b}`:`${a}-${s}`,$=t.ID||t.id||Q||`block-${r}`,c=(pt[$]||null)?.data,w=Array.isArray(c)?c:Array.isArray(c?.translations)?c.translations:Array.isArray(c?.data)?c.data:[],v=Array.isArray(Be)?Be.slice(m-1,b):[];return e.jsxs("div",{className:"rounded-xl mb-2 sm:mb-3 border border-gray-200 dark:border-gray-700 dark:hover:bg-gray-800 hover:bg-[#e8f2f6] active:bg-[#e8f2f6] transition-colors",children:[e.jsx("div",{className:"px-4 sm:px-6 md:px-8 pt-3 sm:pt-4 pb-1 sm:pb-1.5",children:e.jsx("p",{className:"text-lg sm:text-lg md:text-xl lg:text-2xl xl:text-xl text-right text-gray-900 dark:text-white",style:{fontFamily:Me?`'${Me}', serif`:'"Amiri Quran", serif',direction:"rtl",lineHeight:"2.7",fontSize:"23px"},children:v.length>0?v.map((d,x)=>`${d.text_uthmani} ﴿${kt(m+x)}﴾`).join(" "):"Loading Arabic text..."})}),e.jsx("div",{className:"px-4 sm:px-6 md:px-8 pt-3 sm:pt-4 pb-2 sm:pb-3",children:c?e.jsx("div",{className:`text-gray-700 dark:text-white leading-relaxed text-left ${h==="hi"?"font-hindi":h==="ur"?"font-urdu":h==="bn"?"font-bengali":h==="ta"?"font-tamil":h==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${vt}px`},children:w.length>0?w.map((d,x)=>{const E=d.TranslationText||d.translationText||d.translation_text||d.text||"",B=d.VerseNo||d.Verse_Number||d.verse_number||d.VerseNumber||d.ayah_number||d.AyaId||d.AyahId||m+x,N=Number.isFinite(parseInt(B,10))?parseInt(B,10):m+x,F=h==="E"?je.parseEnglishTranslationWithClickableFootnotes(E,parseInt(i,10),N):Qe(E,`${m}-${b}`);return e.jsx("div",{className:"leading-relaxed",style:{fontSize:"17px"},dangerouslySetInnerHTML:{__html:F}},`translation-${$}-${x}`)}):c?.TranslationText||c?.translationText||c?.translation_text||c?.text?e.jsx("div",{className:"leading-relaxed",style:{fontSize:"17px"},dangerouslySetInnerHTML:{__html:h==="E"?je.parseEnglishTranslationWithClickableFootnotes(c.TranslationText||c.translationText||c.translation_text||c.text,parseInt(i,10),m):Qe(c.TranslationText||c.translationText||c.translation_text||c.text,`${m}-${b}`)}}):e.jsx("p",{children:"Translation not available"})}):ft.has($)?e.jsx(Yt,{message:"Loading translation..."}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Translation not available"})}),e.jsx("div",{className:"px-4 sm:px-6 md:px-8 pt-0.5 pb-1 sm:pb-1.5",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-1 sm:gap-1.5 lg:gap-2",children:[e.jsx("button",{className:"p-1.5 sm:p-1.5 text-[#2AA0BF] hover:text-[#0f5f72] dark:hover:text-cyan-300 transition-colors min-h-[36px] sm:min-h-[40px] min-w-[36px] sm:min-w-[40px] flex items-center justify-center focus:outline-none",onClick:async()=>{try{const d=v.length>0?v.map((B,N)=>`${B.text_uthmani} ﴿${m+N}﴾`).join(" "):"Loading Arabic text...";let x="Loading translation...";if(c){let B="";if(w.length>0){const F=w[0];B=F.TranslationText||F.translationText||F.translation_text||F.text||""}else B=c.TranslationText||c.translationText||c.translation_text||c.text||"";const N=document.createElement("div");N.innerHTML=B,x=N.textContent||N.innerText||""}const E=`${d}

${x}`;await navigator.clipboard.writeText(E),V("Text copied to clipboard!")}catch(d){console.error("Copy failed",d),W("Failed to copy text")}},title:"Copy text",children:e.jsx(Mt,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{className:`p-1.5 sm:p-1.5 hover:text-[#0f5f72] dark:hover:text-cyan-300 transition-colors min-h-[36px] sm:min-h-[40px] min-w-[36px] sm:min-w-[40px] flex items-center justify-center ${y===$?"text-cyan-500 dark:text-cyan-400":"text-[#2AA0BF]"}`,onClick:()=>{y===$?_?(k(!1),A(!0),u.current&&u.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(d=>{console.error("Error resuming audio:",d)})):(u.current&&u.current.pause(),k(!0),A(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))):ne($)},title:y===$?_?"Resume audio":"Pause audio":"Play audio",children:y===$&&!_?e.jsx(_t,{className:"w-3 h-3 sm:w-4 sm:h-4"}):e.jsx(zt,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),h!=="ta"&&h!=="E"&&h!=="mal"&&e.jsx("button",{className:"p-1.5 sm:p-1.5 text-[#2AA0BF] hover:text-[#0f5f72] dark:hover:text-cyan-300 transition-colors min-h-[36px] sm:min-h-[40px] min-w-[36px] sm:min-w-[40px] flex items-center justify-center",onClick:d=>{const x=`/surah/${i}#verse-${m}`;d?.ctrlKey||d?.metaKey?(d.preventDefault(),window.open(x,"_blank","noopener,noreferrer")):z(x)},title:"View ayah details",children:e.jsx(Vt,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{className:"p-1.5 sm:p-1.5 text-[#2AA0BF] hover:text-[#0f5f72] dark:hover:text-cyan-300 transition-colors min-h-[36px] sm:min-h-[40px] min-w-[36px] sm:min-w-[40px] flex items-center justify-center focus:outline-none",onClick:d=>{const x=`/word-by-word/${i}/${m}`;if(d?.ctrlKey||d?.metaKey){d.preventDefault(),window.open(x,"_blank","noopener,noreferrer");return}me(!0),Z(m)},title:"Word by word",children:e.jsx(qt,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{className:`p-1.5 sm:p-1.5 text-[#2AA0BF] hover:text-[#0f5f72] dark:hover:text-cyan-300 transition-colors min-h-[36px] sm:min-h-[40px] min-w-[36px] sm:min-w-[40px] flex items-center justify-center ${de[`${m}-${b}`]?"opacity-50 cursor-not-allowed":""}`,onClick:async()=>{if(!Y){W("Please sign in to bookmark blocks"),z("/sign",{state:{from:Le.pathname,message:"Sign in to bookmark blocks"}});return}const d=`${m}-${b}`;try{Ce(E=>({...E,[d]:!0}));const x=ve.getEffectiveUserId(Y);await ve.addBlockBookmark(x,i,m,b),V(`Saved block ${m}-${b}`)}catch(x){console.error("Failed to bookmark block:",x),W("Failed to save block")}finally{Ce(x=>({...x,[d]:!1}))}},title:"Bookmark block",disabled:de[`${m}-${b}`],children:de[`${m}-${b}`]?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b border-current"}):e.jsx(Ut,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("button",{className:"p-1.5 sm:p-1.5 text-[#2AA0BF] hover:text-[#0f5f72] dark:hover:text-cyan-300 transition-colors min-h-[36px] sm:min-h-[40px] min-w-[36px] sm:min-w-[40px] flex items-center justify-center focus:outline-none",onClick:async()=>{try{const d=`Surah ${i} • Verses ${m}-${b}`,x=window.location.href;navigator.share?await navigator.share({title:"Thafheem - Quran Study",text:d,url:x}):(await navigator.clipboard.writeText(`${d}
${x}`),V("Link copied to clipboard!"))}catch(d){console.error("Share failed",d),W("Failed to share")}},title:"Share block",children:e.jsx(Ot,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]})})]},`block-${$}-${m}-${b}`)}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No blocks available for this Surah"})}),e.jsxs("div",{className:"bg-white border-t dark:bg-gray-900 border-gray-200 dark:border-gray-700 px-3 sm:px-4 py-3 sm:py-4 mt-6 sm:mt-8 rounded-lg",children:[e.jsxs("div",{className:"sm:hidden space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:He,disabled:parseInt(i)<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg w-[173.96px] min-h-[44px]
                               disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx(ot,{className:"w-3 h-3"}),e.jsx("span",{children:"Previous Surah"})]}),e.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]`,children:[e.jsx(Ne,{className:"w-3 h-3"}),e.jsx("span",{children:"Beginning of Surah"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:Ke,disabled:parseInt(i)>=114,className:`w-[173.96px] flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                                 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                                 border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]
                                 disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("span",{children:"Next Surah"}),e.jsx(Je,{className:"w-3 h-3"})]})})]}),e.jsxs("div",{className:"hidden sm:flex items-center justify-center space-x-2 sm:space-x-4 lg:space-x-6",children:[e.jsxs("button",{onClick:He,disabled:parseInt(i)<=1,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ot,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{children:"Previous Surah"})]}),e.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px]",children:[e.jsx(Ne,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{children:"Beginning of Surah"})]}),e.jsxs("button",{onClick:Ke,disabled:parseInt(i)>=114,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx("span",{children:"Next Surah"}),e.jsx(Je,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]})]}),it&&oe&&e.jsx("div",{className:"fixed inset-0 bg-gray-500/70 bg-opacity-50 flex items-start justify-center z-[9999] pt-24 sm:pt-28 lg:pt-32 p-2 sm:p-4 lg:p-6 overflow-y-auto",children:e.jsx("div",{className:"bg-white dark:bg-[#2A2C38] rounded-lg max-w-xs sm:max-w-4xl max-h-[90vh] overflow-y-auto relative w-full",children:e.jsx(Ze,{surahId:parseInt(i),range:oe.toString(),ipt:1,lang:h==="E"?"E":"mal",onClose:()=>{Ae(!1),lt(null)},showSuccess:V,showError:W},`interpretation-${i}-${oe}`)})}),xt&&$e&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-start justify-center z-[9999] pt-24 sm:pt-28 lg:pt-32 p-4 overflow-hidden",children:e.jsx(Gt,{selectedVerse:$e,surahId:i,onClose:()=>{me(!1),Z(null)},onNavigate:t=>Z(t),onSurahChange:t=>{me(!1),Z(null),z(`/surah/${t}?wordByWord=1`)}})}),yt&&e.jsx("div",{className:"fixed inset-0 flex items-start justify-center z-[9999] pt-32 sm:pt-40 lg:pt-48 p-2 sm:p-4 lg:p-6 bg-gray-500/70 dark:bg-black/70 overflow-y-auto",children:e.jsxs("div",{className:"bg-white dark:bg-[#2A2C38] rounded-lg shadow-xl w-full max-w-xs sm:max-w-2xl lg:max-w-4xl xl:max-w-[1073px] h-[85vh] sm:h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"English Explanation"}),ae?.footnoteNumber&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Footnote ",ae.footnoteNumber,ae?.ayah?` • Ayah ${ae.ayah}`:""]})]}),e.jsx("button",{onClick:()=>he(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-gray-500 dark:text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-4 sm:px-6 py-4 sm:py-6 overflow-y-auto flex-1",children:wt?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading explanation..."})]})}):e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg p-4 sm:p-6",children:e.jsx("div",{className:"text-gray-700 leading-[1.6] font-poppins sm:leading-[1.7] lg:leading-[1.8] dark:text-white text-sm sm:text-base lg:text-lg prose prose-sm dark:prose-invert max-w-none",style:{fontSize:`${ze}px`},children:bt})})})]})}),X&&e.jsx("div",{className:"fixed inset-0 bg-black/50 dark:bg-black/70 flex items-start justify-center z-[9999] pt-24 sm:pt-28 lg:pt-32 p-2 sm:p-4 lg:p-6 overflow-y-auto",children:e.jsx("div",{className:"bg-white dark:bg-[#2A2C38] rounded-lg max-w-xs sm:max-w-4xl max-h-[90vh] overflow-y-auto relative w-full shadow-2xl",children:e.jsx(Ze,{surahId:parseInt(i),range:X.range,ipt:X.interpretationNumber,lang:h==="E"?"E":"mal",onClose:()=>ue(null),showSuccess:V,showError:W},`block-interpretation-${i}-${X.range}-${X.interpretationNumber}`)})}),gt&&e.jsx("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`fixed right-6 z-[60] bg-cyan-500 hover:bg-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center ${I?"bottom-32 sm:bottom-36":"bottom-6"}`,title:"Beginning of Surah","aria-label":"Beginning of Surah",children:e.jsx(Ne,{className:"w-6 h-6"})}),I&&e.jsx(Jt,{audioElement:u.current,isPlaying:j&&u.current&&!u.current.paused,currentAyah:I,totalAyahs:g.reduce((t,r)=>{const a=r.AyaTo||r.ayato||r.to||0,s=r.AyaFrom||r.ayafrom||r.from||0;return t+(a-s+1)},0),surahInfo:le?.surahInfo,onPlayPause:Oe,onStop:be,onSkipBack:()=>{At()},onSkipForward:()=>{Ue()},onClose:null,selectedQari:H,onQariChange:t=>{ct(t),y&&I&&(be(),setTimeout(()=>{ne(y)},100))},translationLanguage:h,audioTypes:P,onAudioTypesChange:t=>{const r=y,a=I;if(console.log("[BlockWise] onAudioTypesChange",{newTypes:t,currentBlock:r,currentAyah:a,isContinuousPlay:j,isPaused:_}),ie(t),r&&a){if(u.current)try{u.current.pause(),u.current.currentTime=0}catch(s){console.warn("[BlockWise] Failed to pause audio before restarting with new types",s)}A(!0),k(!1),C(r),S(a),setTimeout(()=>{console.log("[BlockWise] restarting playback after audioTypes change",{currentBlock:r,currentAyah:a,newTypes:t}),U(r,a,0,t)},100)}},playbackSpeed:K,onPlaybackSpeedChange:t=>{dt(t)}})]})]})})]})};export{Da as default};
