import{r as o,a as Ut,b as qt,g as Ot,u as Qt,d as Ht,n as Kt,c as Xt,j as t,T as Gt,C as Yt,D as Jt,P as Zt,B as ea,F as ta,o as aa,y as Re,p as ra,q as pt,X as na,E as sa,w as oa,G as ia}from"./index-DwV6Sgdl.js";import{u as la,T as Le}from"./Toast-BkkzXe9J.js";import{W as ca}from"./WordByWord-Bt_DhbBw.js";import ft from"./InterpretationBlockwise-B8ptj4Ls.js";import{a as gt,D as da,B as ua,C as ma,A as De}from"./LoadingSkeleton-C2albd6H.js";import ha from"./StickyAudioPlayer-DWtKBTPn.js";import _e from"./englishTranslationService-DXza466L.js";import{g as pa,s as fa}from"./surahNameUtils-CNmXwDjY.js";import{C as xt}from"./chevron-left-CUJCTrI5.js";import"./tamilWordByWordService-SO7jYcnK.js";import"./hindiWordByWordService-0Fk5bvry.js";import"./banglaWordByWordService-Bv-0rA99.js";import"./banglaTranslationService-CL6dPNsx.js";import"./apiService-BdQWyFVk.js";import"./tamilTranslationService-CILKoxG5.js";import"./hindiTranslationService-BzIxfkHD.js";import"./urduTranslationService-BOrLzMVt.js";import"./BlockInterpretationModal-CHuGHPHx.js";import"./InterpretationNavbar-CR1WEWqw.js";import"./WordByWordIcon-Bl8OnoDL.js";import"./volume-x-DRoqbppe.js";import"./volume-2-BlDcEo1O.js";import"./skip-forward-D1qqYM77.js";import"./surahNameUnicodes-C_pntk6C.js";const Ja=()=>{const[ga,xa]=o.useState("Translation"),[ya,ba]=o.useState("Block wise"),[yt,be]=o.useState(!1),[ke,Me]=o.useState(null),[ee,bt]=o.useState("al-hudaify"),[D,we]=o.useState(["quran"]),[te,kt]=o.useState(1),[k,W]=o.useState(null),[ka,q]=o.useState(null),[$,I]=o.useState(null),[wa,F]=o.useState(1),[S,E]=o.useState(!1),[M,T]=o.useState(!1),h=o.useRef(null);o.useEffect(()=>{console.log("[BlockWise] audioTypes state updated",D)},[D]);const[ae,Ve]=o.useState(null),[O,ie]=o.useState(!0),[ze,le]=o.useState(null),[va,Na]=o.useState([]),[ce,Ue]=o.useState([]),[ve,qe]=o.useState({}),[m,Oe]=o.useState([]),[R,de]=o.useState({}),[Q,re]=o.useState(null),[wt,Ne]=o.useState(!1),[Qe,ue]=o.useState(null),[V,H]=o.useState(new Set),K=o.useRef(!1),[vt,Nt]=o.useState(0),[Ae,me]=o.useState(!1),[At,He]=o.useState(!1),[Aa,Ke]=o.useState(!1),[ja,Ta]=o.useState(!1),[jt,he]=o.useState(!1),[Tt,pe]=o.useState(""),[St,je]=o.useState(!1),[fe,Xe]=o.useState({footnoteId:null,footnoteNumber:null,surah:null,ayah:null}),X=Ut(),Ge=qt(),{pathname:Ye}=Ge,{user:ne}=Ot(),{toasts:Te,removeToast:Se,showSuccess:G,showError:z,showWarning:Je}=la(),{quranFont:Ze,translationLanguage:d,theme:Et,translationFontSize:et,viewType:Y,setViewType:ge}=Qt(),Bt=Math.max(Number(et)-2,10),{surahId:i}=Ht(),{getBlockViewCache:tt,setBlockViewCache:Ee}=Kt(),at=o.useRef(!1),rt=o.useRef(d),nt=o.useRef(i);o.useEffect(()=>{if(!(d==="mal"||d==="E")){Y!=="Ayah Wise"&&ge("Ayah Wise");return}if(Y==="Ayah Wise"){const a=`/surah/${i}`;Ye!==a&&X(a)}else Y!=="Block Wise"&&ge("Block Wise")},[Y,d,i,X,Ye,ge]);const{surahs:Be}=Xt(),xe=o.useCallback((e=[])=>!Array.isArray(e)||e.length===0?new Set:new Set(e.map((a,r)=>{const n=a.AyaFrom??a.ayafrom??a.from??1,s=a.AyaTo??a.ayato??a.to??n,c=Number.parseInt(n,10),x=Number.parseInt(s,10),p=Number.isFinite(c)&&Number.isFinite(x),u=Number.isFinite(Number(n))?Number(n):1,N=p?c:u,y=Number.isFinite(Number(s))?Number(s):N,b=p?`${N}-${p?x:y}`:`${n}-${s}`;return a.ID||a.id||b||`block-${r}`})),[]),st=e=>{const a=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];return e.toString().split("").map(r=>a[r]||r).join("")},_=(e,a=null)=>{const r=Number.parseInt(e,10);return Number.isFinite(r)?r:a},Ce=o.useCallback((e="manual")=>{if(!i)return;console.log(`[BlockWise] Triggering blockwise reload (${e})`),K.current=!1;const a=xe(m);H(a),de({}),le(null),e==="manual"&&me(!1),Nt(r=>r+1)},[i,m,xe]);o.useEffect(()=>(h.current||(h.current=new Audio),()=>{h.current&&(h.current.pause(),h.current.src="",h.current.currentTime=0),W(null),q(null),I(null),E(!1),T(!1)}),[]);const Ct={"al-hudaify":"QH","al-afasy":"QA","al-ghamidi":"QG"},ot=e=>({E:"English",mal:"Malayalam",ur:"Urdu",bn:"Bangla",ta:"Tamil",hi:"Hindi"})[e]||e,ye=(e,a=!1)=>{if(!h.current)return;if(console.log("[BlockWise] playBlockAudio start",{blockId:e,fromContinuous:a,audioTypes:D,translationLanguage:d,selectedQirath:ee}),!a&&d!=="mal"&&D.some(x=>x==="translation"||x==="interpretation")){const x=ot(d);Je(`${x} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available.`);const p=D.filter(u=>u!=="translation"&&u!=="interpretation");p.length>0?we(p):we(["quran"]);return}h.current&&h.current.pause();const r=m.find(c=>(c.ID||c.id)===e);if(!r){console.error("Block not found:",e);return}const n=r.AyaFrom||r.ayafrom||r.from||1,s=_(n,1);E(!0),W(e),I(s),F(1),T(!1),console.log("[BlockWise] playBlockAudio state set",{playingBlock:e,normalizedStartingAyah:s,currentAudioType:D?.[0]||"quran"}),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}})),Z(e,s,0)},$t=(e,a,r)=>{const n=String(e).padStart(3,"0"),s=String(a).padStart(3,"0"),c="https://old.thafheem.net/audio";return r==="quran"?`${c}/qirath/${ee}/${Ct[ee]}${n}_${s}.ogg`:r==="translation"?`${c}/translation/T${n}_${s}.ogg`:r==="interpretation"?`${c}/interpretation/I${n}_${s}.ogg`:null},J=(e,a,r=0,n=null)=>{if(!h.current)return;const s=_(a,_($,1)||1),c=n||D;if(console.log("[BlockWise] playAyahAudioWithTypes",{blockId:e,requestedAyah:a,ayahToPlay:s,audioTypeIndex:r,audioTypes:c,playbackSpeed:te,isContinuousPlay:S,isPaused:M,playingBlock:k}),r>=c.length){it(s,c);return}h.current.pause();const x=c[r],p=$t(i,s,x);if(!p){J(e,s,r+1,n);return}console.log("[BlockWise] generated audioUrl",{blockId:e,ayahToPlay:s,currentAudioType:x,audioUrl:p});const N={quran:"qirath",translation:"translation",interpretation:"interpretation"}[x]||"qirath";q(N),I(s),h.current.onended=null,h.current.onerror=null,h.current.onended=()=>{J(e,s,r+1,c)},h.current.onerror=()=>{console.error("Error playing audio:",p),J(e,s,r+1,c)},h.current.src=p,h.current.playbackRate=te,h.current.load(),h.current.play().catch(y=>{console.error("Error playing audio:",y.name,y.message,p),J(e,s,r+1,c)})},Z=(e,a,r=0,n=null)=>{J(e,a,r,n)},it=(e=null,a=null)=>{const r=e??$;if(!k||!r)return;const n=m.find(u=>(u.ID||u.id)===k);if(!n)return;const s=n.AyaTo||n.ayato||n.to,c=_(r,null),x=_(s,c);if(c===null||x===null){console.warn("[BlockWise] moveToNextAyahOrBlock aborted - invalid ayah numbers",{playingBlock:k,currentAyahInBlock:r,ayaTo:s});return}const p=c+1;console.log("[BlockWise] moveToNextAyahOrBlock",{playingBlock:k,currentAyahNumber:c,nextAyah:p,ayaToNumber:x,isContinuousPlay:S}),p<=x?(F(1),Z(k,p,0,a)):S?(F(1),Pt()):(W(null),q(null),I(null),F(1),T(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}})))},It=(e=null,a=null)=>{const r=e??$;if(!k||!r)return;const n=m.find(u=>(u.ID||u.id)===k);if(!n)return;const s=n.AyaFrom||n.ayafrom||n.from||1,c=_(r,null),x=_(s,1);if(c===null||x===null){console.warn("[BlockWise] moveToPreviousAyahOrBlock aborted - invalid ayah numbers",{playingBlock:k,currentAyahInBlock:r,ayaFrom:s});return}const p=c-1;console.log("[BlockWise] moveToPreviousAyahOrBlock",{playingBlock:k,currentAyahNumber:c,previousAyah:p,ayaFromNumber:x,isContinuousPlay:S}),p>=x?(F(1),Z(k,p,0,a)):S?(F(1),Ft()):(W(null),q(null),I(null),F(1),T(!1))},Ft=()=>{if(!S||!m||m.length===0)return;const e=m.findIndex(a=>(a.ID||a.id)===k);if(e>0){const a=m[e-1],r=a.ID||a.id,n=a.AyaTo||a.ayato||a.to||1,s=_(n,1);E(!0),W(r),I(s),F(1),T(!1),Z(r,s)}else{const a=m[0],r=a.ID||a.id,n=a.AyaFrom||a.ayafrom||a.from||1,s=_(n,1);W(r),I(s),F(1),Z(r,s)}},Pt=()=>{if(!S||!m||m.length===0)return;const e=m.findIndex(a=>(a.ID||a.id)===k);if(e!==-1&&e<m.length-1){const a=m[e+1],r=a.ID||a.id;ye(r,!0)}else W(null),q(null),I(null),F(1),E(!1),T(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))},lt=()=>{if(!m||m.length===0){z("No blocks available to play");return}if(d!=="mal"){const e=ot(d);Je(`${e} translation and explanation audio is coming soon. Currently, only Malayalam translation and explanation audio is available.`);return}try{if(S)h.current&&h.current.pause(),E(!1),T(!0),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}));else if(k&&$)E(!0),T(!1),h.current&&h.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(e=>{console.error("Error resuming audio:",e)});else{E(!0),T(!1);const e=m[0].ID||m[0].id;ye(e)}}catch(e){console.error("Error in handlePlayAudio:",e),E(!1),W(null),I(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},$e=o.useRef(null);$e.current=lt,o.useEffect(()=>{const e=()=>{$e.current&&$e.current()};return window.addEventListener("playAudio",e),()=>{window.removeEventListener("playAudio",e)}},[]),o.useEffect(()=>{const e=S&&!M&&k!==null;window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:e}}))},[S,M,k]),o.useEffect(()=>{const e=a=>{const{type:r,message:n}=a.detail;r==="success"?G(n):r==="error"&&z(n)};return window.addEventListener("showToast",e),()=>{window.removeEventListener("showToast",e)}},[G,z]);const Ie=()=>{h.current&&(h.current.pause(),h.current.currentTime=0),E(!1),W(null),q(null),I(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}})),F(1),T(!1)};o.useEffect(()=>()=>{try{Ie()}catch{}},[]),o.useEffect(()=>()=>{h.current&&(h.current.pause(),W(null),q(null),I(null),F(1),E(!1),T(!1))},[i]),o.useEffect(()=>{k&&$&&h.current&&S&&Z(k,$,0)},[ee,D]),o.useEffect(()=>{h.current&&(h.current.playbackRate=te)},[te]),o.useEffect(()=>{at.current=!1},[i,d]),o.useEffect(()=>{me(!1)},[i]),o.useEffect(()=>{if(!i||!(d==="mal"||d==="E"))return;const a=tt?.(i,d);if(a){at.current=!0,Ve(a.blockData||null),Oe(a.blockRanges||[]),Ue(a.arabicVerses||[]),de(a.blockTranslations||{}),le(null),H(new Set);const r=a.blockTranslations?Object.keys(a.blockTranslations).length:0,n=!!(a.__meta?.isComplete&&r>0);ie(!n),K.current=n}},[i,d,tt]),o.useEffect(()=>((async()=>{if(!i||K.current||Be.length===0)return;if(!(d==="mal"||d==="E")){console.log(`⚠️ BlockWise: Language '${d}' doesn't support blockwise. Skipping fetch.`),ie(!1);return}K.current=!0;try{ie(!0),le(null);const[r,n]=await Promise.all([sa(parseInt(i),d||"mal"),oa(parseInt(i))]),s=Be.find(c=>c.number===parseInt(i));if(Ve({surahInfo:s||{number:parseInt(i),arabic:"القرآن",type:"Makki"}}),Ue(n||[]),Oe(r||[]),r&&r.length>0){const c=async(l,g)=>{const v=l.AyaFrom||l.ayafrom||l.from,A=l.AyaTo||l.ayato||l.to;if(v==null||A===void 0||A===null)return;const f=Number.parseInt(v,10),w=Number.parseInt(A,10),C=Number.isFinite(f)&&Number.isFinite(w),P=C?`${f}-${w}`:`${v}-${A}`,L=l.ID||l.id||P||`block-${g}`,se=C?f:v,Pe=C?w:A;try{H(U=>new Set([...U,L]));let oe;const We=d||"mal";oe=await ia(parseInt(i),P,We),de(U=>({...U,[L]:{range:P,ayaFrom:se,ayaTo:Pe,data:oe}})),H(U=>{const ht=new Set(U);return ht.delete(L),ht})}catch(oe){oe.message?.includes("timeout")||console.error(`❌ BlockWise: Failed to load block ${P}:`,oe.message),H(We=>{const U=new Set(We);return U.delete(L),U})}},p=[];let u=0;const N=async(l,g)=>new Promise(v=>{const A=async()=>{u++;try{await c(l,g)}catch{}finally{u--,p.length>0&&p.shift()(),v()}};u<5?A():p.push(A)}),y=l=>{const g=l.slice(0,3),v=l.slice(3);return{visibleBlocks:g,backgroundBlocks:v}},{visibleBlocks:j,backgroundBlocks:b}=y(r),B=j.map((l,g)=>c(l,g));b.forEach((l,g)=>{setTimeout(()=>{N(l,g+j.length)},50*Math.floor(g/5))}),Promise.allSettled(B).then(l=>{const g=l.filter(v=>v.status==="fulfilled").length})}}catch(r){let n=r.message;r.message?.includes("timeout")||r.message?.includes("Request timeout")?n="The server is taking longer than expected to respond. Please try again in a moment. If the problem persists, the English blockwise data may be temporarily unavailable.":r.message?.includes("Failed to fetch")||r.message?.includes("Network error")?n="Unable to connect to the server. Please check your internet connection and try again.":r.message?.includes("HTTP error")&&(n=`Server error: ${r.message}. Please try again later.`),le(n),console.error("Error fetching block-wise data:",r),K.current=!1}finally{ie(!1)}})(),()=>{K.current=!1}),[i,Be,d,vt]),o.useEffect(()=>{if(!i||!(d==="mal"||d==="E")||!Ee||O||!Array.isArray(m)||m.length===0)return;const r=(R?Object.keys(R).length:0)>0&&(!V||V.size===0);Ee(i,d,{blockData:ae,blockRanges:m,arabicVerses:ce,blockTranslations:R,__meta:{isComplete:r}})},[i,d,ae,m,ce,R,O,V,Ee]),o.useEffect(()=>{const e=d==="mal"||d==="E",a=Array.isArray(m)&&m.length>0,r=O||V&&V.size>0,n=R?Object.keys(R).length:0;!i||!e||!a||r||n>0||Ae||(me(!0),Ce("auto"))},[i,d,m,R,O,V,Ae,Ce]),o.useEffect(()=>{const e=rt.current!==d,a=nt.current!==i;!e&&!a||(rt.current=d,nt.current=i,m.length>0?H(xe(m)):H(new Set),de({}),K.current=!1,re(null),be(!1),he(!1),pe(""),je(!1),Xe({footnoteId:null,footnoteNumber:null,surah:null,ayah:null}),me(!1))},[d,i,m,xe]),o.useEffect(()=>{(async()=>{if(!ne||!i){Ke(!1);return}try{const a=await Re.isFavorited(ne.uid,i);Ke(a)}catch(a){console.error("Error loading favorite status:",a)}})()},[ne,i]),o.useEffect(()=>{if(d!=="E")return;const e=async a=>{const r=a.target.closest(".english-footnote-link");if(!r)return;if(Y==="Block Wise"){a.preventDefault(),a.stopPropagation();const p=r.getAttribute("data-footnote-id"),N=r.getAttribute("data-interpretation-number")||r.getAttribute("data-footnote-number")||(r.textContent||"").trim(),y=N&&/^\d+$/.test(N)?parseInt(N,10):1,j=r.getAttribute("data-ayah"),b=j?parseInt(j,10):null;if(!N&&!p){console.warn("[BlockWise] ⚠️ Missing displayed number and footnote ID");return}let B=null;if(b&&m.length>0){const l=m.find(g=>{const v=g.AyaFrom||g.ayafrom||g.from||0,A=g.AyaTo||g.ayato||g.to||v;return b>=v&&b<=A});if(l){const g=l.AyaFrom||l.ayafrom||l.from||1,v=l.AyaTo||l.ayato||l.to||g;B=`${g}-${v}`}else console.warn("[BlockWise] ⚠️ Could not find block range for verse:",b,"available blocks:",m.map(g=>({from:g.AyaFrom||g.ayafrom||g.from,to:g.AyaTo||g.ayato||g.to})))}if(!B&&m.length>0){const l=m[0],g=l.AyaFrom||l.ayafrom||l.from||1,v=l.AyaTo||l.ayato||l.to||g;B=`${g}-${v}`}if(B){re({range:B,interpretationNumber:y,footnoteId:p});return}else console.warn("[BlockWise] ⚠️ Could not determine block range, falling back to footnote modal")}a.preventDefault(),a.stopPropagation();const n=r.getAttribute("data-footnote-id");if(!n)return;const s=r.getAttribute("data-footnote-number")||(r.textContent||"").trim(),c=r.getAttribute("data-ayah"),x=c?parseInt(c,10):null;Xe({footnoteId:n,footnoteNumber:s||null,surah:i?parseInt(i,10):null,ayah:x}),pe("Loading..."),je(!0),he(!0);try{const p=await _e.getExplanation(parseInt(n,10));pe(p||"Explanation not available.")}catch(p){console.error("Error fetching English footnote explanation:",p),pe(`Error loading explanation: ${p.message||p}`)}finally{je(!1)}};return document.addEventListener("click",e),()=>{document.removeEventListener("click",e)}},[d,i,Y,m]);const Wt=e=>{if(!e)return"";const a=document.createElement("div");return a.innerHTML=e,a.textContent||a.innerText||""},Rt=(e={})=>e?.TranslationText||e?.translationText||e?.translation_text||e?.text||"",Lt=(e={},a)=>{const r=e?.VerseNo??e?.Verse_Number??e?.verse_number??e?.VerseNumber??e?.ayah_number??e?.AyaId??e?.AyahId??a,n=Number.parseInt(r,10);return Number.isFinite(n)?n:a},Dt=(e=[],a=null,r=1)=>{const n=e.length>0?e:a?[a]:[];return n.length===0?"":n.map((s,c)=>{const x=Rt(s);if(!x)return"";const p=Wt(x).trim();if(!p)return"";const u=Lt(s,r+c);return n.length>1?`${u}. ${p}`:p}).filter(Boolean).join(`

`)},ct=(e,a)=>{if(!e)return"";const r=document.createElement("div");return r.innerHTML=e,r.querySelectorAll("sup").forEach(s=>{const c=s.textContent.trim();/^\d+$/.test(c)&&(s.style.cssText=`
          cursor: pointer !important;
          background-color: rgb(41 169 199) !important;
          color: rgb(255, 255, 255) !important;
          font-weight: 600 !important;
          text-decoration: none !important;
          border: none !important;
          display: inline-flex !important;
          align-items: center !important;
          justify-content: center !important;
          font-size: 12px !important;
          vertical-align: middle !important;
          line-height: 1 !important;
          border-radius: 9999px !important;
          position: relative !important;
          z-index: 10 !important;
          top: 0px !important;
          min-width: 20px !important;
          min-height: 19px !important;
          text-align: center !important;
          transition: 0.2s ease-in-out !important;
          padding-top: 3px !important;
          margin-right: 4px;
          margin-left: -1px;
          margin-top: -15px;
          padding-left: 2px !important;
          padding-right: 2px !important;
        `,s.setAttribute("data-interpretation",c),s.setAttribute("data-range",a),s.setAttribute("data-lang",d==="E"?"en":"mal"),s.setAttribute("title",`Click to view interpretation ${c}`),s.setAttribute("aria-label",`Interpretation ${c}`),s.setAttribute("data-interpretation-label",c),s.className="interpretation-link")}),r.innerHTML};o.useEffect(()=>{const e=r=>{let n=r.target.closest(".interpretation-link");if(!n&&d==="E"){const s=r.target.closest(".english-footnote-link");if(s){const x=s.getAttribute("data-interpretation-number")||s.getAttribute("data-footnote-number")||s.textContent?.trim()||"",p=x&&/^\d+$/.test(x)?parseInt(x,10):1,u=s.getAttribute("data-surah"),N=s.getAttribute("data-ayah");if(u===i&&N&&m.length>0){const y=parseInt(N,10),j=m.find(b=>{const B=b.AyaFrom||b.ayafrom||b.from||0,l=b.AyaTo||b.ayato||b.to||B;return y>=B&&y<=l});if(j){const b=j.AyaFrom||j.ayafrom||j.from||1,B=j.AyaTo||j.ayato||j.to||b,l=`${b}-${B}`,g=s.getAttribute("data-footnote-id");r.preventDefault(),r.stopPropagation(),re({range:l,interpretationNumber:p,footnoteId:g});return}else console.warn("[BlockWise] ⚠️ Could not find block range for verse:",y)}}}if(n){r.preventDefault(),r.stopPropagation();const s=n.getAttribute("data-interpretation"),c=n.getAttribute("data-range");n.getAttribute("data-lang"),s&&c?re({range:c,interpretationNumber:parseInt(s,10)}):console.warn("[BlockWise] ⚠️ Missing interpretation data:",{interpretationNumber:s,range:c})}},a=document.createElement("style");return a.textContent=`
      .interpretation-link {
        cursor: pointer !important;
      }
      .interpretation-link > a {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: 100% !important;
        height: 100% !important;
        color: inherit !important;
        font-weight: inherit !important;
        text-decoration: none !important;
      }
      .interpretation-link:hover {
        background-color: #0891b2 !important;
        transform: scale(1.05) !important;
      }
      .interpretation-link:active {
        background-color: #0e7490 !important;
        transform: scale(0.95) !important;
      }
    `,document.head.appendChild(a),document.addEventListener("click",e,!0),()=>{document.removeEventListener("click",e,!0),document.head.removeChild(a)}},[]);const dt=()=>{const e=parseInt(i)-1;e>=1&&X(`/blockwise/${e}`)},ut=()=>{const e=parseInt(i)+1;e<=114&&X(`/blockwise/${e}`)};if(o.useEffect(()=>{const e=()=>{window.scrollY>300?He(!0):He(!1)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),O&&m.length===0)return t.jsxs(t.Fragment,{children:[t.jsx(Le,{toasts:Te,removeToast:Se}),t.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 px-4 py-8",children:t.jsxs("div",{className:"max-w-7xl mx-auto",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("div",{className:"h-12 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-64 mx-auto mb-4 relative overflow-hidden",children:t.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})}),t.jsx("div",{className:"h-6 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-600 rounded w-40 mx-auto relative overflow-hidden",children:t.jsx("div",{className:"absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/60 dark:via-white/10 to-transparent"})})]}),t.jsx(gt,{count:3})]})})]});if(ze)return t.jsxs(t.Fragment,{children:[t.jsx(Le,{toasts:Te,removeToast:Se}),t.jsx("div",{className:"min-h-screen bg-white dark:bg-black flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-red-500 dark:text-red-400 text-lg mb-2",children:"Failed to load Block-wise data"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:ze}),t.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Try Again"})]})})]});const Fe=ae?.surahInfo?.arabic||(i?`Surah ${i}`:"Surah"),_t=pa(i,Fe),mt=i?String(i):"",Mt=mt==="1"||mt==="2"?"font-normal":"font-semibold",Vt=R?Object.keys(R).length:0,zt=!O&&Array.isArray(m)&&m.length>0&&(V?.size??0)===0&&Vt===0&&Ae;return t.jsxs(t.Fragment,{children:[t.jsx(Le,{toasts:Te,removeToast:Se}),t.jsx("div",{className:"mx-auto min-h-screen bg-gray-50 dark:bg-gray-900 font-outfit transition-colors duration-300",children:t.jsxs("div",{className:"sticky top-0 z-40 glass border-b border-gray-200/50 dark:border-gray-700/50 transition-all duration-300",children:[t.jsx("div",{className:"container-responsive py-3 sm:py-4",children:t.jsxs("div",{className:"flex flex-col items-center justify-center relative",children:[t.jsx("div",{className:"mb-2 sm:mb-4",children:t.jsx("h1",{className:`text-4xl sm:text-5xl md:text-6xl font-arabic text-center text-gray-800 dark:text-white drop-shadow-sm ${Mt}`,style:{fontFamily:fa},"aria-label":Fe,children:ae?_t:Fe})}),parseInt(i)!==1&&parseInt(i)!==9&&t.jsx("div",{className:"mb-4 sm:mb-6",children:t.jsx("div",{className:"hidden sm:block",children:t.jsx("div",{className:"max-w-[1290px] mx-auto relative flex items-center justify-center px-4 lg:px-8",children:t.jsx("div",{className:"flex-shrink-0 px-4 sm:px-6 pt-8 pb-6 sm:pt-10 sm:pb-8",children:parseInt(i)!==1&&parseInt(i)!==9?t.jsx("img",{src:Et==="dark"?da:ua,alt:"Bismi",className:"w-[236px] h-[52.9px]"}):t.jsx("div",{className:"h-[52.9px]"})})})})}),t.jsx("div",{className:"w-full flex justify-center mb-4 sm:mb-6",children:(d==="mal"||d==="E")&&t.jsx(Gt,{options:["Ayah Wise","Block Wise"],value:"Block Wise",onChange:e=>ge(e)})}),zt&&t.jsx("div",{className:"w-full flex justify-center mb-4",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 rounded-2xl border border-amber-200 dark:border-amber-700 bg-amber-50 dark:bg-amber-900/30 px-4 py-3 text-sm text-amber-900 dark:text-amber-100",children:[t.jsx("span",{children:"We couldn't load the blockwise translation. Please retry."}),t.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded-full bg-amber-600 text-white px-3 py-1.5 text-xs font-semibold hover:bg-amber-700 transition-colors",onClick:()=>Ce("manual"),children:"Retry now"})]})})]})}),t.jsx("div",{className:`container-responsive py-6 sm:py-8 space-y-4 sm:space-y-6 ${$?"pb-32 sm:pb-36":""}`,children:O&&m.length===0?t.jsx(gt,{count:5}):m&&m.length>0?m.map((e,a)=>{const r=e.AyaFrom??e.ayafrom??e.from??1,n=e.AyaTo??e.ayato??e.to??r,s=Number.parseInt(r,10),c=Number.parseInt(n,10),x=Number.isFinite(s)&&Number.isFinite(c),p=Number.isFinite(Number(r))?Number(r):1,u=x?s:p,N=Number.isFinite(Number(n))?Number(n):u,y=x?c:N,j=x?`${u}-${y}`:`${r}-${n}`,b=e.ID||e.id||j||`block-${a}`,l=(R[b]||null)?.data,g=Array.isArray(l)?l:Array.isArray(l?.translations)?l.translations:Array.isArray(l?.data)?l.data:[],v=l?Dt(g,l,u):"",A=Array.isArray(ce)?ce.slice(u-1,y):[];return t.jsxs("div",{className:"relative rounded-2xl bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 hover:shadow-card hover:border-gray-200 dark:hover:border-gray-600 transition-all duration-300",children:[t.jsxs("div",{className:"absolute top-0 left-0 bg-gray-50 dark:bg-gray-700/50 px-3 py-1.5 rounded-br-xl border-b border-r border-gray-100 dark:border-gray-700 text-xs font-medium text-gray-500 dark:text-gray-400 z-10",children:[i,":",u,u!==y&&`-${y}`]}),t.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 pt-12",children:[t.jsx("div",{className:"w-full mb-6 sm:mb-8 text-right",dir:"rtl",children:t.jsx("p",{className:"leading-[2.2] text-gray-800 dark:text-gray-100",style:{fontFamily:Ze?`'${Ze}', serif`:'"Amiri Quran", serif',direction:"rtl",lineHeight:"2.7",fontSize:"23px"},children:A.length>0?A.map((f,w)=>`${f.text_uthmani} ﴿${st(u+w)}﴾`).join(" "):"Loading Arabic text..."})}),t.jsx("div",{className:"w-full text-left mb-6",children:l?t.jsx("div",{className:`prose dark:prose-invert max-w-none text-gray-600 dark:text-gray-300 ${d==="hi"?"font-hindi":d==="ur"?"font-urdu":d==="bn"?"font-bengali":d==="ta"?"font-tamil":d==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${Bt}px`},children:g.length>0?g.map((f,w)=>{const C=f.TranslationText||f.translationText||f.translation_text||f.text||"",P=f.VerseNo||f.Verse_Number||f.verse_number||f.VerseNumber||f.ayah_number||f.AyaId||f.AyahId||u+w,L=Number.isFinite(parseInt(P,10))?parseInt(P,10):u+w,se=d==="E"?_e.parseEnglishTranslationWithClickableFootnotes(C,parseInt(i,10),L,`${u}-${y}`):ct(C,`${u}-${y}`);return t.jsx("div",{className:"leading-relaxed",style:{fontSize:"17px"},dangerouslySetInnerHTML:{__html:se}},`translation-${b}-${w}`)}):l?.TranslationText||l?.translationText||l?.translation_text||l?.text?t.jsx("div",{className:"leading-relaxed",style:{fontSize:"17px"},dangerouslySetInnerHTML:{__html:d==="E"?_e.parseEnglishTranslationWithClickableFootnotes(l.TranslationText||l.translationText||l.translation_text||l.text,parseInt(i,10),u,`${u}-${y}`):ct(l.TranslationText||l.translationText||l.translation_text||l.text,`${u}-${y}`)}}):t.jsx("p",{children:"Translation not available"})}):V.has(b)?t.jsx(ma,{message:"Loading translation..."}):t.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Translation not available"})}),t.jsx("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-700/50",children:t.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[t.jsx("button",{className:"icon-btn",onClick:async()=>{try{const C=`${A.length>0?A.map((P,L)=>`${P.text_uthmani} ﴿${u+L}﴾`).join(" "):"Loading Arabic text..."}

${v||"Translation not available"}`;await navigator.clipboard.writeText(C),G("Text copied to clipboard!")}catch(f){console.error("Copy failed",f),z("Failed to copy text")}},title:"Copy text",children:t.jsx(Yt,{className:"w-5 h-5"})}),t.jsx("button",{className:`icon-btn ${k===b&&!M?"text-primary bg-primary/10":""}`,onClick:()=>{k===b?M?(T(!1),E(!0),h.current&&h.current.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(f=>{console.error("Error resuming audio:",f)})):(h.current&&h.current.pause(),T(!0),E(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))):ye(b)},title:k===b?M?"Resume audio":"Pause audio":"Play audio",children:k===b&&!M?t.jsx(Jt,{className:"w-5 h-5"}):t.jsx(Zt,{className:"w-5 h-5"})}),d!=="ta"&&d!=="E"&&d!=="mal"&&t.jsx("button",{className:"icon-btn group",onClick:f=>{const w=`/surah/${i}#verse-${u}`;f?.ctrlKey||f?.metaKey?(f.preventDefault(),window.open(w,"_blank","noopener,noreferrer")):X(w)},title:"View ayah details",children:t.jsx(ea,{className:"w-5 h-5 group-hover:scale-110 transition-transform"})}),t.jsx("button",{className:"icon-btn group",onClick:f=>{const w=`/word-by-word/${i}/${u}`;if(f?.ctrlKey||f?.metaKey){f.preventDefault(),window.open(w,"_blank","noopener,noreferrer");return}Ne(!0),ue(u)},title:"Word by word",children:t.jsx(ta,{className:"w-5 h-5 group-hover:scale-110 transition-transform"})}),t.jsx("button",{className:`icon-btn ${ve[`${u}-${y}`]?"opacity-50 cursor-not-allowed":""}`,onClick:async()=>{if(!ne){z("Please sign in to bookmark blocks"),X("/sign",{state:{from:Ge.pathname,message:"Sign in to bookmark blocks"}});return}const f=`${u}-${y}`;try{qe(C=>({...C,[f]:!0}));const w=Re.getEffectiveUserId(ne);await Re.addBlockBookmark(w,i,u,y),G(`Saved block ${u}-${y}`)}catch(w){console.error("Failed to bookmark block:",w),z("Failed to save block")}finally{qe(w=>({...w,[f]:!1}))}},title:"Bookmark block",disabled:ve[`${u}-${y}`],children:ve[`${u}-${y}`]?t.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b border-current"}):t.jsx(aa,{className:"w-5 h-5"})}),t.jsx("button",{className:"icon-btn",onClick:async()=>{try{const f=window.location.href,P=`${A.length>0?A.map((se,Pe)=>`${se.text_uthmani} ﴿${st(u+Pe)}﴾`).join(" "):"Arabic text is loading..."}

${v||"Translation not available"}

Read more: ${f}`,L=`Surah ${i} • Verses ${u}-${y}`;navigator.share?await navigator.share({title:L,text:P}):(await navigator.clipboard.writeText(P),G("Content copied to clipboard!"))}catch(f){console.error("Share failed",f),z("Failed to share")}},title:"Share block",children:t.jsx(ra,{className:"w-5 h-5"})})]})})]})]},`block-${b}-${u}-${y}`)}):t.jsx("div",{className:"text-center py-8",children:t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No blocks available for this Surah"})})}),t.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 dark:border-gray-700 px-3 sm:px-4 lg:px-6 py-3 sm:py-4 mt-6 sm:mt-8",children:t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"sm:hidden space-y-2",children:[t.jsxs("div",{className:"flex space-x-2",children:[t.jsxs("button",{onClick:dt,disabled:parseInt(i)<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg w-[173.96px] min-h-[44px]
                               disabled:opacity-50 disabled:cursor-not-allowed`,children:[t.jsx(xt,{className:"w-3 h-3"}),t.jsx("span",{children:"Previous Surah"})]}),t.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                               dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                               border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]`,children:[t.jsx(De,{className:"w-3 h-3"}),t.jsx("span",{children:"Beginning of Surah"})]})]}),t.jsx("div",{className:"flex justify-center",children:t.jsxs("button",{onClick:ut,disabled:parseInt(i)>=114,className:`w-[173.96px] flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                                 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                                 border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]
                                 disabled:opacity-50 disabled:cursor-not-allowed`,children:[t.jsx("span",{children:"Next Surah"}),t.jsx(pt,{className:"w-3 h-3"})]})})]}),t.jsxs("div",{className:"hidden sm:flex items-center justify-center space-x-2 sm:space-x-4 lg:space-x-6",children:[t.jsxs("button",{onClick:dt,disabled:parseInt(i)<=1,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx(xt,{className:"w-3 h-3 sm:w-4 sm:h-4"}),t.jsx("span",{children:"Previous Surah"})]}),t.jsxs("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px]",children:[t.jsx(De,{className:"w-3 h-3 sm:w-4 sm:h-4"}),t.jsx("span",{children:"Beginning of Surah"})]}),t.jsxs("button",{onClick:ut,disabled:parseInt(i)>=114,className:"flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm bg-white border border-gray-300 rounded-full shadow-sm text-gray-600 dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 transition-colors min-h-[44px] sm:min-h-[48px] disabled:opacity-50 disabled:cursor-not-allowed",children:[t.jsx("span",{children:"Next Surah"}),t.jsx(pt,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]})}),yt&&ke&&t.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:()=>{be(!1),Me(null)}}),t.jsxs("div",{className:"relative w-full sm:w-[550px] max-h-[85vh] sm:max-h-[90vh] bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col animate-slideUp sm:animate-fadeIn overflow-hidden",children:[t.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 sm:hidden cursor-grab active:cursor-grabbing",children:t.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:t.jsx(ft,{surahId:parseInt(i),range:ke.toString(),ipt:1,lang:d==="E"?"E":"mal",onClose:()=>{be(!1),Me(null)},showSuccess:G,showError:z,isModal:!0},`interpretation-${i}-${ke}`)})]})]}),wt&&Qe&&t.jsx(ca,{selectedVerse:Qe,surahId:i,onClose:()=>{Ne(!1),ue(null)},onNavigate:e=>ue(e),onSurahChange:e=>{Ne(!1),ue(null),X(`/surah/${e}?wordByWord=1`)}}),jt&&t.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[t.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:()=>he(!1)}),t.jsxs("div",{className:"relative w-full sm:w-[480px] md:max-w-2xl lg:max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col animate-slideUp sm:animate-fadeIn overflow-hidden",children:[t.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 sm:hidden cursor-grab active:cursor-grabbing",children:t.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),t.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-gray-100 dark:border-gray-800",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white",children:"English Explanation"}),fe?.footnoteNumber&&t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Footnote ",fe.footnoteNumber,fe?.ayah?` • Ayah ${fe.ayah}`:""]})]}),t.jsx("button",{onClick:()=>he(!1),className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-gray-500 dark:text-gray-400",children:t.jsx(na,{className:"w-5 h-5"})})]}),t.jsx("div",{className:"flex-1 overflow-y-auto p-5 space-y-6",children:St?t.jsx("div",{className:"flex items-center justify-center py-8",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading explanation..."})]})}):t.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 rounded-lg",children:t.jsx("div",{className:"text-gray-700 leading-[1.6] font-poppins sm:leading-[1.7] lg:leading-[1.8] dark:text-white text-sm sm:text-base lg:text-lg prose prose-sm dark:prose-invert max-w-none",style:{fontSize:`${et}px`},children:Tt})})})]})]}),Q&&t.jsx(ft,{surahId:parseInt(i),range:Q.range,ipt:Q.interpretationNumber,lang:d==="E"?"E":"mal",footnoteId:Q.footnoteId||null,onClose:()=>re(null)},`block-interpretation-${i}-${Q.range}-${Q.interpretationNumber}-${Q.footnoteId||""}`),At&&t.jsx("button",{onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:`fixed right-6 z-[60] bg-cyan-500 hover:bg-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center ${$?"bottom-32 sm:bottom-36":"bottom-6"}`,title:"Beginning of Surah","aria-label":"Beginning of Surah",children:t.jsx(De,{className:"w-6 h-6"})})]})}),$&&t.jsx(ha,{audioElement:h.current,isPlaying:S&&h.current&&!h.current.paused,currentAyah:$,totalAyahs:m.reduce((e,a)=>{const r=a.AyaTo||a.ayato||a.to||0,n=a.AyaFrom||a.ayafrom||a.from||0;return e+(r-n+1)},0),surahInfo:ae?.surahInfo,onPlayPause:lt,onStop:Ie,onSkipBack:()=>{It()},onSkipForward:()=>{it()},onClose:null,selectedQari:ee,onQariChange:e=>{bt(e),k&&$&&(Ie(),setTimeout(()=>{ye(k)},100))},translationLanguage:d,audioTypes:D,onAudioTypesChange:e=>{const a=k,r=$;if(console.log("[BlockWise] onAudioTypesChange",{newTypes:e,currentBlock:a,currentAyah:r,isContinuousPlay:S,isPaused:M}),we(e),a&&r){if(h.current)try{h.current.pause(),h.current.currentTime=0}catch(n){console.warn("[BlockWise] Failed to pause audio before restarting with new types",n)}E(!0),T(!1),W(a),I(r),setTimeout(()=>{console.log("[BlockWise] restarting playback after audioTypes change",{currentBlock:a,currentAyah:r,newTypes:e}),J(a,r,0,e)},100)}},playbackSpeed:te,onPlaybackSpeedChange:e=>{kt(e)}})]})};export{Ja as default};
