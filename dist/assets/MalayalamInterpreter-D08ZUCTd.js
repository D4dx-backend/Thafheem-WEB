import{i as z,j as n,q as D,N as J,J as K,K as X,y as G}from"./index-D80Klju5.js";import{b as l,u as Q,d as V,h as Y}from"./react-vendor-v5ei6ytj.js";import{I as Z}from"./InterpretationNavbar-DE0H5DgO.js";import{A as tt}from"./WordByWord-BCfrWsO1.js";import{C as et}from"./chevron-left-DtqKiCWt.js";import"./WordByWordIcon-DVCEgjFe.js";import"./tamilWordByWordService-D59vW24j.js";import"./apiService-BNSE2PAx.js";import"./hindiWordByWordService-DuSzT-zx.js";import"./banglaWordByWordService-jkoVAi6c.js";import"./banglaTranslationService-Gk_2fEMr.js";import"./Toast-DEJQjF_w.js";import"./tamilTranslationService-CeJD2Ahs.js";import"./hindiTranslationService-D1cRr0-9.js";import"./urduTranslationService-B9Qr6ZwY.js";import"./englishTranslationService-nTKVISbi.js";import"./surahNameUtils-CZ7_rci5.js";const vt=()=>{const[b,E]=l.useState(!1),[T,N]=l.useState({id:"",content:""}),[j,B]=l.useState(!1),[v,M]=l.useState({surahId:null,verseId:null}),[F,$]=l.useState(!1),[C,L]=l.useState(null),[A,R]=l.useState([]),[k,H]=l.useState(6),[S,O]=l.useState("3"),[w,U]=l.useState(1),[I,_]=l.useState("en"),{quranFont:rt}=z(),g=l.useRef(null);Q();const u=V(),[y]=Y();l.useEffect(()=>{(async()=>{try{$(!0),L(null);const t=u.surahId?parseInt(u.surahId):parseInt(y.get("surahId"))||k,a=u.range||y.get("range")||S,o=u.ipt?parseInt(u.ipt):parseInt(y.get("ipt"))||w,m=u.lang||y.get("lang")||I;H(t),O(a),U(o),_(m);const r=/^\d+$/.test(a)?await K(t,parseInt(a,10),o,m):await X(t,a,o,m),c=Array.isArray(r)?r:[r];R(c)}catch(t){L(t.message||"Failed to load interpretation")}finally{$(!1)}})()},[u,y]);const x=async s=>{N({id:s,content:"Loading..."}),E(!0);try{const t=await G(s),a=t?.NoteText||t?.note_text||t?.content||t?.html||t?.text||t?.body||t?.description||t?.note||(typeof t=="string"?t:null);N(a&&a!=="Note content not available"?{id:s,content:a}:{id:s,content:'<p style="color: #666;">Note content is not available.</p>'})}catch(t){console.error("Error fetching note:",t),N({id:s,content:`
          <div class="note-content">
            <h3 style="color: #2AA0BF; margin-bottom: 10px;">Note ${s}</h3>
            <p style="color: #666;">Note content is temporarily unavailable. Please try again later.</p>
            <p style="color: #999; font-size: 0.9em; margin-top: 10px;">Error: ${t.message||"Unknown error"}</p>
          </div>
        `})}},q=s=>{const t=s.target;if(!(t.classList.contains("note-highlight")||t.closest(".note-highlight")||t.closest("sup")||t.closest("a")))return;const o=t.classList.contains("note-highlight")?t:t.closest(".note-highlight"),m=t.closest("sup"),e=t.closest("a"),r=o?.getAttribute("data-note-id")||m?.getAttribute("data-note-id")||e?.getAttribute("data-note-id")||t.getAttribute("data-note-id");if(r){x(r);return}const c=(o?.innerText||m?.innerText||e?.innerText||t.innerText||"").trim();if(!c)return;const h=c.match(/(\d+,\d+)?B(\d+)/i)||c.match(/B(\d+)/i);if(h){const i=`B${h[2]||h[1]}`;x(i);return}const p=c.match(/N(\d+)/i);if(p){const i=`N${p[1]}`;x(i);return}const f=c.match(/^\(?(\d+)\s*[:：]\s*(\d+)\)?$/);if(f){const[,i,d]=f;M({surahId:parseInt(i,10),verseId:parseInt(d,10)}),B(!0);return}x(c)},P=()=>{if(!g.current)return;g.current.querySelectorAll(".note-highlight").forEach(e=>{const r=e.parentNode;r.replaceChild(document.createTextNode(e.textContent),e),r.normalize()});const t=[],a=document.createTreeWalker(g.current,NodeFilter.SHOW_TEXT,null,!1);let o;for(;o=a.nextNode();)o.parentElement&&!o.parentElement.classList.contains("note-highlight")&&!o.parentElement.closest(".note-highlight")&&o.textContent.trim()&&t.push(o);t.forEach(e=>{let r=e.textContent;const c=e.parentElement;if(!r||r.trim().length===0)return;let h=!1,p=r;if(p=r.replace(/(B\d+)/gi,(i,d)=>(h=!0,`<span class="note-highlight" data-note-id="${d.toUpperCase()}" style="color: #2AA0BF !important; text-decoration: none !important; cursor: pointer !important; font-weight: 600 !important;">${d}</span>`)),!h||p===r){const i=/N\d+/g;i.test(r)&&(p=r.replace(i,d=>`<span class="note-highlight" data-note-id="${d.toUpperCase()}" style="color: #2AA0BF !important; text-decoration: none !important; cursor: pointer !important; font-weight: 600 !important;">${d}</span>`))}else p=p.replace(/N\d+/g,i=>`<span class="note-highlight" data-note-id="${i.toUpperCase()}" style="color: #2AA0BF !important; text-decoration: none !important; cursor: pointer !important; font-weight: 600 !important;">${i}</span>`);const f=/\(?(\d+)\s*[:：]\s*(\d+)\)?/g;if(f.test(r)&&p===r&&(p=r.replace(f,i=>`<span class="verse-highlight" style="color: #059669 !important; cursor: pointer !important; font-weight: 600 !important;">${i}</span>`)),p!==r){const i=document.createElement("div");i.innerHTML=p;const d=document.createDocumentFragment();for(;i.firstChild;)d.appendChild(i.firstChild);c.replaceChild(d,e)}}),g.current.querySelectorAll("sup, a").forEach(e=>{const r=(e.innerText||"").trim();if(/^N\d+$/.test(r)){e.style.setProperty("color","#2AA0BF","important"),e.style.setProperty("text-decoration","none","important"),e.style.setProperty("cursor","pointer","important"),e.style.setProperty("font-weight","600","important"),e.setAttribute("data-note-id",r.toUpperCase());return}const c=r.match(/(B\d+)/i);if(c){const h=c[1].toUpperCase();e.style.setProperty("color","#2AA0BF","important"),e.style.setProperty("text-decoration","none","important"),e.style.setProperty("cursor","pointer","important"),e.style.setProperty("font-weight","600","important"),e.setAttribute("data-note-id",h);return}if(/^\(?\d+\s*[:：]\s*\d+\)?$/.test(r)){e.style.setProperty("color","#2AA0BF","important"),e.style.setProperty("text-decoration","none","important"),e.style.setProperty("cursor","pointer","important"),e.style.setProperty("font-weight","600","important");return}/^\d+\s+\d+:\d+$/.test(r)&&(e.style.setProperty("color","#2AA0BF","important"),e.style.setProperty("text-decoration","none","important"),e.style.setProperty("cursor","pointer","important"),e.style.setProperty("font-weight","600","important"))})};l.useEffect(()=>{P()},[A]),l.useEffect(()=>{!b&&!j&&setTimeout(P,100)},[b,j]),l.useEffect(()=>{if(!g.current)return;const s=new MutationObserver(t=>{let a=!1;t.forEach(o=>{(o.type==="childList"||o.type==="attributes")&&(a=!0)}),a&&setTimeout(P,50)});return s.observe(g.current,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["class","style"]}),()=>s.disconnect()},[A]);const W=s=>{if(s==null)return"";if(typeof s=="string")return s;const t=["interpret_text","interpretation","text","content","meaning","body","desc","description"];for(const a of t)if(typeof s[a]=="string"&&s[a].trim().length>0)return s[a];for(const[a,o]of Object.entries(s))if(typeof o=="string"&&o.trim().length>20)return o;try{return JSON.stringify(s)}catch{return String(s)}};return n.jsxs(n.Fragment,{children:[n.jsx("style",{children:`
               .note-highlight {
                 color: #2AA0BF !important;
                 text-decoration: none !important;
                 cursor: pointer !important;
                 font-weight: 600 !important;
               }
               sup.note-highlight, a.note-highlight {
                 color: #2AA0BF !important;
                 text-decoration: none !important;
                 cursor: pointer !important;
                 font-weight: 600 !important;
               }
             `}),n.jsx(Z,{interpretationNumber:w,surahName:`${k}- Surah`,verseRange:S.replace(/-/g," - "),language:I,onWordByWord:()=>{}}),n.jsx("div",{className:"w-full  mx-auto p-3 sm:p-4 lg:p-6 bg-white dark:bg-[#2A2C38] max-w-[1073px] ",children:n.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-4 text-sm text-gray-600 dark:text-gray-300",children:[n.jsxs("span",{children:["Surah: ",k]}),n.jsxs("span",{children:["• Range: ",S]}),n.jsxs("span",{children:["• Interpretation: ",w]}),n.jsxs("span",{children:["• Lang: ",I]}),n.jsx("button",{onClick:()=>x("N189"),className:"ml-4 px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600",children:"Test Note N189"})]}),F&&n.jsx("div",{className:"text-center py-8 text-gray-600 dark:text-gray-300",children:"Loading interpretation…"}),C&&n.jsx("div",{className:"text-red-600 dark:text-red-400 py-4",children:C}),!F&&!C&&A.length===0&&n.jsx("div",{className:"text-center py-10 text-gray-600 dark:text-gray-300",children:"No interpretation found for this selection."}),A.map((s,t)=>n.jsx("div",{className:"bg-gray-50 dark:bg-[#2A2C38] p-3 sm:p-4 lg:p-6 rounded-lg border-l-4 dark:border-[#2A2C38] border-white",children:n.jsx("div",{className:"text-gray-800 dark:text-white leading-relaxed text-justify space-y-3 sm:space-y-4 prose prose-sm dark:prose-invert max-w-none",ref:g,onClick:q,style:{fontFamily:"serif"},dangerouslySetInnerHTML:{__html:W(s)}})},t)),n.jsxs("div",{className:" bottom-0 left-0 w-full flex justify-between gap-3 sm:gap-0 p-3 sm:p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-[#2A2C38] z-50",children:[n.jsxs("button",{className:`flex items-center justify-center sm:justify-start space-x-2 px-3 sm:px-4 py-2 rounded-lg border transition-colors group min-h-[44px] 
    text-gray-600 dark:text-white hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 border-gray-300 dark:border-gray-500`,children:[n.jsx(et,{className:"w-3 h-3 sm:w-4 sm:h-4 group-hover:-translate-x-1 transition-transform"}),n.jsx("span",{className:"text-xs sm:text-sm font-medium",children:"Previous Ayah"})]}),n.jsxs("button",{className:`flex items-center justify-center sm:justify-start space-x-2 px-3 sm:px-4 py-2 rounded-lg border transition-colors group min-h-[44px] 
    text-gray-600 dark:text-white hover:text-gray-800 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 border-gray-300 dark:border-gray-500`,children:[n.jsx("span",{className:"text-xs sm:text-sm font-medium",children:"Next Ayah"}),n.jsx(D,{className:"w-3 h-3 sm:w-4 sm:h-4 group-hover:translate-x-1 transition-transform"})]})]})]})}),b&&n.jsx(J,{isOpen:b,onClose:()=>E(!1),noteId:T.id,noteContent:T.content}),j&&v.surahId&&v.verseId&&n.jsx(tt,{surahId:v.surahId,verseId:v.verseId,onClose:()=>B(!1),interpretationNo:w,language:I})]})};export{vt as default};
