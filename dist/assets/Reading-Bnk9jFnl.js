const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StickyAudioPlayer-BDOdD66p.js","assets/index-DJ-cZXxg.js","assets/index-CbSABgOk.css","assets/volume-x-D_FITz3q.js","assets/volume-2-D1G5zOnx.js","assets/skip-forward-DJVfF0SL.js"])))=>i.map(i=>d[i]);
import{d as Ee,r as s,a as Ce,g as Ae,u as re,j as e,p as ae,t as Ie,f as Pe,v as Re,x as Te,_ as Fe}from"./index-DJ-cZXxg.js";import{D as $e,B as Le,V as _e,C as Ve,A as H}from"./LoadingSkeleton-CD7w7PgG.js";import{u as Be,T as De}from"./Toast-BlmkPTxW.js";import{s as qe}from"./readingProgressService-DFoY0i0J.js";import{g as Qe,s as Ue}from"./surahNameUtils-CNmXwDjY.js";import{C as se}from"./chevron-left-wLnkTCVt.js";import"./surahNameUnicodes-C_pntk6C.js";const He=s.lazy(()=>Fe(()=>import("./StickyAudioPlayer-BDOdD66p.js"),__vite__mapDeps([0,1,2,3,4,5]))),Me={"al-afasy":"QA","al-ghamidi":"QG","al-hudaify":"QH"},at=()=>{const{surahId:o}=Ee();s.useEffect(()=>{o&&qe({surahId:o,viewType:"reading",path:`/reading/${o}`})},[o]);const M=Ce(),{user:$}=Ae(),{toasts:ne,removeToast:oe,showSuccess:W,showError:z}=Be(),[h,L]=s.useState([]),[k,le]=s.useState(null),[O,_]=s.useState(!0),[ie,j]=s.useState(!1),[V,B]=s.useState(null),[Y,ce]=s.useState([]),[We,D]=s.useState(0),I=50,[P,de]=s.useState("al-afasy"),[q,ue]=s.useState(["quran"]),[R,he]=s.useState(1),[me,T]=s.useState(0),[N,d]=s.useState(!1),[y,E]=s.useState(null),[n,C]=s.useState(null),[x,F]=s.useState(0),m=s.useRef(null),f=s.useRef(null),[ge,Z]=s.useState(!1),[ze,G]=s.useState(!1),[Oe,Ye]=s.useState(!1),{translationLanguage:xe}=re(),fe=(t,r,a,i,c)=>{const u=String(t).padStart(3,"0"),l=String(r).padStart(3,"0");let p;return a==="quran"?p=`https://old.thafheem.net/audio/qirath/${i}/${c}${u}_${l}.ogg`:a==="translation"?p=`https://old.thafheem.net/audio/translation/T${u}_${l}.ogg`:a==="interpretation"&&(p=`https://old.thafheem.net/audio/interpretation/I${u}_${l}.ogg`),p},b=(t,r=0,a=null)=>{const i=a||q;if(t>=h.length){d(!1),E(null),F(0),T(0),C(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}));return}if(r>=i.length){b(t+1,0,a);return}n&&(n.pause(),n.currentTime=0,n.onended=null,n.onerror=null);const c=parseInt(o)||2,u=Me[P];h[t];const l=t+1,p=i[r],w=fe(c,l,p,P,u),g=new Audio(w);g.preload="none",g.playbackRate=R,C(g),m.current=g,E(l),F(t),T(r),g.onended=()=>{m.current===g&&b(t,r+1,a)},g.onerror=S=>{console.error("Audio playback error:",S),console.error("Failed URL:",w),m.current===g&&b(t,r+1,a)},g.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(S=>{if(S.name!=="AbortError"){if(console.error("Error playing audio:",S),console.error("Audio URL that failed:",w),S.name==="NotSupportedError"||S.message.includes("CORS")){console.error("CORS error - audio server does not allow cross-origin requests"),setTimeout(()=>{b(t,r+1,a)},1e3);return}b(t,r+1,a)}})},v=(t,r=0)=>{b(t,r,null)},A=()=>{n&&(n.pause(),n.currentTime=0),d(!1),E(null),F(0),T(0),C(null),m.current=null,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))},pe=t=>{const r=parseInt(t)-1;r>=0&&r<h.length?(n&&(n.pause(),n.currentTime=0,n.onended=null,n.onerror=null),C(null),m.current=null,setTimeout(()=>{E(parseInt(t)),F(r),T(0),d(!0),v(r,0)},100)):(console.error(`Invalid ayah index: ${r} for verse number ${t}`),console.error(`Valid range: 1 to ${h.length}`))},J=()=>{try{N?(n&&n.pause(),d(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))):(x>0||y?(d(!0),v(x,me)):(d(!0),v(0,0)),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}})))}catch(t){console.error("Error playing audio:",t),d(!1),E(null),C(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},Q=s.useRef(null);Q.current=J,s.useEffect(()=>{const t=()=>{Q.current&&Q.current()};return window.addEventListener("playAudio",t),()=>{window.removeEventListener("playAudio",t)}},[]),s.useEffect(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:N}}))},[N]),s.useEffect(()=>{const t=r=>{const{type:a,message:i}=r.detail;a==="success"?W(i):a==="error"&&z(i)};return window.addEventListener("showToast",t),()=>{window.removeEventListener("showToast",t)}},[W,z]),s.useEffect(()=>{N&&n&&A()},[P,q]),s.useEffect(()=>{n&&(n.playbackRate=R)},[n,R]),s.useEffect(()=>()=>{f.current&&(f.current.pause(),f.current.src="",f.current.currentTime=0,f.current.onended=null,f.current.onerror=null,f.current=null),m.current&&(m.current.pause(),m.current.src="",m.current.currentTime=0,m.current=null)},[]),s.useEffect(()=>{f.current=n},[n]),s.useEffect(()=>()=>{n&&A()},[o]),s.useEffect(()=>{(async()=>{try{_(!0),B(null),L([]),D(0);const r=o||2,[a,i]=await Promise.all([Ie(),Pe()]),c=i.filter(l=>l.SuraId===parseInt(r)),u=a.find(l=>l.number===parseInt(r));le(u),ce(c),_(!1),j(!0);try{const l=await Re(r),p=l.slice(0,I);if(L(p),D(I),l.length>I){const w=()=>{const g=l.slice(I);L(l),D(l.length),j(!1)};window.requestIdleCallback?window.requestIdleCallback(w,{timeout:1e3}):setTimeout(w,100)}else j(!1)}catch(l){console.error("Error loading verses:",l),B(l.message),j(!1)}}catch(r){console.error("Error fetching surah data:",r),B(r.message),_(!1),j(!1)}})()},[o]),s.useEffect(()=>{(async()=>{if(!$||!o){G(!1);return}try{const r=await Te.isFavorited($.uid,o);G(r)}catch(r){console.error("Error loading favorite status:",r)}})()},[$,o]);const ye=t=>{const r=Y.find(a=>t>=a.ayafrom&&t<=a.ayato);return r?r.PageId:null},be=()=>{const t=[];let r=null,a=[];return h.forEach((i,c)=>{const u=i.verse_number||c+1,l=ye(u);l!==r?(a.length>0&&t.push({pageNumber:r,verses:a,startVerse:a[0].verse_number,endVerse:a[a.length-1].verse_number}),r=l,a=[{...i,verse_number:u}]):a.push({...i,verse_number:u})}),a.length>0&&t.push({pageNumber:r,verses:a,startVerse:a[0].verse_number,endVerse:a[a.length-1].verse_number}),t},K=()=>{const r=(parseInt(o)||2)-1;r>=1&&M(`/reading/${r}`)},X=()=>{const r=(parseInt(o)||2)+1;r<=114&&M(`/reading/${r}`)},U=()=>{window.scrollTo({top:0,behavior:"smooth"})};s.useEffect(()=>{const t=()=>{window.scrollY>300?Z(!0):Z(!1)};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[]);const ve=t=>{const r=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];return t.replace(/\d/g,a=>r[a])},{quranFont:we,theme:Se}=re(),ke=s.useMemo(()=>be(),[h,Y]),ee=k?.arabic||(o?`Surah ${o}`:"Surah"),je=Qe(o,ee),te=o?String(o):"",Ne=te==="1"||te==="2"?"font-normal":"font-semibold";return e.jsxs(e.Fragment,{children:[e.jsx(De,{toasts:ne,removeToast:oe}),e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"px-3 sm:px-4 lg:px-6 pt-6 sm:pt-8 pb-2 dark:bg-gray-900",children:e.jsx("div",{className:"max-w-4xl mx-auto text-center",children:e.jsxs("div",{className:"mb-4 sm:mb-5",children:[e.jsx("h1",{className:`text-4xl sm:text-5xl font-arabic dark:text-white text-gray-900 mb-6 sm:mb-8 ${Ne}`,style:{fontFamily:Ue},"aria-label":ee,children:je}),k?.number!==1&&k?.number!==9&&e.jsx("div",{className:"mb-3 sm:mb-4",children:e.jsx("p",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-arabic dark:text-white text-gray-800 leading-relaxed px-2",children:e.jsx("img",{src:Se==="dark"?$e:Le,alt:"Bismillah",className:"w-auto h-8 sm:h-10 lg:h-12 xl:h-14 mx-auto"})})})]})})}),e.jsxs("div",{className:"max-w-xs sm:max-w-2xl lg:max-w-4xl mx-auto px-3 sm:px-4 py-4 sm:py-6",children:[O&&e.jsx(_e,{count:5}),V&&e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("p",{className:"text-red-600 dark:text-red-400",children:["Error loading verses: ",V]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Retry"})]}),!O&&!V&&h.length>0&&e.jsxs("div",{children:[ie&&e.jsx("div",{className:"text-center py-4 mb-4",children:e.jsx(Ve,{message:"Loading remaining verses..."})}),ke.map((t,r)=>e.jsx("div",{className:"",children:e.jsx("div",{className:"dark:bg-gray-900 rounded-lg p-3 sm:p-4 lg:p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{style:{fontFamily:`'${we}', serif`,textAlign:"justify",textAlignLast:"right",wordSpacing:"0.1em",letterSpacing:"0.02em",lineHeight:2.3,fontSize:"24px"},className:"font-arabic text-gray-900 dark:text-white",dir:"rtl",children:t.verses.map((a,i)=>{const c=t.startVerse+i;return e.jsxs("span",{onClick:()=>pe(c),className:`inline transition-all duration-300 cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/40 rounded px-2 ${y===c?"bg-blue-100 dark:bg-blue-900":""}`,title:`Click to play ayah ${c}`,children:[a.text_uthmani," ﴿",ve(c.toString()),"﴾",i<t.verses.length-1&&"   "]},a.id||`verse-${c}`)})}),t.pageNumber&&e.jsx("div",{className:"flex items-center justify-center my-6 relative",children:e.jsx("div",{className:"w-full  border-b border-gray-300 dark:border-gray-600 py-2 text-center",children:e.jsx("span",{className:"px-4 bg-white dark:bg-gray-900 text-gray-600 dark:text-gray-300 font-semibold",children:t.pageNumber})})})]})})},r)),h.length>0&&k&&e.jsx("div",{className:"mt-8 mb-4",children:e.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 text-sm mt-4"})})]})]}),e.jsxs("div",{className:"bg-white border-t dark:bg-gray-900 border-gray-200 dark:border-gray-700 px-3 sm:px-4 py-3 sm:py-4 mt-6 sm:mt-8",children:[e.jsxs("div",{className:"sm:hidden space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:K,disabled:parseInt(o)<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg w-[173.96px] min-h-[44px]
                           disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx(se,{className:"w-3 h-3"}),e.jsx("span",{children:"Previous Surah"})]}),e.jsxs("button",{onClick:U,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]`,children:[e.jsx(H,{className:"w-3 h-3"}),e.jsx("span",{children:"Beginning of Surah"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:X,disabled:parseInt(o)>=114,className:`w-[173.96px] flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]
                           disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("span",{children:"Next Surah"}),e.jsx(ae,{className:"w-3 h-3"})]})})]}),e.jsxs("div",{className:"hidden sm:flex max-w-4xl mx-auto items-center justify-center space-x-4 lg:space-x-6",children:[e.jsxs("button",{onClick:K,disabled:parseInt(o)<=1,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg
                         disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx(se,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{children:"Previous Surah"})]}),e.jsxs("button",{onClick:U,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg`,children:[e.jsx(H,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{children:"Beginning of Surah"})]}),e.jsxs("button",{onClick:X,disabled:parseInt(o)>=114,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg
                         disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("span",{children:"Next Surah"}),e.jsx(ae,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]}),ge&&e.jsx("button",{onClick:U,className:`fixed right-6 z-[60] bg-cyan-500 hover:bg-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center ${y?"bottom-32 sm:bottom-36":"bottom-6"}`,title:"Beginning of Surah","aria-label":"Beginning of Surah",children:e.jsx(H,{className:"w-6 h-6"})}),y&&e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"fixed bottom-0 left-0 right-0 h-20 bg-gray-100 dark:bg-gray-800 animate-pulse"}),children:e.jsx(He,{audioElement:n,isPlaying:N,currentAyah:y,totalAyahs:h.length,surahInfo:k,onPlayPause:J,onStop:A,onSkipBack:()=>{x>0&&(d(!0),v(x-1,0))},onSkipForward:()=>{x<h.length-1&&(d(!0),v(x+1,0))},onClose:null,selectedQari:P,onQariChange:t=>{de(t),y&&(A(),setTimeout(()=>{x>=0&&(d(!0),v(x))},100))},translationLanguage:xe,audioTypes:q,onAudioTypesChange:t=>{const r=x;ue(t),y&&r>=0&&(A(),setTimeout(()=>{d(!0),b(r,0,t)},100))},playbackSpeed:R,onPlaybackSpeedChange:t=>{he(t)}})})]})]})};export{at as default};
