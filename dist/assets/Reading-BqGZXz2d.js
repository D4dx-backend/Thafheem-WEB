const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StickyAudioPlayer-DRRhBZ5E.js","assets/index-DmadXW_T.js","assets/react-vendor-v5ei6ytj.js","assets/index-20yl2_WL.css","assets/volume-x-DAJKYzCy.js","assets/skip-forward-M3Ahlipj.js"])))=>i.map(i=>d[i]);
import{m as Fe,u as $e,i as ce,j as r,q as de,t as _e,f as Te,n as ue,w as Be,_ as Ve,e as Ue,h as qe}from"./index-DmadXW_T.js";import{d as De,b as s,u as Qe}from"./react-vendor-v5ei6ytj.js";import{D as Me,B as ze,V as He,C as We,A as O}from"./LoadingSkeleton-BE1LZfF_.js";import{u as Oe,T as Ye}from"./Toast-8dnuOEuu.js";import{g as Ze,s as Ge}from"./surahNameUtils-DQZqK-eJ.js";import{C as he}from"./chevron-left-DAZqGN25.js";const Je=s.lazy(()=>Ve(()=>import("./StickyAudioPlayer-DRRhBZ5E.js"),__vite__mapDeps([0,1,2,3,4,5]))),Ke={"al-afasy":"QA","al-ghamidi":"QG","al-hudaify":"QH"},dt=()=>{const{surahId:o}=De();s.useEffect(()=>{o&&Fe({surahId:o,viewType:"reading",path:`/reading/${o}`})},[o]);const Y=Qe(),{user:_}=$e(),{toasts:ge,removeToast:me,showSuccess:Z,showError:G}=Oe(),[m,T]=s.useState([]),[N,xe]=s.useState(null),[J,B]=s.useState(!0),[fe,C]=s.useState(!1),[V,U]=s.useState(null),[K,pe]=s.useState([]),[Xe,q]=s.useState(0),X=50,[b,ee]=s.useState(()=>localStorage.getItem("reciter")||"al-afasy"),[D,ye]=s.useState(["quran"]),[f,te]=s.useState(()=>{const e=localStorage.getItem("playbackSpeed");return e?parseFloat(e):1}),[be,F]=s.useState(0),[A,h]=s.useState(!1),[k,E]=s.useState(null),[n,I]=s.useState(null),[v,$]=s.useState(0),x=s.useRef(null),S=s.useRef(null),[ve,re]=s.useState(!1),[et,ae]=s.useState(!1),[tt,rt]=s.useState(!1),{translationLanguage:Q}=ce(),we=async(e,t,a,c,g)=>{const y=String(e).padStart(3,"0"),i=String(t).padStart(3,"0");let w;if(a==="quran")w=`https://old.thafheem.net/audio/qirath/${c}/${g}${y}_${i}.ogg`;else if(a==="translation"){if(Q==="ur"){const u=await Ue(e,t);return u||null}w=`https://old.thafheem.net/audio/translation/T${y}_${i}.ogg`}else if(a==="interpretation"){if(Q==="ur"){const u=await qe(e,t);return u||null}w=`https://old.thafheem.net/audio/interpretation/I${y}_${i}.ogg`}return w},p=async(e,t=0,a=null)=>{const c=a||D;if(e>=m.length){h(!1),E(null),$(0),F(0),I(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}));return}if(t>=c.length){p(e+1,0,a);return}n&&(n.pause(),n.currentTime=0,n.onended=null,n.onerror=null);const g=parseInt(o)||2,y=Ke[b];m[e];const i=e+1,w=c[t];let u;try{u=await we(g,i,w,b,y)}catch(d){console.error("[Reading] Error generating audio URL:",d),t<c.length-1?p(e,t+1,a):e<m.length-1?p(e+1,0,a):(h(!1),E(null));return}if(!u){t<c.length-1?p(e,t+1,a):e<m.length-1?p(e+1,0,a):(h(!1),E(null));return}const l=new Audio(u);l.preload="none",l.playbackRate=f;const L=()=>{l&&x.current===l&&(l.playbackRate=f),l.removeEventListener("loadedmetadata",L)};l.addEventListener("loadedmetadata",L,{once:!0});const P=()=>{l&&x.current===l&&(l.playbackRate=f),l.removeEventListener("canplay",P)};l.addEventListener("canplay",P,{once:!0}),I(l),x.current=l,E(i),$(e),F(t),l.onended=()=>{x.current===l&&p(e,t+1,a)},l.onerror=d=>{console.error("Audio playback error:",d),console.error("Failed URL:",u),x.current===l&&p(e,t+1,a)},l.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(d=>{if(d.name!=="AbortError"){if(console.error("Error playing audio:",d),console.error("Audio URL that failed:",u),d.name==="NotSupportedError"||d.message.includes("CORS")){console.error("CORS error - audio server does not allow cross-origin requests"),setTimeout(()=>{p(e,t+1,a)},1e3);return}p(e,t+1,a)}})},j=(e,t=0)=>{p(e,t,null)},R=()=>{n&&(n.pause(),n.currentTime=0),h(!1),E(null),$(0),F(0),I(null),x.current=null,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))},Se=e=>{const t=parseInt(e)-1;t>=0&&t<m.length?(n&&(n.pause(),n.currentTime=0,n.onended=null,n.onerror=null),I(null),x.current=null,setTimeout(()=>{E(parseInt(e)),$(t),F(0),h(!0),j(t,0)},100)):(console.error(`Invalid ayah index: ${t} for verse number ${e}`),console.error(`Valid range: 1 to ${m.length}`))},se=()=>{try{A?(n&&n.pause(),h(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))):(v>0||k?(h(!0),j(v,be)):(h(!0),j(0,0)),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}})))}catch(e){console.error("Error playing audio:",e),h(!1),E(null),I(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},M=s.useRef(null);M.current=se,s.useEffect(()=>{const e=()=>{M.current&&M.current()};return window.addEventListener("playAudio",e),()=>{window.removeEventListener("playAudio",e)}},[]),s.useEffect(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:A}}))},[A]),s.useEffect(()=>{const e=t=>{const{type:a,message:c}=t.detail;a==="success"?Z(c):a==="error"&&G(c)};return window.addEventListener("showToast",e),()=>{window.removeEventListener("showToast",e)}},[Z,G]),s.useEffect(()=>{localStorage.setItem("reciter",b),window.dispatchEvent(new CustomEvent("reciterChange",{detail:{reciter:b}}))},[b]),s.useEffect(()=>{const e=t=>{const a=t.detail.reciter;a!==b&&ee(a)};return window.addEventListener("reciterChange",e),()=>{window.removeEventListener("reciterChange",e)}},[b]),s.useEffect(()=>{A&&n&&R()},[b,D]),s.useEffect(()=>{localStorage.setItem("playbackSpeed",f.toString()),window.dispatchEvent(new CustomEvent("playbackSpeedChange",{detail:{playbackSpeed:f}}))},[f]),s.useEffect(()=>{const e=t=>{const a=t.detail.playbackSpeed;a!==f&&te(a)};return window.addEventListener("playbackSpeedChange",e),()=>{window.removeEventListener("playbackSpeedChange",e)}},[f]),s.useEffect(()=>{n&&(n.playbackRate=f)},[n,f]),s.useEffect(()=>()=>{S.current&&(S.current.pause(),S.current.src="",S.current.currentTime=0,S.current.onended=null,S.current.onerror=null,S.current=null),x.current&&(x.current.pause(),x.current.src="",x.current.currentTime=0,x.current=null)},[]),s.useEffect(()=>{S.current=n},[n]),s.useEffect(()=>()=>{n&&R()},[o]),s.useEffect(()=>{(async()=>{try{B(!0),U(null),T([]),q(0);const t=o||2,[a,c]=await Promise.all([_e(),Te()]),g=c.filter(i=>i.SuraId===parseInt(t)),y=a.find(i=>i.number===parseInt(t));xe(y),pe(g),B(!1),C(!0);try{const i=await ue(t,{page:1,limit:X}),w=Array.isArray(i?.verses)?i.verses:Array.isArray(i)?i:[];T(w),q(w.length);const u=i?.pagination||null;if(u?.hasNext){const l=async()=>{let L=(u.page||1)+1,P=u.hasNext;for(;P;)try{const d=await ue(t,{page:L,limit:X}),H=Array.isArray(d?.verses)?d.verses:Array.isArray(d)?d:[];H.length>0&&(T(W=>[...W,...H]),q(W=>W+H.length)),P=d?.pagination?.hasNext,L+=1}catch(d){console.error("Error loading additional verses:",d);break}C(!1)};window.requestIdleCallback?window.requestIdleCallback(l,{timeout:1e3}):setTimeout(l,100)}else C(!1)}catch(i){console.error("Error loading verses:",i),U(i.message),C(!1)}}catch(t){console.error("Error fetching surah data:",t),U(t.message),B(!1),C(!1)}})()},[o]),s.useEffect(()=>{(async()=>{if(!_||!o){ae(!1);return}try{const t=await Be.isFavorited(_.uid,o);ae(t)}catch(t){console.error("Error loading favorite status:",t)}})()},[_,o]);const ke=e=>{const t=K.find(a=>e>=a.ayafrom&&e<=a.ayato);return t?t.PageId:null},Ee=()=>{const e=[];let t=null,a=[];return m.forEach((c,g)=>{const y=c.verse_number||g+1,i=ke(y);i!==t?(a.length>0&&e.push({pageNumber:t,verses:a,startVerse:a[0].verse_number,endVerse:a[a.length-1].verse_number}),t=i,a=[{...c,verse_number:y}]):a.push({...c,verse_number:y})}),a.length>0&&e.push({pageNumber:t,verses:a,startVerse:a[0].verse_number,endVerse:a[a.length-1].verse_number}),e},ne=()=>{const t=(parseInt(o)||2)-1;t>=1&&Y(`/reading/${t}`)},oe=()=>{const t=(parseInt(o)||2)+1;t<=114&&Y(`/reading/${t}`)},z=()=>{window.scrollTo({top:0,behavior:"smooth"})};s.useEffect(()=>{const e=()=>{window.scrollY>300?re(!0):re(!1)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const je=e=>{const t=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];return e.replace(/\d/g,a=>t[a])},Ne=e=>e?e.replace(/\s*﴿\s*[\d\u0660-\u0669]+\s*﴾\s*$/u,"").trim():"",{quranFont:Ce,theme:Ae,fontSize:Ie}=ce(),Re=s.useMemo(()=>Ee(),[m,K]),ie=N?.arabic||(o?`Surah ${o}`:"Surah"),Le=Ze(o,ie),le=o?String(o):"",Pe=le==="1"||le==="2"?"font-normal":"font-semibold";return r.jsxs(r.Fragment,{children:[r.jsx(Ye,{toasts:ge,removeToast:me}),r.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[r.jsx("div",{className:"px-3 sm:px-4 lg:px-6 pt-6 sm:pt-8 pb-2 dark:bg-gray-900",children:r.jsx("div",{className:"max-w-4xl mx-auto text-center",children:r.jsxs("div",{className:"mb-4 sm:mb-5",children:[r.jsx("h1",{className:`text-4xl sm:text-5xl font-arabic dark:text-white text-gray-900 mb-6 sm:mb-8 ${Pe}`,style:{fontFamily:Ge},"aria-label":ie,children:Le}),N?.number!==1&&N?.number!==9&&r.jsx("div",{className:"mb-3 sm:mb-4",children:r.jsx("p",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-arabic dark:text-white text-gray-800 leading-relaxed px-2",children:r.jsx("img",{src:Ae==="dark"?Me:ze,alt:"Bismillah",className:"w-auto h-8 sm:h-10 lg:h-12 xl:h-14 mx-auto"})})})]})})}),r.jsxs("div",{className:"max-w-xs sm:max-w-2xl lg:max-w-4xl mx-auto px-3 sm:px-4 py-4 sm:py-6",children:[J&&r.jsx(He,{count:5}),V&&r.jsxs("div",{className:"text-center py-8",children:[r.jsxs("p",{className:"text-red-600 dark:text-red-400",children:["Error loading verses: ",V]}),r.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Retry"})]}),!J&&!V&&m.length>0&&r.jsxs("div",{children:[fe&&r.jsx("div",{className:"text-center py-4 mb-4",children:r.jsx(We,{message:"Loading remaining verses..."})}),Re.map((e,t)=>r.jsx("div",{className:"",children:r.jsx("div",{className:"dark:bg-gray-900 rounded-lg p-3 sm:p-4 lg:p-3",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{style:{fontFamily:`'${Ce}', serif`,textAlign:"justify",textAlignLast:"right",wordSpacing:"0.1em",letterSpacing:"0.02em",lineHeight:2.3,fontSize:`${Ie}px`},className:"font-arabic text-gray-900 dark:text-white",dir:"rtl",children:e.verses.map((a,c)=>{const g=e.startVerse+c;return r.jsxs("span",{onClick:()=>Se(g),className:`inline transition-all duration-300 cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/40 rounded px-2 ${k===g?"bg-blue-100 dark:bg-blue-900":""}`,title:`Click to play ayah ${g}`,children:[Ne(a.text_uthmani)||a.text_uthmani||""," ﴿",je(g.toString()),"﴾",c<e.verses.length-1&&"   "]},a.id||`verse-${g}`)})}),e.pageNumber&&r.jsx("div",{className:"flex items-center justify-center my-6 relative",children:r.jsx("div",{className:"w-full  border-b border-gray-300 dark:border-gray-600 py-2 text-center",children:r.jsx("span",{className:"px-4 bg-white dark:bg-gray-900 text-gray-600 dark:text-gray-300 font-semibold",children:e.pageNumber})})})]})})},t)),m.length>0&&N&&r.jsx("div",{className:"mt-8 mb-4",children:r.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 text-sm mt-4"})})]})]}),r.jsxs("div",{className:"bg-white border-t dark:bg-gray-900 border-gray-200 dark:border-gray-700 px-3 sm:px-4 py-3 sm:py-4 mt-6 sm:mt-8",children:[r.jsxs("div",{className:"sm:hidden space-y-2",children:[r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs("button",{onClick:ne,disabled:parseInt(o)<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg w-[173.96px] min-h-[44px]
                           disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx(he,{className:"w-3 h-3"}),r.jsx("span",{children:"Previous Surah"})]}),r.jsxs("button",{onClick:z,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]`,children:[r.jsx(O,{className:"w-3 h-3"}),r.jsx("span",{children:"Beginning of Surah"})]})]}),r.jsx("div",{className:"flex justify-center",children:r.jsxs("button",{onClick:oe,disabled:parseInt(o)>=114,className:`w-[173.96px] flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]
                           disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx("span",{children:"Next Surah"}),r.jsx(de,{className:"w-3 h-3"})]})})]}),r.jsxs("div",{className:"hidden sm:flex max-w-4xl mx-auto items-center justify-center space-x-4 lg:space-x-6",children:[r.jsxs("button",{onClick:ne,disabled:parseInt(o)<=1,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg
                         disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx(he,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{children:"Previous Surah"})]}),r.jsxs("button",{onClick:z,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg`,children:[r.jsx(O,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{children:"Beginning of Surah"})]}),r.jsxs("button",{onClick:oe,disabled:parseInt(o)>=114,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg
                         disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx("span",{children:"Next Surah"}),r.jsx(de,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]}),ve&&r.jsx("button",{onClick:z,className:`fixed right-6 z-[60] bg-cyan-500 hover:bg-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center ${k?"bottom-32 sm:bottom-36":"bottom-6"}`,title:"Beginning of Surah","aria-label":"Beginning of Surah",children:r.jsx(O,{className:"w-6 h-6"})}),k&&r.jsx(s.Suspense,{fallback:r.jsx("div",{className:"fixed bottom-0 left-0 right-0 h-20 bg-gray-100 dark:bg-gray-800 animate-pulse"}),children:r.jsx(Je,{audioElement:n,isPlaying:A,currentAyah:k,totalAyahs:m.length,surahInfo:N,onPlayPause:se,onStop:R,onSkipBack:()=>{v>0&&(h(!0),j(v-1,0))},onSkipForward:()=>{v<m.length-1&&(h(!0),j(v+1,0))},onClose:null,selectedQari:b,onQariChange:e=>{ee(e),k&&(R(),setTimeout(()=>{v>=0&&(h(!0),j(v))},100))},translationLanguage:Q,audioTypes:D,onAudioTypesChange:e=>{const t=v;ye(e),k&&t>=0&&(R(),setTimeout(()=>{h(!0),p(t,0,e)},100))},playbackSpeed:f,onPlaybackSpeedChange:e=>{te(e)}})})]})]})};export{dt as default};
