const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StickyAudioPlayer-BulroMsk.js","assets/index-CQnsQrCL.js","assets/react-vendor-v5ei6ytj.js","assets/index-DWtuzkxu.css","assets/volume-x-aPU91Uyv.js","assets/volume-2-BwLaAnRL.js","assets/skip-forward-DywnVb8O.js"])))=>i.map(i=>d[i]);
import{g as Fe,u as le,j as r,v as ie,b as $e,f as Le,q as ce,y as _e,_ as Te,n as Be,o as Ve}from"./index-CQnsQrCL.js";import{d as Ue,b as s,u as qe}from"./react-vendor-v5ei6ytj.js";import{D as De,B as Qe,V as Me,C as He,A as z}from"./LoadingSkeleton-BnK_3uBS.js";import{u as We,T as ze}from"./Toast-o5YPdajv.js";import{s as Oe}from"./readingProgressService-DFoY0i0J.js";import{g as Ye,s as Ze}from"./surahNameUtils-CNmXwDjY.js";import{C as ue}from"./chevron-left-BOO1WfRR.js";import"./surahNameUnicodes-C_pntk6C.js";const Ge=s.lazy(()=>Te(()=>import("./StickyAudioPlayer-BulroMsk.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Je={"al-afasy":"QA","al-ghamidi":"QG","al-hudaify":"QH"},dt=()=>{const{surahId:o}=Ue();s.useEffect(()=>{o&&Oe({surahId:o,viewType:"reading",path:`/reading/${o}`})},[o]);const O=qe(),{user:L}=Fe(),{toasts:de,removeToast:he,showSuccess:Y,showError:Z}=We(),[h,_]=s.useState([]),[N,ge]=s.useState(null),[G,T]=s.useState(!0),[me,A]=s.useState(!1),[B,V]=s.useState(null),[J,xe]=s.useState([]),[Ke,U]=s.useState(0),K=50,[R,fe]=s.useState("al-afasy"),[q,pe]=s.useState(["quran"]),[P,ye]=s.useState(1),[be,F]=s.useState(0),[E,u]=s.useState(!1),[w,S]=s.useState(null),[n,C]=s.useState(null),[y,$]=s.useState(0),p=s.useRef(null),v=s.useRef(null),[ve,X]=s.useState(!1),[Xe,ee]=s.useState(!1),[et,tt]=s.useState(!1),{translationLanguage:D}=le(),we=async(e,t,a,i,d)=>{const x=String(e).padStart(3,"0"),l=String(t).padStart(3,"0");let b;if(a==="quran")b=`https://old.thafheem.net/audio/qirath/${i}/${d}${x}_${l}.ogg`;else if(a==="translation"){if(D==="ur"){const c=await Be(e,t);return c||null}b=`https://old.thafheem.net/audio/translation/T${x}_${l}.ogg`}else if(a==="interpretation"){if(D==="ur"){const c=await Ve(e,t);return c||null}b=`https://old.thafheem.net/audio/interpretation/I${x}_${l}.ogg`}return b},m=async(e,t=0,a=null)=>{const i=a||q;if(e>=h.length){u(!1),S(null),$(0),F(0),C(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}));return}if(t>=i.length){m(e+1,0,a);return}n&&(n.pause(),n.currentTime=0,n.onended=null,n.onerror=null);const d=parseInt(o)||2,x=Je[R];h[e];const l=e+1,b=i[t];let c;try{c=await we(d,l,b,R,x)}catch(f){console.error("[Reading] Error generating audio URL:",f),t<i.length-1?m(e,t+1,a):e<h.length-1?m(e+1,0,a):(u(!1),S(null));return}if(!c){t<i.length-1?m(e,t+1,a):e<h.length-1?m(e+1,0,a):(u(!1),S(null));return}const g=new Audio(c);g.preload="none",g.playbackRate=P,C(g),p.current=g,S(l),$(e),F(t),g.onended=()=>{p.current===g&&m(e,t+1,a)},g.onerror=f=>{console.error("Audio playback error:",f),console.error("Failed URL:",c),p.current===g&&m(e,t+1,a)},g.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(f=>{if(f.name!=="AbortError"){if(console.error("Error playing audio:",f),console.error("Audio URL that failed:",c),f.name==="NotSupportedError"||f.message.includes("CORS")){console.error("CORS error - audio server does not allow cross-origin requests"),setTimeout(()=>{m(e,t+1,a)},1e3);return}m(e,t+1,a)}})},j=(e,t=0)=>{m(e,t,null)},I=()=>{n&&(n.pause(),n.currentTime=0),u(!1),S(null),$(0),F(0),C(null),p.current=null,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))},Se=e=>{const t=parseInt(e)-1;t>=0&&t<h.length?(n&&(n.pause(),n.currentTime=0,n.onended=null,n.onerror=null),C(null),p.current=null,setTimeout(()=>{S(parseInt(e)),$(t),F(0),u(!0),j(t,0)},100)):(console.error(`Invalid ayah index: ${t} for verse number ${e}`),console.error(`Valid range: 1 to ${h.length}`))},te=()=>{try{E?(n&&n.pause(),u(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))):(y>0||w?(u(!0),j(y,be)):(u(!0),j(0,0)),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}})))}catch(e){console.error("Error playing audio:",e),u(!1),S(null),C(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},Q=s.useRef(null);Q.current=te,s.useEffect(()=>{const e=()=>{Q.current&&Q.current()};return window.addEventListener("playAudio",e),()=>{window.removeEventListener("playAudio",e)}},[]),s.useEffect(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:E}}))},[E]),s.useEffect(()=>{const e=t=>{const{type:a,message:i}=t.detail;a==="success"?Y(i):a==="error"&&Z(i)};return window.addEventListener("showToast",e),()=>{window.removeEventListener("showToast",e)}},[Y,Z]),s.useEffect(()=>{E&&n&&I()},[R,q]),s.useEffect(()=>{n&&(n.playbackRate=P)},[n,P]),s.useEffect(()=>()=>{v.current&&(v.current.pause(),v.current.src="",v.current.currentTime=0,v.current.onended=null,v.current.onerror=null,v.current=null),p.current&&(p.current.pause(),p.current.src="",p.current.currentTime=0,p.current=null)},[]),s.useEffect(()=>{v.current=n},[n]),s.useEffect(()=>()=>{n&&I()},[o]),s.useEffect(()=>{(async()=>{try{T(!0),V(null),_([]),U(0);const t=o||2,[a,i]=await Promise.all([$e(),Le()]),d=i.filter(l=>l.SuraId===parseInt(t)),x=a.find(l=>l.number===parseInt(t));ge(x),xe(d),T(!1),A(!0);try{const l=await ce(t,{page:1,limit:K}),b=Array.isArray(l?.verses)?l.verses:Array.isArray(l)?l:[];_(b),U(b.length);const c=l?.pagination||null;if(c?.hasNext){const g=async()=>{let f=(c.page||1)+1,oe=c.hasNext;for(;oe;)try{const k=await ce(t,{page:f,limit:K}),H=Array.isArray(k?.verses)?k.verses:Array.isArray(k)?k:[];H.length>0&&(_(W=>[...W,...H]),U(W=>W+H.length)),oe=k?.pagination?.hasNext,f+=1}catch(k){console.error("Error loading additional verses:",k);break}A(!1)};window.requestIdleCallback?window.requestIdleCallback(g,{timeout:1e3}):setTimeout(g,100)}else A(!1)}catch(l){console.error("Error loading verses:",l),V(l.message),A(!1)}}catch(t){console.error("Error fetching surah data:",t),V(t.message),T(!1),A(!1)}})()},[o]),s.useEffect(()=>{(async()=>{if(!L||!o){ee(!1);return}try{const t=await _e.isFavorited(L.uid,o);ee(t)}catch(t){console.error("Error loading favorite status:",t)}})()},[L,o]);const ke=e=>{const t=J.find(a=>e>=a.ayafrom&&e<=a.ayato);return t?t.PageId:null},je=()=>{const e=[];let t=null,a=[];return h.forEach((i,d)=>{const x=i.verse_number||d+1,l=ke(x);l!==t?(a.length>0&&e.push({pageNumber:t,verses:a,startVerse:a[0].verse_number,endVerse:a[a.length-1].verse_number}),t=l,a=[{...i,verse_number:x}]):a.push({...i,verse_number:x})}),a.length>0&&e.push({pageNumber:t,verses:a,startVerse:a[0].verse_number,endVerse:a[a.length-1].verse_number}),e},re=()=>{const t=(parseInt(o)||2)-1;t>=1&&O(`/reading/${t}`)},ae=()=>{const t=(parseInt(o)||2)+1;t<=114&&O(`/reading/${t}`)},M=()=>{window.scrollTo({top:0,behavior:"smooth"})};s.useEffect(()=>{const e=()=>{window.scrollY>300?X(!0):X(!1)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const Ne=e=>{const t=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];return e.replace(/\d/g,a=>t[a])},Ae=e=>e?e.replace(/\s*﴿\s*[\d\u0660-\u0669]+\s*﴾\s*$/u,"").trim():"",{quranFont:Ee,theme:Ce}=le(),Ie=s.useMemo(()=>je(),[h,J]),se=N?.arabic||(o?`Surah ${o}`:"Surah"),Re=Ye(o,se),ne=o?String(o):"",Pe=ne==="1"||ne==="2"?"font-normal":"font-semibold";return r.jsxs(r.Fragment,{children:[r.jsx(ze,{toasts:de,removeToast:he}),r.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[r.jsx("div",{className:"px-3 sm:px-4 lg:px-6 pt-6 sm:pt-8 pb-2 dark:bg-gray-900",children:r.jsx("div",{className:"max-w-4xl mx-auto text-center",children:r.jsxs("div",{className:"mb-4 sm:mb-5",children:[r.jsx("h1",{className:`text-4xl sm:text-5xl font-arabic dark:text-white text-gray-900 mb-6 sm:mb-8 ${Pe}`,style:{fontFamily:Ze},"aria-label":se,children:Re}),N?.number!==1&&N?.number!==9&&r.jsx("div",{className:"mb-3 sm:mb-4",children:r.jsx("p",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-arabic dark:text-white text-gray-800 leading-relaxed px-2",children:r.jsx("img",{src:Ce==="dark"?De:Qe,alt:"Bismillah",className:"w-auto h-8 sm:h-10 lg:h-12 xl:h-14 mx-auto"})})})]})})}),r.jsxs("div",{className:"max-w-xs sm:max-w-2xl lg:max-w-4xl mx-auto px-3 sm:px-4 py-4 sm:py-6",children:[G&&r.jsx(Me,{count:5}),B&&r.jsxs("div",{className:"text-center py-8",children:[r.jsxs("p",{className:"text-red-600 dark:text-red-400",children:["Error loading verses: ",B]}),r.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Retry"})]}),!G&&!B&&h.length>0&&r.jsxs("div",{children:[me&&r.jsx("div",{className:"text-center py-4 mb-4",children:r.jsx(He,{message:"Loading remaining verses..."})}),Ie.map((e,t)=>r.jsx("div",{className:"",children:r.jsx("div",{className:"dark:bg-gray-900 rounded-lg p-3 sm:p-4 lg:p-3",children:r.jsxs("div",{className:"text-center",children:[r.jsx("p",{style:{fontFamily:`'${Ee}', serif`,textAlign:"justify",textAlignLast:"right",wordSpacing:"0.1em",letterSpacing:"0.02em",lineHeight:2.3,fontSize:"24px"},className:"font-arabic text-gray-900 dark:text-white",dir:"rtl",children:e.verses.map((a,i)=>{const d=e.startVerse+i;return r.jsxs("span",{onClick:()=>Se(d),className:`inline transition-all duration-300 cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/40 rounded px-2 ${w===d?"bg-blue-100 dark:bg-blue-900":""}`,title:`Click to play ayah ${d}`,children:[Ae(a.text_uthmani)||a.text_uthmani||""," ﴿",Ne(d.toString()),"﴾",i<e.verses.length-1&&"   "]},a.id||`verse-${d}`)})}),e.pageNumber&&r.jsx("div",{className:"flex items-center justify-center my-6 relative",children:r.jsx("div",{className:"w-full  border-b border-gray-300 dark:border-gray-600 py-2 text-center",children:r.jsx("span",{className:"px-4 bg-white dark:bg-gray-900 text-gray-600 dark:text-gray-300 font-semibold",children:e.pageNumber})})})]})})},t)),h.length>0&&N&&r.jsx("div",{className:"mt-8 mb-4",children:r.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 text-sm mt-4"})})]})]}),r.jsxs("div",{className:"bg-white border-t dark:bg-gray-900 border-gray-200 dark:border-gray-700 px-3 sm:px-4 py-3 sm:py-4 mt-6 sm:mt-8",children:[r.jsxs("div",{className:"sm:hidden space-y-2",children:[r.jsxs("div",{className:"flex space-x-2",children:[r.jsxs("button",{onClick:re,disabled:parseInt(o)<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg w-[173.96px] min-h-[44px]
                           disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx(ue,{className:"w-3 h-3"}),r.jsx("span",{children:"Previous Surah"})]}),r.jsxs("button",{onClick:M,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]`,children:[r.jsx(z,{className:"w-3 h-3"}),r.jsx("span",{children:"Beginning of Surah"})]})]}),r.jsx("div",{className:"flex justify-center",children:r.jsxs("button",{onClick:ae,disabled:parseInt(o)>=114,className:`w-[173.96px] flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]
                           disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx("span",{children:"Next Surah"}),r.jsx(ie,{className:"w-3 h-3"})]})})]}),r.jsxs("div",{className:"hidden sm:flex max-w-4xl mx-auto items-center justify-center space-x-4 lg:space-x-6",children:[r.jsxs("button",{onClick:re,disabled:parseInt(o)<=1,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg
                         disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx(ue,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{children:"Previous Surah"})]}),r.jsxs("button",{onClick:M,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg`,children:[r.jsx(z,{className:"w-3 h-3 sm:w-4 sm:h-4"}),r.jsx("span",{children:"Beginning of Surah"})]}),r.jsxs("button",{onClick:ae,disabled:parseInt(o)>=114,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg
                         disabled:opacity-50 disabled:cursor-not-allowed`,children:[r.jsx("span",{children:"Next Surah"}),r.jsx(ie,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]}),ve&&r.jsx("button",{onClick:M,className:`fixed right-6 z-[60] bg-cyan-500 hover:bg-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center ${w?"bottom-32 sm:bottom-36":"bottom-6"}`,title:"Beginning of Surah","aria-label":"Beginning of Surah",children:r.jsx(z,{className:"w-6 h-6"})}),w&&r.jsx(s.Suspense,{fallback:r.jsx("div",{className:"fixed bottom-0 left-0 right-0 h-20 bg-gray-100 dark:bg-gray-800 animate-pulse"}),children:r.jsx(Ge,{audioElement:n,isPlaying:E,currentAyah:w,totalAyahs:h.length,surahInfo:N,onPlayPause:te,onStop:I,onSkipBack:()=>{y>0&&(u(!0),j(y-1,0))},onSkipForward:()=>{y<h.length-1&&(u(!0),j(y+1,0))},onClose:null,selectedQari:R,onQariChange:e=>{fe(e),w&&(I(),setTimeout(()=>{y>=0&&(u(!0),j(y))},100))},translationLanguage:D,audioTypes:q,onAudioTypesChange:e=>{const t=y;pe(e),w&&t>=0&&(I(),setTimeout(()=>{u(!0),m(t,0,e)},100))},playbackSpeed:P,onPlaybackSpeedChange:e=>{ye(e)}})})]})]})};export{dt as default};
