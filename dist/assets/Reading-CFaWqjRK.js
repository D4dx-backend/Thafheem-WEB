const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StickyAudioPlayer-DeSRjKWI.js","assets/index-zWRKLUWk.js","assets/react-vendor-v5ei6ytj.js","assets/index-BXix4HoE.css","assets/volume-x-D3v98kuA.js","assets/volume-2-B8vAoamP.js","assets/skip-forward-_vqWQBqI.js"])))=>i.map(i=>d[i]);
import{c as Te,u as oe,j as t,o as ie,q as Fe,f as $e,k as le,t as _e,_ as Le}from"./index-zWRKLUWk.js";import{d as Be,b as s,u as Ve}from"./react-vendor-v5ei6ytj.js";import{D as qe,B as De,V as Qe,C as Ue,A as W}from"./LoadingSkeleton-c9dbzQb2.js";import{u as Me,T as He}from"./Toast-DunFfijn.js";import{s as We}from"./readingProgressService-DFoY0i0J.js";import{g as ze,s as Oe}from"./surahNameUtils-CNmXwDjY.js";import{C as ce}from"./chevron-left-8YABQ6I3.js";import"./surahNameUnicodes-C_pntk6C.js";const Ye=s.lazy(()=>Le(()=>import("./StickyAudioPlayer-DeSRjKWI.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Ze={"al-afasy":"QA","al-ghamidi":"QG","al-hudaify":"QH"},ct=()=>{const{surahId:o}=Be();s.useEffect(()=>{o&&We({surahId:o,viewType:"reading",path:`/reading/${o}`})},[o]);const z=Ve(),{user:$}=Te(),{toasts:de,removeToast:ue,showSuccess:O,showError:Y}=Me(),[m,_]=s.useState([]),[j,he]=s.useState(null),[Z,L]=s.useState(!0),[me,N]=s.useState(!1),[B,V]=s.useState(null),[G,ge]=s.useState([]),[Ge,q]=s.useState(0),J=50,[P,xe]=s.useState("al-afasy"),[D,fe]=s.useState(["quran"]),[R,pe]=s.useState(1),[ye,T]=s.useState(0),[A,u]=s.useState(!1),[b,E]=s.useState(null),[n,C]=s.useState(null),[x,F]=s.useState(0),g=s.useRef(null),y=s.useRef(null),[be,K]=s.useState(!1),[Je,X]=s.useState(!1),[Ke,Xe]=s.useState(!1),{translationLanguage:ve}=oe(),we=(e,r,a,l,c)=>{const h=String(e).padStart(3,"0"),i=String(r).padStart(3,"0");let f;return a==="quran"?f=`https://old.thafheem.net/audio/qirath/${l}/${c}${h}_${i}.ogg`:a==="translation"?f=`https://old.thafheem.net/audio/translation/T${h}_${i}.ogg`:a==="interpretation"&&(f=`https://old.thafheem.net/audio/interpretation/I${h}_${i}.ogg`),f},v=(e,r=0,a=null)=>{const l=a||D;if(e>=m.length){u(!1),E(null),F(0),T(0),C(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}));return}if(r>=l.length){v(e+1,0,a);return}n&&(n.pause(),n.currentTime=0,n.onended=null,n.onerror=null);const c=parseInt(o)||2,h=Ze[P];m[e];const i=e+1,f=l[r],w=we(c,i,f,P,h),d=new Audio(w);d.preload="none",d.playbackRate=R,C(d),g.current=d,E(i),F(e),T(r),d.onended=()=>{g.current===d&&v(e,r+1,a)},d.onerror=p=>{console.error("Audio playback error:",p),console.error("Failed URL:",w),g.current===d&&v(e,r+1,a)},d.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(p=>{if(p.name!=="AbortError"){if(console.error("Error playing audio:",p),console.error("Audio URL that failed:",w),p.name==="NotSupportedError"||p.message.includes("CORS")){console.error("CORS error - audio server does not allow cross-origin requests"),setTimeout(()=>{v(e,r+1,a)},1e3);return}v(e,r+1,a)}})},k=(e,r=0)=>{v(e,r,null)},I=()=>{n&&(n.pause(),n.currentTime=0),u(!1),E(null),F(0),T(0),C(null),g.current=null,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))},Se=e=>{const r=parseInt(e)-1;r>=0&&r<m.length?(n&&(n.pause(),n.currentTime=0,n.onended=null,n.onerror=null),C(null),g.current=null,setTimeout(()=>{E(parseInt(e)),F(r),T(0),u(!0),k(r,0)},100)):(console.error(`Invalid ayah index: ${r} for verse number ${e}`),console.error(`Valid range: 1 to ${m.length}`))},ee=()=>{try{A?(n&&n.pause(),u(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))):(x>0||b?(u(!0),k(x,ye)):(u(!0),k(0,0)),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}})))}catch(e){console.error("Error playing audio:",e),u(!1),E(null),C(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},Q=s.useRef(null);Q.current=ee,s.useEffect(()=>{const e=()=>{Q.current&&Q.current()};return window.addEventListener("playAudio",e),()=>{window.removeEventListener("playAudio",e)}},[]),s.useEffect(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:A}}))},[A]),s.useEffect(()=>{const e=r=>{const{type:a,message:l}=r.detail;a==="success"?O(l):a==="error"&&Y(l)};return window.addEventListener("showToast",e),()=>{window.removeEventListener("showToast",e)}},[O,Y]),s.useEffect(()=>{A&&n&&I()},[P,D]),s.useEffect(()=>{n&&(n.playbackRate=R)},[n,R]),s.useEffect(()=>()=>{y.current&&(y.current.pause(),y.current.src="",y.current.currentTime=0,y.current.onended=null,y.current.onerror=null,y.current=null),g.current&&(g.current.pause(),g.current.src="",g.current.currentTime=0,g.current=null)},[]),s.useEffect(()=>{y.current=n},[n]),s.useEffect(()=>()=>{n&&I()},[o]),s.useEffect(()=>{(async()=>{try{L(!0),V(null),_([]),q(0);const r=o||2,[a,l]=await Promise.all([Fe(),$e()]),c=l.filter(i=>i.SuraId===parseInt(r)),h=a.find(i=>i.number===parseInt(r));he(h),ge(c),L(!1),N(!0);try{const i=await le(r,{page:1,limit:J}),f=Array.isArray(i?.verses)?i.verses:Array.isArray(i)?i:[];_(f),q(f.length);const w=i?.pagination||null;if(w?.hasNext){const d=async()=>{let p=(w.page||1)+1,ne=w.hasNext;for(;ne;)try{const S=await le(r,{page:p,limit:J}),M=Array.isArray(S?.verses)?S.verses:Array.isArray(S)?S:[];M.length>0&&(_(H=>[...H,...M]),q(H=>H+M.length)),ne=S?.pagination?.hasNext,p+=1}catch(S){console.error("Error loading additional verses:",S);break}N(!1)};window.requestIdleCallback?window.requestIdleCallback(d,{timeout:1e3}):setTimeout(d,100)}else N(!1)}catch(i){console.error("Error loading verses:",i),V(i.message),N(!1)}}catch(r){console.error("Error fetching surah data:",r),V(r.message),L(!1),N(!1)}})()},[o]),s.useEffect(()=>{(async()=>{if(!$||!o){X(!1);return}try{const r=await _e.isFavorited($.uid,o);X(r)}catch(r){console.error("Error loading favorite status:",r)}})()},[$,o]);const ke=e=>{const r=G.find(a=>e>=a.ayafrom&&e<=a.ayato);return r?r.PageId:null},je=()=>{const e=[];let r=null,a=[];return m.forEach((l,c)=>{const h=l.verse_number||c+1,i=ke(h);i!==r?(a.length>0&&e.push({pageNumber:r,verses:a,startVerse:a[0].verse_number,endVerse:a[a.length-1].verse_number}),r=i,a=[{...l,verse_number:h}]):a.push({...l,verse_number:h})}),a.length>0&&e.push({pageNumber:r,verses:a,startVerse:a[0].verse_number,endVerse:a[a.length-1].verse_number}),e},te=()=>{const r=(parseInt(o)||2)-1;r>=1&&z(`/reading/${r}`)},re=()=>{const r=(parseInt(o)||2)+1;r<=114&&z(`/reading/${r}`)},U=()=>{window.scrollTo({top:0,behavior:"smooth"})};s.useEffect(()=>{const e=()=>{window.scrollY>300?K(!0):K(!1)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const Ne=e=>{const r=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];return e.replace(/\d/g,a=>r[a])},Ae=e=>e?e.replace(/\s*﴿\s*[\d\u0660-\u0669]+\s*﴾\s*$/u,"").trim():"",{quranFont:Ee,theme:Ce}=oe(),Ie=s.useMemo(()=>je(),[m,G]),ae=j?.arabic||(o?`Surah ${o}`:"Surah"),Pe=ze(o,ae),se=o?String(o):"",Re=se==="1"||se==="2"?"font-normal":"font-semibold";return t.jsxs(t.Fragment,{children:[t.jsx(He,{toasts:de,removeToast:ue}),t.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[t.jsx("div",{className:"px-3 sm:px-4 lg:px-6 pt-6 sm:pt-8 pb-2 dark:bg-gray-900",children:t.jsx("div",{className:"max-w-4xl mx-auto text-center",children:t.jsxs("div",{className:"mb-4 sm:mb-5",children:[t.jsx("h1",{className:`text-4xl sm:text-5xl font-arabic dark:text-white text-gray-900 mb-6 sm:mb-8 ${Re}`,style:{fontFamily:Oe},"aria-label":ae,children:Pe}),j?.number!==1&&j?.number!==9&&t.jsx("div",{className:"mb-3 sm:mb-4",children:t.jsx("p",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-arabic dark:text-white text-gray-800 leading-relaxed px-2",children:t.jsx("img",{src:Ce==="dark"?qe:De,alt:"Bismillah",className:"w-auto h-8 sm:h-10 lg:h-12 xl:h-14 mx-auto"})})})]})})}),t.jsxs("div",{className:"max-w-xs sm:max-w-2xl lg:max-w-4xl mx-auto px-3 sm:px-4 py-4 sm:py-6",children:[Z&&t.jsx(Qe,{count:5}),B&&t.jsxs("div",{className:"text-center py-8",children:[t.jsxs("p",{className:"text-red-600 dark:text-red-400",children:["Error loading verses: ",B]}),t.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Retry"})]}),!Z&&!B&&m.length>0&&t.jsxs("div",{children:[me&&t.jsx("div",{className:"text-center py-4 mb-4",children:t.jsx(Ue,{message:"Loading remaining verses..."})}),Ie.map((e,r)=>t.jsx("div",{className:"",children:t.jsx("div",{className:"dark:bg-gray-900 rounded-lg p-3 sm:p-4 lg:p-3",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{style:{fontFamily:`'${Ee}', serif`,textAlign:"justify",textAlignLast:"right",wordSpacing:"0.1em",letterSpacing:"0.02em",lineHeight:2.3,fontSize:"24px"},className:"font-arabic text-gray-900 dark:text-white",dir:"rtl",children:e.verses.map((a,l)=>{const c=e.startVerse+l;return t.jsxs("span",{onClick:()=>Se(c),className:`inline transition-all duration-300 cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/40 rounded px-2 ${b===c?"bg-blue-100 dark:bg-blue-900":""}`,title:`Click to play ayah ${c}`,children:[Ae(a.text_uthmani)||a.text_uthmani||""," ﴿",Ne(c.toString()),"﴾",l<e.verses.length-1&&"   "]},a.id||`verse-${c}`)})}),e.pageNumber&&t.jsx("div",{className:"flex items-center justify-center my-6 relative",children:t.jsx("div",{className:"w-full  border-b border-gray-300 dark:border-gray-600 py-2 text-center",children:t.jsx("span",{className:"px-4 bg-white dark:bg-gray-900 text-gray-600 dark:text-gray-300 font-semibold",children:e.pageNumber})})})]})})},r)),m.length>0&&j&&t.jsx("div",{className:"mt-8 mb-4",children:t.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 text-sm mt-4"})})]})]}),t.jsxs("div",{className:"bg-white border-t dark:bg-gray-900 border-gray-200 dark:border-gray-700 px-3 sm:px-4 py-3 sm:py-4 mt-6 sm:mt-8",children:[t.jsxs("div",{className:"sm:hidden space-y-2",children:[t.jsxs("div",{className:"flex space-x-2",children:[t.jsxs("button",{onClick:te,disabled:parseInt(o)<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg w-[173.96px] min-h-[44px]
                           disabled:opacity-50 disabled:cursor-not-allowed`,children:[t.jsx(ce,{className:"w-3 h-3"}),t.jsx("span",{children:"Previous Surah"})]}),t.jsxs("button",{onClick:U,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]`,children:[t.jsx(W,{className:"w-3 h-3"}),t.jsx("span",{children:"Beginning of Surah"})]})]}),t.jsx("div",{className:"flex justify-center",children:t.jsxs("button",{onClick:re,disabled:parseInt(o)>=114,className:`w-[173.96px] flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]
                           disabled:opacity-50 disabled:cursor-not-allowed`,children:[t.jsx("span",{children:"Next Surah"}),t.jsx(ie,{className:"w-3 h-3"})]})})]}),t.jsxs("div",{className:"hidden sm:flex max-w-4xl mx-auto items-center justify-center space-x-4 lg:space-x-6",children:[t.jsxs("button",{onClick:te,disabled:parseInt(o)<=1,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg
                         disabled:opacity-50 disabled:cursor-not-allowed`,children:[t.jsx(ce,{className:"w-3 h-3 sm:w-4 sm:h-4"}),t.jsx("span",{children:"Previous Surah"})]}),t.jsxs("button",{onClick:U,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg`,children:[t.jsx(W,{className:"w-3 h-3 sm:w-4 sm:h-4"}),t.jsx("span",{children:"Beginning of Surah"})]}),t.jsxs("button",{onClick:re,disabled:parseInt(o)>=114,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg
                         disabled:opacity-50 disabled:cursor-not-allowed`,children:[t.jsx("span",{children:"Next Surah"}),t.jsx(ie,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]}),be&&t.jsx("button",{onClick:U,className:`fixed right-6 z-[60] bg-cyan-500 hover:bg-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center ${b?"bottom-32 sm:bottom-36":"bottom-6"}`,title:"Beginning of Surah","aria-label":"Beginning of Surah",children:t.jsx(W,{className:"w-6 h-6"})}),b&&t.jsx(s.Suspense,{fallback:t.jsx("div",{className:"fixed bottom-0 left-0 right-0 h-20 bg-gray-100 dark:bg-gray-800 animate-pulse"}),children:t.jsx(Ye,{audioElement:n,isPlaying:A,currentAyah:b,totalAyahs:m.length,surahInfo:j,onPlayPause:ee,onStop:I,onSkipBack:()=>{x>0&&(u(!0),k(x-1,0))},onSkipForward:()=>{x<m.length-1&&(u(!0),k(x+1,0))},onClose:null,selectedQari:P,onQariChange:e=>{xe(e),b&&(I(),setTimeout(()=>{x>=0&&(u(!0),k(x))},100))},translationLanguage:ve,audioTypes:D,onAudioTypesChange:e=>{const r=x;fe(e),b&&r>=0&&(I(),setTimeout(()=>{u(!0),v(r,0,e)},100))},playbackSpeed:R,onPlaybackSpeedChange:e=>{pe(e)}})})]})]})};export{ct as default};
