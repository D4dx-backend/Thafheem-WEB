const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StickyAudioPlayer-D23gumu9.js","assets/index-pxHnjHjD.js","assets/index-CS0sH5sK.css","assets/volume-x-BJnJqqFB.js","assets/volume-2-O1mrhZ5G.js","assets/skip-forward-DQYe2sNq.js"])))=>i.map(i=>d[i]);
import{d as Se,a as ke,g as je,r as a,u as ee,j as e,p as te,t as Ne,f as Ee,v as Ae,x as Ce,_ as Ie}from"./index-pxHnjHjD.js";import{D as Pe,B as Re,A as H}from"./darkmode-bismi-Dgb0MGm6.js";import{u as Te,T as Le}from"./Toast-B6q433qJ.js";import{C as re}from"./chevron-left-BDDzhXoa.js";const _e=a.lazy(()=>Ie(()=>import("./StickyAudioPlayer-D23gumu9.js"),__vite__mapDeps([0,1,2,3,4,5]))),Fe={"al-afasy":"QA","al-ghamidi":"QG","al-hudaify":"QH"},Me=()=>{const{surahId:i}=Se(),M=ke(),{user:_}=je(),{toasts:se,removeToast:ae,showSuccess:z,showError:O}=Te(),[h,F]=a.useState([]),[k,ne]=a.useState(null),[W,$]=a.useState(!0),[oe,j]=a.useState(!1),[B,V]=a.useState(null),[Y,le]=a.useState([]),[$e,D]=a.useState(0),I=50,[P,ie]=a.useState("al-afasy"),[q,de]=a.useState(["quran"]),[R,ce]=a.useState(1),[ue,T]=a.useState(0),[N,c]=a.useState(!1),[y,E]=a.useState(null),[n,A]=a.useState(null),[g,L]=a.useState(0),m=a.useRef(null),f=a.useRef(null),[he,Z]=a.useState(!1),[Be,G]=a.useState(!1),[Ve,De]=a.useState(!1),{translationLanguage:me}=ee(),xe=(t,r,s,l,d)=>{const u=String(t).padStart(3,"0"),o=String(r).padStart(3,"0");let p;return s==="quran"?p=`https://old.thafheem.net/audio/qirath/${l}/${d}${u}_${o}.ogg`:s==="translation"?p=`https://old.thafheem.net/audio/translation/T${u}_${o}.ogg`:s==="interpretation"&&(p=`https://old.thafheem.net/audio/interpretation/I${u}_${o}.ogg`),p},b=(t,r=0,s=null)=>{const l=s||q;if(t>=h.length){c(!1),E(null),L(0),T(0),A(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}));return}if(r>=l.length){b(t+1,0,s);return}n&&(n.pause(),n.currentTime=0,n.onended=null,n.onerror=null);const d=parseInt(i)||2,u=Fe[P];h[t];const o=t+1,p=l[r],w=xe(d,o,p,P,u),x=new Audio(w);x.preload="none",x.playbackRate=R,A(x),m.current=x,E(o),L(t),T(r),x.onended=()=>{m.current===x&&b(t,r+1,s)},x.onerror=S=>{console.error("Audio playback error:",S),console.error("Failed URL:",w),m.current===x&&b(t,r+1,s)},x.play().then(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}}))}).catch(S=>{if(S.name!=="AbortError"){if(console.error("Error playing audio:",S),console.error("Audio URL that failed:",w),S.name==="NotSupportedError"||S.message.includes("CORS")){console.error("CORS error - audio server does not allow cross-origin requests"),setTimeout(()=>{b(t,r+1,s)},1e3);return}b(t,r+1,s)}})},v=(t,r=0)=>{b(t,r,null)},C=()=>{n&&(n.pause(),n.currentTime=0),c(!1),E(null),L(0),T(0),A(null),m.current=null,window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))},ge=t=>{const r=parseInt(t)-1;r>=0&&r<h.length?(n&&(n.pause(),n.currentTime=0,n.onended=null,n.onerror=null),A(null),m.current=null,setTimeout(()=>{E(parseInt(t)),L(r),T(0),c(!0),v(r,0)},100)):(console.error(`Invalid ayah index: ${r} for verse number ${t}`),console.error(`Valid range: 1 to ${h.length}`))},J=()=>{try{N?(n&&n.pause(),c(!1),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))):(g>0||y?(c(!0),v(g,ue)):(c(!0),v(0,0)),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!0}})))}catch(t){console.error("Error playing audio:",t),c(!1),E(null),A(null),window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:!1}}))}},Q=a.useRef(null);Q.current=J,a.useEffect(()=>{const t=()=>{Q.current&&Q.current()};return window.addEventListener("playAudio",t),()=>{window.removeEventListener("playAudio",t)}},[]),a.useEffect(()=>{window.dispatchEvent(new CustomEvent("audioStateChange",{detail:{isPlaying:N}}))},[N]),a.useEffect(()=>{const t=r=>{const{type:s,message:l}=r.detail;s==="success"?z(l):s==="error"&&O(l)};return window.addEventListener("showToast",t),()=>{window.removeEventListener("showToast",t)}},[z,O]),a.useEffect(()=>{N&&n&&C()},[P,q]),a.useEffect(()=>{n&&(n.playbackRate=R)},[n,R]),a.useEffect(()=>()=>{f.current&&(f.current.pause(),f.current.src="",f.current.currentTime=0,f.current.onended=null,f.current.onerror=null,f.current=null),m.current&&(m.current.pause(),m.current.src="",m.current.currentTime=0,m.current=null)},[]),a.useEffect(()=>{f.current=n},[n]),a.useEffect(()=>()=>{n&&C()},[i]),a.useEffect(()=>{(async()=>{try{$(!0),V(null),F([]),D(0);const r=i||2,[s,l]=await Promise.all([Ne(),Ee()]),d=l.filter(o=>o.SuraId===parseInt(r)),u=s.find(o=>o.number===parseInt(r));ne(u),le(d),$(!1),j(!0);try{const o=await Ae(r),p=o.slice(0,I);if(F(p),D(I),o.length>I){const w=()=>{const x=o.slice(I);F(o),D(o.length),j(!1)};window.requestIdleCallback?window.requestIdleCallback(w,{timeout:1e3}):setTimeout(w,100)}else j(!1)}catch(o){console.error("Error loading verses:",o),V(o.message),j(!1)}}catch(r){console.error("Error fetching surah data:",r),V(r.message),$(!1),j(!1)}})()},[i]),a.useEffect(()=>{(async()=>{if(!_||!i){G(!1);return}try{const r=await Ce.isFavorited(_.uid,i);G(r)}catch(r){console.error("Error loading favorite status:",r)}})()},[_,i]);const fe=t=>{const r=Y.find(s=>t>=s.ayafrom&&t<=s.ayato);return r?r.PageId:null},pe=()=>{const t=[];let r=null,s=[];return h.forEach((l,d)=>{const u=l.verse_number||d+1,o=fe(u);o!==r?(s.length>0&&t.push({pageNumber:r,verses:s,startVerse:s[0].verse_number,endVerse:s[s.length-1].verse_number}),r=o,s=[{...l,verse_number:u}]):s.push({...l,verse_number:u})}),s.length>0&&t.push({pageNumber:r,verses:s,startVerse:s[0].verse_number,endVerse:s[s.length-1].verse_number}),t},K=()=>{const r=(parseInt(i)||2)-1;r>=1&&M(`/reading/${r}`)},X=()=>{const r=(parseInt(i)||2)+1;r<=114&&M(`/reading/${r}`)},U=()=>{window.scrollTo({top:0,behavior:"smooth"})};a.useEffect(()=>{const t=()=>{window.scrollY>300?Z(!0):Z(!1)};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[]);const ye=t=>{const r=["٠","١","٢","٣","٤","٥","٦","٧","٨","٩"];return t.replace(/\d/g,s=>r[s])},{quranFont:be,theme:ve}=ee(),we=a.useMemo(()=>pe(),[h,Y]);return e.jsxs(e.Fragment,{children:[e.jsx(Le,{toasts:se,removeToast:ae}),e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"px-3 sm:px-4 lg:px-6 pt-6 sm:pt-8 pb-2 dark:bg-gray-900",children:e.jsx("div",{className:"max-w-4xl mx-auto text-center",children:e.jsxs("div",{className:"mb-3 sm:mb-4",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-arabic dark:text-white text-gray-900 mb-6 sm:mb-8",children:k?.arabic||"Loading..."}),k?.number!==1&&k?.number!==9&&e.jsx("div",{className:"mb-3 sm:mb-4",children:e.jsx("p",{className:"text-xl sm:text-2xl md:text-3xl lg:text-4xl font-arabic dark:text-white text-gray-800 leading-relaxed px-2",children:e.jsx("img",{src:ve==="dark"?Pe:Re,alt:"Bismillah",className:"w-auto h-8 sm:h-10 lg:h-12 xl:h-14 mx-auto"})})})]})})}),e.jsxs("div",{className:"max-w-xs sm:max-w-2xl lg:max-w-4xl mx-auto px-3 sm:px-4 py-4 sm:py-6",children:[W&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-white mx-auto"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Loading..."})]}),B&&e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("p",{className:"text-red-600 dark:text-red-400",children:["Error loading verses: ",B]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Retry"})]}),!W&&!B&&h.length>0&&e.jsxs("div",{children:[oe&&e.jsx("div",{className:"text-center py-4 mb-4",children:e.jsxs("div",{className:"inline-flex items-center space-x-2 text-gray-600 dark:text-gray-400 text-sm",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600 dark:border-gray-400"}),e.jsx("span",{children:"Loading remaining verses..."})]})}),we.map((t,r)=>e.jsx("div",{className:"",children:e.jsx("div",{className:"dark:bg-gray-900 rounded-lg p-3 sm:p-4 lg:p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{style:{fontFamily:`'${be}', serif`,textAlign:"justify",textAlignLast:"right",wordSpacing:"0.1em",letterSpacing:"0.02em",lineHeight:2.3,fontSize:"24px"},className:"font-arabic text-gray-900 dark:text-white",dir:"rtl",children:t.verses.map((s,l)=>{const d=t.startVerse+l;return e.jsxs("span",{onClick:()=>ge(d),className:`inline transition-all duration-300 cursor-pointer hover:bg-cyan-50 dark:hover:bg-cyan-900/40 rounded px-2 ${y===d?"bg-blue-100 dark:bg-blue-900":""}`,title:`Click to play ayah ${d}`,children:[s.text_uthmani," ﴿",ye(d.toString()),"﴾",l<t.verses.length-1&&"   "]},s.id||`verse-${d}`)})}),t.pageNumber&&e.jsx("div",{className:"flex items-center justify-center my-6 relative",children:e.jsx("div",{className:"w-full  border-b border-gray-300 dark:border-gray-600 py-2 text-center",children:e.jsx("span",{className:"px-4 bg-white dark:bg-gray-900 text-gray-600 dark:text-gray-300 font-semibold",children:t.pageNumber})})})]})})},r)),h.length>0&&k&&e.jsx("div",{className:"mt-8 mb-4",children:e.jsx("div",{className:"text-center text-gray-500 dark:text-gray-400 text-sm mt-4"})})]})]}),e.jsxs("div",{className:"bg-white border-t dark:bg-gray-900 border-gray-200 dark:border-gray-700 px-3 sm:px-4 py-3 sm:py-4 mt-6 sm:mt-8",children:[e.jsxs("div",{className:"sm:hidden space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:K,disabled:parseInt(i)<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg w-[173.96px] min-h-[44px]
                           disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx(re,{className:"w-3 h-3"}),e.jsx("span",{children:"Previous Surah"})]}),e.jsxs("button",{onClick:U,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]`,children:[e.jsx(H,{className:"w-3 h-3"}),e.jsx("span",{children:"Beginning of Surah"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:X,disabled:parseInt(i)>=114,className:`w-[173.96px] flex items-center justify-center space-x-2 px-4 py-2 text-xs text-gray-600 
                           dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 
                           border border-gray-300 dark:border-gray-600 rounded-lg min-h-[44px]
                           disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("span",{children:"Next Surah"}),e.jsx(te,{className:"w-3 h-3"})]})})]}),e.jsxs("div",{className:"hidden sm:flex max-w-4xl mx-auto items-center justify-center space-x-4 lg:space-x-6",children:[e.jsxs("button",{onClick:K,disabled:parseInt(i)<=1,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg
                         disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx(re,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{children:"Previous Surah"})]}),e.jsxs("button",{onClick:U,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg`,children:[e.jsx(H,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{children:"Beginning of Surah"})]}),e.jsxs("button",{onClick:X,disabled:parseInt(i)>=114,className:`flex items-center space-x-2 px-3 sm:px-4 py-2 text-xs sm:text-sm text-gray-600 
                         dark:bg-[#323A3F] dark:text-white hover:text-gray-900 dark:hover:text-gray-300 rounded-lg
                         disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsx("span",{children:"Next Surah"}),e.jsx(te,{className:"w-3 h-3 sm:w-4 sm:h-4"})]})]})]}),he&&e.jsx("button",{onClick:U,className:`fixed right-6 z-[60] bg-cyan-500 hover:bg-cyan-600 dark:bg-cyan-600 dark:hover:bg-cyan-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center ${y?"bottom-32 sm:bottom-36":"bottom-6"}`,title:"Beginning of Surah","aria-label":"Beginning of Surah",children:e.jsx(H,{className:"w-6 h-6"})}),y&&e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"fixed bottom-0 left-0 right-0 h-20 bg-gray-100 dark:bg-gray-800 animate-pulse"}),children:e.jsx(_e,{audioElement:n,isPlaying:N,currentAyah:y,totalAyahs:h.length,surahInfo:k,onPlayPause:J,onStop:C,onSkipBack:()=>{g>0&&(c(!0),v(g-1,0))},onSkipForward:()=>{g<h.length-1&&(c(!0),v(g+1,0))},onClose:null,selectedQari:P,onQariChange:t=>{ie(t),y&&(C(),setTimeout(()=>{g>=0&&(c(!0),v(g))},100))},translationLanguage:me,audioTypes:q,onAudioTypesChange:t=>{const r=g;de(t),y&&r>=0&&(C(),setTimeout(()=>{c(!0),b(r,0,t)},100))},playbackSpeed:R,onPlaybackSpeedChange:t=>{ce(t)}})})]})]})};export{Me as default};
