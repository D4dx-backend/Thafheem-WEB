import{d as _,u as O,r as c,a as E,j as e,L as A,N as L,y as R,z as U}from"./index-DJ-cZXxg.js";import{A as M}from"./arrow-left-lZrQYBp7.js";const B=()=>{const{surahId:x}=_(),{translationLanguage:m}=O(),[t,v]=c.useState(null),[k,u]=c.useState(!0),[j,w]=c.useState(null),S=E(),[o,p]=c.useState({isOpen:!1,noteId:null,loading:!1,error:null,content:null}),d=s=>{if(!s)return"";const a=document.createElement("div");return a.innerHTML=s,(a.textContent||a.innerText||"").replace(/\s+/g," ").trim()},P=s=>{if(!s)return[];const a=[];return s.split(/<h2[^>]*>/).forEach((r,i)=>{if(i===0&&!r.includes("</h2>")){if(r.trim()){const l=d(r);l&&a.push({title:"Introduction",content:l})}}else{const l=r.indexOf("</h2>");if(l!==-1){const h=r.substring(0,l).trim(),b=r.substring(l+5).trim(),N=d(b);h&&N&&a.push({title:d(h),content:N})}}}),a};if(c.useEffect(()=>{(async()=>{try{u(!0);const a=await R(x,m);v(a)}catch(a){w(a.message)}finally{u(!1)}})()},[x,m]),k)return e.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading Surah information..."})]})});if(j)return e.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 dark:text-red-400 text-lg mb-2",children:"Failed to load Surah information"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:j}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Try Again"})]})});const T=c.useMemo(()=>s=>s?s.replace(/\r\n/g,`
`).replace(/\t+/g," ").split(/\n{2,}/).map(a=>a.trim()).filter(Boolean):[],[]),f=t?.thafheem?.PrefaceText?P(t.thafheem.PrefaceText):[],y=Array.isArray(t?.thafheem?.PrefaceSections)?t.thafheem.PrefaceSections.filter(s=>s?.subtitle&&s.subtitle.trim()||s?.text&&s.text.trim()):[],g=m==="mal"&&y.length>0,C=s=>{if(m!=="mal")return;const a=s.target.closest("sup, a");if(!a)return;const n=(a.innerText||a.textContent||"").trim();if(!n)return;let r=!1;const i=n.replace(/[\s()]+/g,"").toUpperCase();if(/^N\d+$/.test(i))r=!0,I(i);else{const l=n.match(/(\d+)\s*[:ï¼š]\s*(\d+)/);if(l){const h=parseInt(l[1],10),b=parseInt(l[2],10);Number.isFinite(h)&&Number.isFinite(b)&&(r=!0,S(`/reading/${h}?verse=${b}`))}}r&&(s.preventDefault(),s.stopPropagation())},I=async s=>{p({isOpen:!0,noteId:s,loading:!0,error:null,content:null});try{const a=await U(s);p(n=>({...n,loading:!1,content:a&&(a.NoteText||a.html||a.content||a.text)||a||"Note content unavailable."}))}catch(a){p(n=>({...n,loading:!1,error:a?.message||"Unable to load this note at the moment. Please try again."}))}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900",children:[e.jsx("div",{className:"bg-white px-3 sm:px-4 lg:px-6 py-4 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center",children:[e.jsx(A,{to:`/surah/${x}`,children:e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors mr-3 sm:mr-4",children:e.jsx(M,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-600 dark:text-white"})})}),e.jsx("h1",{className:"text-base sm:text-lg lg:text-xl font-semibold text-gray-900 dark:text-white",children:t?.basic?.name_simple||t?.surah?.name||`Surah ${x}`})]})}),e.jsxs("div",{className:"w-full max-w-[1290px] mx-auto px-3 sm:px-4 lg:px-6 py-4 sm:py-6",children:[e.jsxs("div",{className:"text-center mb-6 sm:mb-8 border-b border-gray-200 dark:border-white pb-4 sm:pb-6 font-poppins",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-arabic text-black mb-4 sm:mb-6 dark:text-white px-2",children:t?.basic?.name_arabic||t?.surah?.arabic||`Surah ${x}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap justify-center gap-x-6 sm:gap-x-8 md:gap-x-12 lg:gap-x-15 gap-y-2 sm:gap-y-4 text-xs sm:text-sm text-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-black dark:text-white",children:"Revelation: "}),e.jsx("span",{className:"font-semibold text-black dark:text-white",children:t?.basic?.revelation_place||t?.thafheem?.SuraType||t?.surah?.type||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-black dark:text-white",children:"Revelation Order: "}),e.jsx("span",{className:"font-semibold text-black dark:text-white",children:t?.basic?.revelation_order||t?.thafheem?.RevOrder||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-black dark:text-white",children:"Verses: "}),e.jsx("span",{className:"font-semibold text-black dark:text-white",children:t?.basic?.verses_count||t?.thafheem?.TotalAyas||t?.surah?.ayahs||"Unknown"})]})]}),t?.thafheem&&e.jsxs("div",{className:"flex flex-wrap justify-center gap-x-6 sm:gap-x-8 md:gap-x-12 lg:gap-x-15 gap-y-2 sm:gap-y-4 mt-2 sm:mt-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-black dark:text-white text-xs sm:text-sm",children:"Thafheem Vol: "}),e.jsx("span",{className:"font-semibold text-black dark:text-white text-xs sm:text-sm",children:t.thafheem.ThafVolume||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-black dark:text-white text-xs sm:text-sm",children:"Type: "}),e.jsx("span",{className:"font-semibold text-black dark:text-white text-xs sm:text-sm",children:t.thafheem.SuraType||"Unknown"})]})]})]})]}),e.jsxs("div",{className:"font-poppins",children:[g&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h3",{className:"text-lg sm:text-xl lg:text-2xl font-semibold text-cyan-600 mb-3 sm:mb-4",children:"Thafheem Preface (Malayalam)"}),m==="mal"&&e.jsx("style",{children:`
                    .surah-preface-content sup.f-noteno,
                    .surah-preface-content a.crs {
                      color: #2AA0BF !important;
                      cursor: pointer !important;
                      text-decoration: none !important;
                    }

                    .surah-preface-content sup.f-noteno:hover,
                    .surah-preface-content a.crs:hover {
                      text-decoration: underline !important;
                    }
                  `}),e.jsx("div",{className:"text-gray-700 leading-relaxed dark:text-white text-sm sm:text-base lg:text-lg px-1 sm:px-0 space-y-4 surah-preface-content",onClick:C,children:y.map((s,a)=>{const n=T(s.text);return e.jsxs("div",{className:"space-y-3",children:[s.subtitle?e.jsx("h4",{className:"text-base sm:text-lg lg:text-xl font-semibold text-cyan-500",children:s.subtitle}):null,n.map((r,i)=>e.jsx("p",{className:"mb-2 sm:mb-3",dangerouslySetInnerHTML:{__html:r}},i))]},a)})})]}),!g&&t?.detailed?.short_text&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h3",{className:"text-lg sm:text-xl lg:text-2xl font-semibold text-cyan-600 mb-3 sm:mb-4",children:"Overview"}),e.jsx("p",{className:"text-gray-700 leading-relaxed dark:text-white text-sm sm:text-base lg:text-lg px-1 sm:px-0",children:d(t.detailed.short_text)})]}),!g&&t?.detailed?.text&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h3",{className:"text-lg sm:text-xl lg:text-2xl font-semibold text-cyan-600 mb-3 sm:mb-4",children:"Detailed Information"}),e.jsx("div",{className:"text-gray-700 leading-relaxed dark:text-white text-sm sm:text-base lg:text-lg px-1 sm:px-0 space-y-4",children:d(t.detailed.text).split(`

`).map((s,a)=>e.jsx("p",{className:"mb-4",children:s.trim()},a))})]}),f.length>0&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h3",{className:"text-lg sm:text-xl lg:text-2xl font-semibold text-cyan-600 mb-3 sm:mb-4",children:"Thafheem Commentary"}),e.jsx("div",{className:"space-y-6",children:f.map((s,a)=>e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-base sm:text-lg lg:text-xl font-semibold text-cyan-500 mb-2 sm:mb-3",children:s.title}),e.jsx("div",{className:"text-gray-700 leading-relaxed dark:text-white text-sm sm:text-base lg:text-lg px-1 sm:px-0",children:s.content.split(`
`).filter(n=>n.trim()).map((n,r)=>e.jsx("p",{className:"mb-3 sm:mb-4",children:n.trim()},r))})]},a))})]}),!t?.detailed?.text&&f.length===0&&!g&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h3",{className:"text-lg sm:text-xl lg:text-2xl font-semibold text-cyan-600 mb-3 sm:mb-4",children:"Basic Information"}),e.jsxs("div",{className:"text-gray-700 leading-relaxed dark:text-white text-sm sm:text-base lg:text-lg px-1 sm:px-0 space-y-4",children:[t?.basic?.translated_name?.name&&e.jsxs("p",{children:[e.jsx("strong",{children:"English Name:"})," ",t.basic.translated_name.name]}),t?.basic?.name_simple&&e.jsxs("p",{children:[e.jsx("strong",{children:"Simple Name:"})," ",t.basic.name_simple]}),t?.basic?.revelation_place&&e.jsxs("p",{children:[e.jsx("strong",{children:"Place of Revelation:"})," ",t.basic.revelation_place]}),t?.basic?.pages&&e.jsxs("p",{children:[e.jsx("strong",{children:"Pages:"})," ",t.basic.pages[0]," to ",t.basic.pages[1]]}),!t?.basic?.translated_name&&e.jsx("p",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Detailed information for this Surah is not available at the moment."})]})]})]})]})]}),e.jsx(L,{isOpen:o.isOpen,noteId:o.noteId,noteContent:o.content,loading:o.loading,error:o.error,onClose:()=>p(s=>({...s,isOpen:!1}))})]})};export{B as default};
