import{I as ze,A as Ue,u as Be,j as e,X as pe,Z as ye,B as He,o as De,p as Pe,t as fe,w as he,i as Se,q as Fe,ag as Ke,J as Oe,v as Qe,n as Ge,ah as ge,ai as Je}from"./index-D80Klju5.js";import{b as x,u as be,c as le,d as Xe,e as Ze}from"./react-vendor-v5ei6ytj.js";import Ye from"./tamilWordByWordService-D59vW24j.js";import et from"./hindiWordByWordService-DuSzT-zx.js";import tt from"./banglaWordByWordService-jkoVAi6c.js";import{a as ie}from"./apiService-BNSE2PAx.js";import{u as Ie,T as ue}from"./Toast-DEJQjF_w.js";import{C as qe}from"./chevron-left-DtqKiCWt.js";import at from"./tamilTranslationService-CeJD2Ahs.js";import we from"./hindiTranslationService-D1cRr0-9.js";import Te from"./urduTranslationService-B9Qr6ZwY.js";import ke from"./banglaTranslationService-Gk_2fEMr.js";import ve from"./englishTranslationService-nTKVISbi.js";import{g as rt,s as nt}from"./surahNameUtils-CZ7_rci5.js";const st=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"16",height:"18",x:"4",y:"4",rx:"2",key:"1u9h20"}],["path",{d:"M8 10h6",key:"3oa6kw"}],["path",{d:"M8 14h8",key:"1fgep2"}],["path",{d:"M8 18h5",key:"17enja"}]],ot=ze("notepad-text",st);class it{constructor(){this.language="malayalam",this.apiBasePath=Ue,this.pendingRequests=new Map,this.cache=new Map,this.cacheEnabled=!0,this.cacheTtl=3e5}generateCacheKey(n,s){const r=Object.keys(s).sort().map(d=>`${d}=${s[d]}`).join("&");return`${n}${r?`?${r}`:""}`}isCacheValid(n){return Date.now()-n<this.cacheTtl}getCachedData(n){if(!this.cacheEnabled)return null;const s=this.cache.get(n);return s&&this.isCacheValid(s.timestamp)?s.data:(s&&this.cache.delete(n),null)}setCachedData(n,s){this.cacheEnabled&&this.cache.set(n,{data:s,timestamp:Date.now()})}async getAyahTranslation(n,s){const r=this.generateCacheKey("getAyahTranslation",{surahId:n,ayahNumber:s}),d=this.getCachedData(r);if(d)return d;if(this.pendingRequests.has(r))return this.pendingRequests.get(r);const p=this._getAyahTranslationInternal(n,s,r);this.pendingRequests.set(r,p);try{return await p}finally{this.pendingRequests.delete(r)}}async _getAyahTranslationInternal(n,s,r){try{const d=await ie.getTranslation(this.language,n,s),p=d?.translation_text??d?.translation??null;return p?(this.setCachedData(r,p),p):(console.warn(`âš ï¸ No Malayalam translation returned for ${n}:${s}`),null)}catch(d){throw console.error(`âŒ Malayalam translation API failed for ${n}:${s}:`,d),d}}async getSurahTranslations(n){const s=this.generateCacheKey("getSurahTranslations",{surahId:n}),r=this.getCachedData(s);if(r)return r;if(this.pendingRequests.has(s))return this.pendingRequests.get(s);const d=this._getSurahTranslationsInternal(n,s);this.pendingRequests.set(s,d);try{return await d}finally{this.pendingRequests.delete(s)}}async _getSurahTranslationsInternal(n,s){try{const r=await ie.getSurahTranslations(this.language,n),d=Array.isArray(r?.translations)?r.translations.map(p=>({number:p.verse_number,ArabicText:"",Translation:p.translation_text??""})):[];return this.setCachedData(s,d),d}catch(r){throw console.error(`âŒ Malayalam surah translation API failed for ${n}:`,r),r}}async getInterpretation(n,s,r=null){const d=this.generateCacheKey("getInterpretation",{surahId:n,ayahNumber:s,interpretationNo:r}),p=this.getCachedData(d);if(p)return p;if(this.pendingRequests.has(d))return this.pendingRequests.get(d);const a=this._getInterpretationInternal(n,s,r,d);this.pendingRequests.set(d,a);try{return await a}finally{this.pendingRequests.delete(d)}}async _getInterpretationInternal(n,s,r,d){try{const p=await ie.getInterpretation(this.language,n,s,r),a=Array.isArray(p?.explanations)?p.explanations:[];return this.setCachedData(d,a),a}catch(p){throw console.error(`âŒ Malayalam interpretation API failed for ${n}:${s}:`,p),p}}async getWordByWordData(n,s){const r=this.generateCacheKey("getWordByWordData",{surahId:n,ayahNumber:s}),d=this.getCachedData(r);if(d)return d;if(this.pendingRequests.has(r))return this.pendingRequests.get(r);const p=this._getWordByWordDataInternal(n,s,r);this.pendingRequests.set(r,p);try{return await p}finally{this.pendingRequests.delete(r)}}async _getWordByWordDataInternal(n,s,r){try{const d=await ie.getWordByWord(this.language,n,s),p=Array.isArray(d?.words)?d.words:[];if(p.length===0)return console.warn(`âš ï¸ No Malayalam word-by-word data for ${n}:${s}`),null;const a=p.map((i,g)=>({id:i.WordId||i.id||g+1,position:i.WordId||i.id||g+1,audio_url:i.audio_url||null,char_type_name:i.char_type_name||"word",code_v1:i.code_v1||"",code_v2:i.code_v2||"",line_number:i.line_number||1,page_number:i.page_number||1,text_uthmani:i.text_uthmani||i.WordPhrase||"",text_simple:i.text_simple||i.WordPhrase||"",translation:{text:i.MalMeaning||i.WordMeaning||i.translation?.text||"",language_name:"Malayalam",resource_name:"Thafheem Malayalam Word Database"},transliteration:{text:i.transliteration?.text||i.WordPhrase||"",language_name:"English"}})),M={text_uthmani:d?.text_uthmani||"",words:a,translations:d?.translations||[]};return this.setCachedData(r,M),M}catch(d){throw console.error(`âŒ Malayalam word-by-word API failed for ${n}:${s}:`,d),d}}async getWordByWordDataWithArabic(n,s){try{const r=await this.getWordByWordData(n,s);if(!r)return console.warn(`âš ï¸ No Malayalam data found for ${n}:${s}, falling back to English`),await this.getEnglishFallback(n,s);try{const d=await ie.getArabicText(n,s);return{...r,text_uthmani:d.text_uthmani||r.text_uthmani,text_simple:d.text_simple||r.text_simple}}catch{console.warn("âš ï¸ Could not fetch Arabic text, using Malayalam data only")}return r}catch(r){throw console.error(`âŒ Error fetching Malayalam word-by-word with Arabic for ${n}:${s}:`,r),r}}async getEnglishFallback(n,s){try{const r=await ie.getWordByWord("english",n,s),d=Array.isArray(r?.words)?r.words:[];if(d.length===0)return null;const p=d.map((a,M)=>({id:a.WordId||a.id||M+1,position:a.WordId||a.id||M+1,text_uthmani:a.text_uthmani||a.WordPhrase||"",text_simple:a.text_simple||a.WordPhrase||"",translation:{text:a.EngMeaning||a.WordMeaning||a.translation?.text||"",language_name:"English",resource_name:"Thafheem English Word Database"}}));return{text_uthmani:r?.text_uthmani||"",words:p,translations:r?.translations||[]}}catch(r){return console.error(`âŒ English fallback failed for ${n}:${s}:`,r),null}}async getFootnote(n){const s=this.generateCacheKey("getFootnote",{footnoteId:n}),r=this.getCachedData(s);if(r)return r;try{const p=(await ie.getMalayalamFootnote(n))?.footnote_text||"";return this.setCachedData(s,p),p}catch(d){throw console.error(`âŒ Malayalam footnote API failed for ${n}:`,d),d}}clearCache(){this.cache.clear(),this.pendingRequests.clear()}}const lt=new it,Ne=({surahId:j,selectedVerse:n,surahInfo:s,onNavigate:r,onClose:d,onShowAyahModal:p,onSurahChange:a,onVerseChange:M,wordData:i=null,showSuccess:g=null,showError:m=null,translationLanguage:R=null})=>{const[b,k]=x.useState(!0),[N,ne]=x.useState([]),[C,G]=x.useState(!1),[v,B]=x.useState(!1),[ee,J]=x.useState(!1),[te,U]=x.useState(!1),[$,ae]=x.useState(""),H=x.useRef(null),O=x.useRef(null),X=be(),{user:Q}=Be?.()||{user:null};s?.ayahs;const F=u=>{G(!1),ae(""),a&&a(u.number)},V=u=>{B(!1),M&&M(u)},L=()=>{const u=s?.ayahs||0;return Array.from({length:u},(E,T)=>T+1)},de=async()=>{try{J(!0);const u=he.getEffectiveUserId(Q),E=s?.name||`Surah ${j}`,T=i?.text_uthmani||i?.translations?.[0]?.text||"";await he.addBookmark(u,j,n,"word-by-word",E,T),g&&g("Word-by-word content bookmarked successfully!")}catch(u){console.error("Failed to bookmark word-by-word content:",u),m&&m("Failed to save bookmark. Please try again.")}finally{setTimeout(()=>J(!1),300)}},ce=async()=>{try{const u=s?.name||`Surah ${j}`,E=i?.text_uthmani||i?.translations?.[0]?.text||"",T=i?.translations?.[0]?.text||"";let W=`Word by Word - ${u}, Verse ${n}

`;W+=`Arabic: ${E}

`,T&&(W+=`Translation: ${T}

`),i?.words&&i.words.length>0&&(W+=`Word Breakdown:
`,i.words.slice(0,5).forEach((q,o)=>{const l=q.text_uthmani||q.text_simple||"",y=q.translation?.text||"N/A";W+=`${o+1}. ${l} - ${y}
`}),i.words.length>5&&(W+=`... and ${i.words.length-5} more words
`),W+=`
`),W+="Shared from Thafheem - Word by Word Study";const re=window.location.href;if(navigator.share)await navigator.share({title:`Word by Word - ${u}, Verse ${n}`,text:W,url:re});else{const q=`${W}

View full content: ${re}`;if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(q),alert("Word-by-word content copied to clipboard for sharing");else{const o=document.createElement("textarea");o.value=q,o.style.position="fixed",o.style.left="-999999px",o.style.top="-999999px",document.body.appendChild(o),o.focus(),o.select(),document.execCommand("copy"),document.body.removeChild(o),alert("Word-by-word content copied to clipboard for sharing")}}}catch(u){console.error("Failed to share word-by-word content:",u),u.name!=="AbortError"&&alert("Failed to share content: "+u.message)}};return x.useEffect(()=>{(async()=>{try{U(!0);const E=await fe();ne(E)}catch(E){console.error("Error loading surahs:",E)}finally{U(!1)}})()},[]),x.useEffect(()=>{const u=E=>{H.current&&!H.current.contains(E.target)&&G(!1),O.current&&!O.current.contains(E.target)&&B(!1)};return document.addEventListener("mousedown",u),()=>{document.removeEventListener("mousedown",u)}},[]),N.filter(u=>u.name.toLowerCase().includes($.toLowerCase())||u.arabic.includes($)||u.number.toString().includes($)),b?e.jsxs("div",{className:"bg-white dark:bg-gray-900 px-3 sm:px-4 py-3 space-y-3 relative z-10",children:[e.jsx("button",{className:"absolute top-2 right-2 sm:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors bg-white dark:bg-gray-600 shadow-sm z-10",title:"Close",onClick:()=>d?d():X(-1),children:e.jsx(pe,{className:"w-4 h-4 text-gray-600 dark:text-white"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2 sm:space-x-3 pr-12 sm:pr-0",children:[e.jsxs("div",{className:"relative dropdown-container",ref:H,children:[e.jsxs("button",{onClick:()=>G(!C),className:"flex font-poppins items-center space-x-2 px-3 sm:px-4 py-2 bg-gray-100 dark:bg-[#323A3F] dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs sm:text-sm font-medium text-gray-700 transition-colors",children:[e.jsx("span",{children:j?`${j} - ${s?.name||"Loading..."}`:"Select Surah"}),e.jsx(ye,{className:"w-4 h-4 text-gray-600 dark:text-white"})]}),C&&!te&&e.jsx("div",{className:"absolute sm:text-sm text-sm top-full left-0 mt-2 bg-white dark:bg-[#2A2C38] shadow-lg rounded-lg overflow-auto w-80 sm:w-45 h-[calc(100vh-100px)] z-50",children:N.map(u=>e.jsx("div",{className:`px-4 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-white ${u.number===parseInt(j)?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>F(u),children:e.jsxs("span",{className:R==="ur"?"font-urdu-nastaliq":R==="mal"?"font-malayalam":"",style:R==="mal"?{fontFamily:"'NotoSansMalayalam'"}:{},children:[u.number," - ",u.name]})},u.number))})]}),e.jsxs("div",{className:"relative dropdown-container",ref:O,children:[e.jsxs("button",{onClick:()=>B(!v),className:"flex font-poppins items-center space-x-2 px-3 sm:px-4 py-2 bg-gray-100 dark:bg-[#323A3F] dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs sm:text-sm font-medium text-gray-700 transition-colors",children:[e.jsx("span",{children:n||"1"}),e.jsx(ye,{className:"w-4 h-4 text-gray-600 dark:text-white"})]}),v&&e.jsx("div",{className:"absolute top-full left-0 mt-2 bg-white dark:bg-[#2A2C38] shadow-lg rounded-lg overflow-auto w-auto max-h-60 z-50",children:L().map(u=>e.jsx("div",{className:`px-4 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-white ${parseInt(n)===u?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>V(u),children:u},u))})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 self-end sm:self-auto",children:[R!=="ta"&&e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"View Ayah Details",onClick:()=>p&&p(n),children:e.jsx(He,{className:"w-4 sm:w-5 h-4 sm:h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{onClick:de,disabled:ee,className:`p-2 rounded-lg transition-colors ${ee?"text-gray-400 cursor-not-allowed":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,title:ee?"Saving...":"Bookmark this verse",children:e.jsx(De,{className:"w-4 sm:w-5 h-4 sm:h-5"})}),e.jsx("button",{onClick:ce,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Share word-by-word content",children:e.jsx(Pe,{className:"w-4 sm:w-5 h-4 sm:h-5 text-gray-600 dark:text-gray-300"})}),d&&e.jsx("button",{className:"hidden sm:block p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors dark:bg-white",title:"Close",onClick:d,children:e.jsx(pe,{className:"w-5 h-5 text-gray-600"})})]})]})]}):null},je=({surahId:j,verseId:n,totalVerses:s,surahInfo:r,onVerseChange:d,onSurahChange:p,onClose:a,onWordByWordClick:M,verseData:i,interpretationData:g,selectedQari:m,onQariChange:R})=>{const{translationLanguage:b}=Se(),[k,N]=x.useState(!0),[ne,C]=x.useState(!1),[G,v]=x.useState(!1),[B,ee]=x.useState([]),[J,te]=x.useState(!0),[U,$]=x.useState(!1),[ae,H]=x.useState(!1),[O,X]=x.useState(!1),Q=be(),{user:F}=Be(),{showSuccess:V,showError:L}=Ie();x.useEffect(()=>{(async()=>{try{const l=await fe();ee(l)}catch(l){console.error("Error loading surahs:",l)}finally{te(!1)}})()},[]),x.useEffect(()=>{(async()=>{if(F&&j&&n)try{const l=await he.isBookmarked(F.uid,j,n,"interpretation");$(l)}catch(l){console.error("Error checking bookmark status:",l)}})()},[F,j,n]);const de=Array.from({length:s||10},(o,l)=>l+1),ce=r?`${r.number} - ${r.name||r.arabic}`:`${j} - Loading...`,u=o=>{p?p(o):Q(`/surah/${o}`),C(!1)},E=o=>{d&&d(o),v(!1)},T=o=>{if(o==null)return"";if(typeof o!="string")return String(o);if(typeof window<"u"){const l=document.createElement("div");return l.innerHTML=o,l.textContent||l.innerText||""}return o.replace(/<[^>]+>/g," ")},W=o=>{if(!o||typeof o!="object")return"";const l=["AudioIntrerptn","Interpretation","interpretation","AudioText","interpret_text","InterpretText","Interpret_Text","text","Text","content","Content","meaning","Meaning","body","Body","desc","Desc","description","Description"];for(const y of l)if(typeof o[y]=="string"&&o[y].trim().length>0)return o[y];for(const[y,t]of Object.entries(o))if(typeof t=="string"&&t.trim().length>10&&!["InterpretationNo","Interpretation_No","interptn_no","contiayano","ayaid","Ayaid","suraid","pageid","QAudioUrl","TransUrl","InterPtnUrl","ASuraName"].includes(y))return t;return""},re=async()=>{if(!i&&!g){L("No data available to copy");return}try{const o=[];if(i?.arabic&&o.push(i.arabic),i?.translation&&o.push(i.translation),g){const y=[];if(Array.isArray(g))g.forEach((t,f)=>{if(typeof t=="string"&&t.trim().length>0){const c=T(t);if(c.trim()){const w=g.length>1?`Interpretation ${f+1}:
`:`Interpretation:
`;y.push(w+c.trim())}}else if(t&&typeof t=="object"){const c=W(t);if(c){const w=T(c);if(w.trim()){const S=g.length>1?`Interpretation ${f+1}:
`:`Interpretation:
`;y.push(S+w.trim())}}}});else if(typeof g=="string"){const t=T(g);t.trim()&&y.push(`Interpretation:
`+t.trim())}else if(typeof g=="object"){const t=W(g);if(t){const f=T(t);f.trim()&&y.push(`Interpretation:
`+f.trim())}}y.length>0?o.push(y.join(`

`)):console.warn("Interpretation data exists but no text extracted:",g)}if(o.length===0){const y=r?.name||r?.arabic||`Surah ${j}`;o.push(`${y}, Verse ${n}`)}const l=o.join(`

---

`);if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(l);else{const y=document.createElement("textarea");y.value=l,y.style.position="fixed",y.style.opacity="0",document.body.appendChild(y),y.select(),document.execCommand("copy"),document.body.removeChild(y)}X(!0),V("Verse and interpretation copied to clipboard"),setTimeout(()=>X(!1),2e3)}catch(o){console.error("Failed to copy verse:",o),L("Failed to copy verse. Please try again.")}},q=async()=>{if(!F){Q("/sign");return}try{if(H(!0),U){const l=(await he.getBookmarks(F.uid,"interpretation")).find(y=>y.surahId===parseInt(j)&&y.verseId===parseInt(n));l&&(await he.deleteBookmark(l.id,F.uid),$(!1),V("Bookmark removed successfully"))}else{const o=r?.name||r?.arabic||`Surah ${j}`,l=i?.translation||i?.arabic||"";await he.addBookmark(F.uid,j,n,"interpretation",o,l),$(!0),V("Verse bookmarked successfully")}}catch(o){console.error("Error handling bookmark:",o),L("Failed to update bookmark. Please try again.")}finally{H(!1)}};return k?e.jsxs("div",{className:"bg-white dark:bg-gray-900 px-3 sm:px-4 py-3 space-y-3 relative",children:[e.jsx("button",{className:"absolute top-2 right-2 sm:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors bg-white dark:bg-gray-600 shadow-sm z-10",title:"Close",onClick:a||(()=>Q(-1)),children:e.jsx(pe,{className:"w-4 h-4 text-gray-600 dark:text-white"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2 sm:space-x-3 pr-12 sm:pr-0",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>C(o=>!o),className:"flex font-poppins items-center space-x-2 px-3 sm:px-4 py-2 bg-gray-100 dark:bg-[#323A3F] dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs sm:text-sm font-medium text-gray-700 transition-colors",children:[e.jsx("span",{children:ce}),e.jsx(ye,{className:"w-4 h-4 text-gray-600 dark:text-white"})]}),ne&&!J&&e.jsx("div",{className:"absolute sm:text-sm text-sm top-full left-0 mt-2 bg-white dark:bg-[#2A2C38] shadow-lg rounded-lg overflow-auto w-80 sm:w-45 h-[calc(100vh-100px)] z-50",children:B.map(o=>e.jsx("div",{className:`px-4 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-white ${o.number===parseInt(j)?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>u(o.number),children:e.jsxs("span",{className:b==="ur"?"font-urdu-nastaliq":b==="mal"?"font-malayalam":"",style:b==="mal"?{fontFamily:"'NotoSansMalayalam'"}:{},children:[o.number," - ",o.name]})},o.number))})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>v(o=>!o),className:"flex font-poppins items-center space-x-2 px-3 sm:px-4 py-2 bg-gray-100 dark:bg-[#323A3F] dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs sm:text-sm font-medium text-gray-700 transition-colors",children:[e.jsxs("span",{children:[" ",n]}),e.jsx(ye,{className:"w-4 h-4 text-gray-600 dark:text-white"})]}),G&&e.jsx("div",{className:"absolute top-full left-0 mt-2 bg-white dark:bg-[#2A2C38] shadow-lg rounded-lg overflow-auto w-auto max-h-60 z-50",children:de.map(o=>e.jsx("div",{className:`px-4 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-white ${o===parseInt(n)?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>E(o),children:o},o))})]})]}),e.jsx("div",{className:"hidden sm:flex items-center",children:e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors dark:bg-gray-950",title:"Close",onClick:a||(()=>Q(-1)),children:e.jsx(pe,{className:"w-5 h-5 text-gray-600"})})})]}),e.jsxs("div",{className:"flex flex-row items-center justify-between gap-3 sm:gap-0",children:[e.jsx("div",{className:"flex items-center gap-2"}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[e.jsx("button",{onClick:re,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors relative",title:"Copy",children:O?e.jsx("span",{className:"text-green-500 font-bold text-xs",children:"Copied!"}):e.jsx(ot,{className:"w-4 sm:w-5 h-4 sm:h-5 dark:text-white text-gray-600"})}),e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:U?"Remove Bookmark":"Add Bookmark",onClick:q,disabled:ae,children:ae?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 sm:h-5 sm:w-5 border-b border-current"}):e.jsx(De,{className:`w-4 sm:w-5 h-4 sm:h-5 transition-colors ${U?"text-cyan-500 fill-cyan-500 dark:text-cyan-400 dark:fill-cyan-400":"text-gray-600 dark:text-gray-300"}`})}),e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Share",children:e.jsx(Pe,{className:"w-4 sm:w-5 h-4 sm:h-5 text-gray-600 dark:text-gray-300"})})]})]})]}):null},We=j=>{if(!j)return j;const n=document.createElement("textarea");return n.innerHTML=j,n.value};let Ae=null,Me=0;const dt=300*1e3,ct=({surahId:j,verseId:n,onClose:s})=>{const{quranFont:r,fontSize:d,adjustedTranslationFontSize:p,translationLanguage:a}=Se(),{toasts:M,removeToast:i}=Ie(),g=be(),[m,R]=x.useState(()=>{const t=parseInt(j,10);return Number.isNaN(t)?0:t}),[b,k]=x.useState(1),[N,ne]=x.useState(null),[C,G]=x.useState(null),[v,B]=x.useState(null),[ee,J]=x.useState(!0),[te,U]=x.useState(null),[$,ae]=x.useState(0),[H,O]=x.useState(!1),X=t=>{if(!t||typeof t!="object")return null;const f=[t.ayaid,t.AyaId,t.AyaID,t.contiayano,t.contiAyaNo,t.verse_number,t.number];for(const c of f){const w=Number.parseInt(c,10);if(Number.isFinite(w)&&w>0)return w}return null},[Q,F]=x.useState(null),[V,L]=x.useState("al-afasy"),[de,ce]=x.useState("qirath");x.useEffect(()=>{n&&k(parseInt(n))},[n]),x.useEffect(()=>{const t=parseInt(j,10);Number.isNaN(t)||R(t)},[j]),x.useEffect(()=>{let t=!1;return(async()=>{if(!(!m||!b)){console.log("[AyahModal] ðŸ”„ Loading data",{surahId:m,verseId:b,translationLanguage:a});try{J(!0),U(null),B(null),G(null);const c=b,w=a==="mal",S=a==="mal"?(async()=>{try{console.log("[AyahModal] ðŸŒ Fetching Malayalam interpretations via fetchAllInterpretations",{surahId:m,verseId:c});const h=await Ke(m,c,"mal");console.log("[AyahModal] âœ… Raw Malayalam interpretations from fetchAllInterpretations",{count:h?.length??0,sample:h?.[0]});const D=h&&h.length>0?h.map((A,oe)=>({interpretation:A.Interpretation||"",AudioIntrerptn:A.Interpretation||"",text:A.Interpretation||"",content:A.Interpretation||"",InterpretationNo:A.InterpretationNo||String(A.resolvedInterpretationNo||oe+1||1),interptn_no:A.resolvedInterpretationNo||parseInt(A.InterpretationNo||String(oe+1||1),10),number:A.resolvedInterpretationNo||parseInt(A.InterpretationNo||String(oe+1||1),10)})):[];return console.log("[AyahModal] ðŸ§¾ Transformed Malayalam interpretations for modal",{count:D.length,firstThree:D.slice(0,3)}),D}catch(h){return console.error(`[AyahModal] âŒ Error fetching Malayalam interpretations for Surah ${m}, Ayah ${c}:`,h),[]}})():a==="ta"?at.getAyahTranslation(m,c).then(h=>h?[{interpretation:h,AudioIntrerptn:h,text:h,content:h}]:[]).catch(()=>[]):a==="hi"?we.getAllExplanations(m,c).then(h=>h&&h.length>0?h.map(A=>({interpretation:A.explanation,AudioIntrerptn:A.explanation,text:A.explanation,content:A.explanation,explanation_no_BN:A.explanation_no_BN,explanation_no_EN:A.explanation_no_EN})):[]).catch(h=>(console.error("âŒ Error fetching Hindi explanations in AyahModal:",h),[])):a==="ur"?Te.getAllExplanations(m,c).then(h=>h&&h.length>0?h.map(D=>({interpretation:D.explanation,AudioIntrerptn:D.explanation,text:D.explanation,content:D.explanation,explanation_no:D.explanation_no})):[]).catch(()=>[]):a==="bn"?ke.getAllExplanations(m,c).then(h=>h&&h.length>0?h.map(A=>({interpretation:A.explanation,AudioIntrerptn:A.explanation,text:A.explanation,content:A.explanation,explanation_no_BNG:A.explanation_no_BNG,explanation_no_EN:A.explanation_no_EN})):[]).catch(h=>(console.error("âŒ Error fetching Bangla explanations in AyahModal:",h),[])):a==="E"?(async()=>{try{const h=await ve.getAyahTranslation(m,c);if(!h)return[];const D=/<sup[^>]*foot_note="([^"]+)"[^>]*>(\d+)<\/sup>/g,A=[];let oe;for(;(oe=D.exec(h))!==null;){const z=oe[1],Y=parseInt(oe[2],10);A.push({footnoteId:z,footnoteNumber:Y})}const Ee=Array.from(new Map(A.map(z=>[z.footnoteId,z])).values());Ee.sort((z,Y)=>z.footnoteNumber-Y.footnoteNumber);const Le=Ee.map(async z=>{try{const Y=await ve.getExplanation(parseInt(z.footnoteId,10));return{interpretation:Y||"",AudioIntrerptn:Y||"",text:Y||"",content:Y||"",interptn_no:z.footnoteNumber,number:z.footnoteNumber,InterpretationNo:String(z.footnoteNumber),footnoteId:z.footnoteId}}catch(Y){return console.warn(`Failed to fetch footnote ${z.footnoteId}:`,Y),null}});return(await Promise.all(Le)).filter(Boolean)}catch(h){return console.error(`âŒ [AyahModal] Error fetching English footnotes for Surah ${m}, Ayah ${c}:`,h),[]}})():(async()=>{try{return await Oe(m,c,1,a)}catch(h){return console.error(`[AyahModal] Error fetching interpretations for Surah ${m}, Ayah ${c}:`,h),m===114?[]:[]}})(),P=a==="ta"||a==="hi"||a==="bn"||a==="E"||a==="ur"?Promise.resolve(null):Qe(m,c),I=Date.now(),K=async()=>{if(Ae&&I-Me<dt)return Ae;const h=await fe();return Ae=h,Me=I,h},[Re,_e,xe,_]=await Promise.all([K(),Ge(m),P,S]);if(console.log("[AyahModal] ðŸ“¦ After Promise.all",{surahId:m,verseId:c,translationLanguage:a,hasArabic:!!_e?.length,hasTranslationData:!!xe,interpretationType:typeof _,isArray:Array.isArray(_),interpretationCount:Array.isArray(_)?_.length:_?.data?.length??0}),t)return;const Ce=Re.find(h=>h.number===m);ne(Ce||{arabic:"Unknown Surah",number:m}),ae(Ce?.ayahs||0);const Ve=_e.find(h=>h.verse_key===`${m}:${c}`),se=xe?Array.isArray(xe)?xe.find(h=>X(h)===c):xe:null;let Z=null;a==="mal"&&se&&(Z=[se.AudioIntrerptn,se.audioIntrerptn,se.Interpretation,se.interpretation].find(D=>typeof D=="string"&&D.trim().length>0)||null,console.log("[AyahModal] ðŸ‡²ðŸ‡» Malayalam quranaya-based interpretation candidate",{surahId:m,verseId:c,hasMalAyahInterpretation:!!Z,preview:Z?Z.substring(0,200):"N/A"}));let me="";if(a==="E")try{me=await ve.getAyahTranslation(m,c),me=me?me.replace(/<sup[^>]*foot_note[^>]*>\d+<\/sup>/g,"").replace(/\s+/g," ").trim():""}catch(h){console.error("Error fetching English translation:",h),me=""}if(t)return;const $e={number:c,arabic:Ve?.text_uthmani||"",translation:a==="E"?me:se?.AudioText?se.AudioText.replace(/<sup[^>]*foot_note[^>]*>\d+<\/sup>/g,"").replace(/\s+/g," ").trim():"",verseKey:`${m}:${c}`};if(console.log("[AyahModal] ðŸ“– Set verseData for modal",$e),G($e),t)return;if(a==="mal"&&Z){const h={interpretation:Z,AudioIntrerptn:Z,text:Z,content:Z,surahId:m,verseId:c};console.log("[AyahModal] âœ… Using quranaya-based Malayalam interpretation for ayah-wise view",{surahId:m,verseId:c,preview:Z.substring(0,200)}),B([h])}else if(_)if(Array.isArray(_)){const h=_[0]?.Interpretation||_[0]?.interpretation||"";console.log("[AyahModal] ðŸ§  setInterpretationData (array)",{surahId:m,verseId:b,count:_.length,firstInterpretationPreview:h.substring(0,200),firstInterpretationLength:h.length,firstInterpretationNo:_[0]?.InterpretationNo||_[0]?.interptn_no||"N/A"}),B(_)}else _.data&&Array.isArray(_.data)?(B(_.data),console.log("[AyahModal] ðŸ§  setInterpretationData (response.data array)",{count:_.data.length,first:_.data[0]})):typeof _=="object"?(B([_]),console.log("[AyahModal] ðŸ§  setInterpretationData (single object)",{value:_})):(B(null),console.warn("[AyahModal] âš ï¸ interpretationResponse was not in a supported format",_));else B(null),console.warn("[AyahModal] âš ï¸ interpretationResponse is empty/null, clearing interpretationData")}catch(c){if(t)return;U(c.message),console.error("Error fetching verse data:",c)}finally{if(t)return;J(!1)}}})(),()=>{t=!0}},[m,b,a]),x.useEffect(()=>{console.log("[AyahModal] ðŸ” interpretationData STATE CHANGED",{surahId:m,verseId:b,hasData:!!v,count:v?.length||0,firstInterpretationText:v?.[0]?.Interpretation?.substring(0,100)||v?.[0]?.interpretation?.substring(0,100)||"N/A"})},[v,m,b]),x.useEffect(()=>{const t=async f=>{f.preventDefault(),f.stopPropagation();const c=f.target.closest(".bangla-explanation-link");if(c){const w=c.getAttribute("data-explanation-number"),S=c.getAttribute("data-surah"),P=c.getAttribute("data-ayah");if(w&&S&&P)try{const I=await ke.getExplanationByNumber(parseInt(S),parseInt(P),w);alert(I?`Explanation ${w}:

${I}`:"Explanation not found.")}catch(I){console.error("âŒ Error loading Bangla explanation:",I),alert("Error loading explanation.")}}};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]),x.useEffect(()=>{const t=async f=>{f.preventDefault(),f.stopPropagation();const c=f.target.closest(".hindi-explanation-link");if(c){const w=c.getAttribute("data-explanation-number"),S=c.getAttribute("data-surah"),P=c.getAttribute("data-ayah");if(w&&S&&P)try{const I=await we.getExplanationByNumber(parseInt(S),parseInt(P),w);alert(I?`Explanation ${w}:

${I}`:`Explanation ${w} not found.`)}catch(I){console.error("âŒ Error loading Hindi explanation:",I),alert("Error loading explanation.")}}};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]),x.useEffect(()=>{const t=async f=>{f.preventDefault(),f.stopPropagation();const c=f.target.closest(".urdu-footnote-link");if(c){const w=c.getAttribute("data-footnote-id");c.getAttribute("data-footnote-number");const S=c.getAttribute("data-surah"),P=c.getAttribute("data-ayah");if(w&&S&&P)try{const I=await Te.getFootnoteExplanation(w);if(I&&I.trim()!==""&&I!=="Explanation not available"){const K=We(I);B([{interpretation:K,AudioIntrerptn:K,text:K,content:K}]),setShowInterpretationModal(!0)}else showToast("Footnote explanation not available","warning")}catch(I){console.error("Error fetching Urdu footnote:",I),showToast("Failed to load footnote explanation","error")}}};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]);const u=()=>{b<$&&k(b+1)},E=()=>{b>1&&k(b-1)},T=t=>{O(!0)},W=()=>{O(!1)},re=t=>{if(a!=="mal")return;const f=t.target.closest("sup, a");if(!f)return;const c=(f.innerText||f.textContent||"").trim();if(!c)return;let w=!1;const S=c.replace(/[\s()]+/g,"").toUpperCase();if(/^N\d+$/.test(S))w=!0,s&&s(),g(`/note/${S}`);else{const P=c.match(/(\d+)\s*[:ï¼š]\s*(\d+)/);if(P){const I=parseInt(P[1],10),K=parseInt(P[2],10);Number.isFinite(I)&&Number.isFinite(K)&&(w=!0,R(I),k(K))}}w&&(t.preventDefault(),t.stopPropagation())};x.useEffect(()=>{if(H){const t=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}}},[H]);const q=document.getElementById("modal-root")||document.body;if(ee)return le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm"}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx(je,{surahId:m,verseId:b,totalVerses:$,surahInfo:N,onVerseChange:k,onClose:s,onWordByWordClick:T,verseData:C,interpretationData:v,selectedQari:V,onQariChange:L}),e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-[300px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading verse data..."})]})})]})]}),q);if(te)return le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm",onClick:s}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] max-w-4xl flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx(je,{surahId:m,verseId:b,totalVerses:$,surahInfo:N,onVerseChange:k,onClose:s,onWordByWordClick:T,verseData:C,interpretationData:v,selectedQari:V,onQariChange:L}),e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-[300px] p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 dark:text-red-400 text-lg mb-2",children:"Failed to load verse data"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:te}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Try Again"})]})})]})]}),q);const o=typeof a=="string"&&["e","en"].includes(a.toLowerCase()),l=N?.arabic||(m?`Surah ${m}`:"Surah"),y=rt(m,l);return le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:s}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx("div",{className:"sm:hidden w-full flex justify-center pt-3 pb-1 bg-white dark:bg-gray-900 border-b border-gray-100 dark:border-gray-800",onClick:s,children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx(je,{surahId:m,verseId:b,totalVerses:$,surahInfo:N,onVerseChange:k,onClose:s,onWordByWordClick:T,verseData:C,selectedQari:V,onQariChange:L}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-4 sm:py-6 overflow-y-auto flex-1 bg-gray-50/50 dark:bg-gray-900/50",children:[e.jsx("div",{className:"mb-4 sm:mb-6 text-center sm:text-left",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mb-3 gap-2",children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-medium text-gray-800 dark:text-gray-200",style:{fontFamily:nt},"aria-label":l,children:y}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 border border-gray-200 dark:border-gray-700",children:["Verse ",b," of ",$]})]})}),C&&e.jsx("div",{className:"text-right mb-6 sm:mb-8 border-b border-gray-200 dark:border-gray-700 pb-6",children:e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl dark:text-white text-gray-900 leading-[2.2] px-2 sm:px-0",style:{fontFamily:r,fontSize:`${d}px`},dir:"rtl",children:C.arabic})}),C&&!o&&a!=="ur"&&e.jsx("div",{className:"mb-6 sm:mb-8",children:a==="bn"?e.jsx("div",{className:"text-gray-700 leading-[1.8] font-bengali dark:text-gray-200 px-2 sm:px-0 prose dark:prose-invert max-w-none",style:{fontSize:`${p}px`},dangerouslySetInnerHTML:{__html:ke.parseBanglaTranslationWithClickableExplanations(C.translation,m,b)}}):a==="hi"?e.jsx("div",{className:"text-gray-700 leading-[1.8] font-hindi dark:text-gray-200 px-2 sm:px-0 prose dark:prose-invert max-w-none",style:{fontSize:`${p}px`},dangerouslySetInnerHTML:{__html:we.parseHindiTranslationWithClickableExplanations(C.translation,m,b)}}):a==="ta"?e.jsx("div",{className:"text-gray-700 leading-[1.8] font-tamil dark:text-gray-200 px-2 sm:px-0 prose dark:prose-invert max-w-none",style:{fontSize:`${p}px`},dangerouslySetInnerHTML:{__html:C.translation}}):e.jsx("p",{className:"text-gray-700 leading-[1.8] font-poppins dark:text-gray-200 px-2 sm:px-0",style:{fontSize:`${p}px`},children:C.translation})}),(v&&v.length>0&&console.log(`[AyahModal] ðŸ–¼ï¸ RENDER CHECK - About to render interpretation section for Surah ${m}, Ayah ${b}`,{interpretationDataLength:v.length,firstInterpretation:v[0],firstInterpretationText:v[0]?.Interpretation?.substring(0,150)||v[0]?.interpretation?.substring(0,150)||"N/A",willShowFirstOnly:a==="mal"}),null),v&&v.length>0&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("h4",{className:"text-sm font-semibold uppercase tracking-wider text-primary dark:text-primary-light mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-[1px] bg-primary dark:bg-primary-light"}),"Tafheem-ul-Quran"]}),a==="ur"&&e.jsx("style",{children:`
                  .ayah-interpretation-content.font-urdu-nastaliq * {
                    font-family: 'Noto Nastaliq Urdu', 'JameelNoori', serif !important;
                  }
                  .ayah-interpretation-content.font-urdu-nastaliq a {
                    font-family: 'Noto Nastaliq Urdu', 'JameelNoori', serif !important;
                    text-align: right !important;
                  }
                `}),a==="mal"&&e.jsx("style",{children:`
                    .ayah-interpretation-content sup.f-intprno,
                    .ayah-interpretation-content sup.f-noteno,
                    .ayah-interpretation-content a.crs {
                      color: #0F766E !important;
                      cursor: pointer !important;
                      text-decoration: none !important;
                      font-weight: bold;
                    }
                    .dark .ayah-interpretation-content sup.f-intprno,
                    .dark .ayah-interpretation-content sup.f-noteno,
                    .dark .ayah-interpretation-content a.crs {
                      color: #14B8A6 !important;
                    }

                    .ayah-interpretation-content sup.f-intprno:hover,
                    .ayah-interpretation-content sup.f-noteno:hover,
                    .ayah-interpretation-content a.crs:hover {
                      text-decoration: underline !important;
                    }
                  `}),e.jsx("div",{className:`space-y-4 ayah-interpretation-content ${a==="ur"?"font-urdu-nastaliq":""}`,onClick:re,children:(a==="mal"?v.slice(0,1):v).map((t,f)=>{a==="mal"&&f===0&&console.log(`[AyahModal] ðŸŽ¨ RENDERING interpretation for Surah ${m}, Ayah ${b}`,{interpretationObject:t,hasInterpretation:!!t.Interpretation,interpretationLength:t.Interpretation?.length||0,interpretationPreview:t.Interpretation?.substring(0,150)||"N/A"});const w=[t.AudioIntrerptn,t.interpretation,t.Interpretation,t.text,t.content,t?.interpretation_text,t?.InterpretationText].find(K=>typeof K=="string"&&K.trim().length>0)||"No interpretation available";let S=typeof w=="string"?w:String(w??"");a==="ur"&&(S=We(S));const P=a==="hi"?t.explanation_no_BN||t.explanation_no_EN||f+1:a==="bn"?t.explanation_no_BNG||t.explanation_no_EN||f+1:a==="ur"?t.explanation_no||f+1:o?t.interptn_no||t.number||f+1:t.resolvedInterpretationNo||t.InterpretationNo||t.Interpretation_No||t.interptn_no||t.number||t.requestedInterpretationNo||f+1,I=`${m}-${b}-${t.InterpretationNo||t.interptn_no||t.number||f}`;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm border border-gray-100 dark:border-gray-700",children:[(a==="hi"||a==="ur")&&e.jsxs("div",{className:"mb-3 text-sm font-bold text-primary dark:text-primary-light",children:["Explanation ",P,":"]}),o&&null,e.jsx("div",{className:`text-gray-700 leading-[1.8] dark:text-gray-300 text-sm sm:text-base text-justify ${a==="ur"?"font-urdu-nastaliq":"font-poppins"}`,style:{fontSize:`${p}px`,textAlign:a==="ur"?"right":"justify",...a==="ur"?{lineHeight:"2.6",fontFamily:"'Noto Nastaliq Urdu', 'JameelNoori', serif"}:{}},dir:a==="ur"?"rtl":"ltr",dangerouslySetInnerHTML:{__html:S}})]},I)})},`interpretation-content-${m}-${b}`)]},`interpretation-${m}-${b}`),(!v||v.length===0)&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-3",children:"Interpretation"}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-sm italic flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-400"}),m===114?"Interpretation data is not available for Surah An-Nas (114).":"No interpretation available for this verse."]})})]})]}),e.jsxs("div",{className:"flex justify-between gap-3 p-4 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800",children:[e.jsxs("button",{onClick:E,disabled:b<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-xl border transition-all duration-200 group ${b<=1?"bg-gray-50 text-gray-400 border-gray-100 dark:bg-gray-800 dark:text-gray-600 dark:border-gray-700 cursor-not-allowed":"bg-white text-gray-700 border-gray-200 hover:border-primary hover:text-primary hover:bg-primary/5 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:border-primary-light dark:hover:text-primary-light"}`,children:[e.jsx(qe,{className:"w-4 h-4 group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-sm font-medium",children:"Prev"})]}),e.jsxs("button",{onClick:u,disabled:b>=$,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-xl border transition-all duration-200 group ${b>=$?"bg-gray-50 text-gray-400 border-gray-100 dark:bg-gray-800 dark:text-gray-600 dark:border-gray-700 cursor-not-allowed":"bg-primary text-white border-primary hover:bg-primary-dark shadow-lg shadow-primary/20 dark:bg-primary dark:border-primary dark:hover:bg-primary-dark"}`,children:[e.jsx("span",{className:"text-sm font-medium",children:"Next Ayah"}),e.jsx(Fe,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]})]})]}),H&&le.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-start justify-center z-[100000] pt-24 sm:pt-28 lg:pt-32 p-4 overflow-hidden",children:e.jsx("div",{className:"bg-white dark:bg-[#2A2C38] rounded-xl shadow-2xl w-full sm:w-auto sm:max-w-6xl max-w-[95vw]",children:e.jsx(mt,{selectedVerse:b,surahId:m,onClose:W,onNavigate:k})})}),q),e.jsx(ue,{toasts:M,removeToast:i})]}),q)},mt=({selectedVerse:j,surahId:n,onClose:s,onNavigate:r,onSurahChange:d})=>{const p=Xe(),a=be(),M=Ze(),i=p.surahId||n,g=p.verseId?parseInt(p.verseId):j,{quranFont:m,fontSize:R,adjustedTranslationFontSize:b,translationLanguage:k}=Se(),[N,ne]=x.useState(null),[C,G]=x.useState([]),[v,B]=x.useState(null),[ee,J]=x.useState(!0),[te,U]=x.useState(null),[$,ae]=x.useState(0),[H,O]=x.useState(!1),{toasts:X,removeToast:Q,showSuccess:F,showError:V}=Ie(),L=document.getElementById("modal-root")||document.body;x.useEffect(()=>{(async()=>{if(!(!g||!i))try{J(!0),U(null);const y=[k==="ta"?Ye.getWordByWordDataWithArabic(i,g).catch(async w=>await ge(i,g,"E")):k==="hi"?et.getWordByWordDataWithArabic(i,g).catch(async w=>await ge(i,g,"E")):k==="bn"?tt.getWordByWordDataWithArabic(i,g).catch(async w=>await ge(i,g,"E")):k==="mal"?lt.getWordByWordDataWithArabic(i,g).catch(async w=>await ge(i,g,"E")):ge(i,g,k),Je(i,g).catch(()=>[]),v?Promise.resolve(v):fe().then(w=>w.find(S=>S.number===parseInt(i))).catch(()=>null)],[t,f,c]=await Promise.all(y);ne(t),G(f||[]),B(c),ae(c?.ayahs||0)}catch(y){U(y.message)}finally{J(!1)}})()},[g,i,k]);const de=()=>{g>1&&(r?r(g-1):a(`/word-by-word/${i}/${g-1}`,{state:M.state}))},ce=()=>{r?r(g+1):a(`/word-by-word/${i}/${g+1}`,{state:M.state})},u=()=>{if(s)s();else{const l=M.state?.from;a(l&&l!=="/surah/all"&&l!=="/surah"?l:`/surah/${i}`)}},E=l=>{O(!0)},T=l=>{d?d(l):r?(s(),a(`/surah/${l}?wordByWord=1`)):a(`/word-by-word/${l}/1`,{state:M.state})},W=l=>{r?r(l):a(`/word-by-word/${i}/${l}`,{state:M.state})},re=()=>{O(!1)},o=(l=>{switch(l){case"mal":return"Malayalam";case"E":return"English";case"ta":return"Tamil";case"hi":return"Hindi";case"ur":return"Urdu";case"ar":return"Arabic";default:return"English"}})(k);return ee?le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm"}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx("div",{className:"flex-shrink-0 z-10 bg-white dark:bg-gray-900",children:e.jsx(Ne,{surahId:i,selectedVerse:g,surahInfo:v,onNavigate:r,onClose:u,onShowAyahModal:E,onSurahChange:T,onVerseChange:W,wordData:N,showSuccess:F,showError:V,translationLanguage:k})}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-6 py-8 min-h-[300px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading word meanings..."})]})}),e.jsx(ue,{toasts:X,removeToast:Q})]})]}),L):te?le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm",onClick:u}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx("div",{className:"flex-shrink-0 z-10 bg-white dark:bg-gray-900",children:e.jsx(Ne,{surahId:i,selectedVerse:g,surahInfo:v,onNavigate:r,onClose:u,onShowAyahModal:E,onSurahChange:T,onVerseChange:W,wordData:N,showSuccess:F,showError:V,translationLanguage:k})}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-6 py-8 min-h-[300px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 dark:text-red-400 mb-2",children:"Failed to load word meanings"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:te}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Retry"})]})}),e.jsx(ue,{toasts:X,removeToast:Q})]})]}),L):le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:u}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx("div",{className:"sm:hidden w-full flex justify-center pt-3 pb-1 bg-white dark:bg-gray-900 border-b border-gray-100 dark:border-gray-800",onClick:u,children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx("div",{className:"flex-shrink-0 z-10 bg-white dark:bg-gray-900",children:e.jsx(Ne,{surahId:i,selectedVerse:g,surahInfo:v,onNavigate:r,onClose:u,onShowAyahModal:E,onSurahChange:T,onVerseChange:W,wordData:N,showSuccess:F,showError:V,translationLanguage:k})}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-4 sm:py-6 overflow-y-auto flex-1 bg-gray-50/50 dark:bg-gray-900/50",children:[e.jsx("div",{className:"mb-4 sm:mb-6 text-center sm:text-left",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mb-3 gap-2",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-medium text-gray-800 dark:text-gray-200",style:{fontFamily:m,fontSize:`${R}px`},children:v?.arabic||`Surah ${i}`}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 border border-gray-200 dark:border-gray-700",children:["Verse ",g," of ",$]})]})}),N&&e.jsx("div",{className:"text-right mb-6 sm:mb-8 border-b border-gray-200 dark:border-gray-700 pb-6",children:e.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl dark:text-white text-gray-900 leading-[2.2] px-2 sm:px-0",style:{fontFamily:m,fontSize:`${R}px`},dir:"rtl",children:[N.text_uthmani||N.words&&N.words.map(l=>l.text_uthmani||l.text_simple).join(" ")||"Verse text not available"," "]})}),N&&N.translations&&N.translations.length>0&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("h4",{className:"text-sm font-semibold uppercase tracking-wider text-primary dark:text-primary-light mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-[1px] bg-primary dark:bg-primary-light"}),"Translation"]}),e.jsx("p",{className:`text-gray-700 leading-[1.8] dark:text-gray-200 px-2 sm:px-0 ${k==="hi"?"font-hindi":k==="ur"?"font-urdu-nastaliq":k==="bn"?"font-bengali":k==="ta"?"font-tamil":k==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${b}px`},children:N.translations[0].text})]}),N&&N.words&&N.words.length>0&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[k!=="bn"&&e.jsxs("h4",{className:"text-sm font-semibold uppercase tracking-wider text-primary dark:text-primary-light mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-[1px] bg-primary dark:bg-primary-light"}),"Word Breakdown (",o,")"]}),e.jsx("div",{className:"space-y-4",children:N.words.map((l,y)=>{const t=l.text_uthmani||l.text_simple||"",f=!!(l.translation&&l.translation.text);return t&&/^[\s()\u0660-\u0669\u06F0-\u06F9\uFD3E\uFD3F0-9]+$/.test(t)&&!f?null:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-row-reverse justify-between items-center",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl sm:text-3xl text-gray-800 dark:text-white font-arabic",style:{fontFamily:m,fontSize:`${R}px`},children:l.text_uthmani||l.text_simple||"N/A"}),l.text_simple&&l.text_uthmani!==l.text_simple&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:l.text_simple})]}),e.jsxs("div",{className:"text-left max-w-[60%]",children:[f?e.jsx("p",{className:`text-gray-700 leading-[1.6] sm:leading-[1.7] lg:leading-[1.8] dark:text-gray-200 mb-1 font-medium ${k==="hi"?"font-hindi":k==="ur"?"font-urdu-nastaliq":k==="bn"?"font-bengali":k==="ta"?"font-tamil":k==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${b}px`},children:l.translation.text}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-1 italic",style:{fontSize:`${b}px`},children:"Translation not available"}),l.class_name&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1 uppercase tracking-wide",children:l.class_name})]})]})},y)})})]}),N&&(!N.words||N.words.length===0)&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Word Breakdown:"}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm italic",children:"Word-by-word breakdown not available for this verse."})})]}),k==="mal"&&(!N||!N.words||N.words.length===0)&&C&&C.length>0&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("h4",{className:"text-sm font-semibold uppercase tracking-wider text-primary dark:text-primary-light mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-[1px] bg-primary dark:bg-primary-light"}),"Word Breakdown (Malayalam)"]}),e.jsx("div",{className:"space-y-4",children:C.reduce((y,t,f)=>{const c=t.WordPhrase||t.text_uthmani||t.text_simple||"";return y.findIndex(S=>(S.WordPhrase||S.text_uthmani||S.text_simple)===c)===-1&&y.push({...t,originalIndex:f}),y},[]).map((y,t)=>{const f=y.WordPhrase||y.text_uthmani||y.text_simple||"",c=y.Meaning||y.translation?.text||"";return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-row-reverse justify-between items-center",children:[e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-2xl sm:text-3xl font-arabic dark:text-white text-gray-800",style:{fontFamily:m,fontSize:`${R}px`},children:f})}),e.jsx("div",{className:"text-left max-w-[60%]",children:e.jsx("span",{className:"text-gray-700 leading-[1.6] font-poppins sm:leading-[1.7] lg:leading-[1.8] dark:text-gray-200 font-malayalam font-medium",style:{fontSize:`${b}px`},children:c})})]})},`${f}-${t}`)})})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex justify-between gap-3 p-4 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 z-10",children:[e.jsxs("button",{onClick:de,disabled:g<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-xl border transition-all duration-200 group ${g<=1?"bg-gray-50 text-gray-400 border-gray-100 dark:bg-gray-800 dark:text-gray-600 dark:border-gray-700 cursor-not-allowed":"bg-white text-gray-700 border-gray-200 hover:border-primary hover:text-primary hover:bg-primary/5 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:border-primary-light dark:hover:text-primary-light"}`,children:[e.jsx(qe,{className:"w-4 h-4 group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-sm font-medium",children:"Prev"})]}),e.jsxs("button",{onClick:ce,disabled:g>=$,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-xl border transition-all duration-200 group ${g>=$?"bg-gray-50 text-gray-400 border-gray-100 dark:bg-gray-800 dark:text-gray-600 dark:border-gray-700 cursor-not-allowed":"bg-primary text-white border-primary hover:bg-primary-dark shadow-lg shadow-primary/20 dark:bg-primary dark:border-primary dark:hover:bg-primary-dark"}`,children:[e.jsx("span",{className:"text-sm font-medium",children:"Next Ayah"}),e.jsx(Fe,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]})]}),H&&e.jsx(ct,{surahId:i,verseId:g,onClose:re}),e.jsx(ue,{toasts:X,removeToast:Q})]})]}),L)};export{ct as A,mt as W};
