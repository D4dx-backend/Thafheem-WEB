import{G as ze,ae as qe,u as We,j as e,X as ue,W as ye,B as Ue,o as Me,p as Be,t as fe,w as he,i as De,q as Pe,af as He,I as Ke,v as Oe,n as Qe,ag as ge,ah as Ge}from"./index-DmadXW_T.js";import{b as x,u as be,c as le,d as Xe,e as Je}from"./react-vendor-v5ei6ytj.js";import Ye from"./tamilWordByWordService-CjzSbLrS.js";import Ze from"./hindiWordByWordService-CwYWlP76.js";import et from"./banglaWordByWordService-CtsFC8ds.js";import{a as ie}from"./apiService-BnqKikZw.js";import{u as Se,T as pe}from"./Toast-8dnuOEuu.js";import{C as Fe}from"./chevron-left-DAZqGN25.js";import tt from"./tamilTranslationService-D5LUOoAY.js";import we from"./hindiTranslationService-BCljsrBM.js";import Ee from"./urduTranslationService-BM_bPhej.js";import ke from"./banglaTranslationService-BhOEZ8RM.js";import ve from"./englishTranslationService-Cw_-4qKN.js";import{g as at,s as rt}from"./surahNameUtils-DQZqK-eJ.js";const nt=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"16",height:"18",x:"4",y:"4",rx:"2",key:"1u9h20"}],["path",{d:"M8 10h6",key:"3oa6kw"}],["path",{d:"M8 14h8",key:"1fgep2"}],["path",{d:"M8 18h5",key:"17enja"}]],st=ze("notepad-text",nt);class ot{constructor(){this.language="malayalam",this.apiBasePath=qe,this.pendingRequests=new Map,this.cache=new Map,this.cacheEnabled=!0,this.cacheTtl=3e5}generateCacheKey(s,r){const a=Object.keys(r).sort().map(d=>`${d}=${r[d]}`).join("&");return`${s}${a?`?${a}`:""}`}isCacheValid(s){return Date.now()-s<this.cacheTtl}getCachedData(s){if(!this.cacheEnabled)return null;const r=this.cache.get(s);return r&&this.isCacheValid(r.timestamp)?r.data:(r&&this.cache.delete(s),null)}setCachedData(s,r){this.cacheEnabled&&this.cache.set(s,{data:r,timestamp:Date.now()})}async getAyahTranslation(s,r){const a=this.generateCacheKey("getAyahTranslation",{surahId:s,ayahNumber:r}),d=this.getCachedData(a);if(d)return d;if(this.pendingRequests.has(a))return this.pendingRequests.get(a);const u=this._getAyahTranslationInternal(s,r,a);this.pendingRequests.set(a,u);try{return await u}finally{this.pendingRequests.delete(a)}}async _getAyahTranslationInternal(s,r,a){try{const d=await ie.getTranslation(this.language,s,r),u=d?.translation_text??d?.translation??null;return u?(this.setCachedData(a,u),u):(console.warn(`âš ï¸ No Malayalam translation returned for ${s}:${r}`),null)}catch(d){throw console.error(`âŒ Malayalam translation API failed for ${s}:${r}:`,d),d}}async getSurahTranslations(s){const r=this.generateCacheKey("getSurahTranslations",{surahId:s}),a=this.getCachedData(r);if(a)return a;if(this.pendingRequests.has(r))return this.pendingRequests.get(r);const d=this._getSurahTranslationsInternal(s,r);this.pendingRequests.set(r,d);try{return await d}finally{this.pendingRequests.delete(r)}}async _getSurahTranslationsInternal(s,r){try{const a=await ie.getSurahTranslations(this.language,s),d=Array.isArray(a?.translations)?a.translations.map(u=>({number:u.verse_number,ArabicText:"",Translation:u.translation_text??""})):[];return this.setCachedData(r,d),d}catch(a){throw console.error(`âŒ Malayalam surah translation API failed for ${s}:`,a),a}}async getInterpretation(s,r,a=null){const d=this.generateCacheKey("getInterpretation",{surahId:s,ayahNumber:r,interpretationNo:a}),u=this.getCachedData(d);if(u)return u;if(this.pendingRequests.has(d))return this.pendingRequests.get(d);const n=this._getInterpretationInternal(s,r,a,d);this.pendingRequests.set(d,n);try{return await n}finally{this.pendingRequests.delete(d)}}async _getInterpretationInternal(s,r,a,d){try{const u=await ie.getInterpretation(this.language,s,r,a),n=Array.isArray(u?.explanations)?u.explanations:[];return this.setCachedData(d,n),n}catch(u){throw console.error(`âŒ Malayalam interpretation API failed for ${s}:${r}:`,u),u}}async getWordByWordData(s,r){const a=this.generateCacheKey("getWordByWordData",{surahId:s,ayahNumber:r}),d=this.getCachedData(a);if(d)return d;if(this.pendingRequests.has(a))return this.pendingRequests.get(a);const u=this._getWordByWordDataInternal(s,r,a);this.pendingRequests.set(a,u);try{return await u}finally{this.pendingRequests.delete(a)}}async _getWordByWordDataInternal(s,r,a){try{const d=await ie.getWordByWord(this.language,s,r),u=Array.isArray(d?.words)?d.words:[];if(u.length===0)return console.warn(`âš ï¸ No Malayalam word-by-word data for ${s}:${r}`),null;const n=u.map((o,g)=>({id:o.WordId||o.id||g+1,position:o.WordId||o.id||g+1,audio_url:o.audio_url||null,char_type_name:o.char_type_name||"word",code_v1:o.code_v1||"",code_v2:o.code_v2||"",line_number:o.line_number||1,page_number:o.page_number||1,text_uthmani:o.text_uthmani||o.WordPhrase||"",text_simple:o.text_simple||o.WordPhrase||"",translation:{text:o.MalMeaning||o.WordMeaning||o.translation?.text||"",language_name:"Malayalam",resource_name:"Thafheem Malayalam Word Database"},transliteration:{text:o.transliteration?.text||o.WordPhrase||"",language_name:"English"}})),W={text_uthmani:d?.text_uthmani||"",words:n,translations:d?.translations||[]};return this.setCachedData(a,W),W}catch(d){throw console.error(`âŒ Malayalam word-by-word API failed for ${s}:${r}:`,d),d}}async getWordByWordDataWithArabic(s,r){try{const a=await this.getWordByWordData(s,r);if(!a)return console.warn(`âš ï¸ No Malayalam data found for ${s}:${r}, falling back to English`),await this.getEnglishFallback(s,r);try{const d=await ie.getArabicText(s,r);return{...a,text_uthmani:d.text_uthmani||a.text_uthmani,text_simple:d.text_simple||a.text_simple}}catch{console.warn("âš ï¸ Could not fetch Arabic text, using Malayalam data only")}return a}catch(a){throw console.error(`âŒ Error fetching Malayalam word-by-word with Arabic for ${s}:${r}:`,a),a}}async getEnglishFallback(s,r){try{const a=await ie.getWordByWord("english",s,r),d=Array.isArray(a?.words)?a.words:[];if(d.length===0)return null;const u=d.map((n,W)=>({id:n.WordId||n.id||W+1,position:n.WordId||n.id||W+1,text_uthmani:n.text_uthmani||n.WordPhrase||"",text_simple:n.text_simple||n.WordPhrase||"",translation:{text:n.EngMeaning||n.WordMeaning||n.translation?.text||"",language_name:"English",resource_name:"Thafheem English Word Database"}}));return{text_uthmani:a?.text_uthmani||"",words:u,translations:a?.translations||[]}}catch(a){return console.error(`âŒ English fallback failed for ${s}:${r}:`,a),null}}async getFootnote(s){const r=this.generateCacheKey("getFootnote",{footnoteId:s}),a=this.getCachedData(r);if(a)return a;try{const u=(await ie.getMalayalamFootnote(s))?.footnote_text||"";return this.setCachedData(r,u),u}catch(d){throw console.error(`âŒ Malayalam footnote API failed for ${s}:`,d),d}}clearCache(){this.cache.clear(),this.pendingRequests.clear()}}const it=new ot,Ne=({surahId:I,selectedVerse:s,surahInfo:r,onNavigate:a,onClose:d,onShowAyahModal:u,onSurahChange:n,onVerseChange:W,wordData:o=null,showSuccess:g=null,showError:m=null,translationLanguage:G=null})=>{const[b,k]=x.useState(!0),[N,te]=x.useState([]),[E,H]=x.useState(!1),[j,D]=x.useState(!1),[ee,X]=x.useState(!1),[K,z]=x.useState(!1),[T,ae]=x.useState(""),O=x.useRef(null),q=x.useRef(null),U=be(),{user:R}=We?.()||{user:null};r?.ayahs;const J=p=>{H(!1),ae(""),n&&n(p.number)},V=p=>{D(!1),W&&W(p)},Q=()=>{const p=r?.ayahs||0;return Array.from({length:p},(_,M)=>M+1)},de=async()=>{try{X(!0);const p=he.getEffectiveUserId(R),_=r?.name||`Surah ${I}`,M=o?.text_uthmani||o?.translations?.[0]?.text||"";await he.addBookmark(p,I,s,"word-by-word",_,M),g&&g("Word-by-word content bookmarked successfully!")}catch(p){console.error("Failed to bookmark word-by-word content:",p),m&&m("Failed to save bookmark. Please try again.")}finally{setTimeout(()=>X(!1),300)}},ce=async()=>{try{const p=r?.name||`Surah ${I}`,_=o?.text_uthmani||o?.translations?.[0]?.text||"",M=o?.translations?.[0]?.text||"";let B=`Word by Word - ${p}, Verse ${s}

`;B+=`Arabic: ${_}

`,M&&(B+=`Translation: ${M}

`),o?.words&&o.words.length>0&&(B+=`Word Breakdown:
`,o.words.slice(0,5).forEach((l,f)=>{const i=l.text_uthmani||l.text_simple||"",w=l.translation?.text||"N/A";B+=`${f+1}. ${i} - ${w}
`}),o.words.length>5&&(B+=`... and ${o.words.length-5} more words
`),B+=`
`),B+="Shared from Thafheem - Word by Word Study";const re=window.location.href;if(navigator.share)await navigator.share({title:`Word by Word - ${p}, Verse ${s}`,text:B,url:re});else{const l=`${B}

View full content: ${re}`;if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(l),alert("Word-by-word content copied to clipboard for sharing");else{const f=document.createElement("textarea");f.value=l,f.style.position="fixed",f.style.left="-999999px",f.style.top="-999999px",document.body.appendChild(f),f.focus(),f.select(),document.execCommand("copy"),document.body.removeChild(f),alert("Word-by-word content copied to clipboard for sharing")}}}catch(p){console.error("Failed to share word-by-word content:",p),p.name!=="AbortError"&&alert("Failed to share content: "+p.message)}};return x.useEffect(()=>{(async()=>{try{z(!0);const _=await fe();te(_)}catch(_){console.error("Error loading surahs:",_)}finally{z(!1)}})()},[]),x.useEffect(()=>{const p=_=>{O.current&&!O.current.contains(_.target)&&H(!1),q.current&&!q.current.contains(_.target)&&D(!1)};return document.addEventListener("mousedown",p),()=>{document.removeEventListener("mousedown",p)}},[]),N.filter(p=>p.name.toLowerCase().includes(T.toLowerCase())||p.arabic.includes(T)||p.number.toString().includes(T)),b?e.jsxs("div",{className:"bg-white dark:bg-gray-900 px-3 sm:px-4 py-3 space-y-3 relative z-10",children:[e.jsx("button",{className:"absolute top-2 right-2 sm:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors bg-white dark:bg-gray-600 shadow-sm z-10",title:"Close",onClick:()=>d?d():U(-1),children:e.jsx(ue,{className:"w-4 h-4 text-gray-600 dark:text-white"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2 sm:space-x-3 pr-12 sm:pr-0",children:[e.jsxs("div",{className:"relative dropdown-container",ref:O,children:[e.jsxs("button",{onClick:()=>H(!E),className:"flex font-poppins items-center space-x-2 px-3 sm:px-4 py-2 bg-gray-100 dark:bg-[#323A3F] dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs sm:text-sm font-medium text-gray-700 transition-colors",children:[e.jsx("span",{children:I?`${I} - ${r?.name||"Loading..."}`:"Select Surah"}),e.jsx(ye,{className:"w-4 h-4 text-gray-600 dark:text-white"})]}),E&&!K&&e.jsx("div",{className:"absolute sm:text-sm text-sm top-full left-0 mt-2 bg-white dark:bg-[#2A2C38] shadow-lg rounded-lg overflow-auto w-80 sm:w-45 h-[calc(100vh-100px)] z-50",children:N.map(p=>e.jsxs("div",{className:`px-4 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-white ${p.number===parseInt(I)?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>J(p),children:[p.number," - ",p.name]},p.number))})]}),e.jsxs("div",{className:"relative dropdown-container",ref:q,children:[e.jsxs("button",{onClick:()=>D(!j),className:"flex font-poppins items-center space-x-2 px-3 sm:px-4 py-2 bg-gray-100 dark:bg-[#323A3F] dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs sm:text-sm font-medium text-gray-700 transition-colors",children:[e.jsx("span",{children:s||"1"}),e.jsx(ye,{className:"w-4 h-4 text-gray-600 dark:text-white"})]}),j&&e.jsx("div",{className:"absolute top-full left-0 mt-2 bg-white dark:bg-[#2A2C38] shadow-lg rounded-lg overflow-auto w-auto max-h-60 z-50",children:Q().map(p=>e.jsx("div",{className:`px-4 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-white ${parseInt(s)===p?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>V(p),children:p},p))})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 self-end sm:self-auto",children:[G!=="ta"&&e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"View Ayah Details",onClick:()=>u&&u(s),children:e.jsx(Ue,{className:"w-4 sm:w-5 h-4 sm:h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{onClick:de,disabled:ee,className:`p-2 rounded-lg transition-colors ${ee?"text-gray-400 cursor-not-allowed":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,title:ee?"Saving...":"Bookmark this verse",children:e.jsx(Me,{className:"w-4 sm:w-5 h-4 sm:h-5"})}),e.jsx("button",{onClick:ce,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Share word-by-word content",children:e.jsx(Be,{className:"w-4 sm:w-5 h-4 sm:h-5 text-gray-600 dark:text-gray-300"})}),d&&e.jsx("button",{className:"hidden sm:block p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors dark:bg-white",title:"Close",onClick:d,children:e.jsx(ue,{className:"w-5 h-5 text-gray-600"})})]})]})]}):null},je=({surahId:I,verseId:s,totalVerses:r,surahInfo:a,onVerseChange:d,onSurahChange:u,onClose:n,onWordByWordClick:W,verseData:o,interpretationData:g,selectedQari:m,onQariChange:G})=>{const[b,k]=x.useState(!0),[N,te]=x.useState(!1),[E,H]=x.useState(!1),[j,D]=x.useState([]),[ee,X]=x.useState(!0),[K,z]=x.useState(!1),[T,ae]=x.useState(!1),[O,q]=x.useState(!1),U=be(),{user:R}=We(),{showSuccess:J,showError:V}=Se();x.useEffect(()=>{(async()=>{try{const f=await fe();D(f)}catch(f){console.error("Error loading surahs:",f)}finally{X(!1)}})()},[]),x.useEffect(()=>{(async()=>{if(R&&I&&s)try{const f=await he.isBookmarked(R.uid,I,s,"interpretation");z(f)}catch(f){console.error("Error checking bookmark status:",f)}})()},[R,I,s]);const Q=Array.from({length:r||10},(l,f)=>f+1),de=a?`${a.number} - ${a.name||a.arabic}`:`${I} - Loading...`,ce=l=>{u?u(l):U(`/surah/${l}`),te(!1)},p=l=>{d&&d(l),H(!1)},_=l=>{if(l==null)return"";if(typeof l!="string")return String(l);if(typeof window<"u"){const f=document.createElement("div");return f.innerHTML=l,f.textContent||f.innerText||""}return l.replace(/<[^>]+>/g," ")},M=l=>{if(!l||typeof l!="object")return"";const f=["AudioIntrerptn","Interpretation","interpretation","AudioText","interpret_text","InterpretText","Interpret_Text","text","Text","content","Content","meaning","Meaning","body","Body","desc","Desc","description","Description"];for(const i of f)if(typeof l[i]=="string"&&l[i].trim().length>0)return l[i];for(const[i,w]of Object.entries(l))if(typeof w=="string"&&w.trim().length>10&&!["InterpretationNo","Interpretation_No","interptn_no","contiayano","ayaid","Ayaid","suraid","pageid","QAudioUrl","TransUrl","InterPtnUrl","ASuraName"].includes(i))return w;return""},B=async()=>{if(!o&&!g){V("No data available to copy");return}try{const l=[];if(o?.arabic&&l.push(o.arabic),o?.translation&&l.push(o.translation),g){const i=[];if(Array.isArray(g))g.forEach((w,t)=>{if(typeof w=="string"&&w.trim().length>0){const y=_(w);if(y.trim()){const c=g.length>1?`Interpretation ${t+1}:
`:`Interpretation:
`;i.push(c+y.trim())}}else if(w&&typeof w=="object"){const y=M(w);if(y){const c=_(y);if(c.trim()){const v=g.length>1?`Interpretation ${t+1}:
`:`Interpretation:
`;i.push(v+c.trim())}}}});else if(typeof g=="string"){const w=_(g);w.trim()&&i.push(`Interpretation:
`+w.trim())}else if(typeof g=="object"){const w=M(g);if(w){const t=_(w);t.trim()&&i.push(`Interpretation:
`+t.trim())}}i.length>0?l.push(i.join(`

`)):console.warn("Interpretation data exists but no text extracted:",g)}if(l.length===0){const i=a?.name||a?.arabic||`Surah ${I}`;l.push(`${i}, Verse ${s}`)}const f=l.join(`

---

`);if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(f);else{const i=document.createElement("textarea");i.value=f,i.style.position="fixed",i.style.opacity="0",document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i)}q(!0),J("Verse and interpretation copied to clipboard"),setTimeout(()=>q(!1),2e3)}catch(l){console.error("Failed to copy verse:",l),V("Failed to copy verse. Please try again.")}},re=async()=>{if(!R){U("/sign");return}try{if(ae(!0),K){const f=(await he.getBookmarks(R.uid,"interpretation")).find(i=>i.surahId===parseInt(I)&&i.verseId===parseInt(s));f&&(await he.deleteBookmark(f.id,R.uid),z(!1),J("Bookmark removed successfully"))}else{const l=a?.name||a?.arabic||`Surah ${I}`,f=o?.translation||o?.arabic||"";await he.addBookmark(R.uid,I,s,"interpretation",l,f),z(!0),J("Verse bookmarked successfully")}}catch(l){console.error("Error handling bookmark:",l),V("Failed to update bookmark. Please try again.")}finally{ae(!1)}};return b?e.jsxs("div",{className:"bg-white dark:bg-gray-900 px-3 sm:px-4 py-3 space-y-3 relative",children:[e.jsx("button",{className:"absolute top-2 right-2 sm:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors bg-white dark:bg-gray-600 shadow-sm z-10",title:"Close",onClick:n||(()=>U(-1)),children:e.jsx(ue,{className:"w-4 h-4 text-gray-600 dark:text-white"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2 sm:space-x-3 pr-12 sm:pr-0",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>te(l=>!l),className:"flex font-poppins items-center space-x-2 px-3 sm:px-4 py-2 bg-gray-100 dark:bg-[#323A3F] dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs sm:text-sm font-medium text-gray-700 transition-colors",children:[e.jsx("span",{children:de}),e.jsx(ye,{className:"w-4 h-4 text-gray-600 dark:text-white"})]}),N&&!ee&&e.jsx("div",{className:"absolute sm:text-sm text-sm top-full left-0 mt-2 bg-white dark:bg-[#2A2C38] shadow-lg rounded-lg overflow-auto w-80 sm:w-45 h-[calc(100vh-100px)] z-50",children:j.map(l=>e.jsxs("div",{className:`px-4 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-white ${l.number===parseInt(I)?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>ce(l.number),children:[l.number," - ",l.name]},l.number))})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>H(l=>!l),className:"flex font-poppins items-center space-x-2 px-3 sm:px-4 py-2 bg-gray-100 dark:bg-[#323A3F] dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs sm:text-sm font-medium text-gray-700 transition-colors",children:[e.jsxs("span",{children:[" ",s]}),e.jsx(ye,{className:"w-4 h-4 text-gray-600 dark:text-white"})]}),E&&e.jsx("div",{className:"absolute top-full left-0 mt-2 bg-white dark:bg-[#2A2C38] shadow-lg rounded-lg overflow-auto w-auto max-h-60 z-50",children:Q.map(l=>e.jsx("div",{className:`px-4 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-white ${l===parseInt(s)?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>p(l),children:l},l))})]})]}),e.jsx("div",{className:"hidden sm:flex items-center",children:e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors dark:bg-gray-950",title:"Close",onClick:n||(()=>U(-1)),children:e.jsx(ue,{className:"w-5 h-5 text-gray-600"})})})]}),e.jsxs("div",{className:"flex flex-row items-center justify-between gap-3 sm:gap-0",children:[e.jsx("div",{className:"flex items-center gap-2"}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[e.jsx("button",{onClick:B,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors relative",title:"Copy",children:O?e.jsx("span",{className:"text-green-500 font-bold text-xs",children:"Copied!"}):e.jsx(st,{className:"w-4 sm:w-5 h-4 sm:h-5 dark:text-white text-gray-600"})}),e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:K?"Remove Bookmark":"Add Bookmark",onClick:re,disabled:T,children:T?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 sm:h-5 sm:w-5 border-b border-current"}):e.jsx(Me,{className:`w-4 sm:w-5 h-4 sm:h-5 transition-colors ${K?"text-cyan-500 fill-cyan-500 dark:text-cyan-400 dark:fill-cyan-400":"text-gray-600 dark:text-gray-300"}`})}),e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Share",children:e.jsx(Be,{className:"w-4 sm:w-5 h-4 sm:h-5 text-gray-600 dark:text-gray-300"})})]})]})]}):null};let Ae=null,Te=0;const lt=300*1e3,dt=({surahId:I,verseId:s,onClose:r})=>{const{quranFont:a,fontSize:d,adjustedTranslationFontSize:u,translationLanguage:n}=De(),{toasts:W,removeToast:o}=Se(),g=be(),[m,G]=x.useState(()=>{const t=parseInt(I,10);return Number.isNaN(t)?0:t}),[b,k]=x.useState(1),[N,te]=x.useState(null),[E,H]=x.useState(null),[j,D]=x.useState(null),[ee,X]=x.useState(!0),[K,z]=x.useState(null),[T,ae]=x.useState(0),[O,q]=x.useState(!1),U=t=>{if(!t||typeof t!="object")return null;const y=[t.ayaid,t.AyaId,t.AyaID,t.contiayano,t.contiAyaNo,t.verse_number,t.number];for(const c of y){const v=Number.parseInt(c,10);if(Number.isFinite(v)&&v>0)return v}return null},[R,J]=x.useState(null),[V,Q]=x.useState("al-afasy"),[de,ce]=x.useState("qirath");x.useEffect(()=>{s&&k(parseInt(s))},[s]),x.useEffect(()=>{const t=parseInt(I,10);Number.isNaN(t)||G(t)},[I]),x.useEffect(()=>{let t=!1;return(async()=>{if(!(!m||!b)){console.log("[AyahModal] ðŸ”„ Loading data",{surahId:m,verseId:b,translationLanguage:n});try{X(!0),z(null),D(null),H(null);const c=b,v=n==="mal",$=n==="mal"?(async()=>{try{console.log("[AyahModal] ðŸŒ Fetching Malayalam interpretations via fetchAllInterpretations",{surahId:m,verseId:c});const h=await He(m,c,"mal");console.log("[AyahModal] âœ… Raw Malayalam interpretations from fetchAllInterpretations",{count:h?.length??0,sample:h?.[0]});const P=h&&h.length>0?h.map((S,oe)=>({interpretation:S.Interpretation||"",AudioIntrerptn:S.Interpretation||"",text:S.Interpretation||"",content:S.Interpretation||"",InterpretationNo:S.InterpretationNo||String(S.resolvedInterpretationNo||oe+1||1),interptn_no:S.resolvedInterpretationNo||parseInt(S.InterpretationNo||String(oe+1||1),10),number:S.resolvedInterpretationNo||parseInt(S.InterpretationNo||String(oe+1||1),10)})):[];return console.log("[AyahModal] ðŸ§¾ Transformed Malayalam interpretations for modal",{count:P.length,firstThree:P.slice(0,3)}),P}catch(h){return console.error(`[AyahModal] âŒ Error fetching Malayalam interpretations for Surah ${m}, Ayah ${c}:`,h),[]}})():n==="ta"?tt.getAyahTranslation(m,c).then(h=>h?[{interpretation:h,AudioIntrerptn:h,text:h,content:h}]:[]).catch(()=>[]):n==="hi"?we.getAllExplanations(m,c).then(h=>h&&h.length>0?h.map(S=>({interpretation:S.explanation,AudioIntrerptn:S.explanation,text:S.explanation,content:S.explanation,explanation_no_BN:S.explanation_no_BN,explanation_no_EN:S.explanation_no_EN})):[]).catch(h=>(console.error("âŒ Error fetching Hindi explanations in AyahModal:",h),[])):n==="ur"?Ee.getAllExplanations(m,c).then(h=>h&&h.length>0?h.map(P=>({interpretation:P.explanation,AudioIntrerptn:P.explanation,text:P.explanation,content:P.explanation,explanation_no:P.explanation_no})):[]).catch(()=>[]):n==="bn"?ke.getAllExplanations(m,c).then(h=>h&&h.length>0?h.map(S=>({interpretation:S.explanation,AudioIntrerptn:S.explanation,text:S.explanation,content:S.explanation,explanation_no_BNG:S.explanation_no_BNG,explanation_no_EN:S.explanation_no_EN})):[]).catch(h=>(console.error("âŒ Error fetching Bangla explanations in AyahModal:",h),[])):n==="E"?(async()=>{try{const h=await ve.getAyahTranslation(m,c);if(!h)return[];const P=/<sup[^>]*foot_note="([^"]+)"[^>]*>(\d+)<\/sup>/g,S=[];let oe;for(;(oe=P.exec(h))!==null;){const L=oe[1],Z=parseInt(oe[2],10);S.push({footnoteId:L,footnoteNumber:Z})}const $e=Array.from(new Map(S.map(L=>[L.footnoteId,L])).values());$e.sort((L,Z)=>L.footnoteNumber-Z.footnoteNumber);const Le=$e.map(async L=>{try{const Z=await ve.getExplanation(parseInt(L.footnoteId,10));return{interpretation:Z||"",AudioIntrerptn:Z||"",text:Z||"",content:Z||"",interptn_no:L.footnoteNumber,number:L.footnoteNumber,InterpretationNo:String(L.footnoteNumber),footnoteId:L.footnoteId}}catch(Z){return console.warn(`Failed to fetch footnote ${L.footnoteId}:`,Z),null}});return(await Promise.all(Le)).filter(Boolean)}catch(h){return console.error(`âŒ [AyahModal] Error fetching English footnotes for Surah ${m}, Ayah ${c}:`,h),[]}})():(async()=>{try{return await Ke(m,c,1,n)}catch(h){return console.error(`[AyahModal] Error fetching interpretations for Surah ${m}, Ayah ${c}:`,h),m===114?[]:[]}})(),F=n==="ta"||n==="hi"||n==="bn"||n==="E"||n==="ur"?Promise.resolve(null):Oe(m,c),A=Date.now(),ne=async()=>{if(Ae&&A-Te<lt)return Ae;const h=await fe();return Ae=h,Te=A,h},[Re,Ie,xe,C]=await Promise.all([ne(),Qe(m),F,$]);if(console.log("[AyahModal] ðŸ“¦ After Promise.all",{surahId:m,verseId:c,translationLanguage:n,hasArabic:!!Ie?.length,hasTranslationData:!!xe,interpretationType:typeof C,isArray:Array.isArray(C),interpretationCount:Array.isArray(C)?C.length:C?.data?.length??0}),t)return;const _e=Re.find(h=>h.number===m);te(_e||{arabic:"Unknown Surah",number:m}),ae(_e?.ayahs||0);const Ve=Ie.find(h=>h.verse_key===`${m}:${c}`),se=xe?Array.isArray(xe)?xe.find(h=>U(h)===c):xe:null;let Y=null;n==="mal"&&se&&(Y=[se.AudioIntrerptn,se.audioIntrerptn,se.Interpretation,se.interpretation].find(P=>typeof P=="string"&&P.trim().length>0)||null,console.log("[AyahModal] ðŸ‡²ðŸ‡» Malayalam quranaya-based interpretation candidate",{surahId:m,verseId:c,hasMalAyahInterpretation:!!Y,preview:Y?Y.substring(0,200):"N/A"}));let me="";if(n==="E")try{me=await ve.getAyahTranslation(m,c),me=me?me.replace(/<sup[^>]*foot_note[^>]*>\d+<\/sup>/g,"").replace(/\s+/g," ").trim():""}catch(h){console.error("Error fetching English translation:",h),me=""}if(t)return;const Ce={number:c,arabic:Ve?.text_uthmani||"",translation:n==="E"?me:se?.AudioText?se.AudioText.replace(/<sup[^>]*foot_note[^>]*>\d+<\/sup>/g,"").replace(/\s+/g," ").trim():"",verseKey:`${m}:${c}`};if(console.log("[AyahModal] ðŸ“– Set verseData for modal",Ce),H(Ce),t)return;if(n==="mal"&&Y){const h={interpretation:Y,AudioIntrerptn:Y,text:Y,content:Y,surahId:m,verseId:c};console.log("[AyahModal] âœ… Using quranaya-based Malayalam interpretation for ayah-wise view",{surahId:m,verseId:c,preview:Y.substring(0,200)}),D([h])}else if(C)if(Array.isArray(C)){const h=C[0]?.Interpretation||C[0]?.interpretation||"";console.log("[AyahModal] ðŸ§  setInterpretationData (array)",{surahId:m,verseId:b,count:C.length,firstInterpretationPreview:h.substring(0,200),firstInterpretationLength:h.length,firstInterpretationNo:C[0]?.InterpretationNo||C[0]?.interptn_no||"N/A"}),D(C)}else C.data&&Array.isArray(C.data)?(D(C.data),console.log("[AyahModal] ðŸ§  setInterpretationData (response.data array)",{count:C.data.length,first:C.data[0]})):typeof C=="object"?(D([C]),console.log("[AyahModal] ðŸ§  setInterpretationData (single object)",{value:C})):(D(null),console.warn("[AyahModal] âš ï¸ interpretationResponse was not in a supported format",C));else D(null),console.warn("[AyahModal] âš ï¸ interpretationResponse is empty/null, clearing interpretationData")}catch(c){if(t)return;z(c.message),console.error("Error fetching verse data:",c)}finally{if(t)return;X(!1)}}})(),()=>{t=!0}},[m,b,n]),x.useEffect(()=>{console.log("[AyahModal] ðŸ” interpretationData STATE CHANGED",{surahId:m,verseId:b,hasData:!!j,count:j?.length||0,firstInterpretationText:j?.[0]?.Interpretation?.substring(0,100)||j?.[0]?.interpretation?.substring(0,100)||"N/A"})},[j,m,b]),x.useEffect(()=>{const t=async y=>{y.preventDefault(),y.stopPropagation();const c=y.target.closest(".bangla-explanation-link");if(c){const v=c.getAttribute("data-explanation-number"),$=c.getAttribute("data-surah"),F=c.getAttribute("data-ayah");if(v&&$&&F)try{const A=await ke.getExplanationByNumber(parseInt($),parseInt(F),v);alert(A?`Explanation ${v}:

${A}`:"Explanation not found.")}catch(A){console.error("âŒ Error loading Bangla explanation:",A),alert("Error loading explanation.")}}};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]),x.useEffect(()=>{const t=async y=>{y.preventDefault(),y.stopPropagation();const c=y.target.closest(".hindi-explanation-link");if(c){const v=c.getAttribute("data-explanation-number"),$=c.getAttribute("data-surah"),F=c.getAttribute("data-ayah");if(v&&$&&F)try{const A=await we.getExplanationByNumber(parseInt($),parseInt(F),v);alert(A?`Explanation ${v}:

${A}`:`Explanation ${v} not found.`)}catch(A){console.error("âŒ Error loading Hindi explanation:",A),alert("Error loading explanation.")}}};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]),x.useEffect(()=>{const t=async y=>{y.preventDefault(),y.stopPropagation();const c=y.target.closest(".urdu-footnote-link");if(c){const v=c.getAttribute("data-footnote-id");c.getAttribute("data-footnote-number");const $=c.getAttribute("data-surah"),F=c.getAttribute("data-ayah");if(v&&$&&F)try{const A=await Ee.getFootnoteExplanation(v);A&&A.trim()!==""&&A!=="Explanation not available"?(D([{interpretation:A,AudioIntrerptn:A,text:A,content:A}]),setShowInterpretationModal(!0)):showToast("Footnote explanation not available","warning")}catch(A){console.error("Error fetching Urdu footnote:",A),showToast("Failed to load footnote explanation","error")}}};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]);const p=()=>{b<T&&k(b+1)},_=()=>{b>1&&k(b-1)},M=t=>{q(!0)},B=()=>{q(!1)},re=t=>{if(n!=="mal")return;const y=t.target.closest("sup, a");if(!y)return;const c=(y.innerText||y.textContent||"").trim();if(!c)return;let v=!1;const $=c.replace(/[\s()]+/g,"").toUpperCase();if(/^N\d+$/.test($))v=!0,r&&r(),g(`/note/${$}`);else{const F=c.match(/(\d+)\s*[:ï¼š]\s*(\d+)/);if(F){const A=parseInt(F[1],10),ne=parseInt(F[2],10);Number.isFinite(A)&&Number.isFinite(ne)&&(v=!0,G(A),k(ne))}}v&&(t.preventDefault(),t.stopPropagation())};x.useEffect(()=>{if(O){const t=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}}},[O]);const l=document.getElementById("modal-root")||document.body;if(ee)return le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm"}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx(je,{surahId:m,verseId:b,totalVerses:T,surahInfo:N,onVerseChange:k,onClose:r,onWordByWordClick:M,verseData:E,interpretationData:j,selectedQari:V,onQariChange:Q}),e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-[300px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading verse data..."})]})})]})]}),l);if(K)return le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] max-w-4xl flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx(je,{surahId:m,verseId:b,totalVerses:T,surahInfo:N,onVerseChange:k,onClose:r,onWordByWordClick:M,verseData:E,interpretationData:j,selectedQari:V,onQariChange:Q}),e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-[300px] p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 dark:text-red-400 text-lg mb-2",children:"Failed to load verse data"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:K}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Try Again"})]})})]})]}),l);const f=typeof n=="string"&&["e","en"].includes(n.toLowerCase()),i=N?.arabic||(m?`Surah ${m}`:"Surah"),w=at(m,i);return le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:r}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx("div",{className:"sm:hidden w-full flex justify-center pt-3 pb-1 bg-white dark:bg-gray-900 border-b border-gray-100 dark:border-gray-800",onClick:r,children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx(je,{surahId:m,verseId:b,totalVerses:T,surahInfo:N,onVerseChange:k,onClose:r,onWordByWordClick:M,verseData:E,selectedQari:V,onQariChange:Q}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-4 sm:py-6 overflow-y-auto flex-1 bg-gray-50/50 dark:bg-gray-900/50",children:[e.jsx("div",{className:"mb-4 sm:mb-6 text-center sm:text-left",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mb-3 gap-2",children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-medium text-gray-800 dark:text-gray-200",style:{fontFamily:rt},"aria-label":i,children:w}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 border border-gray-200 dark:border-gray-700",children:["Verse ",b," of ",T]})]})}),E&&e.jsx("div",{className:"text-right mb-6 sm:mb-8 border-b border-gray-200 dark:border-gray-700 pb-6",children:e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl dark:text-white text-gray-900 leading-[2.2] px-2 sm:px-0",style:{fontFamily:a,fontSize:`${d}px`},dir:"rtl",children:E.arabic})}),E&&!f&&n!=="ur"&&e.jsx("div",{className:"mb-6 sm:mb-8",children:n==="bn"?e.jsx("div",{className:"text-gray-700 leading-[1.8] font-bengali dark:text-gray-200 px-2 sm:px-0 prose dark:prose-invert max-w-none",style:{fontSize:`${u}px`},dangerouslySetInnerHTML:{__html:ke.parseBanglaTranslationWithClickableExplanations(E.translation,m,b)}}):n==="hi"?e.jsx("div",{className:"text-gray-700 leading-[1.8] font-hindi dark:text-gray-200 px-2 sm:px-0 prose dark:prose-invert max-w-none",style:{fontSize:`${u}px`},dangerouslySetInnerHTML:{__html:we.parseHindiTranslationWithClickableExplanations(E.translation,m,b)}}):n==="ta"?e.jsx("div",{className:"text-gray-700 leading-[1.8] font-tamil dark:text-gray-200 px-2 sm:px-0 prose dark:prose-invert max-w-none",style:{fontSize:`${u}px`},dangerouslySetInnerHTML:{__html:E.translation}}):e.jsx("p",{className:"text-gray-700 leading-[1.8] font-poppins dark:text-gray-200 px-2 sm:px-0",style:{fontSize:`${u}px`},children:E.translation})}),(j&&j.length>0&&console.log(`[AyahModal] ðŸ–¼ï¸ RENDER CHECK - About to render interpretation section for Surah ${m}, Ayah ${b}`,{interpretationDataLength:j.length,firstInterpretation:j[0],firstInterpretationText:j[0]?.Interpretation?.substring(0,150)||j[0]?.interpretation?.substring(0,150)||"N/A",willShowFirstOnly:n==="mal"}),null),j&&j.length>0&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("h4",{className:"text-sm font-semibold uppercase tracking-wider text-primary dark:text-primary-light mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-[1px] bg-primary dark:bg-primary-light"}),"Tafheem-ul-Quran"]}),n==="mal"&&e.jsx("style",{children:`
                    .ayah-interpretation-content sup.f-intprno,
                    .ayah-interpretation-content sup.f-noteno,
                    .ayah-interpretation-content a.crs {
                      color: #0F766E !important;
                      cursor: pointer !important;
                      text-decoration: none !important;
                      font-weight: bold;
                    }
                    .dark .ayah-interpretation-content sup.f-intprno,
                    .dark .ayah-interpretation-content sup.f-noteno,
                    .dark .ayah-interpretation-content a.crs {
                      color: #14B8A6 !important;
                    }

                    .ayah-interpretation-content sup.f-intprno:hover,
                    .ayah-interpretation-content sup.f-noteno:hover,
                    .ayah-interpretation-content a.crs:hover {
                      text-decoration: underline !important;
                    }
                  `}),e.jsx("div",{className:"space-y-4 ayah-interpretation-content",onClick:re,children:(n==="mal"?j.slice(0,1):j).map((t,y)=>{n==="mal"&&y===0&&console.log(`[AyahModal] ðŸŽ¨ RENDERING interpretation for Surah ${m}, Ayah ${b}`,{interpretationObject:t,hasInterpretation:!!t.Interpretation,interpretationLength:t.Interpretation?.length||0,interpretationPreview:t.Interpretation?.substring(0,150)||"N/A"});const v=[t.AudioIntrerptn,t.interpretation,t.Interpretation,t.text,t.content,t?.interpretation_text,t?.InterpretationText].find(ne=>typeof ne=="string"&&ne.trim().length>0)||"No interpretation available",$=typeof v=="string"?v:String(v??""),F=n==="hi"?t.explanation_no_BN||t.explanation_no_EN||y+1:n==="bn"?t.explanation_no_BNG||t.explanation_no_EN||y+1:n==="ur"?t.explanation_no||y+1:f?t.interptn_no||t.number||y+1:t.resolvedInterpretationNo||t.InterpretationNo||t.Interpretation_No||t.interptn_no||t.number||t.requestedInterpretationNo||y+1,A=`${m}-${b}-${t.InterpretationNo||t.interptn_no||t.number||y}`;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm border border-gray-100 dark:border-gray-700",children:[(n==="hi"||n==="ur")&&e.jsxs("div",{className:"mb-3 text-sm font-bold text-primary dark:text-primary-light",children:["Explanation ",F,":"]}),f&&null,e.jsx("div",{className:"text-gray-700 leading-[1.8] font-poppins dark:text-gray-300 text-sm sm:text-base",style:{fontSize:`${u}px`},dangerouslySetInnerHTML:{__html:$}})]},A)})},`interpretation-content-${m}-${b}`)]},`interpretation-${m}-${b}`),(!j||j.length===0)&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-3",children:"Interpretation"}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-sm italic flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-400"}),m===114?"Interpretation data is not available for Surah An-Nas (114).":"No interpretation available for this verse."]})})]})]}),e.jsxs("div",{className:"flex justify-between gap-3 p-4 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800",children:[e.jsxs("button",{onClick:_,disabled:b<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-xl border transition-all duration-200 group ${b<=1?"bg-gray-50 text-gray-400 border-gray-100 dark:bg-gray-800 dark:text-gray-600 dark:border-gray-700 cursor-not-allowed":"bg-white text-gray-700 border-gray-200 hover:border-primary hover:text-primary hover:bg-primary/5 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:border-primary-light dark:hover:text-primary-light"}`,children:[e.jsx(Fe,{className:"w-4 h-4 group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-sm font-medium",children:"Prev"})]}),e.jsxs("button",{onClick:p,disabled:b>=T,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-xl border transition-all duration-200 group ${b>=T?"bg-gray-50 text-gray-400 border-gray-100 dark:bg-gray-800 dark:text-gray-600 dark:border-gray-700 cursor-not-allowed":"bg-primary text-white border-primary hover:bg-primary-dark shadow-lg shadow-primary/20 dark:bg-primary dark:border-primary dark:hover:bg-primary-dark"}`,children:[e.jsx("span",{className:"text-sm font-medium",children:"Next Ayah"}),e.jsx(Pe,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]})]})]}),O&&le.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-start justify-center z-[100000] pt-24 sm:pt-28 lg:pt-32 p-4 overflow-hidden",children:e.jsx("div",{className:"bg-white dark:bg-[#2A2C38] rounded-xl shadow-2xl w-full sm:w-auto sm:max-w-6xl max-w-[95vw]",children:e.jsx(ct,{selectedVerse:b,surahId:m,onClose:B,onNavigate:k})})}),l),e.jsx(pe,{toasts:W,removeToast:o})]}),l)},ct=({selectedVerse:I,surahId:s,onClose:r,onNavigate:a,onSurahChange:d})=>{const u=Xe(),n=be(),W=Je(),o=u.surahId||s,g=u.verseId?parseInt(u.verseId):I,{quranFont:m,fontSize:G,adjustedTranslationFontSize:b,translationLanguage:k}=De(),[N,te]=x.useState(null),[E,H]=x.useState([]),[j,D]=x.useState(null),[ee,X]=x.useState(!0),[K,z]=x.useState(null),[T,ae]=x.useState(0),[O,q]=x.useState(!1),{toasts:U,removeToast:R,showSuccess:J,showError:V}=Se(),Q=document.getElementById("modal-root")||document.body;x.useEffect(()=>{(async()=>{if(!(!g||!o))try{X(!0),z(null);const w=[k==="ta"?Ye.getWordByWordDataWithArabic(o,g).catch(async v=>await ge(o,g,"E")):k==="hi"?Ze.getWordByWordDataWithArabic(o,g).catch(async v=>await ge(o,g,"E")):k==="bn"?et.getWordByWordDataWithArabic(o,g).catch(async v=>await ge(o,g,"E")):k==="mal"?it.getWordByWordDataWithArabic(o,g).catch(async v=>await ge(o,g,"E")):ge(o,g,k),Ge(o,g).catch(()=>[]),j?Promise.resolve(j):fe().then(v=>v.find($=>$.number===parseInt(o))).catch(()=>null)],[t,y,c]=await Promise.all(w);te(t),H(y||[]),D(c),ae(c?.ayahs||0)}catch(w){z(w.message)}finally{X(!1)}})()},[g,o,k]);const de=()=>{g>1&&(a?a(g-1):n(`/word-by-word/${o}/${g-1}`,{state:W.state}))},ce=()=>{a?a(g+1):n(`/word-by-word/${o}/${g+1}`,{state:W.state})},p=()=>{if(r)r();else{const i=W.state?.from;n(i&&i!=="/surah/all"&&i!=="/surah"?i:`/surah/${o}`)}},_=i=>{q(!0)},M=i=>{d?d(i):a?(r(),n(`/surah/${i}?wordByWord=1`)):n(`/word-by-word/${i}/1`,{state:W.state})},B=i=>{a?a(i):n(`/word-by-word/${o}/${i}`,{state:W.state})},re=()=>{q(!1)},f=(i=>{switch(i){case"mal":return"Malayalam";case"E":return"English";case"ta":return"Tamil";case"hi":return"Hindi";case"ur":return"Urdu";case"ar":return"Arabic";default:return"English"}})(k);return ee?le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm"}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx("div",{className:"flex-shrink-0 z-10 bg-white dark:bg-gray-900",children:e.jsx(Ne,{surahId:o,selectedVerse:g,surahInfo:j,onNavigate:a,onClose:p,onShowAyahModal:_,onSurahChange:M,onVerseChange:B,wordData:N,showSuccess:J,showError:V,translationLanguage:k})}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-6 py-8 min-h-[300px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading word meanings..."})]})}),e.jsx(pe,{toasts:U,removeToast:R})]})]}),Q):K?le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm",onClick:p}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx("div",{className:"flex-shrink-0 z-10 bg-white dark:bg-gray-900",children:e.jsx(Ne,{surahId:o,selectedVerse:g,surahInfo:j,onNavigate:a,onClose:p,onShowAyahModal:_,onSurahChange:M,onVerseChange:B,wordData:N,showSuccess:J,showError:V,translationLanguage:k})}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-6 py-8 min-h-[300px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 dark:text-red-400 mb-2",children:"Failed to load word meanings"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:K}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Retry"})]})}),e.jsx(pe,{toasts:U,removeToast:R})]})]}),Q):le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:p}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx("div",{className:"sm:hidden w-full flex justify-center pt-3 pb-1 bg-white dark:bg-gray-900 border-b border-gray-100 dark:border-gray-800",onClick:p,children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx("div",{className:"flex-shrink-0 z-10 bg-white dark:bg-gray-900",children:e.jsx(Ne,{surahId:o,selectedVerse:g,surahInfo:j,onNavigate:a,onClose:p,onShowAyahModal:_,onSurahChange:M,onVerseChange:B,wordData:N,showSuccess:J,showError:V,translationLanguage:k})}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-4 sm:py-6 overflow-y-auto flex-1 bg-gray-50/50 dark:bg-gray-900/50",children:[e.jsx("div",{className:"mb-4 sm:mb-6 text-center sm:text-left",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mb-3 gap-2",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-medium text-gray-800 dark:text-gray-200",style:{fontFamily:m,fontSize:`${G}px`},children:j?.arabic||`Surah ${o}`}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 border border-gray-200 dark:border-gray-700",children:["Verse ",g," of ",T]})]})}),N&&e.jsx("div",{className:"text-right mb-6 sm:mb-8 border-b border-gray-200 dark:border-gray-700 pb-6",children:e.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl dark:text-white text-gray-900 leading-[2.2] px-2 sm:px-0",style:{fontFamily:m,fontSize:`${G}px`},dir:"rtl",children:[N.text_uthmani||N.words&&N.words.map(i=>i.text_uthmani||i.text_simple).join(" ")||"Verse text not available"," "]})}),N&&N.translations&&N.translations.length>0&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("h4",{className:"text-sm font-semibold uppercase tracking-wider text-primary dark:text-primary-light mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-[1px] bg-primary dark:bg-primary-light"}),"Translation"]}),e.jsx("p",{className:`text-gray-700 leading-[1.8] dark:text-gray-200 px-2 sm:px-0 ${k==="hi"?"font-hindi":k==="ur"?"font-urdu":k==="bn"?"font-bengali":k==="ta"?"font-tamil":k==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${b}px`},children:N.translations[0].text})]}),N&&N.words&&N.words.length>0&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[k!=="bn"&&e.jsxs("h4",{className:"text-sm font-semibold uppercase tracking-wider text-primary dark:text-primary-light mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-[1px] bg-primary dark:bg-primary-light"}),"Word Breakdown (",f,")"]}),e.jsx("div",{className:"space-y-4",children:N.words.map((i,w)=>{const t=i.text_uthmani||i.text_simple||"",y=!!(i.translation&&i.translation.text);return t&&/^[\s()\u0660-\u0669\u06F0-\u06F9\uFD3E\uFD3F0-9]+$/.test(t)&&!y?null:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-row-reverse justify-between items-center",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl sm:text-3xl text-gray-800 dark:text-white font-arabic",style:{fontFamily:m,fontSize:`${G}px`},children:i.text_uthmani||i.text_simple||"N/A"}),i.text_simple&&i.text_uthmani!==i.text_simple&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:i.text_simple})]}),e.jsxs("div",{className:"text-left max-w-[60%]",children:[y?e.jsx("p",{className:`text-gray-700 leading-[1.6] sm:leading-[1.7] lg:leading-[1.8] dark:text-gray-200 mb-1 font-medium ${k==="hi"?"font-hindi":k==="ur"?"font-urdu":k==="bn"?"font-bengali":k==="ta"?"font-tamil":k==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${b}px`},children:i.translation.text}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-1 italic",style:{fontSize:`${b}px`},children:"Translation not available"}),i.class_name&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1 uppercase tracking-wide",children:i.class_name})]})]})},w)})})]}),N&&(!N.words||N.words.length===0)&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Word Breakdown:"}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm italic",children:"Word-by-word breakdown not available for this verse."})})]}),k==="mal"&&(!N||!N.words||N.words.length===0)&&E&&E.length>0&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("h4",{className:"text-sm font-semibold uppercase tracking-wider text-primary dark:text-primary-light mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-[1px] bg-primary dark:bg-primary-light"}),"Word Breakdown (Malayalam)"]}),e.jsx("div",{className:"space-y-4",children:E.reduce((w,t,y)=>{const c=t.WordPhrase||t.text_uthmani||t.text_simple||"";return w.findIndex($=>($.WordPhrase||$.text_uthmani||$.text_simple)===c)===-1&&w.push({...t,originalIndex:y}),w},[]).map((w,t)=>{const y=w.WordPhrase||w.text_uthmani||w.text_simple||"",c=w.Meaning||w.translation?.text||"";return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-row-reverse justify-between items-center",children:[e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-2xl sm:text-3xl font-arabic dark:text-white text-gray-800",style:{fontFamily:m,fontSize:`${G}px`},children:y})}),e.jsx("div",{className:"text-left max-w-[60%]",children:e.jsx("span",{className:"text-gray-700 leading-[1.6] font-poppins sm:leading-[1.7] lg:leading-[1.8] dark:text-gray-200 font-malayalam font-medium",style:{fontSize:`${b}px`},children:c})})]})},`${y}-${t}`)})})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex justify-between gap-3 p-4 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 z-10",children:[e.jsxs("button",{onClick:de,disabled:g<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-xl border transition-all duration-200 group ${g<=1?"bg-gray-50 text-gray-400 border-gray-100 dark:bg-gray-800 dark:text-gray-600 dark:border-gray-700 cursor-not-allowed":"bg-white text-gray-700 border-gray-200 hover:border-primary hover:text-primary hover:bg-primary/5 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:border-primary-light dark:hover:text-primary-light"}`,children:[e.jsx(Fe,{className:"w-4 h-4 group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-sm font-medium",children:"Prev"})]}),e.jsxs("button",{onClick:ce,disabled:g>=T,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-xl border transition-all duration-200 group ${g>=T?"bg-gray-50 text-gray-400 border-gray-100 dark:bg-gray-800 dark:text-gray-600 dark:border-gray-700 cursor-not-allowed":"bg-primary text-white border-primary hover:bg-primary-dark shadow-lg shadow-primary/20 dark:bg-primary dark:border-primary dark:hover:bg-primary-dark"}`,children:[e.jsx("span",{className:"text-sm font-medium",children:"Next Ayah"}),e.jsx(Pe,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]})]}),O&&e.jsx(dt,{surahId:o,verseId:g,onClose:re}),e.jsx(pe,{toasts:U,removeToast:R})]})]}),Q)};export{dt as A,ct as W};
