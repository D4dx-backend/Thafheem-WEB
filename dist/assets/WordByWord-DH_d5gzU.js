import{A as Le,a6 as qe,c as Be,j as e,X as pe,J as ye,B as Ue,m as Me,n as Pe,q as fe,t as me,u as De,o as Fe,D as He,r as Ke,k as Qe,a7 as xe,a8 as Oe}from"./index-CYmUdfUH.js";import{b as m,u as be,c as le,d as Ge,e as Je}from"./react-vendor-v5ei6ytj.js";import Xe from"./tamilWordByWordService-0aMUZhbw.js";import Ye from"./hindiWordByWordService-IKYrE6m0.js";import Ze from"./banglaWordByWordService-Btfq8z-m.js";import{a as ie}from"./apiService-BiExnp6s.js";import{u as Ce,T as ue}from"./Toast-CATwdAtO.js";import{C as Ve}from"./chevron-left-CZsIedE5.js";import et from"./tamilTranslationService-ARhWXMCS.js";import ve from"./hindiTranslationService-BZ49cBod.js";import Te from"./urduTranslationService-BtJGiN1d.js";import Ne from"./banglaTranslationService-DwkTVBb7.js";import je from"./englishTranslationService-BczWIkHy.js";import{g as tt,s as at}from"./surahNameUtils-CNmXwDjY.js";const rt=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"16",height:"18",x:"4",y:"4",rx:"2",key:"1u9h20"}],["path",{d:"M8 10h6",key:"3oa6kw"}],["path",{d:"M8 14h8",key:"1fgep2"}],["path",{d:"M8 18h5",key:"17enja"}]],nt=Le("notepad-text",rt);class st{constructor(){this.language="malayalam",this.apiBasePath=qe,this.pendingRequests=new Map,this.cache=new Map,this.cacheEnabled=!0,this.cacheTtl=3e5}generateCacheKey(n,r){const a=Object.keys(r).sort().map(l=>`${l}=${r[l]}`).join("&");return`${n}${a?`?${a}`:""}`}isCacheValid(n){return Date.now()-n<this.cacheTtl}getCachedData(n){if(!this.cacheEnabled)return null;const r=this.cache.get(n);return r&&this.isCacheValid(r.timestamp)?r.data:(r&&this.cache.delete(n),null)}setCachedData(n,r){this.cacheEnabled&&this.cache.set(n,{data:r,timestamp:Date.now()})}async getAyahTranslation(n,r){const a=this.generateCacheKey("getAyahTranslation",{surahId:n,ayahNumber:r}),l=this.getCachedData(a);if(l)return l;if(this.pendingRequests.has(a))return this.pendingRequests.get(a);const h=this._getAyahTranslationInternal(n,r,a);this.pendingRequests.set(a,h);try{return await h}finally{this.pendingRequests.delete(a)}}async _getAyahTranslationInternal(n,r,a){try{const l=await ie.getTranslation(this.language,n,r),h=l?.translation_text??l?.translation??null;return h?(this.setCachedData(a,h),h):(console.warn(`⚠️ No Malayalam translation returned for ${n}:${r}`),null)}catch(l){throw console.error(`❌ Malayalam translation API failed for ${n}:${r}:`,l),l}}async getSurahTranslations(n){const r=this.generateCacheKey("getSurahTranslations",{surahId:n}),a=this.getCachedData(r);if(a)return a;if(this.pendingRequests.has(r))return this.pendingRequests.get(r);const l=this._getSurahTranslationsInternal(n,r);this.pendingRequests.set(r,l);try{return await l}finally{this.pendingRequests.delete(r)}}async _getSurahTranslationsInternal(n,r){try{const a=await ie.getSurahTranslations(this.language,n),l=Array.isArray(a?.translations)?a.translations.map(h=>({number:h.verse_number,ArabicText:"",Translation:h.translation_text??""})):[];return this.setCachedData(r,l),l}catch(a){throw console.error(`❌ Malayalam surah translation API failed for ${n}:`,a),a}}async getInterpretation(n,r,a=null){const l=this.generateCacheKey("getInterpretation",{surahId:n,ayahNumber:r,interpretationNo:a}),h=this.getCachedData(l);if(h)return h;if(this.pendingRequests.has(l))return this.pendingRequests.get(l);const s=this._getInterpretationInternal(n,r,a,l);this.pendingRequests.set(l,s);try{return await s}finally{this.pendingRequests.delete(l)}}async _getInterpretationInternal(n,r,a,l){try{const h=await ie.getInterpretation(this.language,n,r,a),s=Array.isArray(h?.explanations)?h.explanations:[];return this.setCachedData(l,s),s}catch(h){throw console.error(`❌ Malayalam interpretation API failed for ${n}:${r}:`,h),h}}async getWordByWordData(n,r){const a=this.generateCacheKey("getWordByWordData",{surahId:n,ayahNumber:r}),l=this.getCachedData(a);if(l)return l;if(this.pendingRequests.has(a))return this.pendingRequests.get(a);const h=this._getWordByWordDataInternal(n,r,a);this.pendingRequests.set(a,h);try{return await h}finally{this.pendingRequests.delete(a)}}async _getWordByWordDataInternal(n,r,a){try{const l=await ie.getWordByWord(this.language,n,r),h=Array.isArray(l?.words)?l.words:[];if(h.length===0)return console.warn(`⚠️ No Malayalam word-by-word data for ${n}:${r}`),null;const s=h.map((o,x)=>({id:o.WordId||o.id||x+1,position:o.WordId||o.id||x+1,audio_url:o.audio_url||null,char_type_name:o.char_type_name||"word",code_v1:o.code_v1||"",code_v2:o.code_v2||"",line_number:o.line_number||1,page_number:o.page_number||1,text_uthmani:o.text_uthmani||o.WordPhrase||"",text_simple:o.text_simple||o.WordPhrase||"",translation:{text:o.MalMeaning||o.WordMeaning||o.translation?.text||"",language_name:"Malayalam",resource_name:"Thafheem Malayalam Word Database"},transliteration:{text:o.transliteration?.text||o.WordPhrase||"",language_name:"English"}})),B={text_uthmani:l?.text_uthmani||"",words:s,translations:l?.translations||[]};return this.setCachedData(a,B),B}catch(l){throw console.error(`❌ Malayalam word-by-word API failed for ${n}:${r}:`,l),l}}async getWordByWordDataWithArabic(n,r){try{const a=await this.getWordByWordData(n,r);if(!a)return console.warn(`⚠️ No Malayalam data found for ${n}:${r}, falling back to English`),await this.getEnglishFallback(n,r);try{const l=await ie.getArabicText(n,r);return{...a,text_uthmani:l.text_uthmani||a.text_uthmani,text_simple:l.text_simple||a.text_simple}}catch{console.warn("⚠️ Could not fetch Arabic text, using Malayalam data only")}return a}catch(a){throw console.error(`❌ Error fetching Malayalam word-by-word with Arabic for ${n}:${r}:`,a),a}}async getEnglishFallback(n,r){try{const a=await ie.getWordByWord("english",n,r),l=Array.isArray(a?.words)?a.words:[];if(l.length===0)return null;const h=l.map((s,B)=>({id:s.WordId||s.id||B+1,position:s.WordId||s.id||B+1,text_uthmani:s.text_uthmani||s.WordPhrase||"",text_simple:s.text_simple||s.WordPhrase||"",translation:{text:s.EngMeaning||s.WordMeaning||s.translation?.text||"",language_name:"English",resource_name:"Thafheem English Word Database"}}));return{text_uthmani:a?.text_uthmani||"",words:h,translations:a?.translations||[]}}catch(a){return console.error(`❌ English fallback failed for ${n}:${r}:`,a),null}}async getFootnote(n){const r=this.generateCacheKey("getFootnote",{footnoteId:n}),a=this.getCachedData(r);if(a)return a;try{const h=(await ie.getMalayalamFootnote(n))?.footnote_text||"";return this.setCachedData(r,h),h}catch(l){throw console.error(`❌ Malayalam footnote API failed for ${n}:`,l),l}}clearCache(){this.cache.clear(),this.pendingRequests.clear()}}const ot=new st,Se=({surahId:A,selectedVerse:n,surahInfo:r,onNavigate:a,onClose:l,onShowAyahModal:h,onSurahChange:s,onVerseChange:B,wordData:o=null,showSuccess:x=null,showError:f=null,translationLanguage:O=null})=>{const[S,v]=m.useState(!0),[N,re]=m.useState([]),[E,U]=m.useState(!1),[_,M]=m.useState(!1),[Z,G]=m.useState(!1),[H,z]=m.useState(!1),[T,ne]=m.useState(""),K=m.useRef(null),L=m.useRef(null),q=be(),{user:F}=Be?.()||{user:null};r?.ayahs;const J=g=>{U(!1),ne(""),s&&s(g.number)},X=g=>{M(!1),B&&B(g)},Q=()=>{const g=r?.ayahs||0;return Array.from({length:g},(C,V)=>V+1)},ee=async()=>{try{G(!0);const g=me.getEffectiveUserId(F),C=r?.name||`Surah ${A}`,V=o?.text_uthmani||o?.translations?.[0]?.text||"";await me.addBookmark(g,A,n,"word-by-word",C,V),x&&x("Word-by-word content bookmarked successfully!")}catch(g){console.error("Failed to bookmark word-by-word content:",g),f&&f("Failed to save bookmark. Please try again.")}finally{setTimeout(()=>G(!1),300)}},de=async()=>{try{const g=r?.name||`Surah ${A}`,C=o?.text_uthmani||o?.translations?.[0]?.text||"",V=o?.translations?.[0]?.text||"";let $=`Word by Word - ${g}, Verse ${n}

`;$+=`Arabic: ${C}

`,V&&($+=`Translation: ${V}

`),o?.words&&o.words.length>0&&($+=`Word Breakdown:
`,o.words.slice(0,5).forEach((d,u)=>{const i=d.text_uthmani||d.text_simple||"",b=d.translation?.text||"N/A";$+=`${u+1}. ${i} - ${b}
`}),o.words.length>5&&($+=`... and ${o.words.length-5} more words
`),$+=`
`),$+="Shared from Thafheem - Word by Word Study";const se=window.location.href;if(navigator.share)await navigator.share({title:`Word by Word - ${g}, Verse ${n}`,text:$,url:se});else{const d=`${$}

View full content: ${se}`;if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(d),alert("Word-by-word content copied to clipboard for sharing");else{const u=document.createElement("textarea");u.value=d,u.style.position="fixed",u.style.left="-999999px",u.style.top="-999999px",document.body.appendChild(u),u.focus(),u.select(),document.execCommand("copy"),document.body.removeChild(u),alert("Word-by-word content copied to clipboard for sharing")}}}catch(g){console.error("Failed to share word-by-word content:",g),g.name!=="AbortError"&&alert("Failed to share content: "+g.message)}};return m.useEffect(()=>{(async()=>{try{z(!0);const C=await fe();re(C)}catch(C){console.error("Error loading surahs:",C)}finally{z(!1)}})()},[]),m.useEffect(()=>{const g=C=>{K.current&&!K.current.contains(C.target)&&U(!1),L.current&&!L.current.contains(C.target)&&M(!1)};return document.addEventListener("mousedown",g),()=>{document.removeEventListener("mousedown",g)}},[]),N.filter(g=>g.name.toLowerCase().includes(T.toLowerCase())||g.arabic.includes(T)||g.number.toString().includes(T)),S?e.jsxs("div",{className:"bg-white dark:bg-gray-900 px-3 sm:px-4 py-3 space-y-3 relative z-10",children:[e.jsx("button",{className:"absolute top-2 right-2 sm:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors bg-white dark:bg-gray-600 shadow-sm z-10",title:"Close",onClick:()=>l?l():q(-1),children:e.jsx(pe,{className:"w-4 h-4 text-gray-600 dark:text-white"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2 sm:space-x-3 pr-12 sm:pr-0",children:[e.jsxs("div",{className:"relative dropdown-container",ref:K,children:[e.jsxs("button",{onClick:()=>U(!E),className:"flex font-poppins items-center space-x-2 px-3 sm:px-4 py-2 bg-gray-100 dark:bg-[#323A3F] dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs sm:text-sm font-medium text-gray-700 transition-colors",children:[e.jsx("span",{children:A?`${A} - ${r?.name||"Loading..."}`:"Select Surah"}),e.jsx(ye,{className:"w-4 h-4 text-gray-600 dark:text-white"})]}),E&&!H&&e.jsx("div",{className:"absolute sm:text-sm text-sm top-full left-0 mt-2 bg-white dark:bg-[#2A2C38] shadow-lg rounded-lg overflow-auto w-80 sm:w-45 h-[calc(100vh-100px)] z-50",children:N.map(g=>e.jsxs("div",{className:`px-4 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-white ${g.number===parseInt(A)?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>J(g),children:[g.number," - ",g.name]},g.number))})]}),e.jsxs("div",{className:"relative dropdown-container",ref:L,children:[e.jsxs("button",{onClick:()=>M(!_),className:"flex font-poppins items-center space-x-2 px-3 sm:px-4 py-2 bg-gray-100 dark:bg-[#323A3F] dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs sm:text-sm font-medium text-gray-700 transition-colors",children:[e.jsx("span",{children:n||"1"}),e.jsx(ye,{className:"w-4 h-4 text-gray-600 dark:text-white"})]}),_&&e.jsx("div",{className:"absolute top-full left-0 mt-2 bg-white dark:bg-[#2A2C38] shadow-lg rounded-lg overflow-auto w-auto max-h-60 z-50",children:Q().map(g=>e.jsx("div",{className:`px-4 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-white ${parseInt(n)===g?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>X(g),children:g},g))})]})]}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2 self-end sm:self-auto",children:[O!=="ta"&&e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"View Ayah Details",onClick:()=>h&&h(n),children:e.jsx(Ue,{className:"w-4 sm:w-5 h-4 sm:h-5 text-gray-600 dark:text-gray-300"})}),e.jsx("button",{onClick:ee,disabled:Z,className:`p-2 rounded-lg transition-colors ${Z?"text-gray-400 cursor-not-allowed":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,title:Z?"Saving...":"Bookmark this verse",children:e.jsx(Me,{className:"w-4 sm:w-5 h-4 sm:h-5"})}),e.jsx("button",{onClick:de,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Share word-by-word content",children:e.jsx(Pe,{className:"w-4 sm:w-5 h-4 sm:h-5 text-gray-600 dark:text-gray-300"})}),l&&e.jsx("button",{className:"hidden sm:block p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors dark:bg-white",title:"Close",onClick:l,children:e.jsx(pe,{className:"w-5 h-5 text-gray-600"})})]})]})]}):null},Ae=({surahId:A,verseId:n,totalVerses:r,surahInfo:a,onVerseChange:l,onSurahChange:h,onClose:s,onWordByWordClick:B,verseData:o,interpretationData:x,selectedQari:f,onQariChange:O})=>{const[S,v]=m.useState(!0),[N,re]=m.useState(!1),[E,U]=m.useState(!1),[_,M]=m.useState([]),[Z,G]=m.useState(!0),[H,z]=m.useState(!1),[T,ne]=m.useState(!1),[K,L]=m.useState(!1),q=be(),{user:F}=Be(),{showSuccess:J,showError:X}=Ce();m.useEffect(()=>{(async()=>{try{const u=await fe();M(u)}catch(u){console.error("Error loading surahs:",u)}finally{G(!1)}})()},[]),m.useEffect(()=>{(async()=>{if(F&&A&&n)try{const u=await me.isBookmarked(F.uid,A,n,"interpretation");z(u)}catch(u){console.error("Error checking bookmark status:",u)}})()},[F,A,n]);const Q=Array.from({length:r||10},(d,u)=>u+1),ee=a?`${a.number} - ${a.name||a.arabic}`:`${A} - Loading...`,de=d=>{h?h(d):q(`/surah/${d}`),re(!1)},g=d=>{l&&l(d),U(!1)},C=d=>{if(d==null)return"";if(typeof d!="string")return String(d);if(typeof window<"u"){const u=document.createElement("div");return u.innerHTML=d,u.textContent||u.innerText||""}return d.replace(/<[^>]+>/g," ")},V=d=>{if(!d||typeof d!="object")return"";const u=["AudioIntrerptn","Interpretation","interpretation","AudioText","interpret_text","InterpretText","Interpret_Text","text","Text","content","Content","meaning","Meaning","body","Body","desc","Desc","description","Description"];for(const i of u)if(typeof d[i]=="string"&&d[i].trim().length>0)return d[i];for(const[i,b]of Object.entries(d))if(typeof b=="string"&&b.trim().length>10&&!["InterpretationNo","Interpretation_No","interptn_no","contiayano","ayaid","Ayaid","suraid","pageid","QAudioUrl","TransUrl","InterPtnUrl","ASuraName"].includes(i))return b;return""},$=async()=>{if(!o&&!x){X("No data available to copy");return}try{const d=[];if(o?.arabic&&d.push(o.arabic),o?.translation&&d.push(o.translation),x){const i=[];if(Array.isArray(x))x.forEach((b,P)=>{if(typeof b=="string"&&b.trim().length>0){const t=C(b);if(t.trim()){const p=x.length>1?`Interpretation ${P+1}:
`:`Interpretation:
`;i.push(p+t.trim())}}else if(b&&typeof b=="object"){const t=V(b);if(t){const p=C(t);if(p.trim()){const c=x.length>1?`Interpretation ${P+1}:
`:`Interpretation:
`;i.push(c+p.trim())}}}});else if(typeof x=="string"){const b=C(x);b.trim()&&i.push(`Interpretation:
`+b.trim())}else if(typeof x=="object"){const b=V(x);if(b){const P=C(b);P.trim()&&i.push(`Interpretation:
`+P.trim())}}i.length>0?d.push(i.join(`

`)):console.warn("Interpretation data exists but no text extracted:",x)}if(d.length===0){const i=a?.name||a?.arabic||`Surah ${A}`;d.push(`${i}, Verse ${n}`)}const u=d.join(`

---

`);if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(u);else{const i=document.createElement("textarea");i.value=u,i.style.position="fixed",i.style.opacity="0",document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i)}L(!0),J("Verse and interpretation copied to clipboard"),setTimeout(()=>L(!1),2e3)}catch(d){console.error("Failed to copy verse:",d),X("Failed to copy verse. Please try again.")}},se=async()=>{if(!F){q("/sign");return}try{if(ne(!0),H){const u=(await me.getBookmarks(F.uid,"interpretation")).find(i=>i.surahId===parseInt(A)&&i.verseId===parseInt(n));u&&(await me.deleteBookmark(u.id,F.uid),z(!1),J("Bookmark removed successfully"))}else{const d=a?.name||a?.arabic||`Surah ${A}`,u=o?.translation||o?.arabic||"";await me.addBookmark(F.uid,A,n,"interpretation",d,u),z(!0),J("Verse bookmarked successfully")}}catch(d){console.error("Error handling bookmark:",d),X("Failed to update bookmark. Please try again.")}finally{ne(!1)}};return S?e.jsxs("div",{className:"bg-white dark:bg-gray-900 px-3 sm:px-4 py-3 space-y-3 relative",children:[e.jsx("button",{className:"absolute top-2 right-2 sm:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors bg-white dark:bg-gray-600 shadow-sm z-10",title:"Close",onClick:s||(()=>q(-1)),children:e.jsx(pe,{className:"w-4 h-4 text-gray-600 dark:text-white"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0",children:[e.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-2 sm:space-x-3 pr-12 sm:pr-0",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>re(d=>!d),className:"flex font-poppins items-center space-x-2 px-3 sm:px-4 py-2 bg-gray-100 dark:bg-[#323A3F] dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs sm:text-sm font-medium text-gray-700 transition-colors",children:[e.jsx("span",{children:ee}),e.jsx(ye,{className:"w-4 h-4 text-gray-600 dark:text-white"})]}),N&&!Z&&e.jsx("div",{className:"absolute sm:text-sm text-sm top-full left-0 mt-2 bg-white dark:bg-[#2A2C38] shadow-lg rounded-lg overflow-auto w-80 sm:w-45 h-[calc(100vh-100px)] z-50",children:_.map(d=>e.jsxs("div",{className:`px-4 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-white ${d.number===parseInt(A)?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>de(d.number),children:[d.number," - ",d.name]},d.number))})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>U(d=>!d),className:"flex font-poppins items-center space-x-2 px-3 sm:px-4 py-2 bg-gray-100 dark:bg-[#323A3F] dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg text-xs sm:text-sm font-medium text-gray-700 transition-colors",children:[e.jsxs("span",{children:[" ",n]}),e.jsx(ye,{className:"w-4 h-4 text-gray-600 dark:text-white"})]}),E&&e.jsx("div",{className:"absolute top-full left-0 mt-2 bg-white dark:bg-[#2A2C38] shadow-lg rounded-lg overflow-auto w-auto max-h-60 z-50",children:Q.map(d=>e.jsx("div",{className:`px-4 py-3 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-white ${d===parseInt(n)?"bg-gray-100 dark:bg-gray-700":""}`,onClick:()=>g(d),children:d},d))})]})]}),e.jsx("div",{className:"hidden sm:flex items-center",children:e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors dark:bg-gray-950",title:"Close",onClick:s||(()=>q(-1)),children:e.jsx(pe,{className:"w-5 h-5 text-gray-600"})})})]}),e.jsxs("div",{className:"flex flex-row items-center justify-between gap-3 sm:gap-0",children:[e.jsx("div",{className:"flex items-center gap-2"}),e.jsxs("div",{className:"flex items-center space-x-1 sm:space-x-2",children:[e.jsx("button",{onClick:$,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors relative",title:"Copy",children:K?e.jsx("span",{className:"text-green-500 font-bold text-xs",children:"Copied!"}):e.jsx(nt,{className:"w-4 sm:w-5 h-4 sm:h-5 dark:text-white text-gray-600"})}),e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:H?"Remove Bookmark":"Add Bookmark",onClick:se,disabled:T,children:T?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 sm:h-5 sm:w-5 border-b border-current"}):e.jsx(Me,{className:`w-4 sm:w-5 h-4 sm:h-5 transition-colors ${H?"text-cyan-500 fill-cyan-500 dark:text-cyan-400 dark:fill-cyan-400":"text-gray-600 dark:text-gray-300"}`})}),e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",title:"Share",children:e.jsx(Pe,{className:"w-4 sm:w-5 h-4 sm:h-5 text-gray-600 dark:text-gray-300"})})]})]})]}):null};let _e=null,We=0;const it=300*1e3,lt=({surahId:A,verseId:n,onClose:r})=>{const{quranFont:a,fontSize:l,adjustedTranslationFontSize:h,translationLanguage:s}=De(),{toasts:B,removeToast:o}=Ce(),x=be(),[f,O]=m.useState(()=>{const t=parseInt(A,10);return Number.isNaN(t)?0:t}),[S,v]=m.useState(1),[N,re]=m.useState(null),[E,U]=m.useState(null),[_,M]=m.useState(null),[Z,G]=m.useState(!0),[H,z]=m.useState(null),[T,ne]=m.useState(0),[K,L]=m.useState(!1),q=t=>{if(!t||typeof t!="object")return null;const p=[t.ayaid,t.AyaId,t.AyaID,t.contiayano,t.contiAyaNo,t.verse_number,t.number];for(const c of p){const w=Number.parseInt(c,10);if(Number.isFinite(w)&&w>0)return w}return null},F=(t,p=1)=>{if(!t)return[];const c=(k,I=0)=>{if(!k||typeof k!="object")return null;const te=[k.AudioIntrerptn,k.audioIntrerptn,k.AudioInterpretation,k.audioInterpretation,k.interpretation,k.Interpretation].find(W=>typeof W=="string"&&W.trim().length>0);if(!te)return null;const he=[k.interptn_no,k.InterPtnNo,k.InterpretationNo,k.number,k.InterPtnUrl].find(W=>W!=null&&String(W).trim().length>0),oe=he?String(he).trim():String(p??I+1);return{AudioIntrerptn:te,interpretation:te,Interpretation:te,interptn_no:oe,number:oe,surahId:k.suraid??k.SuraId??k.SuraID??null,verseId:k.ayaid??k.AyaId??k.AyaID??null,source:"malayalam-quranaya"}};if(Array.isArray(t))return t.map((k,I)=>c(k,I)).filter(Boolean);const w=c(t,0);return w?[w]:[]},[J,X]=m.useState(null),[Q,ee]=m.useState("al-afasy"),[de,g]=m.useState("qirath");m.useEffect(()=>{n&&v(parseInt(n))},[n]),m.useEffect(()=>{const t=parseInt(A,10);Number.isNaN(t)||O(t)},[A]),m.useEffect(()=>{let t=!1;return(async()=>{if(!(!f||!S))try{G(!0),z(null),M(null),U(null);const c=S,w=s==="mal",k=s==="mal"?Promise.resolve(null):s==="ta"?et.getAyahTranslation(f,c).then(y=>y?[{interpretation:y,AudioIntrerptn:y,text:y,content:y}]:[]).catch(()=>[]):s==="hi"?ve.getAllExplanations(f,c).then(y=>y&&y.length>0?y.map(D=>({interpretation:D.explanation,AudioIntrerptn:D.explanation,text:D.explanation,content:D.explanation,explanation_no_BN:D.explanation_no_BN,explanation_no_EN:D.explanation_no_EN})):[]).catch(y=>(console.error("❌ Error fetching Hindi explanations in AyahModal:",y),[])):s==="ur"?Te.getAllExplanations(f,c).then(y=>y&&y.length>0?y.map(ae=>({interpretation:ae.explanation,AudioIntrerptn:ae.explanation,text:ae.explanation,content:ae.explanation,explanation_no:ae.explanation_no})):[]).catch(()=>[]):s==="bn"?Ne.getAllExplanations(f,c).then(y=>y&&y.length>0?y.map(D=>({interpretation:D.explanation,AudioIntrerptn:D.explanation,text:D.explanation,content:D.explanation,explanation_no_BNG:D.explanation_no_BNG,explanation_no_EN:D.explanation_no_EN})):[]).catch(y=>(console.error("❌ Error fetching Bangla explanations in AyahModal:",y),[])):s==="E"?(async()=>{try{const y=await je.getAyahTranslation(f,c);if(!y)return[];const ae=/<sup[^>]*foot_note="([^"]+)"[^>]*>(\d+)<\/sup>/g,D=[];let we;for(;(we=ae.exec(y))!==null;){const R=we[1],Y=parseInt(we[2],10);D.push({footnoteId:R,footnoteNumber:Y})}const Ie=Array.from(new Map(D.map(R=>[R.footnoteId,R])).values());Ie.sort((R,Y)=>R.footnoteNumber-Y.footnoteNumber);const ze=Ie.map(async R=>{try{const Y=await je.getExplanation(parseInt(R.footnoteId,10));return{interpretation:Y||"",AudioIntrerptn:Y||"",text:Y||"",content:Y||"",interptn_no:R.footnoteNumber,number:R.footnoteNumber,InterpretationNo:String(R.footnoteNumber),footnoteId:R.footnoteId}}catch(Y){return console.warn(`Failed to fetch footnote ${R.footnoteId}:`,Y),null}});return(await Promise.all(ze)).filter(Boolean)}catch(y){return console.error(`❌ [AyahModal] Error fetching English footnotes for Surah ${f}, Ayah ${c}:`,y),[]}})():(async()=>{try{return await He(f,c,1,s)}catch(y){return console.error(`[AyahModal] Error fetching interpretations for Surah ${f}, Ayah ${c}:`,y),f===114?[]:[]}})(),I=s==="ta"||s==="hi"||s==="bn"||s==="E"||s==="ur"?Promise.resolve(null):Ke(f,c),j=Date.now(),te=async()=>{if(_e&&j-We<it)return _e;const y=await fe();return _e=y,We=j,y},[Ee,he,oe,W]=await Promise.all([te(),Qe(f),I,k]);if(console.log("[AyahModal] After Promise.all - interpretationResponse:",W,"type:",typeof W,"isArray:",Array.isArray(W)),t)return;const $e=Ee.find(y=>y.number===f);re($e||{arabic:"Unknown Surah",number:f}),ne($e?.ayahs||0);const Re=he.find(y=>y.verse_key===`${f}:${c}`),ke=oe?Array.isArray(oe)?oe.find(y=>q(y)===c):oe:null,ge=w?F(oe||ke,c):[];let ce="";if(s==="E")try{ce=await je.getAyahTranslation(f,c),ce=ce?ce.replace(/<sup[^>]*foot_note[^>]*>\d+<\/sup>/g,"").replace(/\s+/g," ").trim():""}catch(y){console.error("Error fetching English translation:",y),ce=""}if(t||(U({number:c,arabic:Re?.text_uthmani||"",translation:s==="E"?ce:ke?.AudioText?ke.AudioText.replace(/<sup[^>]*foot_note[^>]*>\d+<\/sup>/g,"").replace(/\s+/g," ").trim():"",verseKey:`${f}:${c}`}),t))return;w?(console.log("[AyahModal] Processing interpretations for Malayalam - malayalamInterpretations from translationData:",ge),ge.length>0?(console.log(`[AyahModal] Using malayalamInterpretations (from AudioIntrerptn) with ${ge.length} items`),M(ge)):(console.log("[AyahModal] No malayalamInterpretations found in translationData, setting to null"),M(null))):W?Array.isArray(W)?M(W):W.data&&Array.isArray(W.data)?M(W.data):M(typeof W=="object"?[W]:null):M(null)}catch(c){if(t)return;z(c.message),console.error("Error fetching verse data:",c)}finally{if(t)return;G(!1)}})(),()=>{t=!0}},[f,S,s]),m.useEffect(()=>{const t=async p=>{p.preventDefault(),p.stopPropagation();const c=p.target.closest(".bangla-explanation-link");if(c){const w=c.getAttribute("data-explanation-number"),k=c.getAttribute("data-surah"),I=c.getAttribute("data-ayah");if(w&&k&&I)try{const j=await Ne.getExplanationByNumber(parseInt(k),parseInt(I),w);alert(j?`Explanation ${w}:

${j}`:"Explanation not found.")}catch(j){console.error("❌ Error loading Bangla explanation:",j),alert("Error loading explanation.")}}};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]),m.useEffect(()=>{const t=async p=>{p.preventDefault(),p.stopPropagation();const c=p.target.closest(".hindi-explanation-link");if(c){const w=c.getAttribute("data-explanation-number"),k=c.getAttribute("data-surah"),I=c.getAttribute("data-ayah");if(w&&k&&I)try{const j=await ve.getExplanationByNumber(parseInt(k),parseInt(I),w);alert(j?`Explanation ${w}:

${j}`:`Explanation ${w} not found.`)}catch(j){console.error("❌ Error loading Hindi explanation:",j),alert("Error loading explanation.")}}};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]),m.useEffect(()=>{const t=async p=>{p.preventDefault(),p.stopPropagation();const c=p.target.closest(".urdu-footnote-link");if(c){const w=c.getAttribute("data-footnote-id");c.getAttribute("data-footnote-number");const k=c.getAttribute("data-surah"),I=c.getAttribute("data-ayah");if(w&&k&&I)try{const j=await Te.getFootnoteExplanation(w);j&&j.trim()!==""&&j!=="Explanation not available"?(M([{interpretation:j,AudioIntrerptn:j,text:j,content:j}]),setShowInterpretationModal(!0)):showToast("Footnote explanation not available","warning")}catch(j){console.error("Error fetching Urdu footnote:",j),showToast("Failed to load footnote explanation","error")}}};return document.addEventListener("click",t),()=>{document.removeEventListener("click",t)}},[]);const C=()=>{S<T&&v(S+1)},V=()=>{S>1&&v(S-1)},$=t=>{L(!0)},se=()=>{L(!1)},d=t=>{if(s!=="mal")return;const p=t.target.closest("sup, a");if(!p)return;const c=(p.innerText||p.textContent||"").trim();if(!c)return;let w=!1;const k=c.replace(/[\s()]+/g,"").toUpperCase();if(/^N\d+$/.test(k))w=!0,r&&r(),x(`/note/${k}`);else{const I=c.match(/(\d+)\s*[:：]\s*(\d+)/);if(I){const j=parseInt(I[1],10),te=parseInt(I[2],10);Number.isFinite(j)&&Number.isFinite(te)&&(w=!0,O(j),v(te))}}w&&(t.preventDefault(),t.stopPropagation())};m.useEffect(()=>{if(K){const t=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}}},[K]);const u=document.getElementById("modal-root")||document.body;if(Z)return le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm"}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx(Ae,{surahId:f,verseId:S,totalVerses:T,surahInfo:N,onVerseChange:v,onClose:r,onWordByWordClick:$,verseData:E,interpretationData:_,selectedQari:Q,onQariChange:ee}),e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-[300px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading verse data..."})]})})]})]}),u);if(H)return le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm",onClick:r}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] max-w-4xl flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx(Ae,{surahId:f,verseId:S,totalVerses:T,surahInfo:N,onVerseChange:v,onClose:r,onWordByWordClick:$,verseData:E,interpretationData:_,selectedQari:Q,onQariChange:ee}),e.jsx("div",{className:"flex-1 flex items-center justify-center min-h-[300px] p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 dark:text-red-400 text-lg mb-2",children:"Failed to load verse data"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:H}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Try Again"})]})})]})]}),u);const i=typeof s=="string"&&["e","en"].includes(s.toLowerCase()),b=N?.arabic||(f?`Surah ${f}`:"Surah"),P=tt(f,b);return le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:r}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx("div",{className:"sm:hidden w-full flex justify-center pt-3 pb-1 bg-white dark:bg-gray-900 border-b border-gray-100 dark:border-gray-800",onClick:r,children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx(Ae,{surahId:f,verseId:S,totalVerses:T,surahInfo:N,onVerseChange:v,onClose:r,onWordByWordClick:$,verseData:E,selectedQari:Q,onQariChange:ee}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-4 sm:py-6 overflow-y-auto flex-1 bg-gray-50/50 dark:bg-gray-900/50",children:[e.jsx("div",{className:"mb-4 sm:mb-6 text-center sm:text-left",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mb-3 gap-2",children:[e.jsx("h3",{className:"text-2xl sm:text-3xl font-medium text-gray-800 dark:text-gray-200",style:{fontFamily:at},"aria-label":b,children:P}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 border border-gray-200 dark:border-gray-700",children:["Verse ",S," of ",T]})]})}),E&&e.jsx("div",{className:"text-right mb-6 sm:mb-8 border-b border-gray-200 dark:border-gray-700 pb-6",children:e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl dark:text-white text-gray-900 leading-[2.2] px-2 sm:px-0",style:{fontFamily:a,fontSize:`${l}px`},dir:"rtl",children:E.arabic})}),E&&!i&&s!=="ur"&&e.jsx("div",{className:"mb-6 sm:mb-8",children:s==="bn"?e.jsx("div",{className:"text-gray-700 leading-[1.8] font-bengali dark:text-gray-200 px-2 sm:px-0 prose dark:prose-invert max-w-none",style:{fontSize:`${h}px`},dangerouslySetInnerHTML:{__html:Ne.parseBanglaTranslationWithClickableExplanations(E.translation,f,S)}}):s==="hi"?e.jsx("div",{className:"text-gray-700 leading-[1.8] font-hindi dark:text-gray-200 px-2 sm:px-0 prose dark:prose-invert max-w-none",style:{fontSize:`${h}px`},dangerouslySetInnerHTML:{__html:ve.parseHindiTranslationWithClickableExplanations(E.translation,f,S)}}):s==="ta"?e.jsx("div",{className:"text-gray-700 leading-[1.8] font-tamil dark:text-gray-200 px-2 sm:px-0 prose dark:prose-invert max-w-none",style:{fontSize:`${h}px`},dangerouslySetInnerHTML:{__html:E.translation}}):e.jsx("p",{className:"text-gray-700 leading-[1.8] font-poppins dark:text-gray-200 px-2 sm:px-0",style:{fontSize:`${h}px`},children:E.translation})}),(_&&_.length>0,null),_&&_.length>0&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("h4",{className:"text-sm font-semibold uppercase tracking-wider text-primary dark:text-primary-light mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-[1px] bg-primary dark:bg-primary-light"}),"Tafheem-ul-Quran"]}),s==="mal"&&e.jsx("style",{children:`
                    .ayah-interpretation-content sup.f-intprno,
                    .ayah-interpretation-content sup.f-noteno,
                    .ayah-interpretation-content a.crs {
                      color: #0F766E !important;
                      cursor: pointer !important;
                      text-decoration: none !important;
                      font-weight: bold;
                    }
                    .dark .ayah-interpretation-content sup.f-intprno,
                    .dark .ayah-interpretation-content sup.f-noteno,
                    .dark .ayah-interpretation-content a.crs {
                      color: #14B8A6 !important;
                    }

                    .ayah-interpretation-content sup.f-intprno:hover,
                    .ayah-interpretation-content sup.f-noteno:hover,
                    .ayah-interpretation-content a.crs:hover {
                      text-decoration: underline !important;
                    }
                  `}),e.jsx("div",{className:"space-y-4 ayah-interpretation-content",onClick:d,children:(s==="mal"?_.slice(0,1):_).map((t,p)=>{const w=[t.AudioIntrerptn,t.interpretation,t.Interpretation,t.text,t.content,t?.interpretation_text,t?.InterpretationText].find(j=>typeof j=="string"&&j.trim().length>0)||"No interpretation available",k=typeof w=="string"?w:String(w??""),I=s==="hi"?t.explanation_no_BN||t.explanation_no_EN||p+1:s==="bn"?t.explanation_no_BNG||t.explanation_no_EN||p+1:s==="ur"?t.explanation_no||p+1:i?t.interptn_no||t.number||p+1:t.resolvedInterpretationNo||t.InterpretationNo||t.Interpretation_No||t.interptn_no||t.number||t.requestedInterpretationNo||p+1;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm border border-gray-100 dark:border-gray-700",children:[(s==="hi"||s==="ur")&&e.jsxs("div",{className:"mb-3 text-sm font-bold text-primary dark:text-primary-light",children:["Explanation ",I,":"]}),i&&null,e.jsx("div",{className:"text-gray-700 leading-[1.8] font-poppins dark:text-gray-300 text-sm sm:text-base",style:{fontSize:`${h}px`},dangerouslySetInnerHTML:{__html:k}})]},p)})})]}),(!_||_.length===0)&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h4",{className:"text-sm font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400 mb-3",children:"Interpretation"}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-sm italic flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-gray-400"}),f===114?"Interpretation data is not available for Surah An-Nas (114).":"No interpretation available for this verse."]})})]})]}),e.jsxs("div",{className:"flex justify-between gap-3 p-4 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800",children:[e.jsxs("button",{onClick:V,disabled:S<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-xl border transition-all duration-200 group ${S<=1?"bg-gray-50 text-gray-400 border-gray-100 dark:bg-gray-800 dark:text-gray-600 dark:border-gray-700 cursor-not-allowed":"bg-white text-gray-700 border-gray-200 hover:border-primary hover:text-primary hover:bg-primary/5 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:border-primary-light dark:hover:text-primary-light"}`,children:[e.jsx(Ve,{className:"w-4 h-4 group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-sm font-medium",children:"Prev"})]}),e.jsxs("button",{onClick:C,disabled:S>=T,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-xl border transition-all duration-200 group ${S>=T?"bg-gray-50 text-gray-400 border-gray-100 dark:bg-gray-800 dark:text-gray-600 dark:border-gray-700 cursor-not-allowed":"bg-primary text-white border-primary hover:bg-primary-dark shadow-lg shadow-primary/20 dark:bg-primary dark:border-primary dark:hover:bg-primary-dark"}`,children:[e.jsx("span",{className:"text-sm font-medium",children:"Next Ayah"}),e.jsx(Fe,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]})]})]}),K&&le.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-start justify-center z-[100000] pt-24 sm:pt-28 lg:pt-32 p-4 overflow-hidden",children:e.jsx("div",{className:"bg-white dark:bg-[#2A2C38] rounded-xl shadow-2xl w-full sm:w-auto sm:max-w-6xl max-w-[95vw]",children:e.jsx(dt,{selectedVerse:S,surahId:f,onClose:se,onNavigate:v})})}),u),e.jsx(ue,{toasts:B,removeToast:o})]}),u)},dt=({selectedVerse:A,surahId:n,onClose:r,onNavigate:a,onSurahChange:l})=>{const h=Ge(),s=be(),B=Je(),o=h.surahId||n,x=h.verseId?parseInt(h.verseId):A,{quranFont:f,fontSize:O,adjustedTranslationFontSize:S,translationLanguage:v}=De(),[N,re]=m.useState(null),[E,U]=m.useState([]),[_,M]=m.useState(null),[Z,G]=m.useState(!0),[H,z]=m.useState(null),[T,ne]=m.useState(0),[K,L]=m.useState(!1),{toasts:q,removeToast:F,showSuccess:J,showError:X}=Ce(),Q=document.getElementById("modal-root")||document.body;m.useEffect(()=>{(async()=>{if(!(!x||!o))try{G(!0),z(null);const b=[v==="ta"?Xe.getWordByWordDataWithArabic(o,x).catch(async c=>await xe(o,x,"E")):v==="hi"?Ye.getWordByWordDataWithArabic(o,x).catch(async c=>await xe(o,x,"E")):v==="bn"?Ze.getWordByWordDataWithArabic(o,x).catch(async c=>await xe(o,x,"E")):v==="mal"?ot.getWordByWordDataWithArabic(o,x).catch(async c=>await xe(o,x,"E")):xe(o,x,v),Oe(o,x).catch(()=>[]),_?Promise.resolve(_):fe().then(c=>c.find(w=>w.number===parseInt(o))).catch(()=>null)],[P,t,p]=await Promise.all(b);re(P),U(t||[]),M(p),ne(p?.ayahs||0)}catch(b){z(b.message)}finally{G(!1)}})()},[x,o,v]);const ee=()=>{x>1&&(a?a(x-1):s(`/word-by-word/${o}/${x-1}`,{state:B.state}))},de=()=>{a?a(x+1):s(`/word-by-word/${o}/${x+1}`,{state:B.state})},g=()=>{if(r)r();else{const i=B.state?.from;s(i&&i!=="/surah/all"&&i!=="/surah"?i:`/surah/${o}`)}},C=i=>{L(!0)},V=i=>{l?l(i):a?(r(),s(`/surah/${i}?wordByWord=1`)):s(`/word-by-word/${i}/1`,{state:B.state})},$=i=>{a?a(i):s(`/word-by-word/${o}/${i}`,{state:B.state})},se=()=>{L(!1)},u=(i=>{switch(i){case"mal":return"Malayalam";case"E":return"English";case"ta":return"Tamil";case"hi":return"Hindi";case"ur":return"Urdu";case"ar":return"Arabic";default:return"English"}})(v);return Z?le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm"}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx("div",{className:"flex-shrink-0 z-10 bg-white dark:bg-gray-900",children:e.jsx(Se,{surahId:o,selectedVerse:x,surahInfo:_,onNavigate:a,onClose:g,onShowAyahModal:C,onSurahChange:V,onVerseChange:$,wordData:N,showSuccess:J,showError:X,translationLanguage:v})}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-6 py-8 min-h-[300px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading word meanings..."})]})}),e.jsx(ue,{toasts:q,removeToast:F})]})]}),Q):H?le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm",onClick:g}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx("div",{className:"flex-shrink-0 z-10 bg-white dark:bg-gray-900",children:e.jsx(Se,{surahId:o,selectedVerse:x,surahInfo:_,onNavigate:a,onClose:g,onShowAyahModal:C,onSurahChange:V,onVerseChange:$,wordData:N,showSuccess:J,showError:X,translationLanguage:v})}),e.jsx("div",{className:"flex-1 flex items-center justify-center px-6 py-8 min-h-[300px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-500 dark:text-red-400 mb-2",children:"Failed to load word meanings"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:H}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600 transition-colors",children:"Retry"})]})}),e.jsx(ue,{toasts:q,removeToast:F})]})]}),Q):le.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[99999] flex items-end sm:items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm transition-opacity",onClick:g}),e.jsxs("div",{className:"relative w-full sm:w-auto sm:min-w-[600px] lg:min-w-[800px] max-w-4xl xl:max-w-[1073px] max-h-[85vh] sm:max-h-[90vh] flex flex-col bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-2xl overflow-hidden animate-slideUp sm:animate-fadeIn",children:[e.jsx("div",{className:"sm:hidden w-full flex justify-center pt-3 pb-1 bg-white dark:bg-gray-900 border-b border-gray-100 dark:border-gray-800",onClick:g,children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx("div",{className:"flex-shrink-0 z-10 bg-white dark:bg-gray-900",children:e.jsx(Se,{surahId:o,selectedVerse:x,surahInfo:_,onNavigate:a,onClose:g,onShowAyahModal:C,onSurahChange:V,onVerseChange:$,wordData:N,showSuccess:J,showError:X,translationLanguage:v})}),e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-4 sm:py-6 overflow-y-auto flex-1 bg-gray-50/50 dark:bg-gray-900/50",children:[e.jsx("div",{className:"mb-4 sm:mb-6 text-center sm:text-left",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between mb-3 gap-2",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-medium text-gray-800 dark:text-gray-200",style:{fontFamily:f,fontSize:`${O}px`},children:_?.arabic||`Surah ${o}`}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-xs sm:text-sm font-medium text-gray-500 dark:text-gray-400 border border-gray-200 dark:border-gray-700",children:["Verse ",x," of ",T]})]})}),N&&e.jsx("div",{className:"text-right mb-6 sm:mb-8 border-b border-gray-200 dark:border-gray-700 pb-6",children:e.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl dark:text-white text-gray-900 leading-[2.2] px-2 sm:px-0",style:{fontFamily:f,fontSize:`${O}px`},dir:"rtl",children:[N.text_uthmani||N.words&&N.words.map(i=>i.text_uthmani||i.text_simple).join(" ")||"Verse text not available"," "]})}),N&&N.translations&&N.translations.length>0&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("h4",{className:"text-sm font-semibold uppercase tracking-wider text-primary dark:text-primary-light mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-[1px] bg-primary dark:bg-primary-light"}),"Translation"]}),e.jsx("p",{className:`text-gray-700 leading-[1.8] dark:text-gray-200 px-2 sm:px-0 ${v==="hi"?"font-hindi":v==="ur"?"font-urdu":v==="bn"?"font-bengali":v==="ta"?"font-tamil":v==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${S}px`},children:N.translations[0].text})]}),N&&N.words&&N.words.length>0&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[v!=="bn"&&e.jsxs("h4",{className:"text-sm font-semibold uppercase tracking-wider text-primary dark:text-primary-light mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-[1px] bg-primary dark:bg-primary-light"}),"Word Breakdown (",u,")"]}),e.jsx("div",{className:"space-y-4",children:N.words.map((i,b)=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-row-reverse justify-between items-center",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl sm:text-3xl text-gray-800 dark:text-white font-arabic",style:{fontFamily:f,fontSize:`${O}px`},children:i.text_uthmani||i.text_simple||"N/A"}),i.text_simple&&i.text_uthmani!==i.text_simple&&e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:i.text_simple})]}),e.jsxs("div",{className:"text-left max-w-[60%]",children:[i.translation&&i.translation.text?e.jsx("p",{className:`text-gray-700 leading-[1.6] sm:leading-[1.7] lg:leading-[1.8] dark:text-gray-200 mb-1 font-medium ${v==="hi"?"font-hindi":v==="ur"?"font-urdu":v==="bn"?"font-bengali":v==="ta"?"font-tamil":v==="mal"?"font-malayalam":"font-poppins"}`,style:{fontSize:`${S}px`},children:i.translation.text}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-1 italic",style:{fontSize:`${S}px`},children:"Translation not available"}),i.class_name&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1 uppercase tracking-wide",children:i.class_name})]})]})},b))})]}),N&&(!N.words||N.words.length===0)&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Word Breakdown:"}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm italic",children:"Word-by-word breakdown not available for this verse."})})]}),v==="mal"&&(!N||!N.words||N.words.length===0)&&E&&E.length>0&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsxs("h4",{className:"text-sm font-semibold uppercase tracking-wider text-primary dark:text-primary-light mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"w-8 h-[1px] bg-primary dark:bg-primary-light"}),"Word Breakdown (Malayalam)"]}),e.jsx("div",{className:"space-y-4",children:E.reduce((b,P,t)=>{const p=P.WordPhrase||P.text_uthmani||P.text_simple||"";return b.findIndex(w=>(w.WordPhrase||w.text_uthmani||w.text_simple)===p)===-1&&b.push({...P,originalIndex:t}),b},[]).map((b,P)=>{const t=b.WordPhrase||b.text_uthmani||b.text_simple||"",p=b.Meaning||b.translation?.text||"";return e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-sm border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-row-reverse justify-between items-center",children:[e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-2xl sm:text-3xl font-arabic dark:text-white text-gray-800",style:{fontFamily:f,fontSize:`${O}px`},children:t})}),e.jsx("div",{className:"text-left max-w-[60%]",children:e.jsx("span",{className:"text-gray-700 leading-[1.6] font-poppins sm:leading-[1.7] lg:leading-[1.8] dark:text-gray-200 font-malayalam font-medium",style:{fontSize:`${S}px`},children:p})})]})},`${t}-${P}`)})})]})]}),e.jsxs("div",{className:"flex-shrink-0 flex justify-between gap-3 p-4 bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 z-10",children:[e.jsxs("button",{onClick:ee,disabled:x<=1,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-xl border transition-all duration-200 group ${x<=1?"bg-gray-50 text-gray-400 border-gray-100 dark:bg-gray-800 dark:text-gray-600 dark:border-gray-700 cursor-not-allowed":"bg-white text-gray-700 border-gray-200 hover:border-primary hover:text-primary hover:bg-primary/5 dark:bg-gray-800 dark:text-gray-200 dark:border-gray-700 dark:hover:border-primary-light dark:hover:text-primary-light"}`,children:[e.jsx(Ve,{className:"w-4 h-4 group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-sm font-medium",children:"Prev"})]}),e.jsxs("button",{onClick:de,disabled:x>=T,className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 rounded-xl border transition-all duration-200 group ${x>=T?"bg-gray-50 text-gray-400 border-gray-100 dark:bg-gray-800 dark:text-gray-600 dark:border-gray-700 cursor-not-allowed":"bg-primary text-white border-primary hover:bg-primary-dark shadow-lg shadow-primary/20 dark:bg-primary dark:border-primary dark:hover:bg-primary-dark"}`,children:[e.jsx("span",{className:"text-sm font-medium",children:"Next Ayah"}),e.jsx(Fe,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]})]}),K&&e.jsx(lt,{surahId:o,verseId:x,onClose:se}),e.jsx(ue,{toasts:q,removeToast:F})]})]}),Q)};export{lt as A,dt as W};
