import{A as p}from"./index-CUlJBpza.js";import{a as c}from"./apiService-B0XJNrcm.js";import"./react-vendor-v5ei6ytj.js";const d=40,m=200;class f{constructor(){this.language="bangla",this.apiBasePath=p,this.pendingRequests=new Map,this.cache=new Map,this.cacheEnabled=!0,this.cacheTtl=3e5}generateCacheKey(a,n){const e=Object.keys(n).sort().map(t=>`${t}=${n[t]}`).join("&");return`${a}${e?`?${e}`:""}`}isCacheValid(a){return Date.now()-a<this.cacheTtl}getCachedData(a){if(!this.cacheEnabled)return null;const n=this.cache.get(a);return n&&this.isCacheValid(n.timestamp)?n.data:(n&&this.cache.delete(a),null)}setCachedData(a,n){this.cacheEnabled&&this.cache.set(a,{data:n,timestamp:Date.now()})}async getAyahTranslation(a,n){const e=this.generateCacheKey("getAyahTranslation",{surahId:a,ayahNumber:n}),t=this.getCachedData(e);if(t)return t;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const i=this._getAyahTranslationInternal(a,n,e);this.pendingRequests.set(e,i);try{return await i}finally{this.pendingRequests.delete(e)}}async _getAyahTranslationInternal(a,n,e){try{const t=await c.getTranslation(this.language,a,n),i=t?.translation_text??t?.translation??null;return i?(this.setCachedData(e,i),i):(console.warn(`⚠️ No Bangla translation returned for ${a}:${n}`),null)}catch(t){throw console.error(`❌ Bangla translation API failed for ${a}:${n}:`,t),t}}async getSurahTranslations(a,n={}){const e=n&&(n.page!==void 0||n.limit!==void 0),t=Number.isInteger(n.page)&&n.page>0?n.page:1,i=Number.isInteger(n.limit)&&n.limit>0?n.limit:d,r=Math.min(i,m),s=this.generateCacheKey("getSurahTranslations",e?{surahId:a,page:t,limit:r}:{surahId:a}),l=this.getCachedData(s);if(l)return l;if(this.pendingRequests.has(s))return this.pendingRequests.get(s);const o=this._getSurahTranslationsInternal(a,s,{page:t,limit:r,hasPagination:e});this.pendingRequests.set(s,o);try{return await o}finally{this.pendingRequests.delete(s)}}async _getSurahTranslationsInternal(a,n,{page:e,limit:t,hasPagination:i}){try{const r=i?{page:e,limit:t}:{},s=await c.getSurahTranslations(this.language,a,r),l=Array.isArray(s?.translations)?s.translations.map(h=>({number:h.verse_number,ArabicText:"",Translation:h.translation_text??""})):[];if(l.forEach(h=>{const u=this.generateCacheKey("getAyahTranslation",{surahId:a,ayahNumber:h.number});h.Translation&&this.setCachedData(u,h.Translation)}),!i)return this.setCachedData(n,l),l;const o=s?.pagination?{page:s.pagination.page??e,limit:s.pagination.limit??t,totalItems:s.pagination.totalItems??s.pagination.total??null,totalPages:s.pagination.totalPages??null,hasNext:s.pagination.hasNext??!1,hasPrev:s.pagination.hasPrev??e>1,from:s.pagination.from??null,to:s.pagination.to??null}:{page:e,limit:t,totalItems:s?.count??null,totalPages:s?.count?Math.ceil(s.count/t):null,hasNext:l.length===t,hasPrev:e>1,from:l[0]?.number??null,to:l[l.length-1]?.number??null},g={translations:l,pagination:o};return this.setCachedData(n,g),g}catch(r){throw console.error(`❌ Bangla surah translation API failed for ${a}:`,r),r}}async getWordByWordData(a,n){const e=this.generateCacheKey("getWordByWordData",{surahId:a,ayahNumber:n}),t=this.getCachedData(e);if(t)return t;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const i=this._getWordByWordDataInternal(a,n,e);this.pendingRequests.set(e,i);try{return await i}finally{this.pendingRequests.delete(e)}}async _getWordByWordDataInternal(a,n,e){try{const t=await c.getWordByWord(this.language,a,n),i=Array.isArray(t?.words)?t.words:[];if(i.length===0)return console.warn(`⚠️ No Bangla word-by-word data for ${a}:${n}`),null;const r=i.map((o,g)=>({id:o.id??o.WordId??o.word_id??g+1,position:o.position??o.WordId??o.word_id??g+1,audio_url:o.audio_url??null,char_type_name:o.char_type_name??"word",code_v1:o.code_v1??"",code_v2:o.code_v2??"",line_number:o.line_number??1,page_number:o.page_number??1,text_uthmani:o.text_uthmani??o.WordPhrase??"",text_simple:o.text_simple??o.WordPhrase??"",translation:{text:o.translation?.text??o.WordMeaning??"",language_name:o.translation?.language_name??"Bangla",resource_name:o.translation?.resource_name??"Thafheem Bangla Word Database"},transliteration:{text:o.transliteration?.text??"",language_name:o.transliteration?.language_name??"English"}})),s=r.map(o=>o.text_uthmani||o.WordPhrase||"").filter(Boolean).join(" "),l={text_uthmani:t?.text_uthmani??s,words:r,translations:t?.translations??[]};return this.setCachedData(e,l),l}catch(t){throw console.error(`❌ Bangla word-by-word API failed for ${a}:${n}:`,t),t}}async getExplanation(a,n){const e=this.generateCacheKey("getExplanation",{surahNo:a,ayahNo:n}),t=this.getCachedData(e);if(t)return t;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const i=this._getExplanationInternal(a,n,e);this.pendingRequests.set(e,i);try{return await i}finally{this.pendingRequests.delete(e)}}async _getExplanationInternal(a,n,e){try{const i=(await c.getInterpretation(this.language,a,n))?.explanations?.[0]?.explanation??null;return i?(this.setCachedData(e,i),i):(console.warn(`⚠️ No Bangla explanation found for ${a}:${n}`),null)}catch(t){throw console.error(`❌ Bangla explanation API failed for ${a}:${n}:`,t),t}}async getAllExplanations(a,n){const e=this.generateCacheKey("getAllExplanations",{surahNo:a,ayahNo:n}),t=this.getCachedData(e);if(t)return t;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const i=this._getAllExplanationsInternal(a,n,e);this.pendingRequests.set(e,i);try{return await i}finally{this.pendingRequests.delete(e)}}async _getAllExplanationsInternal(a,n,e){try{const t=await c.getInterpretation(this.language,a,n),i=Array.isArray(t?.explanations)?t.explanations.map(r=>({explanation:r.explanation,explanation_no_BNG:r.explanation_no_local??r.explanation_no_bng??null,explanation_no_EN:r.explanation_no_en??null})):[];return this.setCachedData(e,i),i}catch(t){throw console.error(`❌ Bangla explanations API failed for ${a}:${n}:`,t),t}}async getExplanationByNumber(a,n,e){const t=this.generateCacheKey("getExplanationByNumber",{surahNo:a,ayahNo:n,explanationNumber:e}),i=this.getCachedData(t);if(i)return i;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const r=this._getExplanationByNumberInternal(a,n,e,t);this.pendingRequests.set(t,r);try{return await r}finally{this.pendingRequests.delete(t)}}async _getExplanationByNumberInternal(a,n,e,t){try{const r=(await c.getInterpretation(this.language,a,n,e))?.explanations?.find(s=>s.explanation_no_local==e||s.explanation_no_en==e||s.explanation_no_bng==e);return r?.explanation?(this.setCachedData(t,r.explanation),r.explanation):(console.warn(`⚠️ No Bangla explanation found for ${a}:${n} number ${e}`),null)}catch(i){throw console.error(`❌ Bangla explanation API failed for ${a}:${n} number ${e}:`,i),i}}parseBanglaTranslationWithClickableExplanations(a,n,e){if(!a)return"";const t=document.createElement("div");return t.innerHTML=a,t.querySelectorAll("sup.f-note").forEach(r=>{const s=r.querySelector("a");if(s){const l=s.textContent.trim();/^[\d১২৩৪৫৬৭৮৯০]+$/.test(l)&&(r.style.cssText=`
            cursor: pointer !important;
            background-color: #19B5DD !important;
            color: #ffffff !important;
            font-weight: 500 !important;
            text-decoration: none !important;
            border: none !important;
            padding: 4px 8px !important;
            margin: 0 4px !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 12px !important;
            vertical-align: middle !important;
            line-height: 1 !important;
            border-radius: 50% !important;
            position: relative !important;
            top: 0 !important;
            min-width: 24px !important;
            min-height: 24px !important;
            text-align: center !important;
            transition: all 0.2s ease-in-out !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
          `,r.addEventListener("mouseenter",()=>{r.style.backgroundColor="#0ea5e9",r.style.transform="scale(1.1)"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor="#19B5DD",r.style.transform="scale(1)"}),r.setAttribute("data-explanation-number",l),r.setAttribute("data-surah",n),r.setAttribute("data-ayah",e),r.setAttribute("title",`Click to view explanation ${l}`),r.className="bangla-explanation-link",r.innerHTML=l)}}),t.innerHTML}async isAvailable(){try{return await c.checkLanguageHealth(this.language),!0}catch(a){return console.error("❌ Bangla service not available:",a),!1}}clearCache(){this.cache.clear(),this.pendingRequests.clear()}getCacheStats(){return{cacheSize:this.cache.size,pendingRequests:this.pendingRequests.size,cacheEnabled:this.cacheEnabled,cacheTtl:this.cacheTtl,mode:"API-only"}}}const q=new f;export{q as default};
