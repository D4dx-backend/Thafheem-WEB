import{ag as p}from"./index-D0NMIq43.js";import{a as c}from"./apiService-Be4cmTqe.js";import"./react-vendor-v5ei6ytj.js";const d=40,m=200;class f{constructor(){this.language="bangla",this.apiBasePath=p,this.pendingRequests=new Map,this.cache=new Map,this.cacheEnabled=!0,this.cacheTtl=3e5}generateCacheKey(a,n){const e=Object.keys(n).sort().map(t=>`${t}=${n[t]}`).join("&");return`${a}${e?`?${e}`:""}`}isCacheValid(a){return Date.now()-a<this.cacheTtl}getCachedData(a){if(!this.cacheEnabled)return null;const n=this.cache.get(a);return n&&this.isCacheValid(n.timestamp)?n.data:(n&&this.cache.delete(a),null)}setCachedData(a,n){this.cacheEnabled&&this.cache.set(a,{data:n,timestamp:Date.now()})}async getAyahTranslation(a,n){const e=this.generateCacheKey("getAyahTranslation",{surahId:a,ayahNumber:n}),t=this.getCachedData(e);if(t)return t;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const i=this._getAyahTranslationInternal(a,n,e);this.pendingRequests.set(e,i);try{return await i}finally{this.pendingRequests.delete(e)}}async _getAyahTranslationInternal(a,n,e){try{const t=await c.getTranslation(this.language,a,n),i=t?.translation_text??t?.translation??null;return i?(this.setCachedData(e,i),i):(console.warn(`⚠️ No Bangla translation returned for ${a}:${n}`),null)}catch(t){throw console.error(`❌ Bangla translation API failed for ${a}:${n}:`,t),t}}async getSurahTranslations(a,n={}){const e=n&&(n.page!==void 0||n.limit!==void 0),t=Number.isInteger(n.page)&&n.page>0?n.page:1,i=Number.isInteger(n.limit)&&n.limit>0?n.limit:d,s=Math.min(i,m),r=this.generateCacheKey("getSurahTranslations",e?{surahId:a,page:t,limit:s}:{surahId:a}),l=this.getCachedData(r);if(l)return l;if(this.pendingRequests.has(r))return this.pendingRequests.get(r);const o=this._getSurahTranslationsInternal(a,r,{page:t,limit:s,hasPagination:e});this.pendingRequests.set(r,o);try{return await o}finally{this.pendingRequests.delete(r)}}async _getSurahTranslationsInternal(a,n,{page:e,limit:t,hasPagination:i}){try{const s=i?{page:e,limit:t}:{},r=await c.getSurahTranslations(this.language,a,s),l=Array.isArray(r?.translations)?r.translations.map(h=>({number:h.verse_number,ArabicText:"",Translation:h.translation_text??""})):[];if(l.forEach(h=>{const u=this.generateCacheKey("getAyahTranslation",{surahId:a,ayahNumber:h.number});h.Translation&&this.setCachedData(u,h.Translation)}),!i)return this.setCachedData(n,l),l;const o=r?.pagination?{page:r.pagination.page??e,limit:r.pagination.limit??t,totalItems:r.pagination.totalItems??r.pagination.total??null,totalPages:r.pagination.totalPages??null,hasNext:r.pagination.hasNext??!1,hasPrev:r.pagination.hasPrev??e>1,from:r.pagination.from??null,to:r.pagination.to??null}:{page:e,limit:t,totalItems:r?.count??null,totalPages:r?.count?Math.ceil(r.count/t):null,hasNext:l.length===t,hasPrev:e>1,from:l[0]?.number??null,to:l[l.length-1]?.number??null},g={translations:l,pagination:o};return this.setCachedData(n,g),g}catch(s){throw console.error(`❌ Bangla surah translation API failed for ${a}:`,s),s}}async getWordByWordData(a,n){const e=this.generateCacheKey("getWordByWordData",{surahId:a,ayahNumber:n}),t=this.getCachedData(e);if(t)return t;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const i=this._getWordByWordDataInternal(a,n,e);this.pendingRequests.set(e,i);try{return await i}finally{this.pendingRequests.delete(e)}}async _getWordByWordDataInternal(a,n,e){try{const t=await c.getWordByWord(this.language,a,n),i=Array.isArray(t?.words)?t.words:[];if(i.length===0)return console.warn(`⚠️ No Bangla word-by-word data for ${a}:${n}`),null;const s=i.map((o,g)=>({id:o.id??o.WordId??o.word_id??g+1,position:o.position??o.WordId??o.word_id??g+1,audio_url:o.audio_url??null,char_type_name:o.char_type_name??"word",code_v1:o.code_v1??"",code_v2:o.code_v2??"",line_number:o.line_number??1,page_number:o.page_number??1,text_uthmani:o.text_uthmani??o.WordPhrase??"",text_simple:o.text_simple??o.WordPhrase??"",translation:{text:o.translation?.text??o.WordMeaning??"",language_name:o.translation?.language_name??"Bangla",resource_name:o.translation?.resource_name??"Thafheem Bangla Word Database"},transliteration:{text:o.transliteration?.text??"",language_name:o.transliteration?.language_name??"English"}})),r=s.map(o=>o.text_uthmani||o.WordPhrase||"").filter(Boolean).join(" "),l={text_uthmani:t?.text_uthmani??r,words:s,translations:t?.translations??[]};return this.setCachedData(e,l),l}catch(t){throw console.error(`❌ Bangla word-by-word API failed for ${a}:${n}:`,t),t}}async getExplanation(a,n){const e=this.generateCacheKey("getExplanation",{surahNo:a,ayahNo:n}),t=this.getCachedData(e);if(t)return t;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const i=this._getExplanationInternal(a,n,e);this.pendingRequests.set(e,i);try{return await i}finally{this.pendingRequests.delete(e)}}async _getExplanationInternal(a,n,e){try{const i=(await c.getInterpretation(this.language,a,n))?.explanations?.[0]?.explanation??null;return i?(this.setCachedData(e,i),i):(console.warn(`⚠️ No Bangla explanation found for ${a}:${n}`),null)}catch(t){throw console.error(`❌ Bangla explanation API failed for ${a}:${n}:`,t),t}}async getAllExplanations(a,n){const e=this.generateCacheKey("getAllExplanations",{surahNo:a,ayahNo:n}),t=this.getCachedData(e);if(t)return t;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const i=this._getAllExplanationsInternal(a,n,e);this.pendingRequests.set(e,i);try{return await i}finally{this.pendingRequests.delete(e)}}async _getAllExplanationsInternal(a,n,e){try{const t=await c.getInterpretation(this.language,a,n),i=Array.isArray(t?.explanations)?t.explanations.map(s=>({explanation:s.explanation,explanation_no_BNG:s.explanation_no_local??s.explanation_no_bng??null,explanation_no_EN:s.explanation_no_en??null})):[];return this.setCachedData(e,i),i}catch(t){throw console.error(`❌ Bangla explanations API failed for ${a}:${n}:`,t),t}}async getExplanationByNumber(a,n,e){const t=this.generateCacheKey("getExplanationByNumber",{surahNo:a,ayahNo:n,explanationNumber:e}),i=this.getCachedData(t);if(i)return i;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const s=this._getExplanationByNumberInternal(a,n,e,t);this.pendingRequests.set(t,s);try{return await s}finally{this.pendingRequests.delete(t)}}async _getExplanationByNumberInternal(a,n,e,t){try{const s=(await c.getInterpretation(this.language,a,n,e))?.explanations?.find(r=>r.explanation_no_local==e||r.explanation_no_en==e||r.explanation_no_bng==e);return s?.explanation?(this.setCachedData(t,s.explanation),s.explanation):(console.warn(`⚠️ No Bangla explanation found for ${a}:${n} number ${e}`),null)}catch(i){throw console.error(`❌ Bangla explanation API failed for ${a}:${n} number ${e}:`,i),i}}parseBanglaTranslationWithClickableExplanations(a,n,e){if(!a)return"";const t=document.createElement("div");return t.innerHTML=a,t.querySelectorAll("sup.f-note").forEach(s=>{const r=s.querySelector("a");if(r){const l=r.textContent.trim();/^[\d১২৩৪৫৬৭৮৯০]+$/.test(l)&&(s.style.cssText=`
            cursor: pointer !important;
            background-color: transparent !important;
            color: #19B5DD !important;
            font-weight: 500 !important;
            text-decoration: none !important;
            border: none !important;
            display: inline !important;
            font-size: 12px !important;
            vertical-align: super !important;
            line-height: 1 !important;
            position: relative !important;
            top: 3px !important;
            transition: all 0.2s ease-in-out !important;
          `,s.addEventListener("mouseenter",()=>{s.style.color="#0ea5e9"}),s.addEventListener("mouseleave",()=>{s.style.color="#19B5DD"}),s.setAttribute("data-explanation-number",l),s.setAttribute("data-surah",n),s.setAttribute("data-ayah",e),s.setAttribute("title",`Click to view explanation ${l}`),s.className="bangla-explanation-link",s.innerHTML=l)}}),t.innerHTML}async isAvailable(){try{return await c.checkLanguageHealth(this.language),!0}catch(a){return console.error("❌ Bangla service not available:",a),!1}}clearCache(){this.cache.clear(),this.pendingRequests.clear()}getCacheStats(){return{cacheSize:this.cache.size,pendingRequests:this.pendingRequests.size,cacheEnabled:this.cacheEnabled,cacheTtl:this.cacheTtl,mode:"API-only"}}}const A=new f;export{A as default};
