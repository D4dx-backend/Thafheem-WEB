import{ad as h,ae as g,af as p,ag as d}from"./index-pxHnjHjD.js";import{a as l}from"./apiService-uFQGO9bv.js";class u{constructor(){this.language="bangla",this.useApi=h,this.apiBasePath=g,this.cacheEnabled=p,this.cacheTtl=d,this.cache=new Map,this.pendingRequests=new Map}_assertApiEnabled(){if(!this.useApi)throw new Error("Bangla API is disabled (VITE_USE_API=false).")}generateCacheKey(n,a){const t=Object.keys(a).sort().map(e=>`${e}=${a[e]}`).join("&");return`${n}${t?`?${t}`:""}`}isCacheValid(n){return Date.now()-n<this.cacheTtl}getCachedData(n){if(!this.cacheEnabled)return null;const a=this.cache.get(n);return a&&this.isCacheValid(a.timestamp)?a.data:(a&&this.cache.delete(n),null)}setCachedData(n,a){this.cacheEnabled&&this.cache.set(n,{data:a,timestamp:Date.now()})}async getAyahTranslation(n,a){const t=this.generateCacheKey("getAyahTranslation",{surahId:n,ayahNumber:a}),e=this.getCachedData(t);if(e)return e;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const s=this._getAyahTranslationInternal(n,a,t);this.pendingRequests.set(t,s);try{return await s}finally{this.pendingRequests.delete(t)}}async _getAyahTranslationInternal(n,a,t){this._assertApiEnabled();try{const e=await l.getTranslation(this.language,n,a),s=e?.translation_text??e?.translation??null;return s?(this.setCachedData(t,s),s):(console.warn(`⚠️ No Bangla translation returned for ${n}:${a}`),null)}catch(e){throw console.error(`❌ Bangla translation API failed for ${n}:${a}:`,e),e}}async getSurahTranslations(n){const a=this.generateCacheKey("getSurahTranslations",{surahId:n}),t=this.getCachedData(a);if(t)return t;if(this.pendingRequests.has(a))return this.pendingRequests.get(a);const e=this._getSurahTranslationsInternal(n,a);this.pendingRequests.set(a,e);try{return await e}finally{this.pendingRequests.delete(a)}}async _getSurahTranslationsInternal(n,a){this._assertApiEnabled();try{const t=await l.getSurahTranslations(this.language,n),e=Array.isArray(t?.translations)?t.translations.map(s=>({number:s.verse_number,ArabicText:"",Translation:s.translation_text??""})):[];return e.forEach(s=>{const i=this.generateCacheKey("getAyahTranslation",{surahId:n,ayahNumber:s.number});s.Translation&&this.setCachedData(i,s.Translation)}),this.setCachedData(a,e),e}catch(t){throw console.error(`❌ Bangla surah translation API failed for ${n}:`,t),t}}async getWordByWordData(n,a){const t=this.generateCacheKey("getWordByWordData",{surahId:n,ayahNumber:a}),e=this.getCachedData(t);if(e)return e;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const s=this._getWordByWordDataInternal(n,a,t);this.pendingRequests.set(t,s);try{return await s}finally{this.pendingRequests.delete(t)}}async _getWordByWordDataInternal(n,a,t){this._assertApiEnabled();try{const e=await l.getWordByWord(this.language,n,a),s=Array.isArray(e?.words)?e.words:[];if(s.length===0)return console.warn(`⚠️ No Bangla word-by-word data for ${n}:${a}`),null;const i=s.map((r,c)=>({id:r.id??r.WordId??r.word_id??c+1,position:r.position??r.WordId??r.word_id??c+1,audio_url:r.audio_url??null,char_type_name:r.char_type_name??"word",code_v1:r.code_v1??"",code_v2:r.code_v2??"",line_number:r.line_number??1,page_number:r.page_number??1,text_uthmani:r.text_uthmani??"",text_simple:r.text_simple??"",translation:{text:r.translation?.text??r.WordMeaning??"",language_name:r.translation?.language_name??"Bangla",resource_name:r.translation?.resource_name??"Thafheem Bangla Word Database"},transliteration:{text:r.transliteration?.text??r.WordPhrase??"",language_name:r.transliteration?.language_name??"Bangla"}})),o={text_uthmani:e?.text_uthmani??"",words:i,translations:e?.translations??[]};return this.setCachedData(t,o),o}catch(e){throw console.error(`❌ Bangla word-by-word API failed for ${n}:${a}:`,e),e}}async getExplanation(n,a){const t=this.generateCacheKey("getExplanation",{surahNo:n,ayahNo:a}),e=this.getCachedData(t);if(e)return e;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const s=this._getExplanationInternal(n,a,t);this.pendingRequests.set(t,s);try{return await s}finally{this.pendingRequests.delete(t)}}async _getExplanationInternal(n,a,t){this._assertApiEnabled();try{const s=(await l.getInterpretation(this.language,n,a))?.explanations?.[0]?.explanation??null;return s?(this.setCachedData(t,s),s):(console.warn(`⚠️ No Bangla explanation found for ${n}:${a}`),null)}catch(e){throw console.error(`❌ Bangla explanation API failed for ${n}:${a}:`,e),e}}async getAllExplanations(n,a){const t=this.generateCacheKey("getAllExplanations",{surahNo:n,ayahNo:a}),e=this.getCachedData(t);if(e)return e;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const s=this._getAllExplanationsInternal(n,a,t);this.pendingRequests.set(t,s);try{return await s}finally{this.pendingRequests.delete(t)}}async _getAllExplanationsInternal(n,a,t){this._assertApiEnabled();try{const e=await l.getInterpretation(this.language,n,a),s=Array.isArray(e?.explanations)?e.explanations.map(i=>({explanation:i.explanation,explanation_no_BNG:i.explanation_no_local??i.explanation_no_bng??null,explanation_no_EN:i.explanation_no_en??null})):[];return this.setCachedData(t,s),s}catch(e){throw console.error(`❌ Bangla explanations API failed for ${n}:${a}:`,e),e}}async getExplanationByNumber(n,a,t){const e=this.generateCacheKey("getExplanationByNumber",{surahNo:n,ayahNo:a,explanationNumber:t}),s=this.getCachedData(e);if(s)return s;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const i=this._getExplanationByNumberInternal(n,a,t,e);this.pendingRequests.set(e,i);try{return await i}finally{this.pendingRequests.delete(e)}}async _getExplanationByNumberInternal(n,a,t,e){this._assertApiEnabled();try{const i=(await l.getInterpretation(this.language,n,a,t))?.explanations?.find(o=>o.explanation_no_local==t||o.explanation_no_en==t||o.explanation_no_bng==t);return i?.explanation?(this.setCachedData(e,i.explanation),i.explanation):(console.warn(`⚠️ No Bangla explanation found for ${n}:${a} number ${t}`),null)}catch(s){throw console.error(`❌ Bangla explanation API failed for ${n}:${a} number ${t}:`,s),s}}parseBanglaTranslationWithClickableExplanations(n,a,t){if(!n)return"";const e=document.createElement("div");return e.innerHTML=n,e.querySelectorAll("sup.f-note").forEach(i=>{const o=i.querySelector("a");if(o){const r=o.textContent.trim();/^[\d১২৩৪৫৬৭৮৯০]+$/.test(r)&&(i.style.cssText=`
            cursor: pointer !important;
            background-color: #19B5DD !important;
            color: #ffffff !important;
            font-weight: 500 !important;
            text-decoration: none !important;
            border: none !important;
            padding: 4px 8px !important;
            margin: 0 4px !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 12px !important;
            vertical-align: middle !important;
            line-height: 1 !important;
            border-radius: 50% !important;
            position: relative !important;
            top: 0 !important;
            min-width: 24px !important;
            min-height: 24px !important;
            text-align: center !important;
            transition: all 0.2s ease-in-out !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
          `,i.addEventListener("mouseenter",()=>{i.style.backgroundColor="#0ea5e9",i.style.transform="scale(1.1)"}),i.addEventListener("mouseleave",()=>{i.style.backgroundColor="#19B5DD",i.style.transform="scale(1)"}),i.setAttribute("data-explanation-number",r),i.setAttribute("data-surah",a),i.setAttribute("data-ayah",t),i.setAttribute("title",`Click to view explanation ${r}`),i.className="bangla-explanation-link",i.innerHTML=r)}}),e.innerHTML}async isAvailable(){try{return this._assertApiEnabled(),await l.checkLanguageHealth(this.language),!0}catch(n){return console.error("❌ Bangla service not available:",n),!1}}clearCache(){this.cache.clear(),this.pendingRequests.clear()}getCacheStats(){return{cacheSize:this.cache.size,pendingRequests:this.pendingRequests.size,cacheEnabled:this.cacheEnabled,cacheTtl:this.cacheTtl,mode:"API-only"}}}const y=new u;export{y as default};
