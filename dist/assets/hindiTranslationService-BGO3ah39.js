import{a6 as u}from"./index-zWRKLUWk.js";import{a as l}from"./apiService-hOh9yyny.js";import"./react-vendor-v5ei6ytj.js";const p=40,m=200;class f{constructor(){this.language="hindi",this.apiBasePath=u,this.pendingRequests=new Map,this.cache=new Map,this.cacheEnabled=!0,this.cacheTtl=3e5}generateCacheKey(a,n){const t=Object.keys(n).sort().map(e=>`${e}=${n[e]}`).join("&");return`${a}${t?`?${t}`:""}`}isCacheValid(a){return Date.now()-a<this.cacheTtl}getCachedData(a){if(!this.cacheEnabled)return null;const n=this.cache.get(a);return n&&this.isCacheValid(n.timestamp)?n.data:(n&&this.cache.delete(a),null)}setCachedData(a,n){this.cacheEnabled&&this.cache.set(a,{data:n,timestamp:Date.now()})}async getAyahTranslation(a,n){const t=this.generateCacheKey("getAyahTranslation",{surahNo:a,ayahNo:n}),e=this.getCachedData(t);if(e)return e;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const r=this._getAyahTranslationInternal(a,n,t);this.pendingRequests.set(t,r);try{return await r}finally{this.pendingRequests.delete(t)}}async _getAyahTranslationInternal(a,n,t){try{const e=await l.getTranslation(this.language,a,n),r=e?.translation_text??e?.translation??"";return this.setCachedData(t,r),r}catch(e){throw console.error(`❌ Hindi translation API failed for ${a}:${n}:`,e),e}}async getSurahTranslations(a,n={}){const t=n&&(n.page!==void 0||n.limit!==void 0),e=Number.isInteger(n.page)&&n.page>0?n.page:1,r=Number.isInteger(n.limit)&&n.limit>0?n.limit:p,s=Math.min(r,m),i=this.generateCacheKey("getSurahTranslations",t?{surahNo:a,page:e,limit:s}:{surahNo:a}),o=this.getCachedData(i);if(o)return o;if(this.pendingRequests.has(i))return this.pendingRequests.get(i);const h=this._getSurahTranslationsInternal(a,i,{page:e,limit:s,hasPagination:t});this.pendingRequests.set(i,h);try{return await h}finally{this.pendingRequests.delete(i)}}async _getSurahTranslationsInternal(a,n,{page:t,limit:e,hasPagination:r}){try{const s=r?{page:t,limit:e}:{},i=await l.getSurahTranslations(this.language,a,s),o=Array.isArray(i?.translations)?i.translations.map(c=>({number:c.verse_number,ArabicText:"",Translation:c.translation_text??""})):[];if(o.forEach(c=>{const d=this.generateCacheKey("getAyahTranslation",{surahNo:a,ayahNo:c.number});c.Translation&&this.setCachedData(d,c.Translation)}),!r)return this.setCachedData(n,o),o;const h=i?.pagination?{page:i.pagination.page??t,limit:i.pagination.limit??e,totalItems:i.pagination.totalItems??i.pagination.total??null,totalPages:i.pagination.totalPages??null,hasNext:i.pagination.hasNext??!1,hasPrev:i.pagination.hasPrev??t>1,from:i.pagination.from??null,to:i.pagination.to??null}:{page:t,limit:e,totalItems:i?.count??null,totalPages:i?.count?Math.ceil(i.count/e):null,hasNext:o.length===e,hasPrev:t>1,from:o[0]?.number??null,to:o[o.length-1]?.number??null},g={translations:o,pagination:h};return this.setCachedData(n,g),g}catch(s){throw console.error(`❌ Hindi surah translation API failed for ${a}:`,s),s}}async getWordByWordData(a,n){const t=this.generateCacheKey("getWordByWordData",{surahNo:a,ayahNo:n}),e=this.getCachedData(t);if(e)return e;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const r=this._getWordByWordDataInternal(a,n,t);this.pendingRequests.set(t,r);try{return await r}finally{this.pendingRequests.delete(t)}}async _getWordByWordDataInternal(a,n,t){try{const e=await l.getWordByWord(this.language,a,n),r=Array.isArray(e?.words)?e.words:[];if(r.length===0)return console.warn(`⚠️ No Hindi word-by-word data for ${a}:${n}`),[];const s=r.map((i,o)=>({id:i.id??i.WordId??i.word_id??o+1,position:i.position??i.WordId??i.word_id??o+1,audio_url:i.audio_url??null,char_type_name:i.char_type_name??"word",code_v1:i.code_v1??"",code_v2:i.code_v2??"",line_number:i.line_number??1,page_number:i.page_number??1,text_uthmani:i.text_uthmani??"",text_simple:i.text_simple??"",translation:{text:i.translation?.text??i.WordMeaning??"",language_name:i.translation?.language_name??"Hindi",resource_name:i.translation?.resource_name??"Thafheem Hindi Word Database"},transliteration:{text:i.transliteration?.text??i.WordPhrase??"",language_name:i.transliteration?.language_name??"Hindi"}}));return this.setCachedData(t,s),s}catch(e){throw console.error(`❌ Hindi word-by-word API failed for ${a}:${n}:`,e),e}}async getExplanation(a,n){const t=this.generateCacheKey("getExplanation",{surahNo:a,ayahNo:n}),e=this.getCachedData(t);if(e)return e;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const r=this._getExplanationInternal(a,n,t);this.pendingRequests.set(t,r);try{return await r}finally{this.pendingRequests.delete(t)}}async _getExplanationInternal(a,n,t){try{const r=(await l.getInterpretation(this.language,a,n))?.explanations?.[0]?.explanation??null;return r?(this.setCachedData(t,r),r):(console.warn(`⚠️ No Hindi explanation found for ${a}:${n}`),null)}catch(e){throw console.error(`❌ Hindi explanation API failed for ${a}:${n}:`,e),e}}async getAllExplanations(a,n){const t=this.generateCacheKey("getAllExplanations",{surahNo:a,ayahNo:n}),e=this.getCachedData(t);if(e)return e;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const r=this._getAllExplanationsInternal(a,n,t);this.pendingRequests.set(t,r);try{return await r}finally{this.pendingRequests.delete(t)}}async _getAllExplanationsInternal(a,n,t){try{const e=await l.getInterpretation(this.language,a,n),r=Array.isArray(e?.explanations)?e.explanations.map(s=>({explanation:s.explanation,explanation_no_local:s.explanation_no_local??null,explanation_no_en:s.explanation_no_en??null})):[];return this.setCachedData(t,r),r}catch(e){throw console.error(`❌ Hindi explanations API failed for ${a}:${n}:`,e),e}}async getExplanationByNumber(a,n,t){const e=this.generateCacheKey("getExplanationByNumber",{surahNo:a,ayahNo:n,explanationNumber:t}),r=this.getCachedData(e);if(r)return r;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const s=this._getExplanationByNumberInternal(a,n,t,e);this.pendingRequests.set(e,s);try{return await s}finally{this.pendingRequests.delete(e)}}async _getExplanationByNumberInternal(a,n,t,e){try{const s=(await l.getInterpretation(this.language,a,n,t))?.explanations?.find(i=>i.explanation_no_local==t||i.explanation_no_en==t);return s?.explanation?(this.setCachedData(e,s.explanation),s.explanation):(console.warn(`⚠️ No Hindi explanation found for ${a}:${n} number ${t}`),null)}catch(r){throw console.error(`❌ Hindi explanation API failed for ${a}:${n} number ${t}:`,r),r}}parseHindiTranslationWithClickableExplanations(a,n,t){if(!a)return"";const e=document.createElement("div");return e.innerHTML=a,e.querySelectorAll("sup.f-note").forEach(s=>{const i=s.querySelector("a");if(i){const o=i.textContent.trim();/^[\d१२३४५६७८९०]+$/.test(o)&&(s.style.cssText=`
            cursor: pointer !important;
            background-color: #19B5DD !important;
            color: #ffffff !important;
            font-weight: 500 !important;
            text-decoration: none !important;
            border: none !important;
            padding: 4px 8px !important;
            margin: 0 4px !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 12px !important;
            vertical-align: middle !important;
            line-height: 1 !important;
            border-radius: 50% !important;
            position: relative !important;
            top: 0 !important;
            min-width: 24px !important;
            min-height: 24px !important;
            text-align: center !important;
            transition: all 0.2s ease-in-out !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
          `,s.addEventListener("mouseenter",()=>{s.style.backgroundColor="#0ea5e9",s.style.transform="scale(1.1)"}),s.addEventListener("mouseleave",()=>{s.style.backgroundColor="#19B5DD",s.style.transform="scale(1)"}),s.setAttribute("data-footnote",o),s.setAttribute("data-surah",n),s.setAttribute("data-ayah",t),s.setAttribute("title",`Click to view explanation ${o}`),s.className="hindi-footnote-link",s.innerHTML=o)}}),e.innerHTML}async isAvailable(){try{return await l.checkLanguageHealth(this.language),!0}catch(a){return console.error("❌ Hindi service not available:",a),!1}}clearCache(){this.cache.clear(),this.pendingRequests.clear()}destroy(){this.clearCache()}getCacheStats(){return{cacheSize:this.cache.size,pendingRequests:this.pendingRequests.size,cacheEnabled:this.cacheEnabled,cacheTtl:this.cacheTtl,mode:"API-only"}}}const q=new f;export{q as default};
