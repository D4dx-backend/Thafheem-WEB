import{ah as c,ai as h,aj as d,ak as p}from"./index-BMIAMJ2S.js";import{a as l}from"./apiService-xUHHIAvd.js";class g{constructor(){this.language="hindi",this.useApi=c,this.apiBasePath=h,this.cacheEnabled=d,this.cacheTtl=p,this.cache=new Map,this.pendingRequests=new Map}_assertApiEnabled(){if(!this.useApi)throw new Error("Hindi API is disabled (VITE_USE_API=false).")}generateCacheKey(n,a){const t=Object.keys(a).sort().map(e=>`${e}=${a[e]}`).join("&");return`${n}${t?`?${t}`:""}`}isCacheValid(n){return Date.now()-n<this.cacheTtl}getCachedData(n){if(!this.cacheEnabled)return null;const a=this.cache.get(n);return a&&this.isCacheValid(a.timestamp)?a.data:(a&&this.cache.delete(n),null)}setCachedData(n,a){this.cacheEnabled&&this.cache.set(n,{data:a,timestamp:Date.now()})}async getAyahTranslation(n,a){const t=this.generateCacheKey("getAyahTranslation",{surahNo:n,ayahNo:a}),e=this.getCachedData(t);if(e)return e;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const i=this._getAyahTranslationInternal(n,a,t);this.pendingRequests.set(t,i);try{return await i}finally{this.pendingRequests.delete(t)}}async _getAyahTranslationInternal(n,a,t){this._assertApiEnabled();try{const e=await l.getTranslation(this.language,n,a),i=e?.translation_text??e?.translation??"";return this.setCachedData(t,i),i}catch(e){throw console.error(`❌ Hindi translation API failed for ${n}:${a}:`,e),e}}async getSurahTranslations(n){const a=this.generateCacheKey("getSurahTranslations",{surahNo:n}),t=this.getCachedData(a);if(t)return t;if(this.pendingRequests.has(a))return this.pendingRequests.get(a);const e=this._getSurahTranslationsInternal(n,a);this.pendingRequests.set(a,e);try{return await e}finally{this.pendingRequests.delete(a)}}async _getSurahTranslationsInternal(n,a){this._assertApiEnabled();try{const t=await l.getSurahTranslations(this.language,n),e=Array.isArray(t?.translations)?t.translations.map(i=>({number:i.verse_number,ArabicText:"",Translation:i.translation_text??""})):[];return e.forEach(i=>{const s=this.generateCacheKey("getAyahTranslation",{surahNo:n,ayahNo:i.number});i.Translation&&this.setCachedData(s,i.Translation)}),this.setCachedData(a,e),e}catch(t){throw console.error(`❌ Hindi surah translation API failed for ${n}:`,t),t}}async getWordByWordData(n,a){const t=this.generateCacheKey("getWordByWordData",{surahNo:n,ayahNo:a}),e=this.getCachedData(t);if(e)return e;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const i=this._getWordByWordDataInternal(n,a,t);this.pendingRequests.set(t,i);try{return await i}finally{this.pendingRequests.delete(t)}}async _getWordByWordDataInternal(n,a,t){this._assertApiEnabled();try{const e=await l.getWordByWord(this.language,n,a),i=Array.isArray(e?.words)?e.words:[];if(i.length===0)return console.warn(`⚠️ No Hindi word-by-word data for ${n}:${a}`),[];const s=i.map((r,o)=>({id:r.id??r.WordId??r.word_id??o+1,position:r.position??r.WordId??r.word_id??o+1,audio_url:r.audio_url??null,char_type_name:r.char_type_name??"word",code_v1:r.code_v1??"",code_v2:r.code_v2??"",line_number:r.line_number??1,page_number:r.page_number??1,text_uthmani:r.text_uthmani??"",text_simple:r.text_simple??"",translation:{text:r.translation?.text??r.WordMeaning??"",language_name:r.translation?.language_name??"Hindi",resource_name:r.translation?.resource_name??"Thafheem Hindi Word Database"},transliteration:{text:r.transliteration?.text??r.WordPhrase??"",language_name:r.transliteration?.language_name??"Hindi"}}));return this.setCachedData(t,s),s}catch(e){throw console.error(`❌ Hindi word-by-word API failed for ${n}:${a}:`,e),e}}async getExplanation(n,a){const t=this.generateCacheKey("getExplanation",{surahNo:n,ayahNo:a}),e=this.getCachedData(t);if(e)return e;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const i=this._getExplanationInternal(n,a,t);this.pendingRequests.set(t,i);try{return await i}finally{this.pendingRequests.delete(t)}}async _getExplanationInternal(n,a,t){this._assertApiEnabled();try{const i=(await l.getInterpretation(this.language,n,a))?.explanations?.[0]?.explanation??null;return i?(this.setCachedData(t,i),i):(console.warn(`⚠️ No Hindi explanation found for ${n}:${a}`),null)}catch(e){throw console.error(`❌ Hindi explanation API failed for ${n}:${a}:`,e),e}}async getAllExplanations(n,a){const t=this.generateCacheKey("getAllExplanations",{surahNo:n,ayahNo:a}),e=this.getCachedData(t);if(e)return e;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const i=this._getAllExplanationsInternal(n,a,t);this.pendingRequests.set(t,i);try{return await i}finally{this.pendingRequests.delete(t)}}async _getAllExplanationsInternal(n,a,t){this._assertApiEnabled();try{const e=await l.getInterpretation(this.language,n,a),i=Array.isArray(e?.explanations)?e.explanations.map(s=>({explanation:s.explanation,explanation_no_local:s.explanation_no_local??null,explanation_no_en:s.explanation_no_en??null})):[];return this.setCachedData(t,i),i}catch(e){throw console.error(`❌ Hindi explanations API failed for ${n}:${a}:`,e),e}}async getExplanationByNumber(n,a,t){const e=this.generateCacheKey("getExplanationByNumber",{surahNo:n,ayahNo:a,explanationNumber:t}),i=this.getCachedData(e);if(i)return i;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const s=this._getExplanationByNumberInternal(n,a,t,e);this.pendingRequests.set(e,s);try{return await s}finally{this.pendingRequests.delete(e)}}async _getExplanationByNumberInternal(n,a,t,e){this._assertApiEnabled();try{const s=(await l.getInterpretation(this.language,n,a,t))?.explanations?.find(r=>r.explanation_no_local==t||r.explanation_no_en==t);return s?.explanation?(this.setCachedData(e,s.explanation),s.explanation):(console.warn(`⚠️ No Hindi explanation found for ${n}:${a} number ${t}`),null)}catch(i){throw console.error(`❌ Hindi explanation API failed for ${n}:${a} number ${t}:`,i),i}}parseHindiTranslationWithClickableExplanations(n,a,t){if(!n)return"";const e=document.createElement("div");return e.innerHTML=n,e.querySelectorAll("sup.f-note").forEach(s=>{const r=s.querySelector("a");if(r){const o=r.textContent.trim();/^[\d१२३४५६७८९०]+$/.test(o)&&(s.style.cssText=`
            cursor: pointer !important;
            background-color: #19B5DD !important;
            color: #ffffff !important;
            font-weight: 500 !important;
            text-decoration: none !important;
            border: none !important;
            padding: 4px 8px !important;
            margin: 0 4px !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            font-size: 12px !important;
            vertical-align: middle !important;
            line-height: 1 !important;
            border-radius: 50% !important;
            position: relative !important;
            top: 0 !important;
            min-width: 24px !important;
            min-height: 24px !important;
            text-align: center !important;
            transition: all 0.2s ease-in-out !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
          `,s.addEventListener("mouseenter",()=>{s.style.backgroundColor="#0ea5e9",s.style.transform="scale(1.1)"}),s.addEventListener("mouseleave",()=>{s.style.backgroundColor="#19B5DD",s.style.transform="scale(1)"}),s.setAttribute("data-footnote",o),s.setAttribute("data-surah",a),s.setAttribute("data-ayah",t),s.setAttribute("title",`Click to view explanation ${o}`),s.className="hindi-footnote-link",s.innerHTML=o)}}),e.innerHTML}async isAvailable(){try{return this._assertApiEnabled(),await l.checkLanguageHealth(this.language),!0}catch(n){return console.error("❌ Hindi service not available:",n),!1}}clearCache(){this.cache.clear(),this.pendingRequests.clear()}destroy(){this.clearCache()}getCacheStats(){return{cacheSize:this.cache.size,pendingRequests:this.pendingRequests.size,cacheEnabled:this.cacheEnabled,cacheTtl:this.cacheTtl,mode:"API-only"}}}const y=new g;export{y as default};
