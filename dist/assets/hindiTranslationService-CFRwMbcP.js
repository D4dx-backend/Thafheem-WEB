import{ag as q}from"./index-D0NMIq43.js";import{a as u}from"./apiService-Be4cmTqe.js";import"./react-vendor-v5ei6ytj.js";const I=40,C=200;class T{constructor(){this.language="hindi",this.apiBasePath=q,this.pendingRequests=new Map,this.cache=new Map,this.cacheEnabled=!0,this.cacheTtl=3e5}generateCacheKey(a,n){const e=Object.keys(n).sort().map(t=>`${t}=${n[t]}`).join("&");return`${a}${e?`?${e}`:""}`}isCacheValid(a){return Date.now()-a<this.cacheTtl}getCachedData(a){if(!this.cacheEnabled)return null;const n=this.cache.get(a);return n&&this.isCacheValid(n.timestamp)?n.data:(n&&this.cache.delete(a),null)}setCachedData(a,n){this.cacheEnabled&&this.cache.set(a,{data:n,timestamp:Date.now()})}async getAyahTranslation(a,n){const e=this.generateCacheKey("getAyahTranslation",{surahNo:a,ayahNo:n}),t=this.getCachedData(e);if(t)return t;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const s=this._getAyahTranslationInternal(a,n,e);this.pendingRequests.set(e,s);try{return await s}finally{this.pendingRequests.delete(e)}}async _getAyahTranslationInternal(a,n,e){try{const t=await u.getTranslation(this.language,a,n),s=t?.translation_text??t?.translation??"";return this.setCachedData(e,s),s}catch(t){throw console.error(`❌ Hindi translation API failed for ${a}:${n}:`,t),t}}async getSurahTranslations(a,n={}){const e=n&&(n.page!==void 0||n.limit!==void 0),t=Number.isInteger(n.page)&&n.page>0?n.page:1,s=Number.isInteger(n.limit)&&n.limit>0?n.limit:I,o=Math.min(s,C),i=this.generateCacheKey("getSurahTranslations",e?{surahNo:a,page:t,limit:o}:{surahNo:a}),c=this.getCachedData(i);if(c)return c;if(this.pendingRequests.has(i))return this.pendingRequests.get(i);const g=this._getSurahTranslationsInternal(a,i,{page:t,limit:o,hasPagination:e});this.pendingRequests.set(i,g);try{return await g}finally{this.pendingRequests.delete(i)}}async _getSurahTranslationsInternal(a,n,{page:e,limit:t,hasPagination:s}){try{const o=s?{page:e,limit:t}:{},i=await u.getSurahTranslations(this.language,a,o),c=Array.isArray(i?.translations)?i.translations.map(l=>({number:l.verse_number,ArabicText:"",Translation:l.translation_text??""})):[];if(c.forEach(l=>{const h=this.generateCacheKey("getAyahTranslation",{surahNo:a,ayahNo:l.number});l.Translation&&this.setCachedData(h,l.Translation)}),!s)return this.setCachedData(n,c),c;const g=i?.pagination?{page:i.pagination.page??e,limit:i.pagination.limit??t,totalItems:i.pagination.totalItems??i.pagination.total??null,totalPages:i.pagination.totalPages??null,hasNext:i.pagination.hasNext??!1,hasPrev:i.pagination.hasPrev??e>1,from:i.pagination.from??null,to:i.pagination.to??null}:{page:e,limit:t,totalItems:i?.count??null,totalPages:i?.count?Math.ceil(i.count/t):null,hasNext:c.length===t,hasPrev:e>1,from:c[0]?.number??null,to:c[c.length-1]?.number??null},r={translations:c,pagination:g};return this.setCachedData(n,r),r}catch(o){throw console.error(`❌ Hindi surah translation API failed for ${a}:`,o),o}}async getWordByWordData(a,n){const e=this.generateCacheKey("getWordByWordData",{surahNo:a,ayahNo:n}),t=this.getCachedData(e);if(t)return t;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const s=this._getWordByWordDataInternal(a,n,e);this.pendingRequests.set(e,s);try{return await s}finally{this.pendingRequests.delete(e)}}async _getWordByWordDataInternal(a,n,e){try{const t=await u.getWordByWord(this.language,a,n),s=Array.isArray(t?.words)?t.words:[];if(s.length===0)return console.warn(`⚠️ No Hindi word-by-word data for ${a}:${n}`),[];const o=s.map((i,c)=>({id:i.id??i.WordId??i.word_id??c+1,position:i.position??i.WordId??i.word_id??c+1,audio_url:i.audio_url??null,char_type_name:i.char_type_name??"word",code_v1:i.code_v1??"",code_v2:i.code_v2??"",line_number:i.line_number??1,page_number:i.page_number??1,text_uthmani:i.text_uthmani??"",text_simple:i.text_simple??"",translation:{text:i.translation?.text??i.WordMeaning??"",language_name:i.translation?.language_name??"Hindi",resource_name:i.translation?.resource_name??"Thafheem Hindi Word Database"},transliteration:{text:i.transliteration?.text??i.WordPhrase??"",language_name:i.transliteration?.language_name??"Hindi"}}));return this.setCachedData(e,o),o}catch(t){throw console.error(`❌ Hindi word-by-word API failed for ${a}:${n}:`,t),t}}async getExplanation(a,n){const e=this.generateCacheKey("getExplanation",{surahNo:a,ayahNo:n}),t=this.getCachedData(e);if(t)return t;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const s=this._getExplanationInternal(a,n,e);this.pendingRequests.set(e,s);try{return await s}finally{this.pendingRequests.delete(e)}}async _getExplanationInternal(a,n,e){try{const s=(await u.getInterpretation(this.language,a,n))?.explanations?.[0]?.explanation??null;return s?(this.setCachedData(e,s),s):(console.warn(`⚠️ No Hindi explanation found for ${a}:${n}`),null)}catch(t){throw console.error(`❌ Hindi explanation API failed for ${a}:${n}:`,t),t}}async getAllExplanations(a,n){const e=this.generateCacheKey("getAllExplanations",{surahNo:a,ayahNo:n}),t=this.getCachedData(e);if(t)return t;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const s=this._getAllExplanationsInternal(a,n,e);this.pendingRequests.set(e,s);try{return await s}finally{this.pendingRequests.delete(e)}}async _getAllExplanationsInternal(a,n,e){try{const t=await u.getInterpretation(this.language,a,n),s=Array.isArray(t?.explanations)?t.explanations.map(o=>({explanation:o.explanation,explanation_no_local:o.explanation_no_local??null,explanation_no_en:o.explanation_no_en??null})):[];return this.setCachedData(e,s),s}catch(t){throw console.error(`❌ Hindi explanations API failed for ${a}:${n}:`,t),t}}async getExplanationByNumber(a,n,e){const t=this.generateCacheKey("getExplanationByNumber",{surahNo:a,ayahNo:n,explanationNumber:e}),s=this.getCachedData(t);if(s)return s;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const o=this._getExplanationByNumberInternal(a,n,e,t);this.pendingRequests.set(t,o);try{return await o}finally{this.pendingRequests.delete(t)}}async _getExplanationByNumberInternal(a,n,e,t){try{const o=(await u.getInterpretation(this.language,a,n,e))?.explanations?.find(i=>i.explanation_no_local==e||i.explanation_no_en==e);return o?.explanation?(this.setCachedData(t,o.explanation),o.explanation):(console.warn(`⚠️ No Hindi explanation found for ${a}:${n} number ${e}`),null)}catch(s){throw console.error(`❌ Hindi explanation API failed for ${a}:${n} number ${e}:`,s),s}}parseHindiTranslationWithClickableExplanations(a,n,e){if(!a)return"";let t=String(a);const s=document.createElement("div");s.innerHTML=t,s.querySelectorAll("sup.f-note").forEach(r=>{const l=r.querySelector("a");if(l){const h=l.textContent.trim();/^[\d१२३४५६७८९०]+[aAbB]?$/.test(h)&&(r.style.cssText=`
            cursor: pointer !important;
            background-color: transparent !important;
            color: rgb(41,169,199) !important;
            font-weight: 600 !important;
            text-decoration: none !important;
            border: none !important;
            display: inline !important;
            font-size: 12px !important;
            vertical-align: super !important;
            line-height: 1 !important;
            position: relative !important;
            top: 3px !important;
            transition: all 0.2s ease-in-out !important;
          `,r.addEventListener("mouseenter",()=>{r.style.color="#0891b2"}),r.addEventListener("mouseleave",()=>{r.style.color="rgb(41,169,199)"}),r.setAttribute("data-footnote",h),r.setAttribute("data-surah",n),r.setAttribute("data-ayah",e),r.setAttribute("title",`Click to view explanation ${h}`),r.className="hindi-footnote-link",r.innerHTML=h)}}),t=s.innerHTML;const i=/(\d{1,3}[aAbB])/g,c=[];let g;for(;(g=i.exec(t))!==null;){const r=g[1],l=g.index,h=r.match(/^(\d{1,3})/);if(!h)continue;const d=parseInt(h[1],10);if(!(d>=1&&d<=342))continue;const p=t.substring(0,l),m=p.lastIndexOf("<"),f=p.lastIndexOf(">");if(m>f)continue;const _=Math.max(0,l-200),y=t.substring(_,l),b=y.lastIndexOf("<sup"),A=y.lastIndexOf("</sup>");if(b>A)continue;const x=t.substring(l,l+r.length+50);x.includes("hindi-footnote-link")||x.includes("data-footnote")||c.push({index:l,token:r,length:r.length})}for(let r=c.length-1;r>=0;r--){const{index:l,token:h,length:d}=c[r],p=t.substring(0,l),m=t.substring(l+d),f=`<sup class="hindi-footnote-link" data-footnote="${h}" data-surah="${n}" data-ayah="${e}" title="Click to view explanation ${h}" style="cursor:pointer!important;background-color:transparent!important;color:rgb(41,169,199)!important;font-weight:600!important;text-decoration:none!important;border:none!important;display:inline!important;font-size:12px!important;vertical-align:super!important;line-height:1!important;position:relative!important;top:3px!important;z-index:10!important;transition:0.2s ease-in-out!important;">${h}</sup>`;t=p+f+m}return t}async isAvailable(){try{return await u.checkLanguageHealth(this.language),!0}catch(a){return console.error("❌ Hindi service not available:",a),!1}}clearCache(){this.cache.clear(),this.pendingRequests.clear()}destroy(){this.clearCache()}getCacheStats(){return{cacheSize:this.cache.size,pendingRequests:this.pendingRequests.size,cacheEnabled:this.cacheEnabled,cacheTtl:this.cacheTtl,mode:"API-only"}}}const D=new T;export{D as default};
