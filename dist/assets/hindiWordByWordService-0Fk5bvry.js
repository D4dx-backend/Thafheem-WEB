class h{constructor(){this.dbPath="/quran_hindi.db".replace(/\/+/g,"/"),this.dbPromise=null,this.isDownloaded=!1}async initDB(){return this.dbPromise?this.dbPromise:(this.dbPromise=(async()=>{try{await new Promise(a=>{const o=()=>{window.initSqlJs?a():setTimeout(o,100)};o()});const e=await window.initSqlJs({locateFile:a=>`https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${a}`});let t,n=this.dbPath;if(t=await fetch(n),!t.ok){const a="/quran_hindi.db";if(n!==a){if(console.warn(`⚠️ Failed to fetch from ${n} (${t.status}), trying root path: ${a}`),n=a,t=await fetch(a),!t.ok)throw console.error(`❌ Failed to fetch Hindi word-by-word DB from ${a}: ${t.status} ${t.statusText}`),new Error(`Failed to fetch database: ${t.status} ${t.statusText}`)}else throw console.error(`❌ Failed to fetch Hindi word-by-word DB from ${n}: ${t.status} ${t.statusText}`),new Error(`Failed to fetch database: ${t.status} ${t.statusText}`)}const l=await t.arrayBuffer(),i=new e.Database(new Uint8Array(l)),r=i.exec("SELECT name FROM sqlite_master WHERE type='table'"),u=i.exec("SELECT COUNT(*) as count FROM hindi_wordmeanings")[0]?.values[0]?.[0]||0;return this.isDownloaded=!0,i}catch(e){throw console.error("❌ Failed to load Hindi database:",e),new Error(`Failed to load Hindi translation database: ${e.message}`)}})(),this.dbPromise)}isHindiWord(e){return e?/[\u0900-\u097F]/.test(e):!1}isEnglishWord(e){if(!e)return!1;const t=e.replace(/[()[\]{}.,;:!?'"]/g,"").trim();return/^[a-zA-Z\s]+$/.test(t)&&t.length>0}async getWordByWordData(e,t){try{const n=await this.initDB(),l=n.prepare(`
        SELECT WordId, WordPhrase, WordMeaning 
        FROM hindi_wordmeanings 
        WHERE SuraId = ? AND AyaId = ?
        ORDER BY WordId ASC
      `);l.bind([e,t]);const i=[];let r=0;for(;l.step();){const a=l.getAsObject(),o=a.WordMeaning||"";this.isHindiWord(o)?(i.push({id:a.WordId||r+1,position:r+1,audio_url:null,char_type_name:"word",code_v1:"",code_v2:"",line_number:1,page_number:1,text_uthmani:a.WordPhrase||"",text_simple:a.WordPhrase||"",translation:{text:o,language_name:"Hindi",resource_name:"Local Hindi Database"},transliteration:{text:"",language_name:"English"}}),r+=1):this.isEnglishWord(o)?(i.push({id:a.WordId||r+1,position:r+1,audio_url:null,char_type_name:"word",code_v1:"",code_v2:"",line_number:1,page_number:1,text_uthmani:a.WordPhrase||"",text_simple:a.WordPhrase||"",translation:{text:o,language_name:"English (Hindi not available)",resource_name:"Local Hindi Database (English fallback)"},transliteration:{text:"",language_name:"English"}}),r+=1):(i.push({id:a.WordId||r+1,position:r+1,audio_url:null,char_type_name:"word",code_v1:"",code_v2:"",line_number:1,page_number:1,text_uthmani:a.WordPhrase||"",text_simple:a.WordPhrase||"",translation:{text:o||"Translation not available",language_name:"Mixed",resource_name:"Local Hindi Database"},transliteration:{text:"",language_name:"English"}}),r+=1)}if(l.free(),i.length>0){const a={text_uthmani:i.map(s=>s.text_uthmani).join(" "),words:i,translations:[{text:i.map(s=>s.translation.text).join(" "),language_name:"Hindi",resource_name:"Local Hindi Database"}]},o=i.filter(s=>s.translation.language_name==="Hindi").length,c=i.filter(s=>s.translation.language_name==="English (Hindi not available)").length;return a}console.warn(`⚠️ No Hindi word meanings found for ${e}:${t}`);const d=n.prepare(`
        SELECT COUNT(*) as count 
        FROM hindi_wordmeanings 
        WHERE SuraId = ?
      `),u=d.getAsObject([e]);return d.free(),null}catch(n){throw console.error(`❌ Error fetching Hindi word-by-word data for ${e}:${t}:`,n),n}}async getWordByWordDataWithArabic(e,t){try{const n=await this.getWordByWordData(e,t);if(!n)return console.warn(`⚠️ No Hindi data found for ${e}:${t}, falling back to English`),await this.getEnglishFallback(e,t);const i=`https://api.quran.com/api/v4/verses/by_key/${`${e}:${t}`}?words=true&word_fields=verse_key,word_number,location,text_uthmani,text_simple,class_name,line_number,page_number,code_v1,qpc_uthmani_hafs`;try{const r=await fetch(i);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const d=await r.json();if(d.verse&&d.verse.words){const u=d.verse.words.map((a,o)=>{let c=n.words[o];return(!c||c.text_uthmani&&c.text_uthmani!==a.text_uthmani)&&(c=n.words.find(s=>s.text_uthmani===a.text_uthmani||s.text_simple===a.text_simple)),{...a,translation:c?c.translation:{text:"Translation not available",language_name:"Hindi",resource_name:"Local Hindi Database"}}});return{...d.verse,words:u,translations:n.translations}}}catch(r){return console.warn("Failed to fetch Arabic words from API, using Hindi-only data:",r),n}return n}catch(n){return console.error(`❌ Error fetching combined Hindi word-by-word data for ${e}:${t}:`,n),console.warn(`⚠️ Error with Hindi data, falling back to English for ${e}:${t}`),await this.getEnglishFallback(e,t)}}async getEnglishFallback(e,t){try{const l=`https://api.quran.com/api/v4/verses/by_key/${`${e}:${t}`}?words=true&word_fields=verse_key,word_number,location,text_uthmani,text_simple,class_name,line_number,page_number,code_v1,qpc_uthmani_hafs,translation&translation_fields=resource_name,language_name&language=en&translations=131`,i=await fetch(l);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const r=await i.json();return r.verse?(r.verse.translations&&r.verse.translations.length>0&&(r.verse.translations[0].resource_name="English Fallback (Hindi not available)"),r.verse):null}catch(n){return console.error(`❌ Error fetching English fallback for ${e}:${t}:`,n),null}}async isAvailable(){try{return await this.initDB(),!0}catch(e){return console.warn("Hindi word-by-word service not available:",e.message),!1}}isDatabaseDownloaded(){return this.isDownloaded}}const m=new h;export{m as default};
