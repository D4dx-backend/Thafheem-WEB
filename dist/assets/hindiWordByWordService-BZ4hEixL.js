import{a as l}from"./apiService-E2C6IBEZ.js";import"./index-C60dBqWj.js";import"./react-vendor-v5ei6ytj.js";class _{constructor(){this.language="hindi",this.cache=new Map,this.cacheEnabled=!0,this.cacheTtl=3e5,this.pendingRequests=new Map}generateCacheKey(t,n){return`hindi_word_${t}_${n}`}isCacheValid(t){return Date.now()-t<this.cacheTtl}getCachedData(t){if(!this.cacheEnabled)return null;const n=this.cache.get(t);return n&&this.isCacheValid(n.timestamp)?n.data:(n&&this.cache.delete(t),null)}setCachedData(t,n){this.cacheEnabled&&this.cache.set(t,{data:n,timestamp:Date.now()})}isHindiWord(t){return t?/[\u0900-\u097F]/.test(t):!1}isEnglishWord(t){if(!t)return!1;const n=t.replace(/[()[\]{}.,;:!?'"]/g,"").trim();return/^[a-zA-Z\s]+$/.test(n)&&n.length>0}async getWordByWordData(t,n){const e=this.generateCacheKey(t,n),r=this.getCachedData(e);if(r)return r;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const a=this._getWordByWordDataInternal(t,n,e);this.pendingRequests.set(e,a);try{return await a}finally{this.pendingRequests.delete(e)}}async _getWordByWordDataInternal(t,n,e){try{const r=await l.getWordByWord(this.language,t,n),a=Array.isArray(r?.words)?r.words:[];if(a.length===0)return console.warn(`⚠️ No Hindi word-by-word data for ${t}:${n}`),null;const s=a.map((i,h)=>{const o=i.WordMeaning||i.translation?.text||"",d=this.isHindiWord(o),u=this.isEnglishWord(o);return{id:i.WordId||i.id||h+1,position:i.WordId||i.id||h+1,audio_url:i.audio_url||null,char_type_name:i.char_type_name||"word",code_v1:i.code_v1||"",code_v2:i.code_v2||"",line_number:i.line_number||1,page_number:i.page_number||1,text_uthmani:i.text_uthmani||i.WordPhrase||"",text_simple:i.text_simple||i.WordPhrase||"",translation:{text:o,language_name:d?"Hindi":u?"English (Hindi not available)":"Hindi",resource_name:d?"Local Hindi Database":u?"Local Hindi Database (English fallback)":"Local Hindi Database"},transliteration:{text:i.transliteration?.text||i.WordPhrase||"",language_name:i.transliteration?.language_name||"English"}}}),g=s.map(i=>i.text_uthmani||i.WordPhrase||"").filter(Boolean).join(" "),c={text_uthmani:r?.text_uthmani||g,words:s,translations:r?.translations||[]};return this.setCachedData(e,c),c}catch(r){throw console.error(`❌ Error fetching Hindi word-by-word data for ${t}:${n}:`,r),r}}async getWordByWordDataWithArabic(t,n){try{const e=await this.getWordByWordData(t,n);if(!e)return console.warn(`⚠️ No Hindi data found for ${t}:${n}, falling back to English`),await this.getEnglishFallback(t,n);try{const r=await l.getArabicText(t,n);return{...e,text_uthmani:r.text_uthmani||e.text_uthmani||"",text_simple:r.text_simple||e.text_simple||""}}catch{if(console.warn("⚠️ Could not fetch Arabic text, using Hindi data only"),e.words&&e.words.length>0){const a=e.words.map(s=>s.text_uthmani||s.WordPhrase||"").filter(Boolean).join(" ");return{...e,text_uthmani:e.text_uthmani||a,text_simple:e.text_simple||a}}}return e}catch(e){throw console.error(`❌ Error fetching Hindi word-by-word with Arabic for ${t}:${n}:`,e),e}}async getEnglishFallback(t,n){try{const e=await l.getWordByWord("english",t,n),r=Array.isArray(e?.words)?e.words:[];return{text_uthmani:e?.text_uthmani||"",words:r.map((a,s)=>({id:a.WordId||s+1,position:a.WordId||s+1,audio_url:a.audio_url||null,char_type_name:a.char_type_name||"word",code_v1:a.code_v1||"",code_v2:a.code_v2||"",line_number:a.line_number||1,page_number:a.page_number||1,text_uthmani:a.text_uthmani||"",text_simple:a.text_simple||"",translation:{text:a.EngMeaning||a.translation?.text||"",language_name:"English (Hindi not available)",resource_name:"English Fallback"},transliteration:{text:a.transliteration?.text||"",language_name:"English"}})),translations:e?.translations||[]}}catch(e){return console.error(`❌ Error fetching English fallback for ${t}:${n}:`,e),null}}clearCache(){this.cache.clear(),this.pendingRequests.clear()}}const f=new _;export{f as default};
