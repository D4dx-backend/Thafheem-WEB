import{aj as g,ak as d}from"./index-D2bCerlO.js";import{a as h}from"./apiService-CutSZesJ.js";const u=25;class y{constructor(){this.language="tamil",this.useApi=g!==!1,this.apiBasePath=d,this.pendingRequests=new Map}_assertApiEnabled(){if(!this.useApi)throw new Error("Tamil API is disabled (VITE_USE_API=false).")}generateCacheKey(e,t){const a=Object.keys(t).sort().map(s=>`${s}=${t[s]}`).join("&");return`${e}${a?`?${a}`:""}`}isCacheValid(e){return Date.now()-e<this.cacheTtl}getCachedData(e){if(!this.cacheEnabled)return null;const t=this.cache.get(e);return t&&this.isCacheValid(t.timestamp)?t.data:(t&&this.cache.delete(e),null)}setCachedData(e,t){this.cacheEnabled&&this.cache.set(e,{data:t,timestamp:Date.now()})}async getAyahTranslation(e,t){const a=this.generateCacheKey("getAyahTranslation",{surahNo:e,ayahNo:t}),s=this.getCachedData(a);if(s)return s;if(this.pendingRequests.has(a))return this.pendingRequests.get(a);const n=this._getAyahTranslationInternal(e,t,a);this.pendingRequests.set(a,n);try{return await n}finally{this.pendingRequests.delete(a)}}async _getAyahTranslationInternal(e,t,a){this._assertApiEnabled();try{const s=await h.getTranslation(this.language,e,t),n=s?.translation_text??s?.translation??"";return this.setCachedData(a,n),n}catch(s){throw console.error(`❌ Tamil translation API failed for ${e}:${t}:`,s),s}}async getSurahTranslations(e,t={}){const a=Number.isInteger(t.page)&&t.page>0?t.page:1,s=Number.isInteger(t.limit)&&t.limit>0?t.limit:u,n=this.generateCacheKey("getSurahTranslations",{surahNo:e,page:a,limit:s}),r=this.getCachedData(n);if(r)return r;if(this.pendingRequests.has(n))return this.pendingRequests.get(n);const c=this._getSurahTranslationsInternal(e,n,{page:a,limit:s});this.pendingRequests.set(n,c);try{return await c}finally{this.pendingRequests.delete(n)}}async _getSurahTranslationsInternal(e,t,{page:a,limit:s}){this._assertApiEnabled();try{const n=await h.getSurahTranslations(this.language,e,{page:a,limit:s}),r=Array.isArray(n?.translations)?n.translations.map(l=>({number:l.verse_number,ArabicText:"",Translation:l.translation_text??"",RawTranslation:l.translation_text??""})):[],c=n?.pagination||null;r.forEach(l=>{const o=this.generateCacheKey("getAyahTranslation",{surahNo:e,ayahNo:l.number});l.Translation&&this.setCachedData(o,l.Translation)});const i={translations:r,pagination:c||{page:a,limit:s,totalItems:r.length,totalPages:r.length>0?Math.ceil(r.length/s):0,hasNext:!1,hasPrev:a>1}};return this.setCachedData(t,i),i}catch(n){throw console.error(`❌ Tamil surah translation API failed for ${e}:`,n),n}}async getWordByWordData(e,t){const a=this.generateCacheKey("getWordByWordData",{surahNo:e,ayahNo:t}),s=this.getCachedData(a);if(s)return s;if(this.pendingRequests.has(a))return this.pendingRequests.get(a);const n=this._getWordByWordDataInternal(e,t,a);this.pendingRequests.set(a,n);try{return await n}finally{this.pendingRequests.delete(a)}}async _getWordByWordDataInternal(e,t,a){this._assertApiEnabled();try{const s=await h.getWordByWord(this.language,e,t),n=Array.isArray(s?.words)?s.words:[];return this.setCachedData(a,n),n}catch(s){throw console.error(`❌ Tamil word-by-word API failed for ${e}:${t}:`,s),s}}async fetchBlockwiseTamil(e,t,a){const s=this.generateCacheKey("fetchBlockwiseTamil",{surahNo:e,startAyah:t,endAyah:a}),n=this.getCachedData(s);if(n)return n;const r=[];for(let i=t;i<=a;i++)r.push(i);const c=await Promise.all(r.map(async i=>({ayah:i,translation:await this.getAyahTranslation(e,i)})));return this.setCachedData(s,c),c}async getExplanation(){return"N/A"}async getAllExplanations(){return[]}async getExplanationByNumber(){return"N/A"}async isAvailable(){try{return this._assertApiEnabled(),await h.checkLanguageHealth(this.language),!0}catch(e){return console.error("❌ Tamil service not available:",e),!1}}hasInterpretations(){return!1}isDatabaseDownloaded(){return!0}async downloadDatabase(){return!0}clearCache(){this.cache.clear(),this.pendingRequests.clear()}destroy(){this.clearCache()}getCacheStats(){return{cacheSize:this.cache.size,pendingRequests:this.pendingRequests.size,cacheEnabled:this.cacheEnabled,cacheTtl:this.cacheTtl,mode:"API-only"}}}const T=new y;export{T as default};
