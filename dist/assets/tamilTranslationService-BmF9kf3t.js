import{A as g}from"./index-ZyCXWqTv.js";import{a as l}from"./apiService-C16t1Qxd.js";import"./react-vendor-v5ei6ytj.js";const u=25;class d{constructor(){this.language="tamil",this.apiBasePath=g,this.pendingRequests=new Map,this.cache=new Map,this.cacheEnabled=!0,this.cacheTtl=3e5}generateCacheKey(e,t){const a=Object.keys(t).sort().map(n=>`${n}=${t[n]}`).join("&");return`${e}${a?`?${a}`:""}`}isCacheValid(e){return Date.now()-e<this.cacheTtl}getCachedData(e){if(!this.cacheEnabled)return null;const t=this.cache.get(e);return t&&this.isCacheValid(t.timestamp)?t.data:(t&&this.cache.delete(e),null)}setCachedData(e,t){this.cacheEnabled&&this.cache.set(e,{data:t,timestamp:Date.now()})}async getAyahTranslation(e,t){const a=this.generateCacheKey("getAyahTranslation",{surahNo:e,ayahNo:t}),n=this.getCachedData(a);if(n)return n;if(this.pendingRequests.has(a))return this.pendingRequests.get(a);const s=this._getAyahTranslationInternal(e,t,a);this.pendingRequests.set(a,s);try{return await s}finally{this.pendingRequests.delete(a)}}async _getAyahTranslationInternal(e,t,a){try{const n=await l.getTranslation(this.language,e,t),s=n?.translation_text??n?.translation??"";return this.setCachedData(a,s),s}catch(n){throw console.error(`❌ Tamil translation API failed for ${e}:${t}:`,n),n}}async getSurahTranslations(e,t={}){const a=Number.isInteger(t.page)&&t.page>0?t.page:1,n=Number.isInteger(t.limit)&&t.limit>0?t.limit:u,s=this.generateCacheKey("getSurahTranslations",{surahNo:e,page:a,limit:n}),r=this.getCachedData(s);if(r)return r;if(this.pendingRequests.has(s))return this.pendingRequests.get(s);const c=this._getSurahTranslationsInternal(e,s,{page:a,limit:n});this.pendingRequests.set(s,c);try{return await c}finally{this.pendingRequests.delete(s)}}async _getSurahTranslationsInternal(e,t,{page:a,limit:n}){try{const s=await l.getSurahTranslations(this.language,e,{page:a,limit:n}),r=Array.isArray(s?.translations)?s.translations.map(h=>({number:h.verse_number,ArabicText:"",Translation:h.translation_text??"",RawTranslation:h.translation_text??""})):[],c=s?.pagination||null;r.forEach(h=>{const o=this.generateCacheKey("getAyahTranslation",{surahNo:e,ayahNo:h.number});h.Translation&&this.setCachedData(o,h.Translation)});const i={translations:r,pagination:c||{page:a,limit:n,totalItems:r.length,totalPages:r.length>0?Math.ceil(r.length/n):0,hasNext:!1,hasPrev:a>1}};return this.setCachedData(t,i),i}catch(s){throw console.error(`❌ Tamil surah translation API failed for ${e}:`,s),s}}async getWordByWordData(e,t){const a=this.generateCacheKey("getWordByWordData",{surahNo:e,ayahNo:t}),n=this.getCachedData(a);if(n)return n;if(this.pendingRequests.has(a))return this.pendingRequests.get(a);const s=this._getWordByWordDataInternal(e,t,a);this.pendingRequests.set(a,s);try{return await s}finally{this.pendingRequests.delete(a)}}async _getWordByWordDataInternal(e,t,a){try{const n=await l.getWordByWord(this.language,e,t),s=Array.isArray(n?.words)?n.words:[];return this.setCachedData(a,s),s}catch(n){throw console.error(`❌ Tamil word-by-word API failed for ${e}:${t}:`,n),n}}async fetchBlockwiseTamil(e,t,a){const n=this.generateCacheKey("fetchBlockwiseTamil",{surahNo:e,startAyah:t,endAyah:a}),s=this.getCachedData(n);if(s)return s;const r=[];for(let i=t;i<=a;i++)r.push(i);const c=await Promise.all(r.map(async i=>({ayah:i,translation:await this.getAyahTranslation(e,i)})));return this.setCachedData(n,c),c}async getExplanation(){return"N/A"}async getAllExplanations(){return[]}async getExplanationByNumber(){return"N/A"}async isAvailable(){try{return await l.checkLanguageHealth(this.language),!0}catch(e){return console.error("❌ Tamil service not available:",e),!1}}hasInterpretations(){return!1}isDatabaseDownloaded(){return!0}async downloadDatabase(){return!0}clearCache(){this.cache.clear(),this.pendingRequests.clear()}destroy(){this.clearCache()}getCacheStats(){return{cacheSize:this.cache.size,pendingRequests:this.pendingRequests.size,cacheEnabled:this.cacheEnabled,cacheTtl:this.cacheTtl,mode:"API-only"}}}const f=new d;export{f as default};
