import{ah as l,ai as o,aj as d,ak as u}from"./index-DJ-cZXxg.js";import{a as c}from"./apiService-D9UdsyGX.js";class g{constructor(){this.language="tamil",this.useApi=l!==!1,this.apiBasePath=o,this.cacheEnabled=d,this.cacheTtl=u,this.cache=new Map,this.pendingRequests=new Map}_assertApiEnabled(){if(!this.useApi)throw new Error("Tamil API is disabled (VITE_USE_API=false).")}generateCacheKey(t,e){const a=Object.keys(e).sort().map(s=>`${s}=${e[s]}`).join("&");return`${t}${a?`?${a}`:""}`}isCacheValid(t){return Date.now()-t<this.cacheTtl}getCachedData(t){if(!this.cacheEnabled)return null;const e=this.cache.get(t);return e&&this.isCacheValid(e.timestamp)?e.data:(e&&this.cache.delete(t),null)}setCachedData(t,e){this.cacheEnabled&&this.cache.set(t,{data:e,timestamp:Date.now()})}async getAyahTranslation(t,e){const a=this.generateCacheKey("getAyahTranslation",{surahNo:t,ayahNo:e}),s=this.getCachedData(a);if(s)return s;if(this.pendingRequests.has(a))return this.pendingRequests.get(a);const n=this._getAyahTranslationInternal(t,e,a);this.pendingRequests.set(a,n);try{return await n}finally{this.pendingRequests.delete(a)}}async _getAyahTranslationInternal(t,e,a){this._assertApiEnabled();try{const s=await c.getTranslation(this.language,t,e),n=s?.translation_text??s?.translation??"";return this.setCachedData(a,n),n}catch(s){throw console.error(`❌ Tamil translation API failed for ${t}:${e}:`,s),s}}async getSurahTranslations(t){const e=this.generateCacheKey("getSurahTranslations",{surahNo:t}),a=this.getCachedData(e);if(a)return a;if(this.pendingRequests.has(e))return this.pendingRequests.get(e);const s=this._getSurahTranslationsInternal(t,e);this.pendingRequests.set(e,s);try{return await s}finally{this.pendingRequests.delete(e)}}async _getSurahTranslationsInternal(t,e){this._assertApiEnabled();try{const a=await c.getSurahTranslations(this.language,t),s=Array.isArray(a?.translations)?a.translations.map(n=>({number:n.verse_number,ArabicText:"",Translation:n.translation_text??""})):[];return s.forEach(n=>{const i=this.generateCacheKey("getAyahTranslation",{surahNo:t,ayahNo:n.number});n.Translation&&this.setCachedData(i,n.Translation)}),this.setCachedData(e,s),s}catch(a){throw console.error(`❌ Tamil surah translation API failed for ${t}:`,a),a}}async getWordByWordData(t,e){const a=this.generateCacheKey("getWordByWordData",{surahNo:t,ayahNo:e}),s=this.getCachedData(a);if(s)return s;if(this.pendingRequests.has(a))return this.pendingRequests.get(a);const n=this._getWordByWordDataInternal(t,e,a);this.pendingRequests.set(a,n);try{return await n}finally{this.pendingRequests.delete(a)}}async _getWordByWordDataInternal(t,e,a){this._assertApiEnabled();try{const s=await c.getWordByWord(this.language,t,e),n=Array.isArray(s?.words)?s.words:[];return this.setCachedData(a,n),n}catch(s){throw console.error(`❌ Tamil word-by-word API failed for ${t}:${e}:`,s),s}}async fetchBlockwiseTamil(t,e,a){const s=this.generateCacheKey("fetchBlockwiseTamil",{surahNo:t,startAyah:e,endAyah:a}),n=this.getCachedData(s);if(n)return n;const i=[];for(let r=e;r<=a;r++)i.push(r);const h=await Promise.all(i.map(async r=>({ayah:r,translation:await this.getAyahTranslation(t,r)})));return this.setCachedData(s,h),h}async getExplanation(){return"N/A"}async getAllExplanations(){return[]}async getExplanationByNumber(){return"N/A"}async isAvailable(){try{return this._assertApiEnabled(),await c.checkLanguageHealth(this.language),!0}catch(t){return console.error("❌ Tamil service not available:",t),!1}}hasInterpretations(){return!1}isDatabaseDownloaded(){return!0}async downloadDatabase(){return!0}clearCache(){this.cache.clear(),this.pendingRequests.clear()}destroy(){this.clearCache()}getCacheStats(){return{cacheSize:this.cache.size,pendingRequests:this.pendingRequests.size,cacheEnabled:this.cacheEnabled,cacheTtl:this.cacheTtl,mode:"API-only"}}}const f=new g;export{f as default};
