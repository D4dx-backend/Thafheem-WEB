import{a as o}from"./apiService-BiExnp6s.js";import"./index-CYmUdfUH.js";import"./react-vendor-v5ei6ytj.js";class m{constructor(){this.language="tamil",this.cache=new Map,this.cacheEnabled=!0,this.cacheTtl=3e5,this.pendingRequests=new Map}generateCacheKey(e,a){return`tamil_word_${e}_${a}`}isCacheValid(e){return Date.now()-e<this.cacheTtl}getCachedData(e){if(!this.cacheEnabled)return null;const a=this.cache.get(e);return a&&this.isCacheValid(a.timestamp)?a.data:(a&&this.cache.delete(e),null)}setCachedData(e,a){this.cacheEnabled&&this.cache.set(e,{data:a,timestamp:Date.now()})}parseTamilTranslation(e){return e?e.split(/[\s,\.;:!?]+/).filter(t=>t.trim().length>0).map(t=>t.trim()):[]}async getWordByWordData(e,a){const t=this.generateCacheKey(e,a),i=this.getCachedData(t);if(i)return i;if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const n=this._getWordByWordDataInternal(e,a,t);this.pendingRequests.set(t,n);try{return await n}finally{this.pendingRequests.delete(t)}}async _getWordByWordDataInternal(e,a,t){try{const i=await o.getWordByWord(this.language,e,a),n=Array.isArray(i?.words)?i.words:[];if(n.length===0)return console.warn(`⚠️ No Tamil word-by-word data for ${e}:${a}`),null;const s=n.map((r,c)=>({id:r.WordId||r.id||c+1,position:r.WordId||r.id||c+1,audio_url:r.audio_url||null,char_type_name:r.char_type_name||"word",code_v1:r.code_v1||"",code_v2:r.code_v2||"",line_number:r.line_number||1,page_number:r.page_number||1,text_uthmani:r.text_uthmani||r.WordPhrase||"",text_simple:r.text_simple||r.WordPhrase||"",translation:{text:r.WordMeaning||r.translation?.text||"",language_name:"Tamil",resource_name:"Local Tamil Database"},transliteration:{text:r.transliteration?.text||r.WordPhrase||"",language_name:"English"}})),h=s.map(r=>r.text_uthmani||r.WordPhrase||"").filter(Boolean).join(" "),l={text_uthmani:i?.text_uthmani||h,words:s,translations:i?.translations||[]};return this.setCachedData(t,l),l}catch(i){throw console.error(`❌ Error fetching Tamil word-by-word data for ${e}:${a}:`,i),i}}async getWordByWordDataWithArabic(e,a){try{const t=await this.getWordByWordData(e,a);if(!t)return console.warn(`⚠️ No Tamil data found for ${e}:${a}, falling back to English`),await this.getEnglishFallback(e,a);try{const i=await o.getArabicText(e,a);return{...t,text_uthmani:i.text_uthmani||t.text_uthmani||"",text_simple:i.text_simple||t.text_simple||""}}catch{if(console.warn("⚠️ Could not fetch Arabic text, using Tamil data only"),t.words&&t.words.length>0){const n=t.words.map(s=>s.text_uthmani||s.WordPhrase||"").filter(Boolean).join(" ");return{...t,text_uthmani:t.text_uthmani||n,text_simple:t.text_simple||n}}}return t}catch(t){throw console.error(`❌ Error fetching Tamil word-by-word with Arabic for ${e}:${a}:`,t),t}}async getEnglishFallback(e,a){try{const t=await o.getWordByWord("english",e,a),i=Array.isArray(t?.words)?t.words:[];return{text_uthmani:t?.text_uthmani||"",words:i.map((n,s)=>({id:n.WordId||s+1,position:n.WordId||s+1,audio_url:n.audio_url||null,char_type_name:n.char_type_name||"word",code_v1:n.code_v1||"",code_v2:n.code_v2||"",line_number:n.line_number||1,page_number:n.page_number||1,text_uthmani:n.text_uthmani||"",text_simple:n.text_simple||"",translation:{text:n.EngMeaning||n.translation?.text||"",language_name:"English (Tamil not available)",resource_name:"English Fallback"},transliteration:{text:n.transliteration?.text||"",language_name:"English"}})),translations:t?.translations||[]}}catch(t){return console.error(`❌ Error fetching English fallback for ${e}:${a}:`,t),null}}clearCache(){this.cache.clear(),this.pendingRequests.clear()}}const p=new m;export{p as default};
