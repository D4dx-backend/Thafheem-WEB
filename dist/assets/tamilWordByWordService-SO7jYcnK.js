class m{constructor(){this.dbPath="/quran_tamil.db",this.dbPromise=null,this.isDownloaded=!1}async initDB(){return this.dbPromise?this.dbPromise:(this.dbPromise=(async()=>{try{await new Promise(i=>{const l=()=>{window.initSqlJs?i():setTimeout(l,100)};l()});const t=await window.initSqlJs({locateFile:i=>`https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${i}`}),a=await fetch(this.dbPath);if(!a.ok)throw new Error(`Failed to fetch database: ${a.status} ${a.statusText}`);const e=await a.arrayBuffer(),n=new t.Database(new Uint8Array(e)),s=n.exec("SELECT name FROM sqlite_master WHERE type='table'"),o=n.exec("SELECT COUNT(*) as count FROM tamil_translations")[0]?.values[0]?.[0]||0;return this.isDownloaded=!0,n}catch(t){throw console.error("❌ Failed to load Tamil database:",t),new Error(`Failed to load Tamil translation database: ${t.message}`)}})(),this.dbPromise)}parseTamilTranslation(t){return t?t.split(/[\s,\.;:!?]+/).filter(e=>e.trim().length>0).map(e=>e.trim()):[]}async getWordByWordData(t,a){try{const n=(await this.initDB()).prepare(`
        SELECT translation_text 
        FROM tamil_translations 
        WHERE chapter_number = ? AND verse_number = ?
      `),s=n.getAsObject([t,a]);if(n.free(),s&&s.translation_text){const r=s.translation_text;return{text_uthmani:"",words:this.parseTamilTranslation(r).map((l,c)=>({id:c+1,position:c+1,audio_url:null,char_type_name:"word",code_v1:"",code_v2:"",line_number:1,page_number:1,text_uthmani:"",text_simple:"",translation:{text:l,language_name:"Tamil",resource_name:"Local Tamil Database"},transliteration:{text:"",language_name:"English"}})),translations:[{text:r,language_name:"Tamil",resource_name:"Local Tamil Database"}]}}return console.warn(`⚠️ No Tamil translation found for ${t}:${a}`),null}catch(e){throw console.error(`❌ Error fetching Tamil word-by-word data for ${t}:${a}:`,e),e}}async getWordByWordDataWithArabic(t,a){try{const e=await this.getWordByWordData(t,a);if(!e)return console.warn(`⚠️ No Tamil data found for ${t}:${a}, falling back to English`),await this.getEnglishFallback(t,a);const s=`https://api.quran.com/api/v4/verses/by_key/${`${t}:${a}`}?words=true&word_fields=verse_key,word_number,location,text_uthmani,text_simple,class_name,line_number,page_number,code_v1,qpc_uthmani_hafs`;try{const r=await fetch(s);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const o=await r.json();if(o.verse&&o.verse.words){const i=o.verse.words.map((l,c)=>{const d=e.words[c];return{...l,translation:d?d.translation:{text:"Translation not available",language_name:"Tamil",resource_name:"Local Tamil Database"}}});return{...o.verse,words:i,translations:e.translations}}}catch(r){return console.warn("Failed to fetch Arabic words from API, using Tamil-only data:",r),e}return e}catch(e){return console.error(`❌ Error fetching combined Tamil word-by-word data for ${t}:${a}:`,e),console.warn(`⚠️ Error with Tamil data, falling back to English for ${t}:${a}`),await this.getEnglishFallback(t,a)}}async getEnglishFallback(t,a){try{const n=`https://api.quran.com/api/v4/verses/by_key/${`${t}:${a}`}?words=true&word_fields=verse_key,word_number,location,text_uthmani,text_simple,class_name,line_number,page_number,code_v1,qpc_uthmani_hafs,translation&translation_fields=resource_name,language_name&language=en&translations=131`,s=await fetch(n);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const r=await s.json();return r.verse?(r.verse.translations&&r.verse.translations.length>0&&(r.verse.translations[0].resource_name="English Fallback (Tamil not available)"),r.verse):null}catch(e){return console.error(`❌ Error fetching English fallback for ${t}:${a}:`,e),null}}async isAvailable(){try{return await this.initDB(),!0}catch(t){return console.warn("Tamil word-by-word service not available:",t.message),!1}}isDatabaseDownloaded(){return this.isDownloaded}}const u=new m;export{u as default};
